const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./raw-in9isEBO.js","./basedecoder-B2c5_Eok.js","./lzw-_aCqfs4w.js","./jpeg-JhJy4lL1.js","./deflate-Dthki0TA.js","./pako.esm-BkaqWuDM.js","./packbits-DDWKfGV_.js","./lerc-suXJbs2Z.js","./zstd-DD6JHAQz.js","./webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
var Mo=Object.defineProperty;var Ro=(s,e,n)=>e in s?Mo(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var k=(s,e,n)=>Ro(s,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function n(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(c){if(c.ep)return;c.ep=!0;const u=n(c);fetch(c.href,u)}})();function Po(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Xn={exports:{}};/*!
 * jQuery JavaScript Library v3.7.1
 * https://jquery.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2023-08-28T13:37Z
 */var Bo=Xn.exports,Di;function No(){return Di||(Di=1,function(s){(function(e,n){s.exports=e.document?n(e,!0):function(i){if(!i.document)throw new Error("jQuery requires a window with a document");return n(i)}})(typeof window<"u"?window:Bo,function(e,n){var i=[],c=Object.getPrototypeOf,u=i.slice,p=i.flat?function(t){return i.flat.call(t)}:function(t){return i.concat.apply([],t)},d=i.push,m=i.indexOf,y={},w=y.toString,T=y.hasOwnProperty,M=T.toString,E=M.call(Object),A={},R=function(r){return typeof r=="function"&&typeof r.nodeType!="number"&&typeof r.item!="function"},O=function(r){return r!=null&&r===r.window},v=e.document,j={type:!0,src:!0,nonce:!0,noModule:!0};function N(t,r,a){a=a||v;var l,f,h=a.createElement("script");if(h.text=t,r)for(l in j)f=r[l]||r.getAttribute&&r.getAttribute(l),f&&h.setAttribute(l,f);a.head.appendChild(h).parentNode.removeChild(h)}function _(t){return t==null?t+"":typeof t=="object"||typeof t=="function"?y[w.call(t)]||"object":typeof t}var L="3.7.1",H=/HTML$/i,o=function(t,r){return new o.fn.init(t,r)};o.fn=o.prototype={jquery:L,constructor:o,length:0,toArray:function(){return u.call(this)},get:function(t){return t==null?u.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var r=o.merge(this.constructor(),t);return r.prevObject=this,r},each:function(t){return o.each(this,t)},map:function(t){return this.pushStack(o.map(this,function(r,a){return t.call(r,a,r)}))},slice:function(){return this.pushStack(u.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(o.grep(this,function(t,r){return(r+1)%2}))},odd:function(){return this.pushStack(o.grep(this,function(t,r){return r%2}))},eq:function(t){var r=this.length,a=+t+(t<0?r:0);return this.pushStack(a>=0&&a<r?[this[a]]:[])},end:function(){return this.prevObject||this.constructor()},push:d,sort:i.sort,splice:i.splice},o.extend=o.fn.extend=function(){var t,r,a,l,f,h,g=arguments[0]||{},S=1,b=arguments.length,I=!1;for(typeof g=="boolean"&&(I=g,g=arguments[S]||{},S++),typeof g!="object"&&!R(g)&&(g={}),S===b&&(g=this,S--);S<b;S++)if((t=arguments[S])!=null)for(r in t)l=t[r],!(r==="__proto__"||g===l)&&(I&&l&&(o.isPlainObject(l)||(f=Array.isArray(l)))?(a=g[r],f&&!Array.isArray(a)?h=[]:!f&&!o.isPlainObject(a)?h={}:h=a,f=!1,g[r]=o.extend(I,h,l)):l!==void 0&&(g[r]=l));return g},o.extend({expando:"jQuery"+(L+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var r,a;return!t||w.call(t)!=="[object Object]"?!1:(r=c(t),r?(a=T.call(r,"constructor")&&r.constructor,typeof a=="function"&&M.call(a)===E):!0)},isEmptyObject:function(t){var r;for(r in t)return!1;return!0},globalEval:function(t,r,a){N(t,{nonce:r&&r.nonce},a)},each:function(t,r){var a,l=0;if(U(t))for(a=t.length;l<a&&r.call(t[l],l,t[l])!==!1;l++);else for(l in t)if(r.call(t[l],l,t[l])===!1)break;return t},text:function(t){var r,a="",l=0,f=t.nodeType;if(!f)for(;r=t[l++];)a+=o.text(r);return f===1||f===11?t.textContent:f===9?t.documentElement.textContent:f===3||f===4?t.nodeValue:a},makeArray:function(t,r){var a=r||[];return t!=null&&(U(Object(t))?o.merge(a,typeof t=="string"?[t]:t):d.call(a,t)),a},inArray:function(t,r,a){return r==null?-1:m.call(r,t,a)},isXMLDoc:function(t){var r=t&&t.namespaceURI,a=t&&(t.ownerDocument||t).documentElement;return!H.test(r||a&&a.nodeName||"HTML")},merge:function(t,r){for(var a=+r.length,l=0,f=t.length;l<a;l++)t[f++]=r[l];return t.length=f,t},grep:function(t,r,a){for(var l,f=[],h=0,g=t.length,S=!a;h<g;h++)l=!r(t[h],h),l!==S&&f.push(t[h]);return f},map:function(t,r,a){var l,f,h=0,g=[];if(U(t))for(l=t.length;h<l;h++)f=r(t[h],h,a),f!=null&&g.push(f);else for(h in t)f=r(t[h],h,a),f!=null&&g.push(f);return p(g)},guid:1,support:A}),typeof Symbol=="function"&&(o.fn[Symbol.iterator]=i[Symbol.iterator]),o.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,r){y["[object "+r+"]"]=r.toLowerCase()});function U(t){var r=!!t&&"length"in t&&t.length,a=_(t);return R(t)||O(t)?!1:a==="array"||r===0||typeof r=="number"&&r>0&&r-1 in t}function z(t,r){return t.nodeName&&t.nodeName.toLowerCase()===r.toLowerCase()}var $=i.pop,Q=i.sort,J=i.splice,Y="[\\x20\\t\\r\\n\\f]",me=new RegExp("^"+Y+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Y+"+$","g");o.contains=function(t,r){var a=r&&r.parentNode;return t===a||!!(a&&a.nodeType===1&&(t.contains?t.contains(a):t.compareDocumentPosition&&t.compareDocumentPosition(a)&16))};var re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function ue(t,r){return r?t==="\0"?"ï¿½":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}o.escapeSelector=function(t){return(t+"").replace(re,ue)};var de=v,Ce=d;(function(){var t,r,a,l,f,h=Ce,g,S,b,I,F,V=o.expando,B=0,q=0,se=jn(),xe=jn(),fe=jn(),Pe=jn(),Me=function(x,C){return x===C&&(f=!0),0},nt="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",rt="(?:\\\\[\\da-fA-F]{1,6}"+Y+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",ye="\\["+Y+"*("+rt+")(?:"+Y+"*([*^$|!~]?=)"+Y+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+rt+"))|)"+Y+"*\\]",Ot=":("+rt+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+ye+")*)|.*)\\)|)",ve=new RegExp(Y+"+","g"),Ie=new RegExp("^"+Y+"*,"+Y+"*"),bn=new RegExp("^"+Y+"*([>+~]|"+Y+")"+Y+"*"),Ar=new RegExp(Y+"|>"),it=new RegExp(Ot),wn=new RegExp("^"+rt+"$"),st={ID:new RegExp("^#("+rt+")"),CLASS:new RegExp("^\\.("+rt+")"),TAG:new RegExp("^("+rt+"|[*])"),ATTR:new RegExp("^"+ye),PSEUDO:new RegExp("^"+Ot),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Y+"*(even|odd|(([+-]|)(\\d*)n|)"+Y+"*(?:([+-]|)"+Y+"*(\\d+)|))"+Y+"*\\)|)","i"),bool:new RegExp("^(?:"+nt+")$","i"),needsContext:new RegExp("^"+Y+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Y+"*((?:-\\d)?\\d*)"+Y+"*\\)|)(?=[^-]|$)","i")},wt=/^(?:input|select|textarea|button)$/i,Tt=/^h\d$/i,$e=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Cr=/[+~]/,gt=new RegExp("\\\\[\\da-fA-F]{1,6}"+Y+"?|\\\\([^\\r\\n\\f])","g"),mt=function(x,C){var P="0x"+x.slice(1)-65536;return C||(P<0?String.fromCharCode(P+65536):String.fromCharCode(P>>10|55296,P&1023|56320))},wo=function(){Et()},To=zn(function(x){return x.disabled===!0&&z(x,"fieldset")},{dir:"parentNode",next:"legend"});function Eo(){try{return g.activeElement}catch{}}try{h.apply(i=u.call(de.childNodes),de.childNodes),i[de.childNodes.length].nodeType}catch{h={apply:function(C,P){Ce.apply(C,u.call(P))},call:function(C){Ce.apply(C,u.call(arguments,1))}}}function Te(x,C,P,D){var G,W,K,Z,X,pe,ie,oe=C&&C.ownerDocument,ge=C?C.nodeType:9;if(P=P||[],typeof x!="string"||!x||ge!==1&&ge!==9&&ge!==11)return P;if(!D&&(Et(C),C=C||g,b)){if(ge!==11&&(X=$e.exec(x)))if(G=X[1]){if(ge===9)if(K=C.getElementById(G)){if(K.id===G)return h.call(P,K),P}else return P;else if(oe&&(K=oe.getElementById(G))&&Te.contains(C,K)&&K.id===G)return h.call(P,K),P}else{if(X[2])return h.apply(P,C.getElementsByTagName(x)),P;if((G=X[3])&&C.getElementsByClassName)return h.apply(P,C.getElementsByClassName(G)),P}if(!Pe[x+" "]&&(!I||!I.test(x))){if(ie=x,oe=C,ge===1&&(Ar.test(x)||bn.test(x))){for(oe=Cr.test(x)&&Ir(C.parentNode)||C,(oe!=C||!A.scope)&&((Z=C.getAttribute("id"))?Z=o.escapeSelector(Z):C.setAttribute("id",Z=V)),pe=Tn(x),W=pe.length;W--;)pe[W]=(Z?"#"+Z:":scope")+" "+Vn(pe[W]);ie=pe.join(",")}try{return h.apply(P,oe.querySelectorAll(ie)),P}catch{Pe(x,!0)}finally{Z===V&&C.removeAttribute("id")}}}return _i(x.replace(me,"$1"),C,P,D)}function jn(){var x=[];function C(P,D){return x.push(P+" ")>r.cacheLength&&delete C[x.shift()],C[P+" "]=D}return C}function Je(x){return x[V]=!0,x}function Zt(x){var C=g.createElement("fieldset");try{return!!x(C)}catch{return!1}finally{C.parentNode&&C.parentNode.removeChild(C),C=null}}function So(x){return function(C){return z(C,"input")&&C.type===x}}function Ao(x){return function(C){return(z(C,"input")||z(C,"button"))&&C.type===x}}function Oi(x){return function(C){return"form"in C?C.parentNode&&C.disabled===!1?"label"in C?"label"in C.parentNode?C.parentNode.disabled===x:C.disabled===x:C.isDisabled===x||C.isDisabled!==!x&&To(C)===x:C.disabled===x:"label"in C?C.disabled===x:!1}}function Lt(x){return Je(function(C){return C=+C,Je(function(P,D){for(var G,W=x([],P.length,C),K=W.length;K--;)P[G=W[K]]&&(P[G]=!(D[G]=P[G]))})})}function Ir(x){return x&&typeof x.getElementsByTagName<"u"&&x}function Et(x){var C,P=x?x.ownerDocument||x:de;return P==g||P.nodeType!==9||!P.documentElement||(g=P,S=g.documentElement,b=!o.isXMLDoc(g),F=S.matches||S.webkitMatchesSelector||S.msMatchesSelector,S.msMatchesSelector&&de!=g&&(C=g.defaultView)&&C.top!==C&&C.addEventListener("unload",wo),A.getById=Zt(function(D){return S.appendChild(D).id=o.expando,!g.getElementsByName||!g.getElementsByName(o.expando).length}),A.disconnectedMatch=Zt(function(D){return F.call(D,"*")}),A.scope=Zt(function(){return g.querySelectorAll(":scope")}),A.cssHas=Zt(function(){try{return g.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),A.getById?(r.filter.ID=function(D){var G=D.replace(gt,mt);return function(W){return W.getAttribute("id")===G}},r.find.ID=function(D,G){if(typeof G.getElementById<"u"&&b){var W=G.getElementById(D);return W?[W]:[]}}):(r.filter.ID=function(D){var G=D.replace(gt,mt);return function(W){var K=typeof W.getAttributeNode<"u"&&W.getAttributeNode("id");return K&&K.value===G}},r.find.ID=function(D,G){if(typeof G.getElementById<"u"&&b){var W,K,Z,X=G.getElementById(D);if(X){if(W=X.getAttributeNode("id"),W&&W.value===D)return[X];for(Z=G.getElementsByName(D),K=0;X=Z[K++];)if(W=X.getAttributeNode("id"),W&&W.value===D)return[X]}return[]}}),r.find.TAG=function(D,G){return typeof G.getElementsByTagName<"u"?G.getElementsByTagName(D):G.querySelectorAll(D)},r.find.CLASS=function(D,G){if(typeof G.getElementsByClassName<"u"&&b)return G.getElementsByClassName(D)},I=[],Zt(function(D){var G;S.appendChild(D).innerHTML="<a id='"+V+"' href='' disabled='disabled'></a><select id='"+V+"-\r\\' disabled='disabled'><option selected=''></option></select>",D.querySelectorAll("[selected]").length||I.push("\\["+Y+"*(?:value|"+nt+")"),D.querySelectorAll("[id~="+V+"-]").length||I.push("~="),D.querySelectorAll("a#"+V+"+*").length||I.push(".#.+[+~]"),D.querySelectorAll(":checked").length||I.push(":checked"),G=g.createElement("input"),G.setAttribute("type","hidden"),D.appendChild(G).setAttribute("name","D"),S.appendChild(D).disabled=!0,D.querySelectorAll(":disabled").length!==2&&I.push(":enabled",":disabled"),G=g.createElement("input"),G.setAttribute("name",""),D.appendChild(G),D.querySelectorAll("[name='']").length||I.push("\\["+Y+"*name"+Y+"*="+Y+`*(?:''|"")`)}),A.cssHas||I.push(":has"),I=I.length&&new RegExp(I.join("|")),Me=function(D,G){if(D===G)return f=!0,0;var W=!D.compareDocumentPosition-!G.compareDocumentPosition;return W||(W=(D.ownerDocument||D)==(G.ownerDocument||G)?D.compareDocumentPosition(G):1,W&1||!A.sortDetached&&G.compareDocumentPosition(D)===W?D===g||D.ownerDocument==de&&Te.contains(de,D)?-1:G===g||G.ownerDocument==de&&Te.contains(de,G)?1:l?m.call(l,D)-m.call(l,G):0:W&4?-1:1)}),g}Te.matches=function(x,C){return Te(x,null,null,C)},Te.matchesSelector=function(x,C){if(Et(x),b&&!Pe[C+" "]&&(!I||!I.test(C)))try{var P=F.call(x,C);if(P||A.disconnectedMatch||x.document&&x.document.nodeType!==11)return P}catch{Pe(C,!0)}return Te(C,g,null,[x]).length>0},Te.contains=function(x,C){return(x.ownerDocument||x)!=g&&Et(x),o.contains(x,C)},Te.attr=function(x,C){(x.ownerDocument||x)!=g&&Et(x);var P=r.attrHandle[C.toLowerCase()],D=P&&T.call(r.attrHandle,C.toLowerCase())?P(x,C,!b):void 0;return D!==void 0?D:x.getAttribute(C)},Te.error=function(x){throw new Error("Syntax error, unrecognized expression: "+x)},o.uniqueSort=function(x){var C,P=[],D=0,G=0;if(f=!A.sortStable,l=!A.sortStable&&u.call(x,0),Q.call(x,Me),f){for(;C=x[G++];)C===x[G]&&(D=P.push(G));for(;D--;)J.call(x,P[D],1)}return l=null,x},o.fn.uniqueSort=function(){return this.pushStack(o.uniqueSort(u.apply(this)))},r=o.expr={cacheLength:50,createPseudo:Je,match:st,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(x){return x[1]=x[1].replace(gt,mt),x[3]=(x[3]||x[4]||x[5]||"").replace(gt,mt),x[2]==="~="&&(x[3]=" "+x[3]+" "),x.slice(0,4)},CHILD:function(x){return x[1]=x[1].toLowerCase(),x[1].slice(0,3)==="nth"?(x[3]||Te.error(x[0]),x[4]=+(x[4]?x[5]+(x[6]||1):2*(x[3]==="even"||x[3]==="odd")),x[5]=+(x[7]+x[8]||x[3]==="odd")):x[3]&&Te.error(x[0]),x},PSEUDO:function(x){var C,P=!x[6]&&x[2];return st.CHILD.test(x[0])?null:(x[3]?x[2]=x[4]||x[5]||"":P&&it.test(P)&&(C=Tn(P,!0))&&(C=P.indexOf(")",P.length-C)-P.length)&&(x[0]=x[0].slice(0,C),x[2]=P.slice(0,C)),x.slice(0,3))}},filter:{TAG:function(x){var C=x.replace(gt,mt).toLowerCase();return x==="*"?function(){return!0}:function(P){return z(P,C)}},CLASS:function(x){var C=se[x+" "];return C||(C=new RegExp("(^|"+Y+")"+x+"("+Y+"|$)"))&&se(x,function(P){return C.test(typeof P.className=="string"&&P.className||typeof P.getAttribute<"u"&&P.getAttribute("class")||"")})},ATTR:function(x,C,P){return function(D){var G=Te.attr(D,x);return G==null?C==="!=":C?(G+="",C==="="?G===P:C==="!="?G!==P:C==="^="?P&&G.indexOf(P)===0:C==="*="?P&&G.indexOf(P)>-1:C==="$="?P&&G.slice(-P.length)===P:C==="~="?(" "+G.replace(ve," ")+" ").indexOf(P)>-1:C==="|="?G===P||G.slice(0,P.length+1)===P+"-":!1):!0}},CHILD:function(x,C,P,D,G){var W=x.slice(0,3)!=="nth",K=x.slice(-4)!=="last",Z=C==="of-type";return D===1&&G===0?function(X){return!!X.parentNode}:function(X,pe,ie){var oe,ge,ne,Ee,je,Ne=W!==K?"nextSibling":"previousSibling",Ye=X.parentNode,ot=Z&&X.nodeName.toLowerCase(),en=!ie&&!Z,Le=!1;if(Ye){if(W){for(;Ne;){for(ne=X;ne=ne[Ne];)if(Z?z(ne,ot):ne.nodeType===1)return!1;je=Ne=x==="only"&&!je&&"nextSibling"}return!0}if(je=[K?Ye.firstChild:Ye.lastChild],K&&en){for(ge=Ye[V]||(Ye[V]={}),oe=ge[x]||[],Ee=oe[0]===B&&oe[1],Le=Ee&&oe[2],ne=Ee&&Ye.childNodes[Ee];ne=++Ee&&ne&&ne[Ne]||(Le=Ee=0)||je.pop();)if(ne.nodeType===1&&++Le&&ne===X){ge[x]=[B,Ee,Le];break}}else if(en&&(ge=X[V]||(X[V]={}),oe=ge[x]||[],Ee=oe[0]===B&&oe[1],Le=Ee),Le===!1)for(;(ne=++Ee&&ne&&ne[Ne]||(Le=Ee=0)||je.pop())&&!((Z?z(ne,ot):ne.nodeType===1)&&++Le&&(en&&(ge=ne[V]||(ne[V]={}),ge[x]=[B,Le]),ne===X)););return Le-=G,Le===D||Le%D===0&&Le/D>=0}}},PSEUDO:function(x,C){var P,D=r.pseudos[x]||r.setFilters[x.toLowerCase()]||Te.error("unsupported pseudo: "+x);return D[V]?D(C):D.length>1?(P=[x,x,"",C],r.setFilters.hasOwnProperty(x.toLowerCase())?Je(function(G,W){for(var K,Z=D(G,C),X=Z.length;X--;)K=m.call(G,Z[X]),G[K]=!(W[K]=Z[X])}):function(G){return D(G,0,P)}):D}},pseudos:{not:Je(function(x){var C=[],P=[],D=Br(x.replace(me,"$1"));return D[V]?Je(function(G,W,K,Z){for(var X,pe=D(G,null,Z,[]),ie=G.length;ie--;)(X=pe[ie])&&(G[ie]=!(W[ie]=X))}):function(G,W,K){return C[0]=G,D(C,null,K,P),C[0]=null,!P.pop()}}),has:Je(function(x){return function(C){return Te(x,C).length>0}}),contains:Je(function(x){return x=x.replace(gt,mt),function(C){return(C.textContent||o.text(C)).indexOf(x)>-1}}),lang:Je(function(x){return wn.test(x||"")||Te.error("unsupported lang: "+x),x=x.replace(gt,mt).toLowerCase(),function(C){var P;do if(P=b?C.lang:C.getAttribute("xml:lang")||C.getAttribute("lang"))return P=P.toLowerCase(),P===x||P.indexOf(x+"-")===0;while((C=C.parentNode)&&C.nodeType===1);return!1}}),target:function(x){var C=e.location&&e.location.hash;return C&&C.slice(1)===x.id},root:function(x){return x===S},focus:function(x){return x===Eo()&&g.hasFocus()&&!!(x.type||x.href||~x.tabIndex)},enabled:Oi(!1),disabled:Oi(!0),checked:function(x){return z(x,"input")&&!!x.checked||z(x,"option")&&!!x.selected},selected:function(x){return x.parentNode&&x.parentNode.selectedIndex,x.selected===!0},empty:function(x){for(x=x.firstChild;x;x=x.nextSibling)if(x.nodeType<6)return!1;return!0},parent:function(x){return!r.pseudos.empty(x)},header:function(x){return Tt.test(x.nodeName)},input:function(x){return wt.test(x.nodeName)},button:function(x){return z(x,"input")&&x.type==="button"||z(x,"button")},text:function(x){var C;return z(x,"input")&&x.type==="text"&&((C=x.getAttribute("type"))==null||C.toLowerCase()==="text")},first:Lt(function(){return[0]}),last:Lt(function(x,C){return[C-1]}),eq:Lt(function(x,C,P){return[P<0?P+C:P]}),even:Lt(function(x,C){for(var P=0;P<C;P+=2)x.push(P);return x}),odd:Lt(function(x,C){for(var P=1;P<C;P+=2)x.push(P);return x}),lt:Lt(function(x,C,P){var D;for(P<0?D=P+C:P>C?D=C:D=P;--D>=0;)x.push(D);return x}),gt:Lt(function(x,C,P){for(var D=P<0?P+C:P;++D<C;)x.push(D);return x})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=So(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=Ao(t);function Li(){}Li.prototype=r.filters=r.pseudos,r.setFilters=new Li;function Tn(x,C){var P,D,G,W,K,Z,X,pe=xe[x+" "];if(pe)return C?0:pe.slice(0);for(K=x,Z=[],X=r.preFilter;K;){(!P||(D=Ie.exec(K)))&&(D&&(K=K.slice(D[0].length)||K),Z.push(G=[])),P=!1,(D=bn.exec(K))&&(P=D.shift(),G.push({value:P,type:D[0].replace(me," ")}),K=K.slice(P.length));for(W in r.filter)(D=st[W].exec(K))&&(!X[W]||(D=X[W](D)))&&(P=D.shift(),G.push({value:P,type:W,matches:D}),K=K.slice(P.length));if(!P)break}return C?K.length:K?Te.error(x):xe(x,Z).slice(0)}function Vn(x){for(var C=0,P=x.length,D="";C<P;C++)D+=x[C].value;return D}function zn(x,C,P){var D=C.dir,G=C.next,W=G||D,K=P&&W==="parentNode",Z=q++;return C.first?function(X,pe,ie){for(;X=X[D];)if(X.nodeType===1||K)return x(X,pe,ie);return!1}:function(X,pe,ie){var oe,ge,ne=[B,Z];if(ie){for(;X=X[D];)if((X.nodeType===1||K)&&x(X,pe,ie))return!0}else for(;X=X[D];)if(X.nodeType===1||K)if(ge=X[V]||(X[V]={}),G&&z(X,G))X=X[D]||X;else{if((oe=ge[W])&&oe[0]===B&&oe[1]===Z)return ne[2]=oe[2];if(ge[W]=ne,ne[2]=x(X,pe,ie))return!0}return!1}}function Mr(x){return x.length>1?function(C,P,D){for(var G=x.length;G--;)if(!x[G](C,P,D))return!1;return!0}:x[0]}function Co(x,C,P){for(var D=0,G=C.length;D<G;D++)Te(x,C[D],P);return P}function Hn(x,C,P,D,G){for(var W,K=[],Z=0,X=x.length,pe=C!=null;Z<X;Z++)(W=x[Z])&&(!P||P(W,D,G))&&(K.push(W),pe&&C.push(Z));return K}function Rr(x,C,P,D,G,W){return D&&!D[V]&&(D=Rr(D)),G&&!G[V]&&(G=Rr(G,W)),Je(function(K,Z,X,pe){var ie,oe,ge,ne,Ee=[],je=[],Ne=Z.length,Ye=K||Co(C||"*",X.nodeType?[X]:X,[]),ot=x&&(K||!C)?Hn(Ye,Ee,x,X,pe):Ye;if(P?(ne=G||(K?x:Ne||D)?[]:Z,P(ot,ne,X,pe)):ne=ot,D)for(ie=Hn(ne,je),D(ie,[],X,pe),oe=ie.length;oe--;)(ge=ie[oe])&&(ne[je[oe]]=!(ot[je[oe]]=ge));if(K){if(G||x){if(G){for(ie=[],oe=ne.length;oe--;)(ge=ne[oe])&&ie.push(ot[oe]=ge);G(null,ne=[],ie,pe)}for(oe=ne.length;oe--;)(ge=ne[oe])&&(ie=G?m.call(K,ge):Ee[oe])>-1&&(K[ie]=!(Z[ie]=ge))}}else ne=Hn(ne===Z?ne.splice(Ne,ne.length):ne),G?G(null,Z,ne,pe):h.apply(Z,ne)})}function Pr(x){for(var C,P,D,G=x.length,W=r.relative[x[0].type],K=W||r.relative[" "],Z=W?1:0,X=zn(function(oe){return oe===C},K,!0),pe=zn(function(oe){return m.call(C,oe)>-1},K,!0),ie=[function(oe,ge,ne){var Ee=!W&&(ne||ge!=a)||((C=ge).nodeType?X(oe,ge,ne):pe(oe,ge,ne));return C=null,Ee}];Z<G;Z++)if(P=r.relative[x[Z].type])ie=[zn(Mr(ie),P)];else{if(P=r.filter[x[Z].type].apply(null,x[Z].matches),P[V]){for(D=++Z;D<G&&!r.relative[x[D].type];D++);return Rr(Z>1&&Mr(ie),Z>1&&Vn(x.slice(0,Z-1).concat({value:x[Z-2].type===" "?"*":""})).replace(me,"$1"),P,Z<D&&Pr(x.slice(Z,D)),D<G&&Pr(x=x.slice(D)),D<G&&Vn(x))}ie.push(P)}return Mr(ie)}function Io(x,C){var P=C.length>0,D=x.length>0,G=function(W,K,Z,X,pe){var ie,oe,ge,ne=0,Ee="0",je=W&&[],Ne=[],Ye=a,ot=W||D&&r.find.TAG("*",pe),en=B+=Ye==null?1:Math.random()||.1,Le=ot.length;for(pe&&(a=K==g||K||pe);Ee!==Le&&(ie=ot[Ee])!=null;Ee++){if(D&&ie){for(oe=0,!K&&ie.ownerDocument!=g&&(Et(ie),Z=!b);ge=x[oe++];)if(ge(ie,K||g,Z)){h.call(X,ie);break}pe&&(B=en)}P&&((ie=!ge&&ie)&&ne--,W&&je.push(ie))}if(ne+=Ee,P&&Ee!==ne){for(oe=0;ge=C[oe++];)ge(je,Ne,K,Z);if(W){if(ne>0)for(;Ee--;)je[Ee]||Ne[Ee]||(Ne[Ee]=$.call(X));Ne=Hn(Ne)}h.apply(X,Ne),pe&&!W&&Ne.length>0&&ne+C.length>1&&o.uniqueSort(X)}return pe&&(B=en,a=Ye),je};return P?Je(G):G}function Br(x,C){var P,D=[],G=[],W=fe[x+" "];if(!W){for(C||(C=Tn(x)),P=C.length;P--;)W=Pr(C[P]),W[V]?D.push(W):G.push(W);W=fe(x,Io(G,D)),W.selector=x}return W}function _i(x,C,P,D){var G,W,K,Z,X,pe=typeof x=="function"&&x,ie=!D&&Tn(x=pe.selector||x);if(P=P||[],ie.length===1){if(W=ie[0]=ie[0].slice(0),W.length>2&&(K=W[0]).type==="ID"&&C.nodeType===9&&b&&r.relative[W[1].type]){if(C=(r.find.ID(K.matches[0].replace(gt,mt),C)||[])[0],C)pe&&(C=C.parentNode);else return P;x=x.slice(W.shift().value.length)}for(G=st.needsContext.test(x)?0:W.length;G--&&(K=W[G],!r.relative[Z=K.type]);)if((X=r.find[Z])&&(D=X(K.matches[0].replace(gt,mt),Cr.test(W[0].type)&&Ir(C.parentNode)||C))){if(W.splice(G,1),x=D.length&&Vn(W),!x)return h.apply(P,D),P;break}}return(pe||Br(x,ie))(D,C,!b,P,!C||Cr.test(x)&&Ir(C.parentNode)||C),P}A.sortStable=V.split("").sort(Me).join("")===V,Et(),A.sortDetached=Zt(function(x){return x.compareDocumentPosition(g.createElement("fieldset"))&1}),o.find=Te,o.expr[":"]=o.expr.pseudos,o.unique=o.uniqueSort,Te.compile=Br,Te.select=_i,Te.setDocument=Et,Te.tokenize=Tn,Te.escape=o.escapeSelector,Te.getText=o.text,Te.isXML=o.isXMLDoc,Te.selectors=o.expr,Te.support=o.support,Te.uniqueSort=o.uniqueSort})();var ce=function(t,r,a){for(var l=[],f=a!==void 0;(t=t[r])&&t.nodeType!==9;)if(t.nodeType===1){if(f&&o(t).is(a))break;l.push(t)}return l},Re=function(t,r){for(var a=[];t;t=t.nextSibling)t.nodeType===1&&t!==r&&a.push(t);return a},vt=o.expr.match.needsContext,bt=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Mt(t,r,a){return R(r)?o.grep(t,function(l,f){return!!r.call(l,f,l)!==a}):r.nodeType?o.grep(t,function(l){return l===r!==a}):typeof r!="string"?o.grep(t,function(l){return m.call(r,l)>-1!==a}):o.filter(r,t,a)}o.filter=function(t,r,a){var l=r[0];return a&&(t=":not("+t+")"),r.length===1&&l.nodeType===1?o.find.matchesSelector(l,t)?[l]:[]:o.find.matches(t,o.grep(r,function(f){return f.nodeType===1}))},o.fn.extend({find:function(t){var r,a,l=this.length,f=this;if(typeof t!="string")return this.pushStack(o(t).filter(function(){for(r=0;r<l;r++)if(o.contains(f[r],this))return!0}));for(a=this.pushStack([]),r=0;r<l;r++)o.find(t,f[r],a);return l>1?o.uniqueSort(a):a},filter:function(t){return this.pushStack(Mt(this,t||[],!1))},not:function(t){return this.pushStack(Mt(this,t||[],!0))},is:function(t){return!!Mt(this,typeof t=="string"&&vt.test(t)?o(t):t||[],!1).length}});var et,ln=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Xe=o.fn.init=function(t,r,a){var l,f;if(!t)return this;if(a=a||et,typeof t=="string")if(t[0]==="<"&&t[t.length-1]===">"&&t.length>=3?l=[null,t,null]:l=ln.exec(t),l&&(l[1]||!r))if(l[1]){if(r=r instanceof o?r[0]:r,o.merge(this,o.parseHTML(l[1],r&&r.nodeType?r.ownerDocument||r:v,!0)),bt.test(l[1])&&o.isPlainObject(r))for(l in r)R(this[l])?this[l](r[l]):this.attr(l,r[l]);return this}else return f=v.getElementById(l[2]),f&&(this[0]=f,this.length=1),this;else return!r||r.jquery?(r||a).find(t):this.constructor(r).find(t);else{if(t.nodeType)return this[0]=t,this.length=1,this;if(R(t))return a.ready!==void 0?a.ready(t):t(o)}return o.makeArray(t,this)};Xe.prototype=o.fn,et=o(v);var Rt=/^(?:parents|prev(?:Until|All))/,ur={children:!0,contents:!0,next:!0,prev:!0};o.fn.extend({has:function(t){var r=o(t,this),a=r.length;return this.filter(function(){for(var l=0;l<a;l++)if(o.contains(this,r[l]))return!0})},closest:function(t,r){var a,l=0,f=this.length,h=[],g=typeof t!="string"&&o(t);if(!vt.test(t)){for(;l<f;l++)for(a=this[l];a&&a!==r;a=a.parentNode)if(a.nodeType<11&&(g?g.index(a)>-1:a.nodeType===1&&o.find.matchesSelector(a,t))){h.push(a);break}}return this.pushStack(h.length>1?o.uniqueSort(h):h)},index:function(t){return t?typeof t=="string"?m.call(o(t),this[0]):m.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,r){return this.pushStack(o.uniqueSort(o.merge(this.get(),o(t,r))))},addBack:function(t){return this.add(t==null?this.prevObject:this.prevObject.filter(t))}});function fn(t,r){for(;(t=t[r])&&t.nodeType!==1;);return t}o.each({parent:function(t){var r=t.parentNode;return r&&r.nodeType!==11?r:null},parents:function(t){return ce(t,"parentNode")},parentsUntil:function(t,r,a){return ce(t,"parentNode",a)},next:function(t){return fn(t,"nextSibling")},prev:function(t){return fn(t,"previousSibling")},nextAll:function(t){return ce(t,"nextSibling")},prevAll:function(t){return ce(t,"previousSibling")},nextUntil:function(t,r,a){return ce(t,"nextSibling",a)},prevUntil:function(t,r,a){return ce(t,"previousSibling",a)},siblings:function(t){return Re((t.parentNode||{}).firstChild,t)},children:function(t){return Re(t.firstChild)},contents:function(t){return t.contentDocument!=null&&c(t.contentDocument)?t.contentDocument:(z(t,"template")&&(t=t.content||t),o.merge([],t.childNodes))}},function(t,r){o.fn[t]=function(a,l){var f=o.map(this,r,a);return t.slice(-5)!=="Until"&&(l=a),l&&typeof l=="string"&&(f=o.filter(l,f)),this.length>1&&(ur[t]||o.uniqueSort(f),Rt.test(t)&&f.reverse()),this.pushStack(f)}});var Oe=/[^\x20\t\r\n\f]+/g;function Ps(t){var r={};return o.each(t.match(Oe)||[],function(a,l){r[l]=!0}),r}o.Callbacks=function(t){t=typeof t=="string"?Ps(t):o.extend({},t);var r,a,l,f,h=[],g=[],S=-1,b=function(){for(f=f||t.once,l=r=!0;g.length;S=-1)for(a=g.shift();++S<h.length;)h[S].apply(a[0],a[1])===!1&&t.stopOnFalse&&(S=h.length,a=!1);t.memory||(a=!1),r=!1,f&&(a?h=[]:h="")},I={add:function(){return h&&(a&&!r&&(S=h.length-1,g.push(a)),function F(V){o.each(V,function(B,q){R(q)?(!t.unique||!I.has(q))&&h.push(q):q&&q.length&&_(q)!=="string"&&F(q)})}(arguments),a&&!r&&b()),this},remove:function(){return o.each(arguments,function(F,V){for(var B;(B=o.inArray(V,h,B))>-1;)h.splice(B,1),B<=S&&S--}),this},has:function(F){return F?o.inArray(F,h)>-1:h.length>0},empty:function(){return h&&(h=[]),this},disable:function(){return f=g=[],h=a="",this},disabled:function(){return!h},lock:function(){return f=g=[],!a&&!r&&(h=a=""),this},locked:function(){return!!f},fireWith:function(F,V){return f||(V=V||[],V=[F,V.slice?V.slice():V],g.push(V),r||b()),this},fire:function(){return I.fireWith(this,arguments),this},fired:function(){return!!l}};return I};function $t(t){return t}function Ln(t){throw t}function ti(t,r,a,l){var f;try{t&&R(f=t.promise)?f.call(t).done(r).fail(a):t&&R(f=t.then)?f.call(t,r,a):r.apply(void 0,[t].slice(l))}catch(h){a.apply(void 0,[h])}}o.extend({Deferred:function(t){var r=[["notify","progress",o.Callbacks("memory"),o.Callbacks("memory"),2],["resolve","done",o.Callbacks("once memory"),o.Callbacks("once memory"),0,"resolved"],["reject","fail",o.Callbacks("once memory"),o.Callbacks("once memory"),1,"rejected"]],a="pending",l={state:function(){return a},always:function(){return f.done(arguments).fail(arguments),this},catch:function(h){return l.then(null,h)},pipe:function(){var h=arguments;return o.Deferred(function(g){o.each(r,function(S,b){var I=R(h[b[4]])&&h[b[4]];f[b[1]](function(){var F=I&&I.apply(this,arguments);F&&R(F.promise)?F.promise().progress(g.notify).done(g.resolve).fail(g.reject):g[b[0]+"With"](this,I?[F]:arguments)})}),h=null}).promise()},then:function(h,g,S){var b=0;function I(F,V,B,q){return function(){var se=this,xe=arguments,fe=function(){var Me,nt;if(!(F<b)){if(Me=B.apply(se,xe),Me===V.promise())throw new TypeError("Thenable self-resolution");nt=Me&&(typeof Me=="object"||typeof Me=="function")&&Me.then,R(nt)?q?nt.call(Me,I(b,V,$t,q),I(b,V,Ln,q)):(b++,nt.call(Me,I(b,V,$t,q),I(b,V,Ln,q),I(b,V,$t,V.notifyWith))):(B!==$t&&(se=void 0,xe=[Me]),(q||V.resolveWith)(se,xe))}},Pe=q?fe:function(){try{fe()}catch(Me){o.Deferred.exceptionHook&&o.Deferred.exceptionHook(Me,Pe.error),F+1>=b&&(B!==Ln&&(se=void 0,xe=[Me]),V.rejectWith(se,xe))}};F?Pe():(o.Deferred.getErrorHook?Pe.error=o.Deferred.getErrorHook():o.Deferred.getStackHook&&(Pe.error=o.Deferred.getStackHook()),e.setTimeout(Pe))}}return o.Deferred(function(F){r[0][3].add(I(0,F,R(S)?S:$t,F.notifyWith)),r[1][3].add(I(0,F,R(h)?h:$t)),r[2][3].add(I(0,F,R(g)?g:Ln))}).promise()},promise:function(h){return h!=null?o.extend(h,l):l}},f={};return o.each(r,function(h,g){var S=g[2],b=g[5];l[g[1]]=S.add,b&&S.add(function(){a=b},r[3-h][2].disable,r[3-h][3].disable,r[0][2].lock,r[0][3].lock),S.add(g[3].fire),f[g[0]]=function(){return f[g[0]+"With"](this===f?void 0:this,arguments),this},f[g[0]+"With"]=S.fireWith}),l.promise(f),t&&t.call(f,f),f},when:function(t){var r=arguments.length,a=r,l=Array(a),f=u.call(arguments),h=o.Deferred(),g=function(S){return function(b){l[S]=this,f[S]=arguments.length>1?u.call(arguments):b,--r||h.resolveWith(l,f)}};if(r<=1&&(ti(t,h.done(g(a)).resolve,h.reject,!r),h.state()==="pending"||R(f[a]&&f[a].then)))return h.then();for(;a--;)ti(f[a],g(a),h.reject);return h.promise()}});var Bs=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;o.Deferred.exceptionHook=function(t,r){e.console&&e.console.warn&&t&&Bs.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,r)},o.readyException=function(t){e.setTimeout(function(){throw t})};var lr=o.Deferred();o.fn.ready=function(t){return lr.then(t).catch(function(r){o.readyException(r)}),this},o.extend({isReady:!1,readyWait:1,ready:function(t){(t===!0?--o.readyWait:o.isReady)||(o.isReady=!0,!(t!==!0&&--o.readyWait>0)&&lr.resolveWith(v,[o]))}}),o.ready.then=lr.then;function _n(){v.removeEventListener("DOMContentLoaded",_n),e.removeEventListener("load",_n),o.ready()}v.readyState==="complete"||v.readyState!=="loading"&&!v.documentElement.doScroll?e.setTimeout(o.ready):(v.addEventListener("DOMContentLoaded",_n),e.addEventListener("load",_n));var dt=function(t,r,a,l,f,h,g){var S=0,b=t.length,I=a==null;if(_(a)==="object"){f=!0;for(S in a)dt(t,r,S,a[S],!0,h,g)}else if(l!==void 0&&(f=!0,R(l)||(g=!0),I&&(g?(r.call(t,l),r=null):(I=r,r=function(F,V,B){return I.call(o(F),B)})),r))for(;S<b;S++)r(t[S],a,g?l:l.call(t[S],S,r(t[S],a)));return f?t:I?r.call(t):b?r(t[0],a):h},Ns=/^-ms-/,Os=/-([a-z])/g;function Ls(t,r){return r.toUpperCase()}function tt(t){return t.replace(Ns,"ms-").replace(Os,Ls)}var hn=function(t){return t.nodeType===1||t.nodeType===9||!+t.nodeType};function dn(){this.expando=o.expando+dn.uid++}dn.uid=1,dn.prototype={cache:function(t){var r=t[this.expando];return r||(r={},hn(t)&&(t.nodeType?t[this.expando]=r:Object.defineProperty(t,this.expando,{value:r,configurable:!0}))),r},set:function(t,r,a){var l,f=this.cache(t);if(typeof r=="string")f[tt(r)]=a;else for(l in r)f[tt(l)]=r[l];return f},get:function(t,r){return r===void 0?this.cache(t):t[this.expando]&&t[this.expando][tt(r)]},access:function(t,r,a){return r===void 0||r&&typeof r=="string"&&a===void 0?this.get(t,r):(this.set(t,r,a),a!==void 0?a:r)},remove:function(t,r){var a,l=t[this.expando];if(l!==void 0){if(r!==void 0)for(Array.isArray(r)?r=r.map(tt):(r=tt(r),r=r in l?[r]:r.match(Oe)||[]),a=r.length;a--;)delete l[r[a]];(r===void 0||o.isEmptyObject(l))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var r=t[this.expando];return r!==void 0&&!o.isEmptyObject(r)}};var ee=new dn,Fe=new dn,_s=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ds=/[A-Z]/g;function Us(t){return t==="true"?!0:t==="false"?!1:t==="null"?null:t===+t+""?+t:_s.test(t)?JSON.parse(t):t}function ni(t,r,a){var l;if(a===void 0&&t.nodeType===1)if(l="data-"+r.replace(Ds,"-$&").toLowerCase(),a=t.getAttribute(l),typeof a=="string"){try{a=Us(a)}catch{}Fe.set(t,r,a)}else a=void 0;return a}o.extend({hasData:function(t){return Fe.hasData(t)||ee.hasData(t)},data:function(t,r,a){return Fe.access(t,r,a)},removeData:function(t,r){Fe.remove(t,r)},_data:function(t,r,a){return ee.access(t,r,a)},_removeData:function(t,r){ee.remove(t,r)}}),o.fn.extend({data:function(t,r){var a,l,f,h=this[0],g=h&&h.attributes;if(t===void 0){if(this.length&&(f=Fe.get(h),h.nodeType===1&&!ee.get(h,"hasDataAttrs"))){for(a=g.length;a--;)g[a]&&(l=g[a].name,l.indexOf("data-")===0&&(l=tt(l.slice(5)),ni(h,l,f[l])));ee.set(h,"hasDataAttrs",!0)}return f}return typeof t=="object"?this.each(function(){Fe.set(this,t)}):dt(this,function(S){var b;if(h&&S===void 0)return b=Fe.get(h,t),b!==void 0||(b=ni(h,t),b!==void 0)?b:void 0;this.each(function(){Fe.set(this,t,S)})},null,r,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){Fe.remove(this,t)})}}),o.extend({queue:function(t,r,a){var l;if(t)return r=(r||"fx")+"queue",l=ee.get(t,r),a&&(!l||Array.isArray(a)?l=ee.access(t,r,o.makeArray(a)):l.push(a)),l||[]},dequeue:function(t,r){r=r||"fx";var a=o.queue(t,r),l=a.length,f=a.shift(),h=o._queueHooks(t,r),g=function(){o.dequeue(t,r)};f==="inprogress"&&(f=a.shift(),l--),f&&(r==="fx"&&a.unshift("inprogress"),delete h.stop,f.call(t,g,h)),!l&&h&&h.empty.fire()},_queueHooks:function(t,r){var a=r+"queueHooks";return ee.get(t,a)||ee.access(t,a,{empty:o.Callbacks("once memory").add(function(){ee.remove(t,[r+"queue",a])})})}}),o.fn.extend({queue:function(t,r){var a=2;return typeof t!="string"&&(r=t,t="fx",a--),arguments.length<a?o.queue(this[0],t):r===void 0?this:this.each(function(){var l=o.queue(this,t,r);o._queueHooks(this,t),t==="fx"&&l[0]!=="inprogress"&&o.dequeue(this,t)})},dequeue:function(t){return this.each(function(){o.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,r){var a,l=1,f=o.Deferred(),h=this,g=this.length,S=function(){--l||f.resolveWith(h,[h])};for(typeof t!="string"&&(r=t,t=void 0),t=t||"fx";g--;)a=ee.get(h[g],t+"queueHooks"),a&&a.empty&&(l++,a.empty.add(S));return S(),f.promise(r)}});var ri=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,pn=new RegExp("^(?:([+-])=|)("+ri+")([a-z%]*)$","i"),pt=["Top","Right","Bottom","Left"],Pt=v.documentElement,Yt=function(t){return o.contains(t.ownerDocument,t)},Fs={composed:!0};Pt.getRootNode&&(Yt=function(t){return o.contains(t.ownerDocument,t)||t.getRootNode(Fs)===t.ownerDocument});var Dn=function(t,r){return t=r||t,t.style.display==="none"||t.style.display===""&&Yt(t)&&o.css(t,"display")==="none"};function ii(t,r,a,l){var f,h,g=20,S=l?function(){return l.cur()}:function(){return o.css(t,r,"")},b=S(),I=a&&a[3]||(o.cssNumber[r]?"":"px"),F=t.nodeType&&(o.cssNumber[r]||I!=="px"&&+b)&&pn.exec(o.css(t,r));if(F&&F[3]!==I){for(b=b/2,I=I||F[3],F=+b||1;g--;)o.style(t,r,F+I),(1-h)*(1-(h=S()/b||.5))<=0&&(g=0),F=F/h;F=F*2,o.style(t,r,F+I),a=a||[]}return a&&(F=+F||+b||0,f=a[1]?F+(a[1]+1)*a[2]:+a[2],l&&(l.unit=I,l.start=F,l.end=f)),f}var si={};function Gs(t){var r,a=t.ownerDocument,l=t.nodeName,f=si[l];return f||(r=a.body.appendChild(a.createElement(l)),f=o.css(r,"display"),r.parentNode.removeChild(r),f==="none"&&(f="block"),si[l]=f,f)}function Wt(t,r){for(var a,l,f=[],h=0,g=t.length;h<g;h++)l=t[h],l.style&&(a=l.style.display,r?(a==="none"&&(f[h]=ee.get(l,"display")||null,f[h]||(l.style.display="")),l.style.display===""&&Dn(l)&&(f[h]=Gs(l))):a!=="none"&&(f[h]="none",ee.set(l,"display",a)));for(h=0;h<g;h++)f[h]!=null&&(t[h].style.display=f[h]);return t}o.fn.extend({show:function(){return Wt(this,!0)},hide:function(){return Wt(this)},toggle:function(t){return typeof t=="boolean"?t?this.show():this.hide():this.each(function(){Dn(this)?o(this).show():o(this).hide()})}});var gn=/^(?:checkbox|radio)$/i,oi=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ai=/^$|^module$|\/(?:java|ecma)script/i;(function(){var t=v.createDocumentFragment(),r=t.appendChild(v.createElement("div")),a=v.createElement("input");a.setAttribute("type","radio"),a.setAttribute("checked","checked"),a.setAttribute("name","t"),r.appendChild(a),A.checkClone=r.cloneNode(!0).cloneNode(!0).lastChild.checked,r.innerHTML="<textarea>x</textarea>",A.noCloneChecked=!!r.cloneNode(!0).lastChild.defaultValue,r.innerHTML="<option></option>",A.option=!!r.lastChild})();var qe={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};qe.tbody=qe.tfoot=qe.colgroup=qe.caption=qe.thead,qe.th=qe.td,A.option||(qe.optgroup=qe.option=[1,"<select multiple='multiple'>","</select>"]);function Ge(t,r){var a;return typeof t.getElementsByTagName<"u"?a=t.getElementsByTagName(r||"*"):typeof t.querySelectorAll<"u"?a=t.querySelectorAll(r||"*"):a=[],r===void 0||r&&z(t,r)?o.merge([t],a):a}function fr(t,r){for(var a=0,l=t.length;a<l;a++)ee.set(t[a],"globalEval",!r||ee.get(r[a],"globalEval"))}var ks=/<|&#?\w+;/;function ci(t,r,a,l,f){for(var h,g,S,b,I,F,V=r.createDocumentFragment(),B=[],q=0,se=t.length;q<se;q++)if(h=t[q],h||h===0)if(_(h)==="object")o.merge(B,h.nodeType?[h]:h);else if(!ks.test(h))B.push(r.createTextNode(h));else{for(g=g||V.appendChild(r.createElement("div")),S=(oi.exec(h)||["",""])[1].toLowerCase(),b=qe[S]||qe._default,g.innerHTML=b[1]+o.htmlPrefilter(h)+b[2],F=b[0];F--;)g=g.lastChild;o.merge(B,g.childNodes),g=V.firstChild,g.textContent=""}for(V.textContent="",q=0;h=B[q++];){if(l&&o.inArray(h,l)>-1){f&&f.push(h);continue}if(I=Yt(h),g=Ge(V.appendChild(h),"script"),I&&fr(g),a)for(F=0;h=g[F++];)ai.test(h.type||"")&&a.push(h)}return V}var ui=/^([^.]*)(?:\.(.+)|)/;function Kt(){return!0}function Xt(){return!1}function hr(t,r,a,l,f,h){var g,S;if(typeof r=="object"){typeof a!="string"&&(l=l||a,a=void 0);for(S in r)hr(t,S,a,l,r[S],h);return t}if(l==null&&f==null?(f=a,l=a=void 0):f==null&&(typeof a=="string"?(f=l,l=void 0):(f=l,l=a,a=void 0)),f===!1)f=Xt;else if(!f)return t;return h===1&&(g=f,f=function(b){return o().off(b),g.apply(this,arguments)},f.guid=g.guid||(g.guid=o.guid++)),t.each(function(){o.event.add(this,r,f,l,a)})}o.event={global:{},add:function(t,r,a,l,f){var h,g,S,b,I,F,V,B,q,se,xe,fe=ee.get(t);if(hn(t))for(a.handler&&(h=a,a=h.handler,f=h.selector),f&&o.find.matchesSelector(Pt,f),a.guid||(a.guid=o.guid++),(b=fe.events)||(b=fe.events=Object.create(null)),(g=fe.handle)||(g=fe.handle=function(Pe){return typeof o<"u"&&o.event.triggered!==Pe.type?o.event.dispatch.apply(t,arguments):void 0}),r=(r||"").match(Oe)||[""],I=r.length;I--;)S=ui.exec(r[I])||[],q=xe=S[1],se=(S[2]||"").split(".").sort(),q&&(V=o.event.special[q]||{},q=(f?V.delegateType:V.bindType)||q,V=o.event.special[q]||{},F=o.extend({type:q,origType:xe,data:l,handler:a,guid:a.guid,selector:f,needsContext:f&&o.expr.match.needsContext.test(f),namespace:se.join(".")},h),(B=b[q])||(B=b[q]=[],B.delegateCount=0,(!V.setup||V.setup.call(t,l,se,g)===!1)&&t.addEventListener&&t.addEventListener(q,g)),V.add&&(V.add.call(t,F),F.handler.guid||(F.handler.guid=a.guid)),f?B.splice(B.delegateCount++,0,F):B.push(F),o.event.global[q]=!0)},remove:function(t,r,a,l,f){var h,g,S,b,I,F,V,B,q,se,xe,fe=ee.hasData(t)&&ee.get(t);if(!(!fe||!(b=fe.events))){for(r=(r||"").match(Oe)||[""],I=r.length;I--;){if(S=ui.exec(r[I])||[],q=xe=S[1],se=(S[2]||"").split(".").sort(),!q){for(q in b)o.event.remove(t,q+r[I],a,l,!0);continue}for(V=o.event.special[q]||{},q=(l?V.delegateType:V.bindType)||q,B=b[q]||[],S=S[2]&&new RegExp("(^|\\.)"+se.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=h=B.length;h--;)F=B[h],(f||xe===F.origType)&&(!a||a.guid===F.guid)&&(!S||S.test(F.namespace))&&(!l||l===F.selector||l==="**"&&F.selector)&&(B.splice(h,1),F.selector&&B.delegateCount--,V.remove&&V.remove.call(t,F));g&&!B.length&&((!V.teardown||V.teardown.call(t,se,fe.handle)===!1)&&o.removeEvent(t,q,fe.handle),delete b[q])}o.isEmptyObject(b)&&ee.remove(t,"handle events")}},dispatch:function(t){var r,a,l,f,h,g,S=new Array(arguments.length),b=o.event.fix(t),I=(ee.get(this,"events")||Object.create(null))[b.type]||[],F=o.event.special[b.type]||{};for(S[0]=b,r=1;r<arguments.length;r++)S[r]=arguments[r];if(b.delegateTarget=this,!(F.preDispatch&&F.preDispatch.call(this,b)===!1)){for(g=o.event.handlers.call(this,b,I),r=0;(f=g[r++])&&!b.isPropagationStopped();)for(b.currentTarget=f.elem,a=0;(h=f.handlers[a++])&&!b.isImmediatePropagationStopped();)(!b.rnamespace||h.namespace===!1||b.rnamespace.test(h.namespace))&&(b.handleObj=h,b.data=h.data,l=((o.event.special[h.origType]||{}).handle||h.handler).apply(f.elem,S),l!==void 0&&(b.result=l)===!1&&(b.preventDefault(),b.stopPropagation()));return F.postDispatch&&F.postDispatch.call(this,b),b.result}},handlers:function(t,r){var a,l,f,h,g,S=[],b=r.delegateCount,I=t.target;if(b&&I.nodeType&&!(t.type==="click"&&t.button>=1)){for(;I!==this;I=I.parentNode||this)if(I.nodeType===1&&!(t.type==="click"&&I.disabled===!0)){for(h=[],g={},a=0;a<b;a++)l=r[a],f=l.selector+" ",g[f]===void 0&&(g[f]=l.needsContext?o(f,this).index(I)>-1:o.find(f,this,null,[I]).length),g[f]&&h.push(l);h.length&&S.push({elem:I,handlers:h})}}return I=this,b<r.length&&S.push({elem:I,handlers:r.slice(b)}),S},addProp:function(t,r){Object.defineProperty(o.Event.prototype,t,{enumerable:!0,configurable:!0,get:R(r)?function(){if(this.originalEvent)return r(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(a){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:a})}})},fix:function(t){return t[o.expando]?t:new o.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var r=this||t;return gn.test(r.type)&&r.click&&z(r,"input")&&Un(r,"click",!0),!1},trigger:function(t){var r=this||t;return gn.test(r.type)&&r.click&&z(r,"input")&&Un(r,"click"),!0},_default:function(t){var r=t.target;return gn.test(r.type)&&r.click&&z(r,"input")&&ee.get(r,"click")||z(r,"a")}},beforeunload:{postDispatch:function(t){t.result!==void 0&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}};function Un(t,r,a){if(!a){ee.get(t,r)===void 0&&o.event.add(t,r,Kt);return}ee.set(t,r,!1),o.event.add(t,r,{namespace:!1,handler:function(l){var f,h=ee.get(this,r);if(l.isTrigger&1&&this[r]){if(h)(o.event.special[r]||{}).delegateType&&l.stopPropagation();else if(h=u.call(arguments),ee.set(this,r,h),this[r](),f=ee.get(this,r),ee.set(this,r,!1),h!==f)return l.stopImmediatePropagation(),l.preventDefault(),f}else h&&(ee.set(this,r,o.event.trigger(h[0],h.slice(1),this)),l.stopPropagation(),l.isImmediatePropagationStopped=Kt)}})}o.removeEvent=function(t,r,a){t.removeEventListener&&t.removeEventListener(r,a)},o.Event=function(t,r){if(!(this instanceof o.Event))return new o.Event(t,r);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.defaultPrevented===void 0&&t.returnValue===!1?Kt:Xt,this.target=t.target&&t.target.nodeType===3?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,r&&o.extend(this,r),this.timeStamp=t&&t.timeStamp||Date.now(),this[o.expando]=!0},o.Event.prototype={constructor:o.Event,isDefaultPrevented:Xt,isPropagationStopped:Xt,isImmediatePropagationStopped:Xt,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Kt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Kt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Kt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},o.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},o.event.addProp),o.each({focus:"focusin",blur:"focusout"},function(t,r){function a(l){if(v.documentMode){var f=ee.get(this,"handle"),h=o.event.fix(l);h.type=l.type==="focusin"?"focus":"blur",h.isSimulated=!0,f(l),h.target===h.currentTarget&&f(h)}else o.event.simulate(r,l.target,o.event.fix(l))}o.event.special[t]={setup:function(){var l;if(Un(this,t,!0),v.documentMode)l=ee.get(this,r),l||this.addEventListener(r,a),ee.set(this,r,(l||0)+1);else return!1},trigger:function(){return Un(this,t),!0},teardown:function(){var l;if(v.documentMode)l=ee.get(this,r)-1,l?ee.set(this,r,l):(this.removeEventListener(r,a),ee.remove(this,r));else return!1},_default:function(l){return ee.get(l.target,t)},delegateType:r},o.event.special[r]={setup:function(){var l=this.ownerDocument||this.document||this,f=v.documentMode?this:l,h=ee.get(f,r);h||(v.documentMode?this.addEventListener(r,a):l.addEventListener(t,a,!0)),ee.set(f,r,(h||0)+1)},teardown:function(){var l=this.ownerDocument||this.document||this,f=v.documentMode?this:l,h=ee.get(f,r)-1;h?ee.set(f,r,h):(v.documentMode?this.removeEventListener(r,a):l.removeEventListener(t,a,!0),ee.remove(f,r))}}}),o.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,r){o.event.special[t]={delegateType:r,bindType:r,handle:function(a){var l,f=this,h=a.relatedTarget,g=a.handleObj;return(!h||h!==f&&!o.contains(f,h))&&(a.type=g.origType,l=g.handler.apply(this,arguments),a.type=r),l}}}),o.fn.extend({on:function(t,r,a,l){return hr(this,t,r,a,l)},one:function(t,r,a,l){return hr(this,t,r,a,l,1)},off:function(t,r,a){var l,f;if(t&&t.preventDefault&&t.handleObj)return l=t.handleObj,o(t.delegateTarget).off(l.namespace?l.origType+"."+l.namespace:l.origType,l.selector,l.handler),this;if(typeof t=="object"){for(f in t)this.off(f,r,t[f]);return this}return(r===!1||typeof r=="function")&&(a=r,r=void 0),a===!1&&(a=Xt),this.each(function(){o.event.remove(this,t,a,r)})}});var js=/<script|<style|<link/i,Vs=/checked\s*(?:[^=]|=\s*.checked.)/i,zs=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function li(t,r){return z(t,"table")&&z(r.nodeType!==11?r:r.firstChild,"tr")&&o(t).children("tbody")[0]||t}function Hs(t){return t.type=(t.getAttribute("type")!==null)+"/"+t.type,t}function qs(t){return(t.type||"").slice(0,5)==="true/"?t.type=t.type.slice(5):t.removeAttribute("type"),t}function fi(t,r){var a,l,f,h,g,S,b;if(r.nodeType===1){if(ee.hasData(t)&&(h=ee.get(t),b=h.events,b)){ee.remove(r,"handle events");for(f in b)for(a=0,l=b[f].length;a<l;a++)o.event.add(r,f,b[f][a])}Fe.hasData(t)&&(g=Fe.access(t),S=o.extend({},g),Fe.set(r,S))}}function $s(t,r){var a=r.nodeName.toLowerCase();a==="input"&&gn.test(t.type)?r.checked=t.checked:(a==="input"||a==="textarea")&&(r.defaultValue=t.defaultValue)}function Qt(t,r,a,l){r=p(r);var f,h,g,S,b,I,F=0,V=t.length,B=V-1,q=r[0],se=R(q);if(se||V>1&&typeof q=="string"&&!A.checkClone&&Vs.test(q))return t.each(function(xe){var fe=t.eq(xe);se&&(r[0]=q.call(this,xe,fe.html())),Qt(fe,r,a,l)});if(V&&(f=ci(r,t[0].ownerDocument,!1,t,l),h=f.firstChild,f.childNodes.length===1&&(f=h),h||l)){for(g=o.map(Ge(f,"script"),Hs),S=g.length;F<V;F++)b=f,F!==B&&(b=o.clone(b,!0,!0),S&&o.merge(g,Ge(b,"script"))),a.call(t[F],b,F);if(S)for(I=g[g.length-1].ownerDocument,o.map(g,qs),F=0;F<S;F++)b=g[F],ai.test(b.type||"")&&!ee.access(b,"globalEval")&&o.contains(I,b)&&(b.src&&(b.type||"").toLowerCase()!=="module"?o._evalUrl&&!b.noModule&&o._evalUrl(b.src,{nonce:b.nonce||b.getAttribute("nonce")},I):N(b.textContent.replace(zs,""),b,I))}return t}function hi(t,r,a){for(var l,f=r?o.filter(r,t):t,h=0;(l=f[h])!=null;h++)!a&&l.nodeType===1&&o.cleanData(Ge(l)),l.parentNode&&(a&&Yt(l)&&fr(Ge(l,"script")),l.parentNode.removeChild(l));return t}o.extend({htmlPrefilter:function(t){return t},clone:function(t,r,a){var l,f,h,g,S=t.cloneNode(!0),b=Yt(t);if(!A.noCloneChecked&&(t.nodeType===1||t.nodeType===11)&&!o.isXMLDoc(t))for(g=Ge(S),h=Ge(t),l=0,f=h.length;l<f;l++)$s(h[l],g[l]);if(r)if(a)for(h=h||Ge(t),g=g||Ge(S),l=0,f=h.length;l<f;l++)fi(h[l],g[l]);else fi(t,S);return g=Ge(S,"script"),g.length>0&&fr(g,!b&&Ge(t,"script")),S},cleanData:function(t){for(var r,a,l,f=o.event.special,h=0;(a=t[h])!==void 0;h++)if(hn(a)){if(r=a[ee.expando]){if(r.events)for(l in r.events)f[l]?o.event.remove(a,l):o.removeEvent(a,l,r.handle);a[ee.expando]=void 0}a[Fe.expando]&&(a[Fe.expando]=void 0)}}}),o.fn.extend({detach:function(t){return hi(this,t,!0)},remove:function(t){return hi(this,t)},text:function(t){return dt(this,function(r){return r===void 0?o.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=r)})},null,t,arguments.length)},append:function(){return Qt(this,arguments,function(t){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var r=li(this,t);r.appendChild(t)}})},prepend:function(){return Qt(this,arguments,function(t){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var r=li(this,t);r.insertBefore(t,r.firstChild)}})},before:function(){return Qt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return Qt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,r=0;(t=this[r])!=null;r++)t.nodeType===1&&(o.cleanData(Ge(t,!1)),t.textContent="");return this},clone:function(t,r){return t=t??!1,r=r??t,this.map(function(){return o.clone(this,t,r)})},html:function(t){return dt(this,function(r){var a=this[0]||{},l=0,f=this.length;if(r===void 0&&a.nodeType===1)return a.innerHTML;if(typeof r=="string"&&!js.test(r)&&!qe[(oi.exec(r)||["",""])[1].toLowerCase()]){r=o.htmlPrefilter(r);try{for(;l<f;l++)a=this[l]||{},a.nodeType===1&&(o.cleanData(Ge(a,!1)),a.innerHTML=r);a=0}catch{}}a&&this.empty().append(r)},null,t,arguments.length)},replaceWith:function(){var t=[];return Qt(this,arguments,function(r){var a=this.parentNode;o.inArray(this,t)<0&&(o.cleanData(Ge(this)),a&&a.replaceChild(r,this))},t)}}),o.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,r){o.fn[t]=function(a){for(var l,f=[],h=o(a),g=h.length-1,S=0;S<=g;S++)l=S===g?this:this.clone(!0),o(h[S])[r](l),d.apply(f,l.get());return this.pushStack(f)}});var dr=new RegExp("^("+ri+")(?!px)[a-z%]+$","i"),pr=/^--/,Fn=function(t){var r=t.ownerDocument.defaultView;return(!r||!r.opener)&&(r=e),r.getComputedStyle(t)},di=function(t,r,a){var l,f,h={};for(f in r)h[f]=t.style[f],t.style[f]=r[f];l=a.call(t);for(f in r)t.style[f]=h[f];return l},Ys=new RegExp(pt.join("|"),"i");(function(){function t(){if(I){b.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",I.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Pt.appendChild(b).appendChild(I);var F=e.getComputedStyle(I);a=F.top!=="1%",S=r(F.marginLeft)===12,I.style.right="60%",h=r(F.right)===36,l=r(F.width)===36,I.style.position="absolute",f=r(I.offsetWidth/3)===12,Pt.removeChild(b),I=null}}function r(F){return Math.round(parseFloat(F))}var a,l,f,h,g,S,b=v.createElement("div"),I=v.createElement("div");I.style&&(I.style.backgroundClip="content-box",I.cloneNode(!0).style.backgroundClip="",A.clearCloneStyle=I.style.backgroundClip==="content-box",o.extend(A,{boxSizingReliable:function(){return t(),l},pixelBoxStyles:function(){return t(),h},pixelPosition:function(){return t(),a},reliableMarginLeft:function(){return t(),S},scrollboxSize:function(){return t(),f},reliableTrDimensions:function(){var F,V,B,q;return g==null&&(F=v.createElement("table"),V=v.createElement("tr"),B=v.createElement("div"),F.style.cssText="position:absolute;left:-11111px;border-collapse:separate",V.style.cssText="box-sizing:content-box;border:1px solid",V.style.height="1px",B.style.height="9px",B.style.display="block",Pt.appendChild(F).appendChild(V).appendChild(B),q=e.getComputedStyle(V),g=parseInt(q.height,10)+parseInt(q.borderTopWidth,10)+parseInt(q.borderBottomWidth,10)===V.offsetHeight,Pt.removeChild(F)),g}}))})();function mn(t,r,a){var l,f,h,g,S=pr.test(r),b=t.style;return a=a||Fn(t),a&&(g=a.getPropertyValue(r)||a[r],S&&g&&(g=g.replace(me,"$1")||void 0),g===""&&!Yt(t)&&(g=o.style(t,r)),!A.pixelBoxStyles()&&dr.test(g)&&Ys.test(r)&&(l=b.width,f=b.minWidth,h=b.maxWidth,b.minWidth=b.maxWidth=b.width=g,g=a.width,b.width=l,b.minWidth=f,b.maxWidth=h)),g!==void 0?g+"":g}function pi(t,r){return{get:function(){if(t()){delete this.get;return}return(this.get=r).apply(this,arguments)}}}var gi=["Webkit","Moz","ms"],mi=v.createElement("div").style,yi={};function Ws(t){for(var r=t[0].toUpperCase()+t.slice(1),a=gi.length;a--;)if(t=gi[a]+r,t in mi)return t}function gr(t){var r=o.cssProps[t]||yi[t];return r||(t in mi?t:yi[t]=Ws(t)||t)}var Ks=/^(none|table(?!-c[ea]).+)/,Xs={position:"absolute",visibility:"hidden",display:"block"},xi={letterSpacing:"0",fontWeight:"400"};function vi(t,r,a){var l=pn.exec(r);return l?Math.max(0,l[2]-(a||0))+(l[3]||"px"):r}function mr(t,r,a,l,f,h){var g=r==="width"?1:0,S=0,b=0,I=0;if(a===(l?"border":"content"))return 0;for(;g<4;g+=2)a==="margin"&&(I+=o.css(t,a+pt[g],!0,f)),l?(a==="content"&&(b-=o.css(t,"padding"+pt[g],!0,f)),a!=="margin"&&(b-=o.css(t,"border"+pt[g]+"Width",!0,f))):(b+=o.css(t,"padding"+pt[g],!0,f),a!=="padding"?b+=o.css(t,"border"+pt[g]+"Width",!0,f):S+=o.css(t,"border"+pt[g]+"Width",!0,f));return!l&&h>=0&&(b+=Math.max(0,Math.ceil(t["offset"+r[0].toUpperCase()+r.slice(1)]-h-b-S-.5))||0),b+I}function bi(t,r,a){var l=Fn(t),f=!A.boxSizingReliable()||a,h=f&&o.css(t,"boxSizing",!1,l)==="border-box",g=h,S=mn(t,r,l),b="offset"+r[0].toUpperCase()+r.slice(1);if(dr.test(S)){if(!a)return S;S="auto"}return(!A.boxSizingReliable()&&h||!A.reliableTrDimensions()&&z(t,"tr")||S==="auto"||!parseFloat(S)&&o.css(t,"display",!1,l)==="inline")&&t.getClientRects().length&&(h=o.css(t,"boxSizing",!1,l)==="border-box",g=b in t,g&&(S=t[b])),S=parseFloat(S)||0,S+mr(t,r,a||(h?"border":"content"),g,l,S)+"px"}o.extend({cssHooks:{opacity:{get:function(t,r){if(r){var a=mn(t,"opacity");return a===""?"1":a}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(t,r,a,l){if(!(!t||t.nodeType===3||t.nodeType===8||!t.style)){var f,h,g,S=tt(r),b=pr.test(r),I=t.style;if(b||(r=gr(S)),g=o.cssHooks[r]||o.cssHooks[S],a!==void 0){if(h=typeof a,h==="string"&&(f=pn.exec(a))&&f[1]&&(a=ii(t,r,f),h="number"),a==null||a!==a)return;h==="number"&&!b&&(a+=f&&f[3]||(o.cssNumber[S]?"":"px")),!A.clearCloneStyle&&a===""&&r.indexOf("background")===0&&(I[r]="inherit"),(!g||!("set"in g)||(a=g.set(t,a,l))!==void 0)&&(b?I.setProperty(r,a):I[r]=a)}else return g&&"get"in g&&(f=g.get(t,!1,l))!==void 0?f:I[r]}},css:function(t,r,a,l){var f,h,g,S=tt(r),b=pr.test(r);return b||(r=gr(S)),g=o.cssHooks[r]||o.cssHooks[S],g&&"get"in g&&(f=g.get(t,!0,a)),f===void 0&&(f=mn(t,r,l)),f==="normal"&&r in xi&&(f=xi[r]),a===""||a?(h=parseFloat(f),a===!0||isFinite(h)?h||0:f):f}}),o.each(["height","width"],function(t,r){o.cssHooks[r]={get:function(a,l,f){if(l)return Ks.test(o.css(a,"display"))&&(!a.getClientRects().length||!a.getBoundingClientRect().width)?di(a,Xs,function(){return bi(a,r,f)}):bi(a,r,f)},set:function(a,l,f){var h,g=Fn(a),S=!A.scrollboxSize()&&g.position==="absolute",b=S||f,I=b&&o.css(a,"boxSizing",!1,g)==="border-box",F=f?mr(a,r,f,I,g):0;return I&&S&&(F-=Math.ceil(a["offset"+r[0].toUpperCase()+r.slice(1)]-parseFloat(g[r])-mr(a,r,"border",!1,g)-.5)),F&&(h=pn.exec(l))&&(h[3]||"px")!=="px"&&(a.style[r]=l,l=o.css(a,r)),vi(a,l,F)}}}),o.cssHooks.marginLeft=pi(A.reliableMarginLeft,function(t,r){if(r)return(parseFloat(mn(t,"marginLeft"))||t.getBoundingClientRect().left-di(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),o.each({margin:"",padding:"",border:"Width"},function(t,r){o.cssHooks[t+r]={expand:function(a){for(var l=0,f={},h=typeof a=="string"?a.split(" "):[a];l<4;l++)f[t+pt[l]+r]=h[l]||h[l-2]||h[0];return f}},t!=="margin"&&(o.cssHooks[t+r].set=vi)}),o.fn.extend({css:function(t,r){return dt(this,function(a,l,f){var h,g,S={},b=0;if(Array.isArray(l)){for(h=Fn(a),g=l.length;b<g;b++)S[l[b]]=o.css(a,l[b],!1,h);return S}return f!==void 0?o.style(a,l,f):o.css(a,l)},t,r,arguments.length>1)}});function ke(t,r,a,l,f){return new ke.prototype.init(t,r,a,l,f)}o.Tween=ke,ke.prototype={constructor:ke,init:function(t,r,a,l,f,h){this.elem=t,this.prop=a,this.easing=f||o.easing._default,this.options=r,this.start=this.now=this.cur(),this.end=l,this.unit=h||(o.cssNumber[a]?"":"px")},cur:function(){var t=ke.propHooks[this.prop];return t&&t.get?t.get(this):ke.propHooks._default.get(this)},run:function(t){var r,a=ke.propHooks[this.prop];return this.options.duration?this.pos=r=o.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=r=t,this.now=(this.end-this.start)*r+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),a&&a.set?a.set(this):ke.propHooks._default.set(this),this}},ke.prototype.init.prototype=ke.prototype,ke.propHooks={_default:{get:function(t){var r;return t.elem.nodeType!==1||t.elem[t.prop]!=null&&t.elem.style[t.prop]==null?t.elem[t.prop]:(r=o.css(t.elem,t.prop,""),!r||r==="auto"?0:r)},set:function(t){o.fx.step[t.prop]?o.fx.step[t.prop](t):t.elem.nodeType===1&&(o.cssHooks[t.prop]||t.elem.style[gr(t.prop)]!=null)?o.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},ke.propHooks.scrollTop=ke.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},o.easing={linear:function(t){return t},swing:function(t){return .5-Math.cos(t*Math.PI)/2},_default:"swing"},o.fx=ke.prototype.init,o.fx.step={};var Jt,Gn,Qs=/^(?:toggle|show|hide)$/,Js=/queueHooks$/;function yr(){Gn&&(v.hidden===!1&&e.requestAnimationFrame?e.requestAnimationFrame(yr):e.setTimeout(yr,o.fx.interval),o.fx.tick())}function wi(){return e.setTimeout(function(){Jt=void 0}),Jt=Date.now()}function kn(t,r){var a,l=0,f={height:t};for(r=r?1:0;l<4;l+=2-r)a=pt[l],f["margin"+a]=f["padding"+a]=t;return r&&(f.opacity=f.width=t),f}function Ti(t,r,a){for(var l,f=(Qe.tweeners[r]||[]).concat(Qe.tweeners["*"]),h=0,g=f.length;h<g;h++)if(l=f[h].call(a,r,t))return l}function Zs(t,r,a){var l,f,h,g,S,b,I,F,V="width"in r||"height"in r,B=this,q={},se=t.style,xe=t.nodeType&&Dn(t),fe=ee.get(t,"fxshow");a.queue||(g=o._queueHooks(t,"fx"),g.unqueued==null&&(g.unqueued=0,S=g.empty.fire,g.empty.fire=function(){g.unqueued||S()}),g.unqueued++,B.always(function(){B.always(function(){g.unqueued--,o.queue(t,"fx").length||g.empty.fire()})}));for(l in r)if(f=r[l],Qs.test(f)){if(delete r[l],h=h||f==="toggle",f===(xe?"hide":"show"))if(f==="show"&&fe&&fe[l]!==void 0)xe=!0;else continue;q[l]=fe&&fe[l]||o.style(t,l)}if(b=!o.isEmptyObject(r),!(!b&&o.isEmptyObject(q))){V&&t.nodeType===1&&(a.overflow=[se.overflow,se.overflowX,se.overflowY],I=fe&&fe.display,I==null&&(I=ee.get(t,"display")),F=o.css(t,"display"),F==="none"&&(I?F=I:(Wt([t],!0),I=t.style.display||I,F=o.css(t,"display"),Wt([t]))),(F==="inline"||F==="inline-block"&&I!=null)&&o.css(t,"float")==="none"&&(b||(B.done(function(){se.display=I}),I==null&&(F=se.display,I=F==="none"?"":F)),se.display="inline-block")),a.overflow&&(se.overflow="hidden",B.always(function(){se.overflow=a.overflow[0],se.overflowX=a.overflow[1],se.overflowY=a.overflow[2]})),b=!1;for(l in q)b||(fe?"hidden"in fe&&(xe=fe.hidden):fe=ee.access(t,"fxshow",{display:I}),h&&(fe.hidden=!xe),xe&&Wt([t],!0),B.done(function(){xe||Wt([t]),ee.remove(t,"fxshow");for(l in q)o.style(t,l,q[l])})),b=Ti(xe?fe[l]:0,l,B),l in fe||(fe[l]=b.start,xe&&(b.end=b.start,b.start=0))}}function eo(t,r){var a,l,f,h,g;for(a in t)if(l=tt(a),f=r[l],h=t[a],Array.isArray(h)&&(f=h[1],h=t[a]=h[0]),a!==l&&(t[l]=h,delete t[a]),g=o.cssHooks[l],g&&"expand"in g){h=g.expand(h),delete t[l];for(a in h)a in t||(t[a]=h[a],r[a]=f)}else r[l]=f}function Qe(t,r,a){var l,f,h=0,g=Qe.prefilters.length,S=o.Deferred().always(function(){delete b.elem}),b=function(){if(f)return!1;for(var V=Jt||wi(),B=Math.max(0,I.startTime+I.duration-V),q=B/I.duration||0,se=1-q,xe=0,fe=I.tweens.length;xe<fe;xe++)I.tweens[xe].run(se);return S.notifyWith(t,[I,se,B]),se<1&&fe?B:(fe||S.notifyWith(t,[I,1,0]),S.resolveWith(t,[I]),!1)},I=S.promise({elem:t,props:o.extend({},r),opts:o.extend(!0,{specialEasing:{},easing:o.easing._default},a),originalProperties:r,originalOptions:a,startTime:Jt||wi(),duration:a.duration,tweens:[],createTween:function(V,B){var q=o.Tween(t,I.opts,V,B,I.opts.specialEasing[V]||I.opts.easing);return I.tweens.push(q),q},stop:function(V){var B=0,q=V?I.tweens.length:0;if(f)return this;for(f=!0;B<q;B++)I.tweens[B].run(1);return V?(S.notifyWith(t,[I,1,0]),S.resolveWith(t,[I,V])):S.rejectWith(t,[I,V]),this}}),F=I.props;for(eo(F,I.opts.specialEasing);h<g;h++)if(l=Qe.prefilters[h].call(I,t,F,I.opts),l)return R(l.stop)&&(o._queueHooks(I.elem,I.opts.queue).stop=l.stop.bind(l)),l;return o.map(F,Ti,I),R(I.opts.start)&&I.opts.start.call(t,I),I.progress(I.opts.progress).done(I.opts.done,I.opts.complete).fail(I.opts.fail).always(I.opts.always),o.fx.timer(o.extend(b,{elem:t,anim:I,queue:I.opts.queue})),I}o.Animation=o.extend(Qe,{tweeners:{"*":[function(t,r){var a=this.createTween(t,r);return ii(a.elem,t,pn.exec(r),a),a}]},tweener:function(t,r){R(t)?(r=t,t=["*"]):t=t.match(Oe);for(var a,l=0,f=t.length;l<f;l++)a=t[l],Qe.tweeners[a]=Qe.tweeners[a]||[],Qe.tweeners[a].unshift(r)},prefilters:[Zs],prefilter:function(t,r){r?Qe.prefilters.unshift(t):Qe.prefilters.push(t)}}),o.speed=function(t,r,a){var l=t&&typeof t=="object"?o.extend({},t):{complete:a||!a&&r||R(t)&&t,duration:t,easing:a&&r||r&&!R(r)&&r};return o.fx.off?l.duration=0:typeof l.duration!="number"&&(l.duration in o.fx.speeds?l.duration=o.fx.speeds[l.duration]:l.duration=o.fx.speeds._default),(l.queue==null||l.queue===!0)&&(l.queue="fx"),l.old=l.complete,l.complete=function(){R(l.old)&&l.old.call(this),l.queue&&o.dequeue(this,l.queue)},l},o.fn.extend({fadeTo:function(t,r,a,l){return this.filter(Dn).css("opacity",0).show().end().animate({opacity:r},t,a,l)},animate:function(t,r,a,l){var f=o.isEmptyObject(t),h=o.speed(r,a,l),g=function(){var S=Qe(this,o.extend({},t),h);(f||ee.get(this,"finish"))&&S.stop(!0)};return g.finish=g,f||h.queue===!1?this.each(g):this.queue(h.queue,g)},stop:function(t,r,a){var l=function(f){var h=f.stop;delete f.stop,h(a)};return typeof t!="string"&&(a=r,r=t,t=void 0),r&&this.queue(t||"fx",[]),this.each(function(){var f=!0,h=t!=null&&t+"queueHooks",g=o.timers,S=ee.get(this);if(h)S[h]&&S[h].stop&&l(S[h]);else for(h in S)S[h]&&S[h].stop&&Js.test(h)&&l(S[h]);for(h=g.length;h--;)g[h].elem===this&&(t==null||g[h].queue===t)&&(g[h].anim.stop(a),f=!1,g.splice(h,1));(f||!a)&&o.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var r,a=ee.get(this),l=a[t+"queue"],f=a[t+"queueHooks"],h=o.timers,g=l?l.length:0;for(a.finish=!0,o.queue(this,t,[]),f&&f.stop&&f.stop.call(this,!0),r=h.length;r--;)h[r].elem===this&&h[r].queue===t&&(h[r].anim.stop(!0),h.splice(r,1));for(r=0;r<g;r++)l[r]&&l[r].finish&&l[r].finish.call(this);delete a.finish})}}),o.each(["toggle","show","hide"],function(t,r){var a=o.fn[r];o.fn[r]=function(l,f,h){return l==null||typeof l=="boolean"?a.apply(this,arguments):this.animate(kn(r,!0),l,f,h)}}),o.each({slideDown:kn("show"),slideUp:kn("hide"),slideToggle:kn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,r){o.fn[t]=function(a,l,f){return this.animate(r,a,l,f)}}),o.timers=[],o.fx.tick=function(){var t,r=0,a=o.timers;for(Jt=Date.now();r<a.length;r++)t=a[r],!t()&&a[r]===t&&a.splice(r--,1);a.length||o.fx.stop(),Jt=void 0},o.fx.timer=function(t){o.timers.push(t),o.fx.start()},o.fx.interval=13,o.fx.start=function(){Gn||(Gn=!0,yr())},o.fx.stop=function(){Gn=null},o.fx.speeds={slow:600,fast:200,_default:400},o.fn.delay=function(t,r){return t=o.fx&&o.fx.speeds[t]||t,r=r||"fx",this.queue(r,function(a,l){var f=e.setTimeout(a,t);l.stop=function(){e.clearTimeout(f)}})},function(){var t=v.createElement("input"),r=v.createElement("select"),a=r.appendChild(v.createElement("option"));t.type="checkbox",A.checkOn=t.value!=="",A.optSelected=a.selected,t=v.createElement("input"),t.value="t",t.type="radio",A.radioValue=t.value==="t"}();var Ei,yn=o.expr.attrHandle;o.fn.extend({attr:function(t,r){return dt(this,o.attr,t,r,arguments.length>1)},removeAttr:function(t){return this.each(function(){o.removeAttr(this,t)})}}),o.extend({attr:function(t,r,a){var l,f,h=t.nodeType;if(!(h===3||h===8||h===2)){if(typeof t.getAttribute>"u")return o.prop(t,r,a);if((h!==1||!o.isXMLDoc(t))&&(f=o.attrHooks[r.toLowerCase()]||(o.expr.match.bool.test(r)?Ei:void 0)),a!==void 0){if(a===null){o.removeAttr(t,r);return}return f&&"set"in f&&(l=f.set(t,a,r))!==void 0?l:(t.setAttribute(r,a+""),a)}return f&&"get"in f&&(l=f.get(t,r))!==null?l:(l=o.find.attr(t,r),l??void 0)}},attrHooks:{type:{set:function(t,r){if(!A.radioValue&&r==="radio"&&z(t,"input")){var a=t.value;return t.setAttribute("type",r),a&&(t.value=a),r}}}},removeAttr:function(t,r){var a,l=0,f=r&&r.match(Oe);if(f&&t.nodeType===1)for(;a=f[l++];)t.removeAttribute(a)}}),Ei={set:function(t,r,a){return r===!1?o.removeAttr(t,a):t.setAttribute(a,a),a}},o.each(o.expr.match.bool.source.match(/\w+/g),function(t,r){var a=yn[r]||o.find.attr;yn[r]=function(l,f,h){var g,S,b=f.toLowerCase();return h||(S=yn[b],yn[b]=g,g=a(l,f,h)!=null?b:null,yn[b]=S),g}});var to=/^(?:input|select|textarea|button)$/i,no=/^(?:a|area)$/i;o.fn.extend({prop:function(t,r){return dt(this,o.prop,t,r,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[o.propFix[t]||t]})}}),o.extend({prop:function(t,r,a){var l,f,h=t.nodeType;if(!(h===3||h===8||h===2))return(h!==1||!o.isXMLDoc(t))&&(r=o.propFix[r]||r,f=o.propHooks[r]),a!==void 0?f&&"set"in f&&(l=f.set(t,a,r))!==void 0?l:t[r]=a:f&&"get"in f&&(l=f.get(t,r))!==null?l:t[r]},propHooks:{tabIndex:{get:function(t){var r=o.find.attr(t,"tabindex");return r?parseInt(r,10):to.test(t.nodeName)||no.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),A.optSelected||(o.propHooks.selected={get:function(t){var r=t.parentNode;return r&&r.parentNode&&r.parentNode.selectedIndex,null},set:function(t){var r=t.parentNode;r&&(r.selectedIndex,r.parentNode&&r.parentNode.selectedIndex)}}),o.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){o.propFix[this.toLowerCase()]=this});function Bt(t){var r=t.match(Oe)||[];return r.join(" ")}function Nt(t){return t.getAttribute&&t.getAttribute("class")||""}function xr(t){return Array.isArray(t)?t:typeof t=="string"?t.match(Oe)||[]:[]}o.fn.extend({addClass:function(t){var r,a,l,f,h,g;return R(t)?this.each(function(S){o(this).addClass(t.call(this,S,Nt(this)))}):(r=xr(t),r.length?this.each(function(){if(l=Nt(this),a=this.nodeType===1&&" "+Bt(l)+" ",a){for(h=0;h<r.length;h++)f=r[h],a.indexOf(" "+f+" ")<0&&(a+=f+" ");g=Bt(a),l!==g&&this.setAttribute("class",g)}}):this)},removeClass:function(t){var r,a,l,f,h,g;return R(t)?this.each(function(S){o(this).removeClass(t.call(this,S,Nt(this)))}):arguments.length?(r=xr(t),r.length?this.each(function(){if(l=Nt(this),a=this.nodeType===1&&" "+Bt(l)+" ",a){for(h=0;h<r.length;h++)for(f=r[h];a.indexOf(" "+f+" ")>-1;)a=a.replace(" "+f+" "," ");g=Bt(a),l!==g&&this.setAttribute("class",g)}}):this):this.attr("class","")},toggleClass:function(t,r){var a,l,f,h,g=typeof t,S=g==="string"||Array.isArray(t);return R(t)?this.each(function(b){o(this).toggleClass(t.call(this,b,Nt(this),r),r)}):typeof r=="boolean"&&S?r?this.addClass(t):this.removeClass(t):(a=xr(t),this.each(function(){if(S)for(h=o(this),f=0;f<a.length;f++)l=a[f],h.hasClass(l)?h.removeClass(l):h.addClass(l);else(t===void 0||g==="boolean")&&(l=Nt(this),l&&ee.set(this,"__className__",l),this.setAttribute&&this.setAttribute("class",l||t===!1?"":ee.get(this,"__className__")||""))}))},hasClass:function(t){var r,a,l=0;for(r=" "+t+" ";a=this[l++];)if(a.nodeType===1&&(" "+Bt(Nt(a))+" ").indexOf(r)>-1)return!0;return!1}});var ro=/\r/g;o.fn.extend({val:function(t){var r,a,l,f=this[0];return arguments.length?(l=R(t),this.each(function(h){var g;this.nodeType===1&&(l?g=t.call(this,h,o(this).val()):g=t,g==null?g="":typeof g=="number"?g+="":Array.isArray(g)&&(g=o.map(g,function(S){return S==null?"":S+""})),r=o.valHooks[this.type]||o.valHooks[this.nodeName.toLowerCase()],(!r||!("set"in r)||r.set(this,g,"value")===void 0)&&(this.value=g))})):f?(r=o.valHooks[f.type]||o.valHooks[f.nodeName.toLowerCase()],r&&"get"in r&&(a=r.get(f,"value"))!==void 0?a:(a=f.value,typeof a=="string"?a.replace(ro,""):a??"")):void 0}}),o.extend({valHooks:{option:{get:function(t){var r=o.find.attr(t,"value");return r??Bt(o.text(t))}},select:{get:function(t){var r,a,l,f=t.options,h=t.selectedIndex,g=t.type==="select-one",S=g?null:[],b=g?h+1:f.length;for(h<0?l=b:l=g?h:0;l<b;l++)if(a=f[l],(a.selected||l===h)&&!a.disabled&&(!a.parentNode.disabled||!z(a.parentNode,"optgroup"))){if(r=o(a).val(),g)return r;S.push(r)}return S},set:function(t,r){for(var a,l,f=t.options,h=o.makeArray(r),g=f.length;g--;)l=f[g],(l.selected=o.inArray(o.valHooks.option.get(l),h)>-1)&&(a=!0);return a||(t.selectedIndex=-1),h}}}}),o.each(["radio","checkbox"],function(){o.valHooks[this]={set:function(t,r){if(Array.isArray(r))return t.checked=o.inArray(o(t).val(),r)>-1}},A.checkOn||(o.valHooks[this].get=function(t){return t.getAttribute("value")===null?"on":t.value})});var xn=e.location,Si={guid:Date.now()},vr=/\?/;o.parseXML=function(t){var r,a;if(!t||typeof t!="string")return null;try{r=new e.DOMParser().parseFromString(t,"text/xml")}catch{}return a=r&&r.getElementsByTagName("parsererror")[0],(!r||a)&&o.error("Invalid XML: "+(a?o.map(a.childNodes,function(l){return l.textContent}).join(`
`):t)),r};var Ai=/^(?:focusinfocus|focusoutblur)$/,Ci=function(t){t.stopPropagation()};o.extend(o.event,{trigger:function(t,r,a,l){var f,h,g,S,b,I,F,V,B=[a||v],q=T.call(t,"type")?t.type:t,se=T.call(t,"namespace")?t.namespace.split("."):[];if(h=V=g=a=a||v,!(a.nodeType===3||a.nodeType===8)&&!Ai.test(q+o.event.triggered)&&(q.indexOf(".")>-1&&(se=q.split("."),q=se.shift(),se.sort()),b=q.indexOf(":")<0&&"on"+q,t=t[o.expando]?t:new o.Event(q,typeof t=="object"&&t),t.isTrigger=l?2:3,t.namespace=se.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+se.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=a),r=r==null?[t]:o.makeArray(r,[t]),F=o.event.special[q]||{},!(!l&&F.trigger&&F.trigger.apply(a,r)===!1))){if(!l&&!F.noBubble&&!O(a)){for(S=F.delegateType||q,Ai.test(S+q)||(h=h.parentNode);h;h=h.parentNode)B.push(h),g=h;g===(a.ownerDocument||v)&&B.push(g.defaultView||g.parentWindow||e)}for(f=0;(h=B[f++])&&!t.isPropagationStopped();)V=h,t.type=f>1?S:F.bindType||q,I=(ee.get(h,"events")||Object.create(null))[t.type]&&ee.get(h,"handle"),I&&I.apply(h,r),I=b&&h[b],I&&I.apply&&hn(h)&&(t.result=I.apply(h,r),t.result===!1&&t.preventDefault());return t.type=q,!l&&!t.isDefaultPrevented()&&(!F._default||F._default.apply(B.pop(),r)===!1)&&hn(a)&&b&&R(a[q])&&!O(a)&&(g=a[b],g&&(a[b]=null),o.event.triggered=q,t.isPropagationStopped()&&V.addEventListener(q,Ci),a[q](),t.isPropagationStopped()&&V.removeEventListener(q,Ci),o.event.triggered=void 0,g&&(a[b]=g)),t.result}},simulate:function(t,r,a){var l=o.extend(new o.Event,a,{type:t,isSimulated:!0});o.event.trigger(l,null,r)}}),o.fn.extend({trigger:function(t,r){return this.each(function(){o.event.trigger(t,r,this)})},triggerHandler:function(t,r){var a=this[0];if(a)return o.event.trigger(t,r,a,!0)}});var io=/\[\]$/,Ii=/\r?\n/g,so=/^(?:submit|button|image|reset|file)$/i,oo=/^(?:input|select|textarea|keygen)/i;function br(t,r,a,l){var f;if(Array.isArray(r))o.each(r,function(h,g){a||io.test(t)?l(t,g):br(t+"["+(typeof g=="object"&&g!=null?h:"")+"]",g,a,l)});else if(!a&&_(r)==="object")for(f in r)br(t+"["+f+"]",r[f],a,l);else l(t,r)}o.param=function(t,r){var a,l=[],f=function(h,g){var S=R(g)?g():g;l[l.length]=encodeURIComponent(h)+"="+encodeURIComponent(S??"")};if(t==null)return"";if(Array.isArray(t)||t.jquery&&!o.isPlainObject(t))o.each(t,function(){f(this.name,this.value)});else for(a in t)br(a,t[a],r,f);return l.join("&")},o.fn.extend({serialize:function(){return o.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=o.prop(this,"elements");return t?o.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!o(this).is(":disabled")&&oo.test(this.nodeName)&&!so.test(t)&&(this.checked||!gn.test(t))}).map(function(t,r){var a=o(this).val();return a==null?null:Array.isArray(a)?o.map(a,function(l){return{name:r.name,value:l.replace(Ii,`\r
`)}}):{name:r.name,value:a.replace(Ii,`\r
`)}}).get()}});var ao=/%20/g,co=/#.*$/,uo=/([?&])_=[^&]*/,lo=/^(.*?):[ \t]*([^\r\n]*)$/mg,fo=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ho=/^(?:GET|HEAD)$/,po=/^\/\//,Mi={},wr={},Ri="*/".concat("*"),Tr=v.createElement("a");Tr.href=xn.href;function Pi(t){return function(r,a){typeof r!="string"&&(a=r,r="*");var l,f=0,h=r.toLowerCase().match(Oe)||[];if(R(a))for(;l=h[f++];)l[0]==="+"?(l=l.slice(1)||"*",(t[l]=t[l]||[]).unshift(a)):(t[l]=t[l]||[]).push(a)}}function Bi(t,r,a,l){var f={},h=t===wr;function g(S){var b;return f[S]=!0,o.each(t[S]||[],function(I,F){var V=F(r,a,l);if(typeof V=="string"&&!h&&!f[V])return r.dataTypes.unshift(V),g(V),!1;if(h)return!(b=V)}),b}return g(r.dataTypes[0])||!f["*"]&&g("*")}function Er(t,r){var a,l,f=o.ajaxSettings.flatOptions||{};for(a in r)r[a]!==void 0&&((f[a]?t:l||(l={}))[a]=r[a]);return l&&o.extend(!0,t,l),t}function go(t,r,a){for(var l,f,h,g,S=t.contents,b=t.dataTypes;b[0]==="*";)b.shift(),l===void 0&&(l=t.mimeType||r.getResponseHeader("Content-Type"));if(l){for(f in S)if(S[f]&&S[f].test(l)){b.unshift(f);break}}if(b[0]in a)h=b[0];else{for(f in a){if(!b[0]||t.converters[f+" "+b[0]]){h=f;break}g||(g=f)}h=h||g}if(h)return h!==b[0]&&b.unshift(h),a[h]}function mo(t,r,a,l){var f,h,g,S,b,I={},F=t.dataTypes.slice();if(F[1])for(g in t.converters)I[g.toLowerCase()]=t.converters[g];for(h=F.shift();h;)if(t.responseFields[h]&&(a[t.responseFields[h]]=r),!b&&l&&t.dataFilter&&(r=t.dataFilter(r,t.dataType)),b=h,h=F.shift(),h){if(h==="*")h=b;else if(b!=="*"&&b!==h){if(g=I[b+" "+h]||I["* "+h],!g){for(f in I)if(S=f.split(" "),S[1]===h&&(g=I[b+" "+S[0]]||I["* "+S[0]],g)){g===!0?g=I[f]:I[f]!==!0&&(h=S[0],F.unshift(S[1]));break}}if(g!==!0)if(g&&t.throws)r=g(r);else try{r=g(r)}catch(V){return{state:"parsererror",error:g?V:"No conversion from "+b+" to "+h}}}}return{state:"success",data:r}}o.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:xn.href,type:"GET",isLocal:fo.test(xn.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ri,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":o.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,r){return r?Er(Er(t,o.ajaxSettings),r):Er(o.ajaxSettings,t)},ajaxPrefilter:Pi(Mi),ajaxTransport:Pi(wr),ajax:function(t,r){typeof t=="object"&&(r=t,t=void 0),r=r||{};var a,l,f,h,g,S,b,I,F,V,B=o.ajaxSetup({},r),q=B.context||B,se=B.context&&(q.nodeType||q.jquery)?o(q):o.event,xe=o.Deferred(),fe=o.Callbacks("once memory"),Pe=B.statusCode||{},Me={},nt={},rt="canceled",ye={readyState:0,getResponseHeader:function(ve){var Ie;if(b){if(!h)for(h={};Ie=lo.exec(f);)h[Ie[1].toLowerCase()+" "]=(h[Ie[1].toLowerCase()+" "]||[]).concat(Ie[2]);Ie=h[ve.toLowerCase()+" "]}return Ie==null?null:Ie.join(", ")},getAllResponseHeaders:function(){return b?f:null},setRequestHeader:function(ve,Ie){return b==null&&(ve=nt[ve.toLowerCase()]=nt[ve.toLowerCase()]||ve,Me[ve]=Ie),this},overrideMimeType:function(ve){return b==null&&(B.mimeType=ve),this},statusCode:function(ve){var Ie;if(ve)if(b)ye.always(ve[ye.status]);else for(Ie in ve)Pe[Ie]=[Pe[Ie],ve[Ie]];return this},abort:function(ve){var Ie=ve||rt;return a&&a.abort(Ie),Ot(0,Ie),this}};if(xe.promise(ye),B.url=((t||B.url||xn.href)+"").replace(po,xn.protocol+"//"),B.type=r.method||r.type||B.method||B.type,B.dataTypes=(B.dataType||"*").toLowerCase().match(Oe)||[""],B.crossDomain==null){S=v.createElement("a");try{S.href=B.url,S.href=S.href,B.crossDomain=Tr.protocol+"//"+Tr.host!=S.protocol+"//"+S.host}catch{B.crossDomain=!0}}if(B.data&&B.processData&&typeof B.data!="string"&&(B.data=o.param(B.data,B.traditional)),Bi(Mi,B,r,ye),b)return ye;I=o.event&&B.global,I&&o.active++===0&&o.event.trigger("ajaxStart"),B.type=B.type.toUpperCase(),B.hasContent=!ho.test(B.type),l=B.url.replace(co,""),B.hasContent?B.data&&B.processData&&(B.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(B.data=B.data.replace(ao,"+")):(V=B.url.slice(l.length),B.data&&(B.processData||typeof B.data=="string")&&(l+=(vr.test(l)?"&":"?")+B.data,delete B.data),B.cache===!1&&(l=l.replace(uo,"$1"),V=(vr.test(l)?"&":"?")+"_="+Si.guid+++V),B.url=l+V),B.ifModified&&(o.lastModified[l]&&ye.setRequestHeader("If-Modified-Since",o.lastModified[l]),o.etag[l]&&ye.setRequestHeader("If-None-Match",o.etag[l])),(B.data&&B.hasContent&&B.contentType!==!1||r.contentType)&&ye.setRequestHeader("Content-Type",B.contentType),ye.setRequestHeader("Accept",B.dataTypes[0]&&B.accepts[B.dataTypes[0]]?B.accepts[B.dataTypes[0]]+(B.dataTypes[0]!=="*"?", "+Ri+"; q=0.01":""):B.accepts["*"]);for(F in B.headers)ye.setRequestHeader(F,B.headers[F]);if(B.beforeSend&&(B.beforeSend.call(q,ye,B)===!1||b))return ye.abort();if(rt="abort",fe.add(B.complete),ye.done(B.success),ye.fail(B.error),a=Bi(wr,B,r,ye),!a)Ot(-1,"No Transport");else{if(ye.readyState=1,I&&se.trigger("ajaxSend",[ye,B]),b)return ye;B.async&&B.timeout>0&&(g=e.setTimeout(function(){ye.abort("timeout")},B.timeout));try{b=!1,a.send(Me,Ot)}catch(ve){if(b)throw ve;Ot(-1,ve)}}function Ot(ve,Ie,bn,Ar){var it,wn,st,wt,Tt,$e=Ie;b||(b=!0,g&&e.clearTimeout(g),a=void 0,f=Ar||"",ye.readyState=ve>0?4:0,it=ve>=200&&ve<300||ve===304,bn&&(wt=go(B,ye,bn)),!it&&o.inArray("script",B.dataTypes)>-1&&o.inArray("json",B.dataTypes)<0&&(B.converters["text script"]=function(){}),wt=mo(B,wt,ye,it),it?(B.ifModified&&(Tt=ye.getResponseHeader("Last-Modified"),Tt&&(o.lastModified[l]=Tt),Tt=ye.getResponseHeader("etag"),Tt&&(o.etag[l]=Tt)),ve===204||B.type==="HEAD"?$e="nocontent":ve===304?$e="notmodified":($e=wt.state,wn=wt.data,st=wt.error,it=!st)):(st=$e,(ve||!$e)&&($e="error",ve<0&&(ve=0))),ye.status=ve,ye.statusText=(Ie||$e)+"",it?xe.resolveWith(q,[wn,$e,ye]):xe.rejectWith(q,[ye,$e,st]),ye.statusCode(Pe),Pe=void 0,I&&se.trigger(it?"ajaxSuccess":"ajaxError",[ye,B,it?wn:st]),fe.fireWith(q,[ye,$e]),I&&(se.trigger("ajaxComplete",[ye,B]),--o.active||o.event.trigger("ajaxStop")))}return ye},getJSON:function(t,r,a){return o.get(t,r,a,"json")},getScript:function(t,r){return o.get(t,void 0,r,"script")}}),o.each(["get","post"],function(t,r){o[r]=function(a,l,f,h){return R(l)&&(h=h||f,f=l,l=void 0),o.ajax(o.extend({url:a,type:r,dataType:h,data:l,success:f},o.isPlainObject(a)&&a))}}),o.ajaxPrefilter(function(t){var r;for(r in t.headers)r.toLowerCase()==="content-type"&&(t.contentType=t.headers[r]||"")}),o._evalUrl=function(t,r,a){return o.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(l){o.globalEval(l,r,a)}})},o.fn.extend({wrapAll:function(t){var r;return this[0]&&(R(t)&&(t=t.call(this[0])),r=o(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&r.insertBefore(this[0]),r.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(t){return R(t)?this.each(function(r){o(this).wrapInner(t.call(this,r))}):this.each(function(){var r=o(this),a=r.contents();a.length?a.wrapAll(t):r.append(t)})},wrap:function(t){var r=R(t);return this.each(function(a){o(this).wrapAll(r?t.call(this,a):t)})},unwrap:function(t){return this.parent(t).not("body").each(function(){o(this).replaceWith(this.childNodes)}),this}}),o.expr.pseudos.hidden=function(t){return!o.expr.pseudos.visible(t)},o.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},o.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch{}};var yo={0:200,1223:204},vn=o.ajaxSettings.xhr();A.cors=!!vn&&"withCredentials"in vn,A.ajax=vn=!!vn,o.ajaxTransport(function(t){var r,a;if(A.cors||vn&&!t.crossDomain)return{send:function(l,f){var h,g=t.xhr();if(g.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(h in t.xhrFields)g[h]=t.xhrFields[h];t.mimeType&&g.overrideMimeType&&g.overrideMimeType(t.mimeType),!t.crossDomain&&!l["X-Requested-With"]&&(l["X-Requested-With"]="XMLHttpRequest");for(h in l)g.setRequestHeader(h,l[h]);r=function(S){return function(){r&&(r=a=g.onload=g.onerror=g.onabort=g.ontimeout=g.onreadystatechange=null,S==="abort"?g.abort():S==="error"?typeof g.status!="number"?f(0,"error"):f(g.status,g.statusText):f(yo[g.status]||g.status,g.statusText,(g.responseType||"text")!=="text"||typeof g.responseText!="string"?{binary:g.response}:{text:g.responseText},g.getAllResponseHeaders()))}},g.onload=r(),a=g.onerror=g.ontimeout=r("error"),g.onabort!==void 0?g.onabort=a:g.onreadystatechange=function(){g.readyState===4&&e.setTimeout(function(){r&&a()})},r=r("abort");try{g.send(t.hasContent&&t.data||null)}catch(S){if(r)throw S}},abort:function(){r&&r()}}}),o.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),o.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return o.globalEval(t),t}}}),o.ajaxPrefilter("script",function(t){t.cache===void 0&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),o.ajaxTransport("script",function(t){if(t.crossDomain||t.scriptAttrs){var r,a;return{send:function(l,f){r=o("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",a=function(h){r.remove(),a=null,h&&f(h.type==="error"?404:200,h.type)}),v.head.appendChild(r[0])},abort:function(){a&&a()}}}});var Ni=[],Sr=/(=)\?(?=&|$)|\?\?/;o.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Ni.pop()||o.expando+"_"+Si.guid++;return this[t]=!0,t}}),o.ajaxPrefilter("json jsonp",function(t,r,a){var l,f,h,g=t.jsonp!==!1&&(Sr.test(t.url)?"url":typeof t.data=="string"&&(t.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Sr.test(t.data)&&"data");if(g||t.dataTypes[0]==="jsonp")return l=t.jsonpCallback=R(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,g?t[g]=t[g].replace(Sr,"$1"+l):t.jsonp!==!1&&(t.url+=(vr.test(t.url)?"&":"?")+t.jsonp+"="+l),t.converters["script json"]=function(){return h||o.error(l+" was not called"),h[0]},t.dataTypes[0]="json",f=e[l],e[l]=function(){h=arguments},a.always(function(){f===void 0?o(e).removeProp(l):e[l]=f,t[l]&&(t.jsonpCallback=r.jsonpCallback,Ni.push(l)),h&&R(f)&&f(h[0]),h=f=void 0}),"script"}),A.createHTMLDocument=function(){var t=v.implementation.createHTMLDocument("").body;return t.innerHTML="<form></form><form></form>",t.childNodes.length===2}(),o.parseHTML=function(t,r,a){if(typeof t!="string")return[];typeof r=="boolean"&&(a=r,r=!1);var l,f,h;return r||(A.createHTMLDocument?(r=v.implementation.createHTMLDocument(""),l=r.createElement("base"),l.href=v.location.href,r.head.appendChild(l)):r=v),f=bt.exec(t),h=!a&&[],f?[r.createElement(f[1])]:(f=ci([t],r,h),h&&h.length&&o(h).remove(),o.merge([],f.childNodes))},o.fn.load=function(t,r,a){var l,f,h,g=this,S=t.indexOf(" ");return S>-1&&(l=Bt(t.slice(S)),t=t.slice(0,S)),R(r)?(a=r,r=void 0):r&&typeof r=="object"&&(f="POST"),g.length>0&&o.ajax({url:t,type:f||"GET",dataType:"html",data:r}).done(function(b){h=arguments,g.html(l?o("<div>").append(o.parseHTML(b)).find(l):b)}).always(a&&function(b,I){g.each(function(){a.apply(this,h||[b.responseText,I,b])})}),this},o.expr.pseudos.animated=function(t){return o.grep(o.timers,function(r){return t===r.elem}).length},o.offset={setOffset:function(t,r,a){var l,f,h,g,S,b,I,F=o.css(t,"position"),V=o(t),B={};F==="static"&&(t.style.position="relative"),S=V.offset(),h=o.css(t,"top"),b=o.css(t,"left"),I=(F==="absolute"||F==="fixed")&&(h+b).indexOf("auto")>-1,I?(l=V.position(),g=l.top,f=l.left):(g=parseFloat(h)||0,f=parseFloat(b)||0),R(r)&&(r=r.call(t,a,o.extend({},S))),r.top!=null&&(B.top=r.top-S.top+g),r.left!=null&&(B.left=r.left-S.left+f),"using"in r?r.using.call(t,B):V.css(B)}},o.fn.extend({offset:function(t){if(arguments.length)return t===void 0?this:this.each(function(f){o.offset.setOffset(this,t,f)});var r,a,l=this[0];if(l)return l.getClientRects().length?(r=l.getBoundingClientRect(),a=l.ownerDocument.defaultView,{top:r.top+a.pageYOffset,left:r.left+a.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var t,r,a,l=this[0],f={top:0,left:0};if(o.css(l,"position")==="fixed")r=l.getBoundingClientRect();else{for(r=this.offset(),a=l.ownerDocument,t=l.offsetParent||a.documentElement;t&&(t===a.body||t===a.documentElement)&&o.css(t,"position")==="static";)t=t.parentNode;t&&t!==l&&t.nodeType===1&&(f=o(t).offset(),f.top+=o.css(t,"borderTopWidth",!0),f.left+=o.css(t,"borderLeftWidth",!0))}return{top:r.top-f.top-o.css(l,"marginTop",!0),left:r.left-f.left-o.css(l,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&o.css(t,"position")==="static";)t=t.offsetParent;return t||Pt})}}),o.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,r){var a=r==="pageYOffset";o.fn[t]=function(l){return dt(this,function(f,h,g){var S;if(O(f)?S=f:f.nodeType===9&&(S=f.defaultView),g===void 0)return S?S[r]:f[h];S?S.scrollTo(a?S.pageXOffset:g,a?g:S.pageYOffset):f[h]=g},t,l,arguments.length)}}),o.each(["top","left"],function(t,r){o.cssHooks[r]=pi(A.pixelPosition,function(a,l){if(l)return l=mn(a,r),dr.test(l)?o(a).position()[r]+"px":l})}),o.each({Height:"height",Width:"width"},function(t,r){o.each({padding:"inner"+t,content:r,"":"outer"+t},function(a,l){o.fn[l]=function(f,h){var g=arguments.length&&(a||typeof f!="boolean"),S=a||(f===!0||h===!0?"margin":"border");return dt(this,function(b,I,F){var V;return O(b)?l.indexOf("outer")===0?b["inner"+t]:b.document.documentElement["client"+t]:b.nodeType===9?(V=b.documentElement,Math.max(b.body["scroll"+t],V["scroll"+t],b.body["offset"+t],V["offset"+t],V["client"+t])):F===void 0?o.css(b,I,S):o.style(b,I,F,S)},r,g?f:void 0,g)}})}),o.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,r){o.fn[r]=function(a){return this.on(r,a)}}),o.fn.extend({bind:function(t,r,a){return this.on(t,null,r,a)},unbind:function(t,r){return this.off(t,null,r)},delegate:function(t,r,a,l){return this.on(r,t,a,l)},undelegate:function(t,r,a){return arguments.length===1?this.off(t,"**"):this.off(r,t||"**",a)},hover:function(t,r){return this.on("mouseenter",t).on("mouseleave",r||t)}}),o.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,r){o.fn[r]=function(a,l){return arguments.length>0?this.on(r,null,a,l):this.trigger(r)}});var xo=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;o.proxy=function(t,r){var a,l,f;if(typeof r=="string"&&(a=t[r],r=t,t=a),!!R(t))return l=u.call(arguments,2),f=function(){return t.apply(r||this,l.concat(u.call(arguments)))},f.guid=t.guid=t.guid||o.guid++,f},o.holdReady=function(t){t?o.readyWait++:o.ready(!0)},o.isArray=Array.isArray,o.parseJSON=JSON.parse,o.nodeName=z,o.isFunction=R,o.isWindow=O,o.camelCase=tt,o.type=_,o.now=Date.now,o.isNumeric=function(t){var r=o.type(t);return(r==="number"||r==="string")&&!isNaN(t-parseFloat(t))},o.trim=function(t){return t==null?"":(t+"").replace(xo,"$1")};var vo=e.jQuery,bo=e.$;return o.noConflict=function(t){return e.$===o&&(e.$=bo),t&&e.jQuery===o&&(e.jQuery=vo),o},typeof n>"u"&&(e.jQuery=e.$=o),o})}(Xn)),Xn.exports}var Oo=No();const Ui=Po(Oo);var Nr=1e-6,on=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});function Zn(){var s=new on(16);return on!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s}function is(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Lo(s,e,n){var i=n[0],c=n[1],u=n[2],p,d,m,y,w,T,M,E,A,R,O,v;return e===s?(s[12]=e[0]*i+e[4]*c+e[8]*u+e[12],s[13]=e[1]*i+e[5]*c+e[9]*u+e[13],s[14]=e[2]*i+e[6]*c+e[10]*u+e[14],s[15]=e[3]*i+e[7]*c+e[11]*u+e[15]):(p=e[0],d=e[1],m=e[2],y=e[3],w=e[4],T=e[5],M=e[6],E=e[7],A=e[8],R=e[9],O=e[10],v=e[11],s[0]=p,s[1]=d,s[2]=m,s[3]=y,s[4]=w,s[5]=T,s[6]=M,s[7]=E,s[8]=A,s[9]=R,s[10]=O,s[11]=v,s[12]=p*i+w*c+A*u+e[12],s[13]=d*i+T*c+R*u+e[13],s[14]=m*i+M*c+O*u+e[14],s[15]=y*i+E*c+v*u+e[15]),s}function _o(s,e,n){var i=n[0],c=n[1],u=n[2];return s[0]=e[0]*i,s[1]=e[1]*i,s[2]=e[2]*i,s[3]=e[3]*i,s[4]=e[4]*c,s[5]=e[5]*c,s[6]=e[6]*c,s[7]=e[7]*c,s[8]=e[8]*u,s[9]=e[9]*u,s[10]=e[10]*u,s[11]=e[11]*u,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s}function Do(s,e,n){var i=Math.sin(n),c=Math.cos(n),u=e[4],p=e[5],d=e[6],m=e[7],y=e[8],w=e[9],T=e[10],M=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=u*c+y*i,s[5]=p*c+w*i,s[6]=d*c+T*i,s[7]=m*c+M*i,s[8]=y*c-u*i,s[9]=w*c-p*i,s[10]=T*c-d*i,s[11]=M*c-m*i,s}function Uo(s,e,n){var i=Math.sin(n),c=Math.cos(n),u=e[0],p=e[1],d=e[2],m=e[3],y=e[8],w=e[9],T=e[10],M=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=u*c-y*i,s[1]=p*c-w*i,s[2]=d*c-T*i,s[3]=m*c-M*i,s[8]=u*i+y*c,s[9]=p*i+w*c,s[10]=d*i+T*c,s[11]=m*i+M*c,s}function Fo(s,e,n){var i=Math.sin(n),c=Math.cos(n),u=e[0],p=e[1],d=e[2],m=e[3],y=e[4],w=e[5],T=e[6],M=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=u*c+y*i,s[1]=p*c+w*i,s[2]=d*c+T*i,s[3]=m*c+M*i,s[4]=y*c-u*i,s[5]=w*c-p*i,s[6]=T*c-d*i,s[7]=M*c-m*i,s}function Go(s,e,n,i,c){var u=1/Math.tan(e/2),p;return s[0]=u/n,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=u,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,c!=null&&c!==1/0?(p=1/(i-c),s[10]=(c+i)*p,s[14]=2*c*i*p):(s[10]=-1,s[14]=-2*i),s}var Fi=Go;function ko(s,e,n,i){var c,u,p,d,m,y,w,T,M,E,A=e[0],R=e[1],O=e[2],v=i[0],j=i[1],N=i[2],_=n[0],L=n[1],H=n[2];return Math.abs(A-_)<Nr&&Math.abs(R-L)<Nr&&Math.abs(O-H)<Nr?is(s):(w=A-_,T=R-L,M=O-H,E=1/Math.hypot(w,T,M),w*=E,T*=E,M*=E,c=j*M-N*T,u=N*w-v*M,p=v*T-j*w,E=Math.hypot(c,u,p),E?(E=1/E,c*=E,u*=E,p*=E):(c=0,u=0,p=0),d=T*p-M*u,m=M*c-w*p,y=w*u-T*c,E=Math.hypot(d,m,y),E?(E=1/E,d*=E,m*=E,y*=E):(d=0,m=0,y=0),s[0]=c,s[1]=d,s[2]=w,s[3]=0,s[4]=u,s[5]=m,s[6]=T,s[7]=0,s[8]=p,s[9]=y,s[10]=M,s[11]=0,s[12]=-(c*A+u*R+p*O),s[13]=-(d*A+m*R+y*O),s[14]=-(w*A+T*R+M*O),s[15]=1,s)}function Ft(){var s=new on(3);return on!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Dt(s){var e=new on(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e}function jo(s){var e=s[0],n=s[1],i=s[2];return Math.hypot(e,n,i)}function he(s,e,n){var i=new on(3);return i[0]=s,i[1]=e,i[2]=n,i}function Qn(s,e,n,i){return s[0]=e,s[1]=n,s[2]=i,s}function Sn(s,e,n){return s[0]=e[0]+n[0],s[1]=e[1]+n[1],s[2]=e[2]+n[2],s}function Or(s,e,n,i){return s[0]=e[0]+n[0]*i,s[1]=e[1]+n[1]*i,s[2]=e[2]+n[2]*i,s}function Vo(s,e){var n=e[0],i=e[1],c=e[2],u=n*n+i*i+c*c;return u>0&&(u=1/Math.sqrt(u)),s[0]=e[0]*u,s[1]=e[1]*u,s[2]=e[2]*u,s}function nn(s,e,n){var i=e[0],c=e[1],u=e[2],p=n[0],d=n[1],m=n[2];return s[0]=c*m-u*d,s[1]=u*p-i*m,s[2]=i*d-c*p,s}(function(){var s=Ft();return function(e,n,i,c,u,p){var d,m;for(n||(n=3),i||(i=0),c?m=Math.min(c*n+i,e.length):m=e.length,d=i;d<m;d+=n)s[0]=e[d],s[1]=e[d+1],s[2]=e[d+2],u(s,s,p),e[d]=s[0],e[d+1]=s[1],e[d+2]=s[2];return e}})();const Gi=`

struct TransformData{
    view: mat4x4<f32>,
    projection: mat4x4<f32>,
};

struct ObjectData{
    model: array<mat4x4<f32>>
}

@binding(0) @group(0) var<uniform> transformUBO: TransformData;
@binding(1) @group(0) var<storage,read> objects: ObjectData;

@binding(0) @group(1) var myTexture: texture_2d<f32>;
@binding(1) @group(1) var mySampler: sampler;

struct Fragment{
    @builtin(position) Position: vec4<f32>,
    @location(0) TexCoord: vec2<f32>,
};

@vertex
fn vs_main(
    @builtin(instance_index) ID: u32,
    @location(0) vertexPosition: vec3<f32>, 
    @location(1) vertexTexCoord: vec2<f32>) -> Fragment {

    var output : Fragment;
    output.Position = transformUBO.projection * transformUBO.view * objects.model[ID] * vec4<f32>(vertexPosition, 1.0);
    output.TexCoord = vertexTexCoord;
    
    return output;
}

@fragment
fn fs_main(@location(0) TexCoord: vec2<f32>) -> @location(0) vec4<f32>{
    let textureColor = textureSample(myTexture, mySampler, TexCoord);
    return textureColor;
}


`,ki=`struct TransformData {
  view: mat4x4<f32>,
  projection: mat4x4<f32>,
};

struct ObjectData {
  model: array<mat4x4<f32>>
};

@group(0) @binding(0) var<uniform> transformUBO: TransformData;
@group(0) @binding(1) var<storage, read> objects: ObjectData;

@group(1) @binding(0) var myTexture: texture_2d<f32>;
@group(1) @binding(1) var mySampler: sampler;

struct VSOut {
  @builtin(position) Position: vec4<f32>,
  @location(0) TexCoord: vec2<f32>,
};

@vertex
fn vs_main(
  @builtin(instance_index) ID: u32,
  @location(0) vertexPosition: vec3<f32>,
  @location(1) vertexTexCoord: vec2<f32>
) -> VSOut {
  let model = objects.model[ID];

  // World-space center from model translation
  let centerWS = vec3<f32>(model[3].x, model[3].y, model[3].z);

  let sx = length(vec3<f32>(model[0].x, model[0].y, model[0].z));
  let sy = length(vec3<f32>(model[1].x, model[1].y, model[1].z));
  let v = transformUBO.view;

// Camera direction
  let rightWS = normalize(vec3<f32>(v[0].x, v[1].x, v[2].x));
  let upWS    = normalize(vec3<f32>(v[0].y, v[1].y, v[2].y));

  let local = vertexPosition.xy; // expect -0.5..0.5
  let worldPos =
    centerWS
    + rightWS * (local.x * sx)
    + upWS    * (local.y * sy);

  var out: VSOut;
  out.Position = transformUBO.projection * transformUBO.view * vec4<f32>(worldPos, 1.0);
  out.TexCoord = vertexTexCoord;
  return out;
}

@fragment
fn fs_main(@location(0) TexCoord: vec2<f32>) -> @location(0) vec4<f32> {
  // Convert to centered coordinates (-0.5 to 0.5)
  let centered = TexCoord - vec2<f32>(0.5, 0.5);
  
  // Distance from center
  let dist = length(centered);
  
  // Discard pixels outside circle (radius = 0.5)
  if (dist > 0.5) {
    discard;
  }
  
  let baseColor = textureSample(myTexture, mySampler, TexCoord);


  return baseColor;
}
`,ji=`// Terrain Shader with Dual Texture Blending
// Blends GHI heatmap with satellite imagery

struct TransformData {
    view: mat4x4<f32>,
    projection: mat4x4<f32>,
};

struct ObjectData {
    model: array<mat4x4<f32>>
};

struct BlendSettings {
    satelliteOpacity: f32,  // 0.0 = GHI only, 1.0 = satellite only
    _padding1: f32,
    _padding2: f32,
    _padding3: f32,
};

struct SelectionQuad {
    p0: vec2<f32>,
    p1: vec2<f32>,
    p2: vec2<f32>,
    p3: vec2<f32>,
    enabled: f32,
    time: f32,
    _pad2: f32,
    _pad3: f32
}

// Group 0: Frame data (shared)
@binding(0) @group(0) var<uniform> transformUBO: TransformData;
@binding(1) @group(0) var<storage, read> objects: ObjectData;

// Group 1: Terrain material (dual textures + blend)
@binding(0) @group(1) var ghiTexture: texture_2d<f32>;
@binding(1) @group(1) var ghiSampler: sampler;
@binding(2) @group(1) var satelliteTexture: texture_2d<f32>;
@binding(3) @group(1) var satelliteSampler: sampler;
@binding(4) @group(1) var<uniform> blendSettings: BlendSettings;
@binding(5) @group(1) var<uniform> selectionQuad: SelectionQuad;

struct Fragment {
    @builtin(position) Position: vec4<f32>,
    @location(0) TexCoord: vec2<f32>,
    @location(1) WorldPos: vec3<f32>,
    @location(2) WorldNormal: vec3<f32>,
};

@vertex
fn vs_main(
    @builtin(instance_index) ID: u32,
    @location(0) vertexPosition: vec3<f32>,
    @location(1) vertexNormal: vec3<f32>,
    @location(2) vertexTexCoord: vec2<f32>
) -> Fragment {
    var output: Fragment;
    let model = objects.model[ID];
    let worldPos = model * vec4<f32>(vertexPosition, 1.0);
    
    // Transform normal to world space (using upper 3x3 of model matrix)
    let worldNormal = normalize((model * vec4<f32>(vertexNormal, 0.0)).xyz);
    
    output.Position = transformUBO.projection * transformUBO.view * worldPos;
    output.TexCoord = vertexTexCoord;
    output.WorldPos = worldPos.xyz;
    output.WorldNormal = worldNormal;
    return output;
}


fn sign2D(p1: vec2<f32>, p2: vec2<f32>, p3: vec2<f32>) -> f32 {
    return (p1.x - p3.x) * (p2.y - p3.y) - (p2.x - p3.x) * (p1.y - p3.y);
}

fn pointInTriangle(pt: vec2<f32>, v1: vec2<f32>, v2: vec2<f32>, v3: vec2<f32>) -> bool {
    let d1 = sign2D(pt, v1, v2);
    let d2 = sign2D(pt, v2, v3);
    let d3 = sign2D(pt, v3, v1);
    
    let hasNeg = (d1 < 0.0) || (d2 < 0.0) || (d3 < 0.0);
    let hasPos = (d1 > 0.0) || (d2 > 0.0) || (d3 > 0.0);
    
    return !(hasNeg && hasPos);
}

fn isInsideSelectionQuad(pt: vec2<f32>) -> bool {
    if (selectionQuad.enabled < 0.5) {
        return false;
    }
    
    let inTri1 = pointInTriangle(pt, selectionQuad.p0, selectionQuad.p1, selectionQuad.p2);
    let inTri2 = pointInTriangle(pt, selectionQuad.p0, selectionQuad.p2, selectionQuad.p3);
    
    return inTri1 || inTri2;
}

// Calculate slope angle from normal (returns degrees)
fn getSlopeAngle(normal: vec3<f32>) -> f32 {

    let cosAngle = clamp(abs(normal.z), 0.0, 1.0);
    return acos(cosAngle) * (180.0 / 3.14159265);
}

@fragment
fn fs_main(
    @location(0) TexCoord: vec2<f32>, 
    @location(1) WorldPos: vec3<f32>,
    @location(2) WorldNormal: vec3<f32>
) -> @location(0) vec4<f32> {
    // Sample both textures
    let ghiColor = textureSample(ghiTexture, ghiSampler, TexCoord);
    let satelliteColor = textureSample(satelliteTexture, satelliteSampler, TexCoord);
    
    var finalColor = mix(ghiColor, satelliteColor, blendSettings.satelliteOpacity);

    // Selection highlight with slope coloring for solar panel suitability
    let pt = vec2<f32>(WorldPos.x, WorldPos.y);
    if (isInsideSelectionQuad(pt)) {
        let slopeAngle = getSlopeAngle(WorldNormal);
        let pulse = (sin(selectionQuad.time) + 1.0) * 0.2 + 0.4; // 0.4-0.6
        
        var slopeColor: vec4<f32>;
        
        if (slopeAngle <= 5.0) {
            // 0-5Â° â Ä°DEAL (Koyu YeÅil)
            slopeColor = vec4<f32>(0.0, 0.8, 0.0, 1.0);
        } else if (slopeAngle <= 10.0) {
            // 5-10Â° â KABUL EDÄ°LEBÄ°LÄ°R (SarÄ±-YeÅil)
            slopeColor = vec4<f32>(0.7, 0.9, 0.0, 1.0);
        } else if (slopeAngle <= 15.0) {
            // 10-15Â° â EKONOMÄ°K RÄ°SK (Turuncu)
            slopeColor = vec4<f32>(1.0, 0.6, 0.0, 1.0);
        } else {
            // 15Â°+ â UYGUN DEÄÄ°L (KÄ±rmÄ±zÄ±)
            slopeColor = vec4<f32>(1.0, 0.15, 0.15, 1.0);
        }
        
        finalColor = mix(finalColor, slopeColor, pulse);
    }
    
    return finalColor;
}

`,Vi=`struct TransformData {
    view: mat4x4<f32>,
    projection: mat4x4<f32>,
};

struct ObjectData {
    model: array<mat4x4<f32>>
};

@group(0) @binding(0) var<uniform> transformUBO: TransformData;
@group(0) @binding(1) var<storage, read> objects: ObjectData;

struct VSOut {
    @builtin(position) Position: vec4<f32>,
    @location(0) worldPosition: vec3<f32>,
};

@vertex
fn vs_main(
    @builtin(instance_index) ID: u32,
    @location(0) vertexPosition: vec3<f32>,
    @location(1) vertexTexCoord: vec2<f32>
) -> VSOut {
    let model = objects.model[ID];
    let worldPos = model * vec4<f32>(vertexPosition, 1.0);
    
    var out: VSOut;
    out.Position = transformUBO.projection * transformUBO.view * worldPos;
    out.worldPosition = worldPos.xyz;
    return out;
}

@fragment
fn fs_main(@location(0) worldPosition: vec3<f32>) -> @location(0) vec4<f32> {
    return vec4<f32>(worldPosition, 1.0);
}


`,zi=`// Terrain Picking Shader
// Uses TERRAIN_BUFFER_LAYOUT (position + normal + uv)

struct TransformData {
    view: mat4x4<f32>,
    projection: mat4x4<f32>,
};

struct ObjectData {
    model: array<mat4x4<f32>>
};

@group(0) @binding(0) var<uniform> transformUBO: TransformData;
@group(0) @binding(1) var<storage, read> objects: ObjectData;

struct VSOut {
    @builtin(position) Position: vec4<f32>,
    @location(0) worldPosition: vec3<f32>,
};

@vertex
fn vs_main(
    @builtin(instance_index) ID: u32,
    @location(0) vertexPosition: vec3<f32>,
    @location(1) vertexNormal: vec3<f32>,
    @location(2) vertexTexCoord: vec2<f32>
) -> VSOut {
    let model = objects.model[ID];
    let worldPos = model * vec4<f32>(vertexPosition, 1.0);
    
    var out: VSOut;
    out.Position = transformUBO.projection * transformUBO.view * worldPos;
    out.worldPosition = worldPos.xyz;
    return out;
}

@fragment
fn fs_main(@location(0) worldPosition: vec3<f32>) -> @location(0) vec4<f32> {
    return vec4<f32>(worldPosition, 1.0);
}

`,An={arrayStride:5*4,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:3*4}]},Fr={arrayStride:8*4,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x3",offset:3*4},{shaderLocation:2,format:"float32x2",offset:6*4}]};function _t(s,e,n,i=An,c=0){const u=s.createBuffer({size:e.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST|c,mappedAtCreation:!0});new Float32Array(u.getMappedRange()).set(e),u.unmap();let p=null;n&&n.length>0&&(p=s.createBuffer({size:n.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),new Uint32Array(p.getMappedRange()).set(n),p.unmap());const d=i.arrayStride/4;return{vertexBuffer:u,indexBuffer:p,vertexCount:e.length/d,indexCount:(n==null?void 0:n.length)??0,bufferLayout:i,useIndexBuffer:n!==void 0&&n.length>0}}class We{constructor(e=he(0,0,0),n=he(0,0,0),i=he(1,1,1)){k(this,"position");k(this,"rotation");k(this,"scale");k(this,"_modelMatrix");k(this,"_dirty",!0);this.position=Dt(e),this.rotation=Dt(n),this.scale=Dt(i),this._modelMatrix=Zn()}setPosition(e,n,i){return Qn(this.position,e,n,i),this._dirty=!0,this}setRotation(e,n,i){return Qn(this.rotation,e,n,i),this._dirty=!0,this}setScale(e,n,i){return Qn(this.scale,e,n,i),this._dirty=!0,this}translate(e,n,i){return this.position[0]+=e,this.position[1]+=n,this.position[2]+=i,this._dirty=!0,this}rotate(e,n,i){return this.rotation[0]+=e,this.rotation[1]+=n,this.rotation[2]+=i,this._dirty=!0,this}getModelMatrix(){return this._dirty&&(this._recalculateMatrix(),this._dirty=!1),this._modelMatrix}markDirty(){this._dirty=!0}_recalculateMatrix(){const e=n=>n*Math.PI/180;is(this._modelMatrix),Lo(this._modelMatrix,this._modelMatrix,this.position),Do(this._modelMatrix,this._modelMatrix,e(this.rotation[0])),Uo(this._modelMatrix,this._modelMatrix,e(this.rotation[1])),Fo(this._modelMatrix,this._modelMatrix,e(this.rotation[2])),_o(this._modelMatrix,this._modelMatrix,this.scale)}clone(){return new We(Dt(this.position),Dt(this.rotation),Dt(this.scale))}}var ze=(s=>(s.Standard="standard",s.Terrain="terrain",s.Billboard="billboard",s))(ze||{});const ir=class ir{constructor(e){k(this,"id");k(this,"mesh");k(this,"material");k(this,"transform");k(this,"visible");k(this,"renderType");k(this,"onUpdate");this.id=ir._idCounter++,this.mesh=e.mesh,this.material=e.material,this.transform=e.transform??new We,this.visible=e.visible??!0,this.renderType=e.renderType??"standard",this.onUpdate=e.onUpdate}getModelMatrix(){return this.transform.getModelMatrix()}update(e=0){this.onUpdate&&this.onUpdate(this,e)}bind(e){e.setVertexBuffer(0,this.mesh.vertexBuffer),this.mesh.useIndexBuffer&&this.mesh.indexBuffer&&e.setIndexBuffer(this.mesh.indexBuffer,"uint32")}draw(e,n=0){this.mesh.useIndexBuffer?e.drawIndexed(this.mesh.indexCount,1,0,0,n):e.draw(this.mesh.vertexCount,1,0,n)}setVisible(e){return this.visible=e,this}setMaterial(e){return this.material=e,this}destroy(){this.mesh.vertexBuffer.destroy(),this.mesh.indexBuffer&&this.mesh.indexBuffer.destroy()}};k(ir,"_idCounter",0);let ft=ir;const Hi=`// Selection Compute Shader
// Pass 1: Count vertices inside selection
// Pass 2: Write selected vertex positions

struct SelectionQuad {
    p0: vec2<f32>,
    p1: vec2<f32>,
    p2: vec2<f32>,
    p3: vec2<f32>,
    enabled: f32,
    time: f32,
    _pad2: f32,
    _pad3: f32,
};

// Vertex struct matching TERRAIN_BUFFER_LAYOUT (8 floats)
// position (3) + normal (3) + uv (2)
struct Vertex {
    px: f32,  // position.x
    py: f32,  // position.y
    pz: f32,  // position.z
    nx: f32,  // normal.x
    ny: f32,  // normal.y
    nz: f32,  // normal.z
    u: f32,   // texcoord.u
    v: f32,   // texcoord.v
};

struct CountBuffer {
    count: atomic<u32>,
};

struct OutputVertex {
    x: f32,
    y: f32,
    z: f32,
};

// Bindings
@group(0) @binding(0) var<uniform> selection: SelectionQuad;
@group(0) @binding(1) var<storage, read> vertices: array<Vertex>;
@group(0) @binding(2) var<storage, read_write> countBuffer: CountBuffer;
@group(0) @binding(3) var<storage, read_write> outputVertices: array<OutputVertex>;

// ========== Point-in-triangle functions ==========

fn sign2D(p1: vec2<f32>, p2: vec2<f32>, p3: vec2<f32>) -> f32 {
    return (p1.x - p3.x) * (p2.y - p3.y) - (p2.x - p3.x) * (p1.y - p3.y);
}

fn pointInTriangle(pt: vec2<f32>, v1: vec2<f32>, v2: vec2<f32>, v3: vec2<f32>) -> bool {
    let d1 = sign2D(pt, v1, v2);
    let d2 = sign2D(pt, v2, v3);
    let d3 = sign2D(pt, v3, v1);
    
    let hasNeg = (d1 < 0.0) || (d2 < 0.0) || (d3 < 0.0);
    let hasPos = (d1 > 0.0) || (d2 > 0.0) || (d3 > 0.0);
    
    return !(hasNeg && hasPos);
}

fn isInsideSelection(pt: vec2<f32>) -> bool {
    if (selection.enabled < 0.5) {
        return false;
    }
    
    let inTri1 = pointInTriangle(pt, selection.p0, selection.p1, selection.p2);
    let inTri2 = pointInTriangle(pt, selection.p0, selection.p2, selection.p3);
    
    return inTri1 || inTri2;
}

// ========== Slope calculation ==========

const MAX_SLOPE_DEGREES: f32 = 10.0;  // Maximum allowed slope for panel placement
const PI: f32 = 3.14159265;

// Calculate slope angle from normal (degrees)
fn getSlopeAngle(nx: f32, ny: f32, nz: f32) -> f32 {
    // normal.z = cos(angle) for ground plane XY, height Z
    let cosAngle = clamp(abs(nz), 0.0, 1.0);
    return acos(cosAngle) * (180.0 / PI);
}

// Check if vertex is suitable for panel placement
fn isValidForPanel(vertex: Vertex) -> bool {
    let pt = vec2<f32>(vertex.px, vertex.py);
    
    // Must be inside selection
    if (!isInsideSelection(pt)) {
        return false;
    }
    
    // Must have acceptable slope (â¤10Â°)
    let slopeAngle = getSlopeAngle(vertex.nx, vertex.ny, vertex.nz);
    if (slopeAngle > MAX_SLOPE_DEGREES) {
        return false;
    }
    
    return true;
}

// ========== Pass 1: Count ==========

@compute @workgroup_size(256)
fn count_main(@builtin(global_invocation_id) global_id: vec3<u32>) {
    let idx = global_id.x;
    let vertexCount = arrayLength(&vertices);
    
    if (idx >= vertexCount) {
        return;
    }
    
    let vertex = vertices[idx];
    
    if (isValidForPanel(vertex)) {
        atomicAdd(&countBuffer.count, 1u);
    }
}

// ========== Pass 2: Write ==========

@compute @workgroup_size(256)
fn write_main(@builtin(global_invocation_id) global_id: vec3<u32>) {
    let idx = global_id.x;
    let vertexCount = arrayLength(&vertices);
    
    if (idx >= vertexCount) {
        return;
    }
    
    let vertex = vertices[idx];
    
    if (isValidForPanel(vertex)) {
        let writeIdx = atomicAdd(&countBuffer.count, 1u);
        outputVertices[writeIdx] = OutputVertex(vertex.px, vertex.py, vertex.pz);
    }
}

`;class zo{constructor(e){k(this,"canvas");k(this,"adapter");k(this,"device");k(this,"context");k(this,"format");k(this,"pipeline");k(this,"billboardPipeline");k(this,"terrainPipeline");k(this,"frameGroupLayout");k(this,"materialGroupLayout");k(this,"terrainMaterialGroupLayout");k(this,"frameBindGroup");k(this,"blendSettingsBuffer");k(this,"_satelliteOpacity",.1);k(this,"selectionQuadBuffer");k(this,"selectionTime",0);k(this,"uniformBuffer");k(this,"objectBuffer");k(this,"depthStencilState");k(this,"depthStencilBuffer");k(this,"depthStencilView");k(this,"depthStencilAttachment");k(this,"pickingPipeline");k(this,"terrainPickingPipeline");k(this,"pickingTexture");k(this,"pickingDepthTexture");k(this,"pickingReadBuffer");k(this,"computePipeline");k(this,"computeCountPipeline");k(this,"computeWritePipeline");k(this,"computeBindGroupLayout");k(this,"computeCountBuffer");k(this,"computeOutputBuffer");k(this,"computeReadbackBuffer");k(this,"instancedBindGroups",new WeakMap);this.canvas=e}async init(){await this.setupDevice(),this.setupBindGroupLayouts(),this.setupBuffers(),this.setupDepthBuffer(),this.setupPipeline(),this.setupBindGroup(),this.setupPicking(),this.setupCompute()}async setupDevice(){var e;if(this.adapter=await((e=navigator.gpu)==null?void 0:e.requestAdapter()),!this.adapter)throw new Error("WebGPU is not supported on this device!");this.device=await this.adapter.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}setupBindGroupLayouts(){this.frameGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage",hasDynamicOffset:!1}}]}),this.materialGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]}),this.terrainMaterialGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:4,visibility:GPUShaderStage.FRAGMENT,buffer:{}},{binding:5,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]})}setupBuffers(){this.uniformBuffer=this.device.createBuffer({size:64*2,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.selectionQuadBuffer=this.device.createBuffer({size:48,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.device.queue.writeBuffer(this.selectionQuadBuffer,0,new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0])),this.objectBuffer=this.device.createBuffer({size:64*1024,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.blendSettingsBuffer=this.device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.updateBlendSettings(this._satelliteOpacity)}setupDepthBuffer(){this.depthStencilState={format:"depth24plus-stencil8",depthWriteEnabled:!0,depthCompare:"less-equal"},this.depthStencilBuffer=this.device.createTexture({size:{width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1},format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthStencilView=this.depthStencilBuffer.createView({format:"depth24plus-stencil8",dimension:"2d",aspect:"all"}),this.depthStencilAttachment={view:this.depthStencilView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilLoadOp:"clear",stencilStoreOp:"discard"}}setupPipeline(){const e=this.device.createPipelineLayout({bindGroupLayouts:[this.frameGroupLayout,this.materialGroupLayout]});this.pipeline=this.device.createRenderPipeline({layout:e,vertex:{module:this.device.createShaderModule({code:Gi}),entryPoint:"vs_main",buffers:[An]},fragment:{module:this.device.createShaderModule({code:Gi}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},depthStencil:this.depthStencilState});const n=this.device.createPipelineLayout({bindGroupLayouts:[this.frameGroupLayout,this.materialGroupLayout]});this.billboardPipeline=this.device.createRenderPipeline({layout:n,vertex:{module:this.device.createShaderModule({code:ki}),entryPoint:"vs_main",buffers:[An]},fragment:{module:this.device.createShaderModule({code:ki}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus-stencil8",depthWriteEnabled:!1,depthCompare:"always"}});const i=this.device.createPipelineLayout({bindGroupLayouts:[this.frameGroupLayout,this.terrainMaterialGroupLayout]});this.terrainPipeline=this.device.createRenderPipeline({layout:i,vertex:{module:this.device.createShaderModule({code:ji}),entryPoint:"vs_main",buffers:[Fr]},fragment:{module:this.device.createShaderModule({code:ji}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},depthStencil:this.depthStencilState})}setupBindGroup(){this.frameBindGroup=this.device.createBindGroup({layout:this.frameGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:this.objectBuffer}}]})}getMaterialGroupLayout(){return this.materialGroupLayout}getTerrainMaterialGroupLayout(){return this.terrainMaterialGroupLayout}getBlendSettingsBuffer(){return this.blendSettingsBuffer}updateBlendSettings(e){this._satelliteOpacity=Math.max(0,Math.min(1,e));const n=new Float32Array([this._satelliteOpacity,0,0,0]);this.device.queue.writeBuffer(this.blendSettingsBuffer,0,n)}get satelliteOpacity(){return this._satelliteOpacity}toggleSatellite(){this._satelliteOpacity>0?this.updateBlendSettings(0):this.updateBlendSettings(.1),console.log(`ð°ï¸ Satellite opacity: ${Math.round(this._satelliteOpacity*100)}%`)}getTerrainPipeline(){return this.terrainPipeline}getInstancedBindGroup(e){let n=this.instancedBindGroups.get(e);return n||(n=this.device.createBindGroup({layout:this.frameGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:e.getInstanceBuffer()}}]}),this.instancedBindGroups.set(e,n)),n}render(e){if(!this.device||!this.pipeline){console.error("Renderer not initialized");return}this.selectionTime+=.05,this.updateSelectionTime();const{viewTransform:n,objects:i}=e,c=Zn();Fi(c,Math.PI/4,this.canvas.width/this.canvas.height,.1,100),this.device.queue.writeBuffer(this.uniformBuffer,0,new Float32Array(n)),this.device.queue.writeBuffer(this.uniformBuffer,64,new Float32Array(c));const u=new Float32Array(i.length*16);i.forEach((E,A)=>{const R=E.getModelMatrix();for(let O=0;O<16;O++)u[A*16+O]=R[O]}),this.device.queue.writeBuffer(this.objectBuffer,0,u);const p=this.device.createCommandEncoder(),d=i.filter(E=>E.renderType===ze.Standard),m=i.filter(E=>E.renderType===ze.Terrain),y=i.filter(E=>E.renderType===ze.Billboard),w=this.context.getCurrentTexture().createView(),T=p.beginRenderPass({colorAttachments:[{view:w,clearValue:{r:.1,g:.1,b:.15,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:this.depthStencilAttachment});T.setBindGroup(0,this.frameBindGroup),d.length>0&&(T.setPipeline(this.pipeline),d.forEach(E=>{const A=i.indexOf(E);T.setBindGroup(1,E.material),E.bind(T),E.draw(T,A)})),m.length>0&&(T.setPipeline(this.terrainPipeline),m.forEach(E=>{const A=i.indexOf(E);T.setBindGroup(1,E.material),E.bind(T),E.draw(T,A)})),y.length>0&&(T.setPipeline(this.billboardPipeline),y.forEach(E=>{const A=i.indexOf(E);T.setBindGroup(1,E.material),E.bind(T),E.draw(T,A)}));const M=e.instancedMeshes??[];for(const E of M){if(E.getInstanceCount()===0)continue;switch(E.renderType){case ze.Billboard:T.setPipeline(this.billboardPipeline);break;case ze.Terrain:T.setPipeline(this.terrainPipeline);break;default:T.setPipeline(this.pipeline)}const A=this.getInstancedBindGroup(E);T.setBindGroup(0,A),E.drawAll(T)}M.length>0&&T.setBindGroup(0,this.frameBindGroup),T.end(),this.device.queue.submit([p.finish()])}resize(){var e,n;this.depthStencilBuffer.destroy(),this.setupDepthBuffer(),(e=this.pickingTexture)==null||e.destroy(),(n=this.pickingDepthTexture)==null||n.destroy(),this.setupPickingTextures()}setupPicking(){this.setupPickingTextures();const e=this.device.createPipelineLayout({bindGroupLayouts:[this.frameGroupLayout]});this.pickingPipeline=this.device.createRenderPipeline({layout:e,vertex:{module:this.device.createShaderModule({code:Vi}),entryPoint:"vs_main",buffers:[An]},fragment:{module:this.device.createShaderModule({code:Vi}),entryPoint:"fs_main",targets:[{format:"rgba32float"}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less-equal"}}),this.terrainPickingPipeline=this.device.createRenderPipeline({layout:e,vertex:{module:this.device.createShaderModule({code:zi}),entryPoint:"vs_main",buffers:[Fr]},fragment:{module:this.device.createShaderModule({code:zi}),entryPoint:"fs_main",targets:[{format:"rgba32float"}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less-equal"}}),this.pickingReadBuffer=this.device.createBuffer({size:16,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}setupCompute(){this.computeBindGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),this.computeCountBuffer=this.device.createBuffer({size:4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST});const e=this.device.createPipelineLayout({bindGroupLayouts:[this.computeBindGroupLayout]});this.computeCountPipeline=this.device.createComputePipeline({layout:e,compute:{module:this.device.createShaderModule({code:Hi}),entryPoint:"count_main"}}),this.computeWritePipeline=this.device.createComputePipeline({layout:e,compute:{module:this.device.createShaderModule({code:Hi}),entryPoint:"write_main"}}),console.log("â Compute pipelines created"),this.computeOutputBuffer=this.device.createBuffer({size:1e4*12,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),this.computeReadbackBuffer=this.device.createBuffer({size:4,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}async runSelectionCompute(e,n){this.device.queue.writeBuffer(this.computeCountBuffer,0,new Uint32Array([0]));const i=this.device.createBindGroup({layout:this.computeBindGroupLayout,entries:[{binding:0,resource:{buffer:this.selectionQuadBuffer}},{binding:1,resource:{buffer:e}},{binding:2,resource:{buffer:this.computeCountBuffer}},{binding:3,resource:{buffer:this.computeOutputBuffer}}]}),c=Math.ceil(n/256),u=this.device.createCommandEncoder(),p=u.beginComputePass();p.setPipeline(this.computeCountPipeline),p.setBindGroup(0,i),p.dispatchWorkgroups(c),p.end(),u.copyBufferToBuffer(this.computeCountBuffer,0,this.computeReadbackBuffer,0,4),this.device.queue.submit([u.finish()]),await this.computeReadbackBuffer.mapAsync(GPUMapMode.READ);const d=new Uint32Array(this.computeReadbackBuffer.getMappedRange().slice(0));this.computeReadbackBuffer.unmap();const m=d[0];if(console.log(`ð¯ Selection compute: ${m} vertices inside selection`),m===0)return null;this.device.queue.writeBuffer(this.computeCountBuffer,0,new Uint32Array([0]));const y=this.device.createCommandEncoder(),w=y.beginComputePass();w.setPipeline(this.computeWritePipeline),w.setBindGroup(0,i),w.dispatchWorkgroups(c),w.end(),this.device.queue.submit([y.finish()]);const T=m*12,M=this.device.createBuffer({size:T,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),E=this.device.createCommandEncoder();E.copyBufferToBuffer(this.computeOutputBuffer,0,M,0,T),this.device.queue.submit([E.finish()]),await M.mapAsync(GPUMapMode.READ);const A=new Float32Array(M.getMappedRange().slice(0));return M.unmap(),M.destroy(),console.log(`Compute Shader: Retrieved ${m} selected vertices`),A}setupPickingTextures(){this.pickingTexture=this.device.createTexture({size:[this.canvas.width,this.canvas.height],format:"rgba32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.pickingDepthTexture=this.device.createTexture({size:[this.canvas.width,this.canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT})}renderPickingPass(e){const{viewTransform:n,objects:i}=e,c=Zn();Fi(c,Math.PI/4,this.canvas.width/this.canvas.height,.1,100),this.device.queue.writeBuffer(this.uniformBuffer,0,new Float32Array(n)),this.device.queue.writeBuffer(this.uniformBuffer,64,new Float32Array(c));const u=new Float32Array(i.length*16);i.forEach((w,T)=>{const M=w.getModelMatrix();for(let E=0;E<16;E++)u[T*16+E]=M[E]}),this.device.queue.writeBuffer(this.objectBuffer,0,u);const p=this.device.createCommandEncoder(),d=p.beginRenderPass({colorAttachments:[{view:this.pickingTexture.createView(),clearValue:{r:-9999,g:-9999,b:-9999,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.pickingDepthTexture.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});d.setBindGroup(0,this.frameBindGroup);const m=i.filter(w=>w.renderType!==ze.Terrain),y=i.filter(w=>w.renderType===ze.Terrain);m.length>0&&(d.setPipeline(this.pickingPipeline),m.forEach(w=>{const T=i.indexOf(w);w.bind(d),w.draw(d,T)})),y.length>0&&(d.setPipeline(this.terrainPickingPipeline),y.forEach(w=>{const T=i.indexOf(w);w.bind(d),w.draw(d,T)})),d.end(),this.device.queue.submit([p.finish()])}async readWorldPosition(e,n){const i=Math.floor(e),c=Math.floor(n);if(i<0||i>=this.canvas.width||c<0||c>=this.canvas.height)return null;const u=this.device.createCommandEncoder();u.copyTextureToBuffer({texture:this.pickingTexture,origin:{x:i,y:c,z:0}},{buffer:this.pickingReadBuffer,bytesPerRow:256},{width:1,height:1}),this.device.queue.submit([u.finish()]),await this.pickingReadBuffer.mapAsync(GPUMapMode.READ);const p=new Float32Array(this.pickingReadBuffer.getMappedRange().slice(0));return this.pickingReadBuffer.unmap(),p[0]<-9e3?null:he(p[0],p[1],p[2])}getDevice(){return this.device}updateSelectionQuad(e){console.log("updateSelectionQuad called with:",e);const n=new Float32Array(12);e&&e.length===4&&(n[0]=e[0][0],n[1]=e[0][1],n[2]=e[1][0],n[3]=e[1][1],n[4]=e[2][0],n[5]=e[2][1],n[6]=e[3][0],n[7]=e[3][1],n[8]=1,n[9]=this.selectionTime),this.device.queue.writeBuffer(this.selectionQuadBuffer,0,n)}updateSelectionTime(){this.selectionTime+=.05;const e=new Float32Array([this.selectionTime]);this.device.queue.writeBuffer(this.selectionQuadBuffer,36,e)}getSelectionQuadBuffer(){return this.selectionQuadBuffer}}function En(s){return s*Math.PI/180}let Ho=class{constructor(e,n,i){k(this,"position");k(this,"eulers");k(this,"view");k(this,"forwards");k(this,"right");k(this,"up");this.position=e,this.eulers=Ft(),this.eulers=[0,i,n],this.forwards=Ft(),this.right=Ft(),this.up=Ft()}update(){this.forwards=[Math.cos(En(this.eulers[2]))*Math.cos(En(this.eulers[1])),Math.sin(En(this.eulers[2]))*Math.cos(En(this.eulers[1])),Math.sin(En(this.eulers[1]))],nn(this.right,this.forwards,[0,0,1]),nn(this.up,this.right,this.forwards);const e=Ft();Sn(e,this.position,this.forwards),this.view=Zn(),ko(this.view,this.position,e,this.up)}getView(){return this.view}},qo=class{constructor(){k(this,"_objects",new Map);k(this,"_instancedMeshes",[]);k(this,"_camera");k(this,"_lastTime",0);this._camera=new Ho([-10,0,1],0,0)}add(e){return this._objects.set(e.id,e),console.log(`Scene: Added object ${e.id}`),this}addInstanced(e){return this._instancedMeshes.push(e),console.log(`Scene: Added instanced mesh with ${e.getInstanceCount()} instances`),this}removeInstanced(e){const n=this._instancedMeshes.indexOf(e);return n!==-1&&this._instancedMeshes.splice(n,1),this}getInstancedMeshes(){return this._instancedMeshes.filter(e=>e.visible)}remove(e){return this._objects.delete(e.id),this}removeById(e){return this._objects.delete(e),this}get(e){return this._objects.get(e)}has(e){return this._objects.has(e.id)}getAll(){return Array.from(this._objects.values())}getVisible(){return this.getAll().filter(e=>e.visible)}get count(){return this._objects.size}update(){const e=performance.now(),n=this._lastTime?(e-this._lastTime)/1e3:0;this._lastTime=e;for(const i of this._objects.values())i.update(n);for(const i of this._instancedMeshes)i.updateBuffer();this._camera.update()}getRenderData(){return{viewTransform:this._camera.getView(),objects:this.getVisible(),instancedMeshes:this.getInstancedMeshes()}}get camera(){return this._camera}spinCamera(e,n){this._camera.eulers[2]-=e,this._camera.eulers[2]%=360,this._camera.eulers[1]=Math.min(89,Math.max(-89,this._camera.eulers[1]+n))}moveCamera(e,n,i){Or(this._camera.position,this._camera.position,this._camera.forwards,e),Or(this._camera.position,this._camera.position,this._camera.right,n),Or(this._camera.position,this._camera.position,this._camera.up,i)}clear(){for(const e of this._objects.values())e.destroy();this._objects.clear()}find(e){return this.getAll().filter(e)}};class qi{constructor(e){k(this,"submeshes");k(this,"renderType");k(this,"device");k(this,"maxInstances");k(this,"instanceCount",0);k(this,"transforms",[]);k(this,"instanceMatrices");k(this,"instanceBuffer");k(this,"needsUpdate",!1);k(this,"visible",!0);if(this.device=e.device,this.maxInstances=e.maxInstances??1e3,this.renderType=e.renderType??ze.Standard,e.submeshes)this.submeshes=e.submeshes;else if(e.mesh&&e.material)this.submeshes=[{mesh:e.mesh,material:e.material}];else throw new Error("InstancedMesh: Must provide either 'mesh'+'material' or 'submeshes'");this.instanceMatrices=new Float32Array(this.maxInstances*16),this.instanceBuffer=this.device.createBuffer({size:this.maxInstances*16*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,label:"InstancedMesh instance buffer"})}getSubmeshCount(){return this.submeshes.length}get material(){var e;return(e=this.submeshes[0])==null?void 0:e.material}get mesh(){var e;return(e=this.submeshes[0])==null?void 0:e.mesh}addInstance(e={}){if(this.instanceCount>=this.maxInstances)return console.warn(`InstancedMesh: Max instances (${this.maxInstances}) reached`),-1;const n=new We(e.position?he(...e.position):void 0,e.rotation?he(...e.rotation):void 0,e.scale?he(...e.scale):void 0);return this.transforms.push(n),this.needsUpdate=!0,this.instanceCount++}addInstances(e){return e.map(n=>this.addInstance(n))}updateInstance(e,n){if(e<0||e>=this.instanceCount)return;const i=this.transforms[e];n.position&&(i.position=he(...n.position)),n.rotation&&(i.rotation=he(...n.rotation)),n.scale&&(i.scale=he(...n.scale)),this.needsUpdate=!0}getTransform(e){return this.transforms[e]??null}removeInstance(e){e<0||e>=this.instanceCount||(e<this.instanceCount-1&&(this.transforms[e]=this.transforms[this.instanceCount-1]),this.transforms.pop(),this.instanceCount--,this.needsUpdate=!0)}clear(){this.transforms=[],this.instanceCount=0,this.needsUpdate=!0}updateBuffer(){if(this.needsUpdate){if(this.instanceCount===0){this.needsUpdate=!1;return}for(let e=0;e<this.instanceCount;e++){const n=this.transforms[e].getModelMatrix();this.instanceMatrices.set(n,e*16)}this.device.queue.writeBuffer(this.instanceBuffer,0,this.instanceMatrices.buffer,0,this.instanceCount*16*4),this.needsUpdate=!1}}getInstanceBuffer(){return this.instanceBuffer}getInstanceCount(){return this.instanceCount}bindSubmesh(e,n){const i=this.submeshes[n];i&&(e.setVertexBuffer(0,i.mesh.vertexBuffer),i.mesh.useIndexBuffer&&i.mesh.indexBuffer&&e.setIndexBuffer(i.mesh.indexBuffer,"uint32"))}drawSubmesh(e,n){if(this.instanceCount===0||!this.visible)return;const i=this.submeshes[n];i&&(i.mesh.useIndexBuffer?e.drawIndexed(i.mesh.indexCount,this.instanceCount,0,0,0):e.draw(i.mesh.vertexCount,this.instanceCount,0,0))}drawAll(e){if(!(this.instanceCount===0||!this.visible))for(let n=0;n<this.submeshes.length;n++){const i=this.submeshes[n];e.setBindGroup(1,i.material),this.bindSubmesh(e,n),this.drawSubmesh(e,n)}}bind(e){this.bindSubmesh(e,0)}draw(e){this.drawSubmesh(e,0)}destroy(){this.instanceBuffer.destroy()}}const $o="modulepreload",Yo=function(s,e){return new URL(s,e).href},$i={},It=function(e,n,i){let c=Promise.resolve();if(n&&n.length>0){const p=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),m=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));c=Promise.allSettled(n.map(y=>{if(y=Yo(y,i),y in $i)return;$i[y]=!0;const w=y.endsWith(".css"),T=w?'[rel="stylesheet"]':"";if(!!i)for(let A=p.length-1;A>=0;A--){const R=p[A];if(R.href===y&&(!w||R.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${T}`))return;const E=document.createElement("link");if(E.rel=w?"stylesheet":$o,w||(E.as="script"),E.crossOrigin="",E.href=y,m&&E.setAttribute("nonce",m),document.head.appendChild(E),w)return new Promise((A,R)=>{E.addEventListener("load",A),E.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${y}`)))})}))}function u(p){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=p,window.dispatchEvent(d),!d.defaultPrevented)throw p}return c.then(p=>{for(const d of p||[])d.status==="rejected"&&u(d.reason);return e().catch(u)})};class ss{constructor(){this._listeners={}}addEventListener(e,n){const i=this._listeners;return i[e]===void 0&&(i[e]=[]),i[e].indexOf(n)===-1&&i[e].push(n),this}removeEventListener(e,n){const c=this._listeners[e];if(c!==void 0){const u=c.indexOf(n);u!==-1&&c.splice(u,1)}return this}dispatchEvent(e){const i=this._listeners[e.type];if(i!==void 0){const c=i.slice(0);for(let u=0,p=c.length;u<p;u++)c[u].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class rn{constructor(e,n,i,c={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=n,this._child=i,this._attributes=c,!n.isOnGraph(i))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class Wo extends ss{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const n=new Set;for(const i of this.listParentEdges(e))n.add(i.getParent());return Array.from(n)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const n=new Set;for(const i of this.listChildEdges(e))n.add(i.getChild());return Array.from(n)}disconnectParents(e,n){for(const i of this.listParentEdges(e))(!n||n(i.getParent()))&&i.dispose();return this}_createEdge(e,n,i,c){const u=new rn(e,n,i,c);this._edges.add(u);const p=u.getParent();this._parentEdges.has(p)||this._parentEdges.set(p,new Set),this._parentEdges.get(p).add(u);const d=u.getChild();return this._childEdges.has(d)||this._childEdges.set(d,new Set),this._childEdges.get(d).add(u),u}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Cn(){return Cn=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=n[i])}return s},Cn.apply(this,arguments)}class St{constructor(e){if(this.list=[],e)for(const n of e)this.list.push(n)}add(e){this.list.push(e)}remove(e){const n=this.list.indexOf(e);n>=0&&this.list.splice(n,1)}removeChild(e){const n=[];for(const i of this.list)i.getChild()===e&&n.push(i);for(const i of n)this.remove(i);return n}listRefsByChild(e){const n=[];for(const i of this.list)i.getChild()===e&&n.push(i);return n}values(){return this.list}}class Se{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const n of e)this.add(n)}add(e){const n=e.getChild();this.removeChild(n),this.set.add(e),this.map.set(n,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const n=this.map.get(e)||null;return n&&this.remove(n),n}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class ht{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,n){this.map[e]=n}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const we=Symbol("attributes"),Gt=Symbol("immutableKeys");class $r extends ss{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[we]=void 0,this[Gt]=void 0,this.graph=e,this[Gt]=new Set,this[we]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),n={};for(const i in e){const c=e[i];if(c instanceof $r){const u=this.graph._createEdge(i,this,c);this[Gt].add(i),n[i]=u}else n[i]=c}return n}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,n){for(const i in this[we]){const c=this[we][i];if(c instanceof rn){const u=c;u.getChild()===e&&this.setRef(i,n,u.getAttributes())}else if(c instanceof St)for(const u of c.listRefsByChild(e)){const p=u.getAttributes();this.removeRef(i,e),this.addRef(i,n,p)}else if(c instanceof Se){const u=c.getRefByChild(e);if(u){const p=u.getAttributes();this.removeRef(i,e),this.addRef(i,n,p)}}else if(c instanceof ht)for(const u of c.keys()){const p=c.get(u);p.getChild()===e&&this.setRefMap(i,u,n,p.getAttributes())}}return this}get(e){return this[we][e]}set(e,n){return this[we][e]=n,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const n=this[we][e];return n?n.getChild():null}setRef(e,n,i){if(this[Gt].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const c=this[we][e];if(c&&c.dispose(),!n)return this;const u=this.graph._createEdge(e,this,n,i);return this[we][e]=u,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(i=>i.getChild())}addRef(e,n,i){const c=this.graph._createEdge(e,this,n,i);return this.assertRefList(e).add(c),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,n){const i=this.assertRefList(e);if(i instanceof St)for(const c of i.listRefsByChild(n))c.dispose();else{const c=i.getRefByChild(n);c&&c.dispose()}return this}assertRefList(e){const n=this[we][e];if(n instanceof St||n instanceof Se)return n;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(n=>n.getChild())}getRefMap(e,n){const c=this.assertRefMap(e).get(n);return c?c.getChild():null}setRefMap(e,n,i,c){const u=this.assertRefMap(e),p=u.get(n);if(p&&p.dispose(),!i)return this;c=Object.assign(c||{},{key:n});const d=this.graph._createEdge(e,this,i,Cn({},c,{key:n}));return u.set(n,d),this.dispatchEvent({type:"change",attribute:e,key:n})}assertRefMap(e){const n=this[we][e];if(n instanceof ht)return n;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(Cn({},e,{target:this})),this.graph.dispatchEvent(Cn({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const n=e.getName();if(this[we][n]===e)this[we][n]=null,this[Gt].has(n)&&e.getChild().dispose();else if(this[we][n]instanceof St)this[we][n].remove(e);else if(this[we][n]instanceof Se)this[we][n].remove(e);else if(this[we][n]instanceof ht){const i=this[we][n];for(const c of i.keys())i.get(c)===e&&i.delete(c)}else return;this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:n})}}const os="v4.2.1",er="@glb.bin";var te;(function(s){s.ACCESSOR="Accessor",s.ANIMATION="Animation",s.ANIMATION_CHANNEL="AnimationChannel",s.ANIMATION_SAMPLER="AnimationSampler",s.BUFFER="Buffer",s.CAMERA="Camera",s.MATERIAL="Material",s.MESH="Mesh",s.PRIMITIVE="Primitive",s.PRIMITIVE_TARGET="PrimitiveTarget",s.NODE="Node",s.ROOT="Root",s.SCENE="Scene",s.SKIN="Skin",s.TEXTURE="Texture",s.TEXTURE_INFO="TextureInfo"})(te||(te={}));var tr;(function(s){s.INTERLEAVED="interleaved",s.SEPARATE="separate"})(tr||(tr={}));var He;(function(s){s.ARRAY_BUFFER="ARRAY_BUFFER",s.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",s.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",s.OTHER="OTHER",s.SPARSE="SPARSE"})(He||(He={}));var Gr;(function(s){s[s.R=4096]="R",s[s.G=256]="G",s[s.B=16]="B",s[s.A=1]="A"})(Gr||(Gr={}));var At;(function(s){s.GLTF="GLTF",s.GLB="GLB"})(At||(At={}));const sr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class be{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const n=atob(e.split(",")[1]),i=new Uint8Array(n.length);for(let c=0;c<n.length;c++)i[c]=n.charCodeAt(c);return i}else{const n=e.split(",")[1],i=e.indexOf("base64")>=0;return Buffer.from(n,i?"base64":"utf8")}}static encodeText(e){return new TextEncoder().encode(e)}static decodeText(e){return new TextDecoder().decode(e)}static concat(e){let n=0;for(const u of e)n+=u.byteLength;const i=new Uint8Array(n);let c=0;for(const u of e)i.set(u,c),c+=u.byteLength;return i}static pad(e,n=0){const i=this.padNumber(e.byteLength);if(i===e.byteLength)return e;const c=new Uint8Array(i);if(c.set(e),n!==0)for(let u=e.byteLength;u<i;u++)c[u]=n;return c}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,n){if(e===n)return!0;if(e.byteLength!==n.byteLength)return!1;let i=e.byteLength;for(;i--;)if(e[i]!==n[i])return!1;return!0}static toView(e,n=0,i=1/0){return new Uint8Array(e.buffer,e.byteOffset+n,Math.min(e.byteLength,i))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Ko{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let n=new DataView(e.buffer,e.byteOffset+4),i,c;for(;n.byteLength;){if(i=n.getUint16(0,!1),Xo(n,i),c=n.getUint8(i+1),c===192||c===193||c===194)return[n.getUint16(i+7,!1),n.getUint16(i+5,!1)];n=new DataView(e.buffer,n.byteOffset+i+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class or{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const n=new DataView(e.buffer,e.byteOffset);return be.decodeText(e.slice(12,16))===or.PNG_FRIED_CHUNK_NAME?[n.getUint32(32,!1),n.getUint32(36,!1)]:[n.getUint32(16,!1),n.getUint32(20,!1)]}getChannels(e){return 4}}or.PNG_FRIED_CHUNK_NAME="CgBI";class Vt{static registerFormat(e,n){this.impls[e]=n}static getMimeType(e){for(const n in this.impls)if(this.impls[n].match(e))return n;return null}static getSize(e,n){return this.impls[n]?this.impls[n].getSize(e):null}static getChannels(e,n){return this.impls[n]?this.impls[n].getChannels(e):null}static getVRAMByteLength(e,n){if(!this.impls[n])return null;if(this.impls[n].getVRAMByteLength)return this.impls[n].getVRAMByteLength(e);let i=0;const c=4,u=this.getSize(e,n);if(!u)return null;for(;u[0]>1||u[1]>1;)i+=u[0]*u[1]*c,u[0]=Math.max(Math.floor(u[0]/2),1),u[1]=Math.max(Math.floor(u[1]/2),1);return i+=1*1*c,i}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}Vt.impls={"image/jpeg":new Ko,"image/png":new or};function Xo(s,e){if(e>s.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(s.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return s}class an{static basename(e){const n=e.split(/[\\/]/).pop();return n.substring(0,n.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const n=e.match(/data:(image\/\w+)/)[1];return Vt.mimeTypeToExtension(n)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}var kr=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});function Qo(){var s=new kr(3);return kr!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Lr(s){var e=s[0],n=s[1],i=s[2];return Math.hypot(e,n,i)}(function(){var s=Qo();return function(e,n,i,c,u,p){var d,m;for(n||(n=3),i||(i=0),c?m=Math.min(c*n+i,e.length):m=e.length,d=i;d<m;d+=n)s[0]=e[d],s[1]=e[d+1],s[2]=e[d+2],u(s,s,p),e[d]=s[0],e[d+1]=s[1],e[d+2]=s[2];return e}})();const Yi="https://null.example";class In{static dirname(e){const n=e.lastIndexOf("/");return n===-1?"./":e.substring(0,n+1)}static basename(e){return an.basename(new URL(e,Yi).pathname)}static extension(e){return an.extension(new URL(e,Yi).pathname)}static resolve(e,n){if(!this.isRelativePath(n))return n;const i=e.split("/"),c=n.split("/");i.pop();for(let u=0;u<c.length;u++)c[u]!=="."&&(c[u]===".."?i.pop():i.push(c[u]));return i.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}In.DEFAULT_INIT={};In.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;function Wi(s){return Object.prototype.toString.call(s)==="[object Object]"}function jt(s){if(Wi(s)===!1)return!1;const e=s.constructor;if(e===void 0)return!0;const n=e.prototype;return!(Wi(n)===!1||Object.hasOwn(n,"isPrototypeOf")===!1)}var jr,Vr;(function(s){s[s.SILENT=4]="SILENT",s[s.ERROR=3]="ERROR",s[s.WARN=2]="WARN",s[s.INFO=1]="INFO",s[s.DEBUG=0]="DEBUG"})(Vr||(Vr={}));class Ke{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Ke.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Ke.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Ke.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Ke.Verbosity.ERROR&&console.error(e)}}jr=Ke;Ke.Verbosity=Vr;Ke.DEFAULT_INSTANCE=new jr(jr.Verbosity.INFO);function Jo(s){var e=s[0],n=s[1],i=s[2],c=s[3],u=s[4],p=s[5],d=s[6],m=s[7],y=s[8],w=s[9],T=s[10],M=s[11],E=s[12],A=s[13],R=s[14],O=s[15],v=e*p-n*u,j=e*d-i*u,N=e*m-c*u,_=n*d-i*p,L=n*m-c*p,H=i*m-c*d,o=y*A-w*E,U=y*R-T*E,z=y*O-M*E,$=w*R-T*A,Q=w*O-M*A,J=T*O-M*R;return v*J-j*Q+N*$+_*z-L*U+H*o}function Zo(s,e,n){var i=e[0],c=e[1],u=e[2],p=e[3],d=e[4],m=e[5],y=e[6],w=e[7],T=e[8],M=e[9],E=e[10],A=e[11],R=e[12],O=e[13],v=e[14],j=e[15],N=n[0],_=n[1],L=n[2],H=n[3];return s[0]=N*i+_*d+L*T+H*R,s[1]=N*c+_*m+L*M+H*O,s[2]=N*u+_*y+L*E+H*v,s[3]=N*p+_*w+L*A+H*j,N=n[4],_=n[5],L=n[6],H=n[7],s[4]=N*i+_*d+L*T+H*R,s[5]=N*c+_*m+L*M+H*O,s[6]=N*u+_*y+L*E+H*v,s[7]=N*p+_*w+L*A+H*j,N=n[8],_=n[9],L=n[10],H=n[11],s[8]=N*i+_*d+L*T+H*R,s[9]=N*c+_*m+L*M+H*O,s[10]=N*u+_*y+L*E+H*v,s[11]=N*p+_*w+L*A+H*j,N=n[12],_=n[13],L=n[14],H=n[15],s[12]=N*i+_*d+L*T+H*R,s[13]=N*c+_*m+L*M+H*O,s[14]=N*u+_*y+L*E+H*v,s[15]=N*p+_*w+L*A+H*j,s}function ea(s,e){var n=e[0],i=e[1],c=e[2],u=e[4],p=e[5],d=e[6],m=e[8],y=e[9],w=e[10];return s[0]=Math.hypot(n,i,c),s[1]=Math.hypot(u,p,d),s[2]=Math.hypot(m,y,w),s}function ta(s,e){var n=new kr(3);ea(n,e);var i=1/n[0],c=1/n[1],u=1/n[2],p=e[0]*i,d=e[1]*c,m=e[2]*u,y=e[4]*i,w=e[5]*c,T=e[6]*u,M=e[8]*i,E=e[9]*c,A=e[10]*u,R=p+w+A,O=0;return R>0?(O=Math.sqrt(R+1)*2,s[3]=.25*O,s[0]=(T-E)/O,s[1]=(M-m)/O,s[2]=(d-y)/O):p>w&&p>A?(O=Math.sqrt(1+p-w-A)*2,s[3]=(T-E)/O,s[0]=.25*O,s[1]=(d+y)/O,s[2]=(M+m)/O):w>A?(O=Math.sqrt(1+w-p-A)*2,s[3]=(M-m)/O,s[0]=(d+y)/O,s[1]=.25*O,s[2]=(T+E)/O):(O=Math.sqrt(1+A-p-w)*2,s[3]=(d-y)/O,s[0]=(M+m)/O,s[1]=(T+E)/O,s[2]=.25*O),s}class Ae{static identity(e){return e}static eq(e,n,i=1e-5){if(e.length!==n.length)return!1;for(let c=0;c<e.length;c++)if(Math.abs(e[c]-n[c])>i)return!1;return!0}static clamp(e,n,i){return e<n?n:e>i?i:e}static decodeNormalizedInt(e,n){switch(n){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,n){switch(n){case 5126:return e;case 5123:return Math.round(Ae.clamp(e,0,1)*65535);case 5121:return Math.round(Ae.clamp(e,0,1)*255);case 5122:return Math.round(Ae.clamp(e,-1,1)*32767);case 5120:return Math.round(Ae.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,n,i,c){let u=Lr([e[0],e[1],e[2]]);const p=Lr([e[4],e[5],e[6]]),d=Lr([e[8],e[9],e[10]]);Jo(e)<0&&(u=-u),n[0]=e[12],n[1]=e[13],n[2]=e[14];const y=e.slice(),w=1/u,T=1/p,M=1/d;y[0]*=w,y[1]*=w,y[2]*=w,y[4]*=T,y[5]*=T,y[6]*=T,y[8]*=M,y[9]*=M,y[10]*=M,ta(i,y),c[0]=u,c[1]=p,c[2]=d}static compose(e,n,i,c){const u=c,p=n[0],d=n[1],m=n[2],y=n[3],w=p+p,T=d+d,M=m+m,E=p*w,A=p*T,R=p*M,O=d*T,v=d*M,j=m*M,N=y*w,_=y*T,L=y*M,H=i[0],o=i[1],U=i[2];return u[0]=(1-(O+j))*H,u[1]=(A+L)*H,u[2]=(R-_)*H,u[3]=0,u[4]=(A-L)*o,u[5]=(1-(E+j))*o,u[6]=(v+N)*o,u[7]=0,u[8]=(R+_)*U,u[9]=(v-N)*U,u[10]=(1-(E+O))*U,u[11]=0,u[12]=e[0],u[13]=e[1],u[14]=e[2],u[15]=1,u}}function na(s,e){if(!!s!=!!e)return!1;const n=s.getChild(),i=e.getChild();return n===i||n.equals(i)}function ra(s,e){if(!!s!=!!e)return!1;const n=s.values(),i=e.values();if(n.length!==i.length)return!1;for(let c=0;c<n.length;c++){const u=n[c],p=i[c];if(u.getChild()!==p.getChild()&&!u.getChild().equals(p.getChild()))return!1}return!0}function ia(s,e){if(!!s!=!!e)return!1;const n=s.keys(),i=e.keys();if(n.length!==i.length)return!1;for(const c of n){const u=s.get(c),p=e.get(c);if(!!u!=!!p)return!1;const d=u.getChild(),m=p.getChild();if(d!==m&&!d.equals(m))return!1}return!0}function as(s,e){if(s===e)return!0;if(!!s!=!!e||!s||!e||s.length!==e.length)return!1;for(let n=0;n<s.length;n++)if(s[n]!==e[n])return!1;return!0}function cs(s,e){if(s===e)return!0;if(!!s!=!!e)return!1;if(!jt(s)||!jt(e))return s===e;const n=s,i=e;let c=0,u=0,p;for(p in n)c++;for(p in i)u++;if(c!==u)return!1;for(p in n){const d=n[p],m=i[p];if(nr(d)&&nr(m)){if(!as(d,m))return!1}else if(jt(d)&&jt(m)){if(!cs(d,m))return!1}else if(d!==m)return!1}return!0}function nr(s){return Array.isArray(s)||ArrayBuffer.isView(s)}const Ki="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",sa=999,oa=6,Xi=new Set,aa=function(){let e="";for(let n=0;n<oa;n++)e+=Ki.charAt(Math.floor(Math.random()*Ki.length));return e},ca=function(){for(let e=0;e<sa;e++){const n=aa();if(!Xi.has(n))return Xi.add(n),n}return""},Ct=s=>s,ua=new Set;class Yr extends $r{constructor(e,n=""){super(e),this[we].name=n,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,n){return Array.isArray(n)&&(n=n.slice()),super.set(e,n)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,Ct)}copy(e,n=Ct){for(const i in this[we]){const c=this[we][i];if(c instanceof rn)this[Gt].has(i)||c.dispose();else if(c instanceof St||c instanceof Se)for(const u of c.values())u.dispose();else if(c instanceof ht)for(const u of c.values())u.dispose()}for(const i in e[we]){const c=this[we][i],u=e[we][i];if(u instanceof rn)this[Gt].has(i)?c.getChild().copy(n(u.getChild()),n):this.setRef(i,n(u.getChild()),u.getAttributes());else if(u instanceof Se||u instanceof St)for(const p of u.values())this.addRef(i,n(p.getChild()),p.getAttributes());else if(u instanceof ht)for(const p of u.keys()){const d=u.get(p);this.setRefMap(i,p,n(d.getChild()),d.getAttributes())}else jt(u)?this[we][i]=JSON.parse(JSON.stringify(u)):Array.isArray(u)||u instanceof ArrayBuffer||ArrayBuffer.isView(u)?this[we][i]=u.slice():this[we][i]=u}return this}equals(e,n=ua){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const i in this[we]){if(n.has(i))continue;const c=this[we][i],u=e[we][i];if(c instanceof rn||u instanceof rn){if(!na(c,u))return!1}else if(c instanceof Se||u instanceof Se||c instanceof St||u instanceof St){if(!ra(c,u))return!1}else if(c instanceof ht||u instanceof ht){if(!ia(c,u))return!1}else if(jt(c)||jt(u)){if(!cs(c,u))return!1}else if(nr(c)||nr(u)){if(!as(c,u))return!1}else if(c!==u)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class De extends Yr{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new ht})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,n){return n&&n._validateParent(this),this.setRefMap("extensions",e,n)}listExtensions(){return this.listRefMapValues("extensions")}}class ae extends De{init(){this.propertyType=te.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:ae.Type.SCALAR,componentType:ae.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case ae.Type.SCALAR:return 1;case ae.Type.VEC2:return 2;case ae.Type.VEC3:return 3;case ae.Type.VEC4:return 4;case ae.Type.MAT2:return 4;case ae.Type.MAT3:return 9;case ae.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case ae.ComponentType.BYTE:return 1;case ae.ComponentType.UNSIGNED_BYTE:return 1;case ae.ComponentType.SHORT:return 2;case ae.ComponentType.UNSIGNED_SHORT:return 2;case ae.ComponentType.UNSIGNED_INT:return 4;case ae.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const n=this.getNormalized(),i=this.getElementSize(),c=this.getComponentType();if(this.getMin(e),n)for(let u=0;u<i;u++)e[u]=Ae.decodeNormalizedInt(e[u],c);return e}getMin(e){const n=this.getArray(),i=this.getCount(),c=this.getElementSize();for(let u=0;u<c;u++)e[u]=1/0;for(let u=0;u<i*c;u+=c)for(let p=0;p<c;p++){const d=n[u+p];Number.isFinite(d)&&(e[p]=Math.min(e[p],d))}return e}getMaxNormalized(e){const n=this.getNormalized(),i=this.getElementSize(),c=this.getComponentType();if(this.getMax(e),n)for(let u=0;u<i;u++)e[u]=Ae.decodeNormalizedInt(e[u],c);return e}getMax(e){const n=this.get("array"),i=this.getCount(),c=this.getElementSize();for(let u=0;u<c;u++)e[u]=-1/0;for(let u=0;u<i*c;u+=c)for(let p=0;p<c;p++){const d=n[u+p];Number.isFinite(d)&&(e[p]=Math.max(e[p],d))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return ae.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const n=this.getElementSize(),i=this.getComponentType(),c=this.getArray();return this.getNormalized()?Ae.decodeNormalizedInt(c[e*n],i):c[e*n]}setScalar(e,n){const i=this.getElementSize(),c=this.getComponentType(),u=this.getArray();return this.getNormalized()?u[e*i]=Ae.encodeNormalizedInt(n,c):u[e*i]=n,this}getElement(e,n){const i=this.getNormalized(),c=this.getElementSize(),u=this.getComponentType(),p=this.getArray();for(let d=0;d<c;d++)i?n[d]=Ae.decodeNormalizedInt(p[e*c+d],u):n[d]=p[e*c+d];return n}setElement(e,n){const i=this.getNormalized(),c=this.getElementSize(),u=this.getComponentType(),p=this.getArray();for(let d=0;d<c;d++)i?p[e*c+d]=Ae.encodeNormalizedInt(n[d],u):p[e*c+d]=n[d];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?la(e):ae.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}ae.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};ae.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function la(s){switch(s.constructor){case Float32Array:return ae.ComponentType.FLOAT;case Uint32Array:return ae.ComponentType.UNSIGNED_INT;case Uint16Array:return ae.ComponentType.UNSIGNED_SHORT;case Uint8Array:return ae.ComponentType.UNSIGNED_BYTE;case Int16Array:return ae.ComponentType.SHORT;case Int8Array:return ae.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class us extends De{init(){this.propertyType=te.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new Se,samplers:new Se})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class ls extends De{init(){this.propertyType=te.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}ls.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class Nn extends De{init(){this.propertyType=te.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Nn.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:He.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:He.OTHER})}}Nn.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class fs extends De{init(){this.propertyType=te.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class qt extends De{init(){this.propertyType=te.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:qt.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}qt.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class fa extends Yr{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}fa.EXTENSION_NAME=void 0;class Ze extends De{init(){this.propertyType=te.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Ze.WrapMode.REPEAT,wrapT:Ze.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Ze.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Ze.MagFilter={NEAREST:9728,LINEAR:9729};Ze.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:qn,G:$n,B:Yn,A:ha}=Gr;class Ht extends De{init(){this.propertyType=te.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Ht.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Ze(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Ze(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Ze(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Ze(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Ze(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const n=this.get("baseColorFactor").slice();return n[3]=e,this.set("baseColorFactor",n)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:qn|$n|Yn|ha,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:qn|$n|Yn,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:qn|$n|Yn})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:qn})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:$n|Yn})}}Ht.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class hs extends De{init(){this.propertyType=te.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new Se})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class ds extends De{init(){this.propertyType=te.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new Se})}copy(e,n=Ct){if(n===Ct)throw new Error("Node cannot be copied.");return super.copy(e,n)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Ae.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const n=this.get("translation").slice(),i=this.get("rotation").slice(),c=this.get("scale").slice();return Ae.decompose(e,n,i,c),this.set("translation",n).set("rotation",i).set("scale",c)}getWorldTranslation(){const e=[0,0,0];return Ae.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Ae.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Ae.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let c=this;c!=null;c=c.getParentNode())e.push(c);let n;const i=e.pop().getMatrix();for(;n=e.pop();)Zo(i,i,n.getMatrix());return i}addChild(e){const n=e.getParentNode();n&&n.removeChild(e);for(const i of e.listParents())i.propertyType===te.SCENE&&i.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===te.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const n of this.listChildren())n.traverse(e);return this}}class ar extends De{init(){this.propertyType=te.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:ar.Mode.TRIANGLES,material:null,indices:null,attributes:new ht,targets:new Se})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:He.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,n){return this.setRefMap("attributes",e,n,{usage:He.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}ar.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class da extends Yr{init(){this.propertyType=te.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new ht})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,n){return this.setRefMap("attributes",e,n,{usage:He.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function _e(){return _e=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(s[i]=n[i])}return s},_e.apply(null,arguments)}class ps extends De{init(){this.propertyType=te.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new Se})}copy(e,n=Ct){if(n===Ct)throw new Error("Scene cannot be copied.");return super.copy(e,n)}addChild(e){const n=e.getParentNode();return n&&n.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const n of this.listChildren())n.traverse(e);return this}}class gs extends De{init(){this.propertyType=te.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new Se})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:He.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class ms extends De{init(){this.propertyType=te.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Vt.extensionToMimeType(an.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const n=Vt.extensionToMimeType(an.extension(e));return n&&this.set("mimeType",n),this}getImage(){return this.get("image")}setImage(e){return this.set("image",be.assertView(e))}getSize(){const e=this.get("image");return e?Vt.getSize(e,this.getMimeType()):null}}class pa extends De{init(){this.propertyType=te.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${os}`,version:"2.0"},defaultScene:null,accessors:new Se,animations:new Se,buffers:new Se,cameras:new Se,materials:new Se,meshes:new Se,nodes:new Se,scenes:new Se,skins:new Se,textures:new Se})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",n=>{this._addChildOfRoot(n.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,n=Ct){if(n===Ct)throw new Error("Root cannot be copied.");this.set("asset",_e({},e.get("asset"))),this.setName(e.getName()),this.setExtras(_e({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?n(e.getDefaultScene()):null);for(const i of e.listRefMapKeys("extensions")){const c=e.getExtension(i);this.setExtension(i,n(c))}return this}_addChildOfRoot(e){return e instanceof ps?this.addRef("scenes",e):e instanceof ds?this.addRef("nodes",e):e instanceof qt?this.addRef("cameras",e):e instanceof gs?this.addRef("skins",e):e instanceof hs?this.addRef("meshes",e):e instanceof Ht?this.addRef("materials",e):e instanceof ms?this.addRef("textures",e):e instanceof us?this.addRef("animations",e):e instanceof ae?this.addRef("accessors",e):e instanceof fs&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Rn{static fromGraph(e){return Rn._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new Wo,this._root=new pa(this._graph),this._logger=Ke.DEFAULT_INSTANCE,Rn._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const n=e.map(i=>i.name);for(const i of e)await i(this,{stack:n});return this}createExtension(e){const n=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(c=>c.extensionName===n)||new e(this)}createScene(e=""){return new ps(this._graph,e)}createNode(e=""){return new ds(this._graph,e)}createCamera(e=""){return new qt(this._graph,e)}createSkin(e=""){return new gs(this._graph,e)}createMesh(e=""){return new hs(this._graph,e)}createPrimitive(){return new ar(this._graph)}createPrimitiveTarget(e=""){return new da(this._graph,e)}createMaterial(e=""){return new Ht(this._graph,e)}createTexture(e=""){return new ms(this._graph,e)}createAnimation(e=""){return new us(this._graph,e)}createAnimationChannel(e=""){return new ls(this._graph,e)}createAnimationSampler(e=""){return new Nn(this._graph,e)}createAccessor(e="",n=null){return n||(n=this.getRoot().listBuffers()[0]),new ae(this._graph,e).setBuffer(n)}createBuffer(e=""){return new fs(this._graph,e)}}Rn._GRAPH_DOCUMENTS=new WeakMap;class ga{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,n){this.textureInfos.set(e,n),n.texCoord!==void 0&&e.setTexCoord(n.texCoord),n.extras!==void 0&&e.setExtras(n.extras);const i=this.jsonDoc.json.textures[n.index];if(i.sampler===void 0)return;const c=this.jsonDoc.json.samplers[i.sampler];c.magFilter!==void 0&&e.setMagFilter(c.magFilter),c.minFilter!==void 0&&e.setMinFilter(c.minFilter),c.wrapS!==void 0&&e.setWrapS(c.wrapS),c.wrapT!==void 0&&e.setWrapT(c.wrapT)}}const Qi={logger:Ke.DEFAULT_INSTANCE,extensions:[],dependencies:{}},ma=new Set([te.BUFFER,te.TEXTURE,te.MATERIAL,te.MESH,te.PRIMITIVE,te.NODE,te.SCENE]);class ya{static read(e,n=Qi){const i=_e({},Qi,n),{json:c}=e,u=new Rn().setLogger(i.logger);this.validate(e,i);const p=new ga(e),d=c.asset,m=u.getRoot().getAsset();d.copyright&&(m.copyright=d.copyright),d.extras&&(m.extras=d.extras),c.extras!==void 0&&u.getRoot().setExtras(_e({},c.extras));const y=c.extensionsUsed||[],w=c.extensionsRequired||[];i.extensions.sort((o,U)=>o.EXTENSION_NAME>U.EXTENSION_NAME?1:-1);for(const o of i.extensions)if(y.includes(o.EXTENSION_NAME)){const U=u.createExtension(o).setRequired(w.includes(o.EXTENSION_NAME)),z=U.prereadTypes.filter($=>!ma.has($));z.length&&i.logger.warn(`Preread hooks for some types (${z.join()}), requested by extension ${U.extensionName}, are unsupported. Please file an issue or a PR.`);for(const $ of U.readDependencies)U.install($,i.dependencies[$])}const T=c.buffers||[];u.getRoot().listExtensionsUsed().filter(o=>o.prereadTypes.includes(te.BUFFER)).forEach(o=>o.preread(p,te.BUFFER)),p.buffers=T.map(o=>{const U=u.createBuffer(o.name);return o.extras&&U.setExtras(o.extras),o.uri&&o.uri.indexOf("__")!==0&&U.setURI(o.uri),U});const M=c.bufferViews||[];p.bufferViewBuffers=M.map((o,U)=>{if(!p.bufferViews[U]){const z=e.json.buffers[o.buffer],$=z.uri?e.resources[z.uri]:e.resources[er],Q=o.byteOffset||0;p.bufferViews[U]=be.toView($,Q,o.byteLength)}return p.buffers[o.buffer]});const E=c.accessors||[];p.accessors=E.map(o=>{const U=p.bufferViewBuffers[o.bufferView],z=u.createAccessor(o.name,U).setType(o.type);return o.extras&&z.setExtras(o.extras),o.normalized!==void 0&&z.setNormalized(o.normalized),o.bufferView===void 0||z.setArray(Jn(o,p)),z});const A=c.images||[],R=c.textures||[];u.getRoot().listExtensionsUsed().filter(o=>o.prereadTypes.includes(te.TEXTURE)).forEach(o=>o.preread(p,te.TEXTURE)),p.textures=A.map(o=>{const U=u.createTexture(o.name);if(o.extras&&U.setExtras(o.extras),o.bufferView!==void 0){const z=c.bufferViews[o.bufferView],$=e.json.buffers[z.buffer],Q=$.uri?e.resources[$.uri]:e.resources[er],J=z.byteOffset||0,Y=z.byteLength,me=Q.slice(J,J+Y);U.setImage(me)}else o.uri!==void 0&&(U.setImage(e.resources[o.uri]),o.uri.indexOf("__")!==0&&U.setURI(o.uri));if(o.mimeType!==void 0)U.setMimeType(o.mimeType);else if(o.uri){const z=an.extension(o.uri);U.setMimeType(Vt.extensionToMimeType(z))}return U}),u.getRoot().listExtensionsUsed().filter(o=>o.prereadTypes.includes(te.MATERIAL)).forEach(o=>o.preread(p,te.MATERIAL));const O=c.materials||[];p.materials=O.map(o=>{const U=u.createMaterial(o.name);o.extras&&U.setExtras(o.extras),o.alphaMode!==void 0&&U.setAlphaMode(o.alphaMode),o.alphaCutoff!==void 0&&U.setAlphaCutoff(o.alphaCutoff),o.doubleSided!==void 0&&U.setDoubleSided(o.doubleSided);const z=o.pbrMetallicRoughness||{};if(z.baseColorFactor!==void 0&&U.setBaseColorFactor(z.baseColorFactor),o.emissiveFactor!==void 0&&U.setEmissiveFactor(o.emissiveFactor),z.metallicFactor!==void 0&&U.setMetallicFactor(z.metallicFactor),z.roughnessFactor!==void 0&&U.setRoughnessFactor(z.roughnessFactor),z.baseColorTexture!==void 0){const $=z.baseColorTexture,Q=p.textures[R[$.index].source];U.setBaseColorTexture(Q),p.setTextureInfo(U.getBaseColorTextureInfo(),$)}if(o.emissiveTexture!==void 0){const $=o.emissiveTexture,Q=p.textures[R[$.index].source];U.setEmissiveTexture(Q),p.setTextureInfo(U.getEmissiveTextureInfo(),$)}if(o.normalTexture!==void 0){const $=o.normalTexture,Q=p.textures[R[$.index].source];U.setNormalTexture(Q),p.setTextureInfo(U.getNormalTextureInfo(),$),o.normalTexture.scale!==void 0&&U.setNormalScale(o.normalTexture.scale)}if(o.occlusionTexture!==void 0){const $=o.occlusionTexture,Q=p.textures[R[$.index].source];U.setOcclusionTexture(Q),p.setTextureInfo(U.getOcclusionTextureInfo(),$),o.occlusionTexture.strength!==void 0&&U.setOcclusionStrength(o.occlusionTexture.strength)}if(z.metallicRoughnessTexture!==void 0){const $=z.metallicRoughnessTexture,Q=p.textures[R[$.index].source];U.setMetallicRoughnessTexture(Q),p.setTextureInfo(U.getMetallicRoughnessTextureInfo(),$)}return U}),u.getRoot().listExtensionsUsed().filter(o=>o.prereadTypes.includes(te.MESH)).forEach(o=>o.preread(p,te.MESH));const v=c.meshes||[];u.getRoot().listExtensionsUsed().filter(o=>o.prereadTypes.includes(te.PRIMITIVE)).forEach(o=>o.preread(p,te.PRIMITIVE)),p.meshes=v.map(o=>{const U=u.createMesh(o.name);return o.extras&&U.setExtras(o.extras),o.weights!==void 0&&U.setWeights(o.weights),(o.primitives||[]).forEach($=>{const Q=u.createPrimitive();$.extras&&Q.setExtras($.extras),$.material!==void 0&&Q.setMaterial(p.materials[$.material]),$.mode!==void 0&&Q.setMode($.mode);for(const[me,re]of Object.entries($.attributes||{}))Q.setAttribute(me,p.accessors[re]);$.indices!==void 0&&Q.setIndices(p.accessors[$.indices]);const J=o.extras&&o.extras.targetNames||[];($.targets||[]).forEach((me,re)=>{const ue=J[re]||re.toString(),de=u.createPrimitiveTarget(ue);for(const[Ce,ce]of Object.entries(me))de.setAttribute(Ce,p.accessors[ce]);Q.addTarget(de)}),U.addPrimitive(Q)}),U});const j=c.cameras||[];p.cameras=j.map(o=>{const U=u.createCamera(o.name).setType(o.type);if(o.extras&&U.setExtras(o.extras),o.type===qt.Type.PERSPECTIVE){const z=o.perspective;U.setYFov(z.yfov),U.setZNear(z.znear),z.zfar!==void 0&&U.setZFar(z.zfar),z.aspectRatio!==void 0&&U.setAspectRatio(z.aspectRatio)}else{const z=o.orthographic;U.setZNear(z.znear).setZFar(z.zfar).setXMag(z.xmag).setYMag(z.ymag)}return U});const N=c.nodes||[];u.getRoot().listExtensionsUsed().filter(o=>o.prereadTypes.includes(te.NODE)).forEach(o=>o.preread(p,te.NODE)),p.nodes=N.map(o=>{const U=u.createNode(o.name);if(o.extras&&U.setExtras(o.extras),o.translation!==void 0&&U.setTranslation(o.translation),o.rotation!==void 0&&U.setRotation(o.rotation),o.scale!==void 0&&U.setScale(o.scale),o.matrix!==void 0){const z=[0,0,0],$=[0,0,0,1],Q=[1,1,1];Ae.decompose(o.matrix,z,$,Q),U.setTranslation(z),U.setRotation($),U.setScale(Q)}return o.weights!==void 0&&U.setWeights(o.weights),U});const _=c.skins||[];p.skins=_.map(o=>{const U=u.createSkin(o.name);o.extras&&U.setExtras(o.extras),o.inverseBindMatrices!==void 0&&U.setInverseBindMatrices(p.accessors[o.inverseBindMatrices]),o.skeleton!==void 0&&U.setSkeleton(p.nodes[o.skeleton]);for(const z of o.joints)U.addJoint(p.nodes[z]);return U}),N.map((o,U)=>{const z=p.nodes[U];(o.children||[]).forEach(Q=>z.addChild(p.nodes[Q])),o.mesh!==void 0&&z.setMesh(p.meshes[o.mesh]),o.camera!==void 0&&z.setCamera(p.cameras[o.camera]),o.skin!==void 0&&z.setSkin(p.skins[o.skin])});const L=c.animations||[];p.animations=L.map(o=>{const U=u.createAnimation(o.name);o.extras&&U.setExtras(o.extras);const $=(o.samplers||[]).map(J=>{const Y=u.createAnimationSampler().setInput(p.accessors[J.input]).setOutput(p.accessors[J.output]).setInterpolation(J.interpolation||Nn.Interpolation.LINEAR);return J.extras&&Y.setExtras(J.extras),U.addSampler(Y),Y});return(o.channels||[]).forEach(J=>{const Y=u.createAnimationChannel().setSampler($[J.sampler]).setTargetPath(J.target.path);J.target.node!==void 0&&Y.setTargetNode(p.nodes[J.target.node]),J.extras&&Y.setExtras(J.extras),U.addChannel(Y)}),U});const H=c.scenes||[];return u.getRoot().listExtensionsUsed().filter(o=>o.prereadTypes.includes(te.SCENE)).forEach(o=>o.preread(p,te.SCENE)),p.scenes=H.map(o=>{const U=u.createScene(o.name);return o.extras&&U.setExtras(o.extras),(o.nodes||[]).map($=>p.nodes[$]).forEach($=>U.addChild($)),U}),c.scene!==void 0&&u.getRoot().setDefaultScene(p.scenes[c.scene]),u.getRoot().listExtensionsUsed().forEach(o=>o.read(p)),E.forEach((o,U)=>{const z=p.accessors[U],$=!!o.sparse,Q=!o.bufferView&&!z.getArray();($||Q)&&z.setSparse(!0).setArray(va(o,p))}),u}static validate(e,n){const i=e.json;if(i.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${i.asset.version}".`);if(i.extensionsRequired){for(const c of i.extensionsRequired)if(!n.extensions.find(u=>u.EXTENSION_NAME===c))throw new Error(`Missing required extension, "${c}".`)}if(i.extensionsUsed)for(const c of i.extensionsUsed)n.extensions.find(u=>u.EXTENSION_NAME===c)||n.logger.warn(`Missing optional extension, "${c}".`)}}function xa(s,e){const n=e.jsonDoc,i=e.bufferViews[s.bufferView],c=n.json.bufferViews[s.bufferView],u=sr[s.componentType],p=ae.getElementSize(s.type),d=u.BYTES_PER_ELEMENT,m=s.byteOffset||0,y=new u(s.count*p),w=new DataView(i.buffer,i.byteOffset,i.byteLength),T=c.byteStride;for(let M=0;M<s.count;M++)for(let E=0;E<p;E++){const A=m+M*T+E*d;let R;switch(s.componentType){case ae.ComponentType.FLOAT:R=w.getFloat32(A,!0);break;case ae.ComponentType.UNSIGNED_INT:R=w.getUint32(A,!0);break;case ae.ComponentType.UNSIGNED_SHORT:R=w.getUint16(A,!0);break;case ae.ComponentType.UNSIGNED_BYTE:R=w.getUint8(A);break;case ae.ComponentType.SHORT:R=w.getInt16(A,!0);break;case ae.ComponentType.BYTE:R=w.getInt8(A);break;default:throw new Error(`Unexpected componentType "${s.componentType}".`)}y[M*p+E]=R}return y}function Jn(s,e){const n=e.jsonDoc,i=e.bufferViews[s.bufferView],c=n.json.bufferViews[s.bufferView],u=sr[s.componentType],p=ae.getElementSize(s.type),d=u.BYTES_PER_ELEMENT,m=p*d;if(c.byteStride!==void 0&&c.byteStride!==m)return xa(s,e);const y=i.byteOffset+(s.byteOffset||0),w=s.count*p*d;return new u(i.buffer.slice(y,y+w))}function va(s,e){const n=sr[s.componentType],i=ae.getElementSize(s.type);let c;s.bufferView!==void 0?c=Jn(s,e):c=new n(s.count*i);const u=s.sparse;if(!u)return c;const p=u.count,d=_e({},s,u.indices,{count:p,type:"SCALAR"}),m=_e({},s,u.values,{count:p}),y=Jn(d,e),w=Jn(m,e);for(let T=0;T<d.count;T++)for(let M=0;M<i;M++)c[y[T]*i+M]=w[T*i+M];return c}var Pn;(function(s){s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Pn||(Pn={}));class zt{constructor(e,n,i){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=n,this.options=i;const c=e.getRoot(),u=c.listBuffers().length,p=c.listTextures().length;this.bufferURIGenerator=new Ji(u>1,()=>i.basename||"buffer"),this.imageURIGenerator=new Ji(p>1,d=>ba(e,d)||i.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,n){const i={magFilter:n.getMagFilter()||void 0,minFilter:n.getMinFilter()||void 0,wrapS:n.getWrapS(),wrapT:n.getWrapT()},c=JSON.stringify(i);this.samplerDefIndexMap.has(c)||(this.samplerDefIndexMap.set(c,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(i));const u={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(c)},p=JSON.stringify(u);this.textureDefIndexMap.has(p)||(this.textureDefIndexMap.set(p,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(u));const d={index:this.textureDefIndexMap.get(p)};return n.getTexCoord()!==0&&(d.texCoord=n.getTexCoord()),Object.keys(n.getExtras()).length>0&&(d.extras=n.getExtras()),this.textureInfoDefMap.set(n,d),d}createPropertyDef(e){const n={};return e.getName()&&(n.name=e.getName()),Object.keys(e.getExtras()).length>0&&(n.extras=e.getExtras()),n}createAccessorDef(e){const n=this.createPropertyDef(e);return n.type=e.getType(),n.componentType=e.getComponentType(),n.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(c=>c.getName()==="attributes"&&c.getAttributes().key==="POSITION"||c.getName()==="input")&&(n.max=e.getMax([]).map(Math.fround),n.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(n.normalized=e.getNormalized()),n}createImageData(e,n,i){if(this.options.format===At.GLB)this.imageBufferViews.push(n),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:n.byteLength});else{const c=Vt.mimeTypeToExtension(i.getMimeType());e.uri=this.imageURIGenerator.createURI(i,c),this.assignResourceURI(e.uri,n,!1)}}assignResourceURI(e,n,i){const c=this.jsonDoc.resources;if(!(e in c)){c[e]=n;return}if(n===c[e]){this.logger.warn(`Duplicate resource URI, "${e}".`);return}const u=`Resource URI "${e}" already assigned to different data.`;if(!i){this.logger.warn(u);return}throw new Error(u)}getAccessorUsage(e){const n=this._accessorUsageMap.get(e);if(n)return n;if(e.getSparse())return He.SPARSE;for(const i of this._doc.getGraph().listParentEdges(e)){const{usage:c}=i.getAttributes();if(c)return c;i.getParent().propertyType!==te.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${i.getName()}".`)}return He.OTHER}addAccessorToUsageGroup(e,n){const i=this._accessorUsageMap.get(e);if(i&&i!==n)throw new Error(`Accessor with usage "${i}" cannot be reused as "${n}".`);return this._accessorUsageMap.set(e,n),this}}zt.BufferViewTarget=Pn;zt.BufferViewUsage=He;zt.USAGE_TO_TARGET={[He.ARRAY_BUFFER]:Pn.ARRAY_BUFFER,[He.ELEMENT_ARRAY_BUFFER]:Pn.ELEMENT_ARRAY_BUFFER};class Ji{constructor(e,n){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=n}createURI(e,n){if(e.getURI())return e.getURI();if(this.multiple){const i=this.basename(e);return this.counter[i]=this.counter[i]||1,`${i}_${this.counter[i]++}.${n}`}else return`${this.basename(e)}.${n}`}}function ba(s,e){const n=s.getGraph().listParentEdges(e).find(i=>i.getParent()!==s.getRoot());return n?n.getName().replace(/texture$/i,""):""}const{BufferViewUsage:Wn}=zt,{UNSIGNED_INT:wa,UNSIGNED_SHORT:Ta,UNSIGNED_BYTE:Ea}=ae.ComponentType,Sa=new Set([te.ACCESSOR,te.BUFFER,te.MATERIAL,te.MESH]);class Aa{static write(e,n){const i=e.getGraph(),c=e.getRoot(),u={asset:_e({generator:`glTF-Transform ${os}`},c.getAsset()),extras:_e({},c.getExtras())},p={json:u,resources:{}},d=new zt(e,p,n),m=n.logger||Ke.DEFAULT_INSTANCE,y=new Set(n.extensions.map(v=>v.EXTENSION_NAME)),w=e.getRoot().listExtensionsUsed().filter(v=>y.has(v.extensionName)).sort((v,j)=>v.extensionName>j.extensionName?1:-1),T=e.getRoot().listExtensionsRequired().filter(v=>y.has(v.extensionName)).sort((v,j)=>v.extensionName>j.extensionName?1:-1);w.length<e.getRoot().listExtensionsUsed().length&&m.warn("Some extensions were not registered for I/O, and will not be written.");for(const v of w){const j=v.prewriteTypes.filter(N=>!Sa.has(N));j.length&&m.warn(`Prewrite hooks for some types (${j.join()}), requested by extension ${v.extensionName}, are unsupported. Please file an issue or a PR.`);for(const N of v.writeDependencies)v.install(N,n.dependencies[N])}function M(v,j,N,_){const L=[];let H=0;for(const z of v){const $=d.createAccessorDef(z);$.bufferView=u.bufferViews.length;const Q=z.getArray(),J=be.pad(be.toView(Q));$.byteOffset=H,H+=J.byteLength,L.push(J),d.accessorIndexMap.set(z,u.accessors.length),u.accessors.push($)}const o=be.concat(L),U={buffer:j,byteOffset:N,byteLength:o.byteLength};return _&&(U.target=_),u.bufferViews.push(U),{buffers:L,byteLength:H}}function E(v,j,N){const _=v[0].getCount();let L=0;for(const $ of v){const Q=d.createAccessorDef($);Q.bufferView=u.bufferViews.length,Q.byteOffset=L;const J=$.getElementSize(),Y=$.getComponentSize();L+=be.padNumber(J*Y),d.accessorIndexMap.set($,u.accessors.length),u.accessors.push(Q)}const H=_*L,o=new ArrayBuffer(H),U=new DataView(o);for(let $=0;$<_;$++){let Q=0;for(const J of v){const Y=J.getElementSize(),me=J.getComponentSize(),re=J.getComponentType(),ue=J.getArray();for(let de=0;de<Y;de++){const Ce=$*L+Q+de*me,ce=ue[$*Y+de];switch(re){case ae.ComponentType.FLOAT:U.setFloat32(Ce,ce,!0);break;case ae.ComponentType.BYTE:U.setInt8(Ce,ce);break;case ae.ComponentType.SHORT:U.setInt16(Ce,ce,!0);break;case ae.ComponentType.UNSIGNED_BYTE:U.setUint8(Ce,ce);break;case ae.ComponentType.UNSIGNED_SHORT:U.setUint16(Ce,ce,!0);break;case ae.ComponentType.UNSIGNED_INT:U.setUint32(Ce,ce,!0);break;default:throw new Error("Unexpected component type: "+re)}}Q+=be.padNumber(Y*me)}}const z={buffer:j,byteOffset:N,byteLength:H,byteStride:L,target:zt.BufferViewTarget.ARRAY_BUFFER};return u.bufferViews.push(z),{byteLength:H,buffers:[new Uint8Array(o)]}}function A(v,j,N){const _=[];let L=0;const H=new Map;let o=-1/0,U=!1;for(const re of v){const ue=d.createAccessorDef(re);u.accessors.push(ue),d.accessorIndexMap.set(re,u.accessors.length-1);const de=[],Ce=[],ce=[],Re=new Array(re.getElementSize()).fill(0);for(let et=0,ln=re.getCount();et<ln;et++)if(re.getElement(et,ce),!Ae.eq(ce,Re,0)){o=Math.max(et,o),de.push(et);for(let Xe=0;Xe<ce.length;Xe++)Ce.push(ce[Xe])}const vt=de.length,bt={accessorDef:ue,count:vt};if(H.set(re,bt),vt===0)continue;vt>re.getCount()/2&&(U=!0);const Mt=sr[re.getComponentType()];bt.indices=de,bt.values=new Mt(Ce)}if(!Number.isFinite(o))return{buffers:_,byteLength:L};U&&m.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const z=o<255?Uint8Array:o<65535?Uint16Array:Uint32Array,$=o<255?Ea:o<65535?Ta:wa,Q={buffer:j,byteOffset:N+L,byteLength:0};for(const re of v){const ue=H.get(re);if(ue.count===0)continue;ue.indicesByteOffset=Q.byteLength;const de=be.pad(be.toView(new z(ue.indices)));_.push(de),L+=de.byteLength,Q.byteLength+=de.byteLength}u.bufferViews.push(Q);const J=u.bufferViews.length-1,Y={buffer:j,byteOffset:N+L,byteLength:0};for(const re of v){const ue=H.get(re);if(ue.count===0)continue;ue.valuesByteOffset=Y.byteLength;const de=be.pad(be.toView(ue.values));_.push(de),L+=de.byteLength,Y.byteLength+=de.byteLength}u.bufferViews.push(Y);const me=u.bufferViews.length-1;for(const re of v){const ue=H.get(re);ue.count!==0&&(ue.accessorDef.sparse={count:ue.count,indices:{bufferView:J,byteOffset:ue.indicesByteOffset,componentType:$},values:{bufferView:me,byteOffset:ue.valuesByteOffset}})}return{buffers:_,byteLength:L}}if(u.accessors=[],u.bufferViews=[],u.samplers=[],u.textures=[],u.images=c.listTextures().map((v,j)=>{const N=d.createPropertyDef(v);v.getMimeType()&&(N.mimeType=v.getMimeType());const _=v.getImage();return _&&d.createImageData(N,_,v),d.imageIndexMap.set(v,j),N}),w.filter(v=>v.prewriteTypes.includes(te.ACCESSOR)).forEach(v=>v.prewrite(d,te.ACCESSOR)),c.listAccessors().forEach(v=>{const j=d.accessorUsageGroupedByParent,N=d.accessorParents;if(d.accessorIndexMap.has(v))return;const _=d.getAccessorUsage(v);if(d.addAccessorToUsageGroup(v,_),j.has(_)){const L=i.listParents(v).find(H=>H.propertyType!==te.ROOT);N.set(v,L)}}),w.filter(v=>v.prewriteTypes.includes(te.BUFFER)).forEach(v=>v.prewrite(d,te.BUFFER)),(c.listAccessors().length>0||d.otherBufferViews.size>0||c.listTextures().length>0&&n.format===At.GLB)&&c.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");u.buffers=[],c.listBuffers().forEach((v,j)=>{const N=d.createPropertyDef(v),_=d.accessorUsageGroupedByParent,L=v.listParents().filter(Y=>Y instanceof ae),H=new Set(L.map(Y=>d.accessorParents.get(Y))),o=new Map(Array.from(H).map((Y,me)=>[Y,me])),U={};for(const Y of L){var z;if(d.accessorIndexMap.has(Y))continue;const me=d.getAccessorUsage(Y);let re=me;if(_.has(me)){const ue=d.accessorParents.get(Y);re+=`:${o.get(ue)}`}U[z=re]||(U[z]={usage:me,accessors:[]}),U[re].accessors.push(Y)}const $=[],Q=u.buffers.length;let J=0;for(const{usage:Y,accessors:me}of Object.values(U))if(Y===Wn.ARRAY_BUFFER&&n.vertexLayout===tr.INTERLEAVED){const re=E(me,Q,J);J+=re.byteLength;for(const ue of re.buffers)$.push(ue)}else if(Y===Wn.ARRAY_BUFFER)for(const re of me){const ue=E([re],Q,J);J+=ue.byteLength;for(const de of ue.buffers)$.push(de)}else if(Y===Wn.SPARSE){const re=A(me,Q,J);J+=re.byteLength;for(const ue of re.buffers)$.push(ue)}else if(Y===Wn.ELEMENT_ARRAY_BUFFER){const re=zt.BufferViewTarget.ELEMENT_ARRAY_BUFFER,ue=M(me,Q,J,re);J+=ue.byteLength;for(const de of ue.buffers)$.push(de)}else{const re=M(me,Q,J);J+=re.byteLength;for(const ue of re.buffers)$.push(ue)}if(d.imageBufferViews.length&&j===0){for(let Y=0;Y<d.imageBufferViews.length;Y++)if(u.bufferViews[u.images[Y].bufferView].byteOffset=J,J+=d.imageBufferViews[Y].byteLength,$.push(d.imageBufferViews[Y]),J%8){const me=8-J%8;J+=me,$.push(new Uint8Array(me))}}if(d.otherBufferViews.has(v))for(const Y of d.otherBufferViews.get(v))u.bufferViews.push({buffer:Q,byteOffset:J,byteLength:Y.byteLength}),d.otherBufferViewsIndexMap.set(Y,u.bufferViews.length-1),J+=Y.byteLength,$.push(Y);if(J){let Y;n.format===At.GLB?Y=er:(Y=d.bufferURIGenerator.createURI(v,"bin"),N.uri=Y),N.byteLength=J,d.assignResourceURI(Y,be.concat($),!0)}u.buffers.push(N),d.bufferIndexMap.set(v,j)}),c.listAccessors().find(v=>!v.getBuffer())&&m.warn("Skipped writing one or more Accessors: no Buffer assigned."),w.filter(v=>v.prewriteTypes.includes(te.MATERIAL)).forEach(v=>v.prewrite(d,te.MATERIAL)),u.materials=c.listMaterials().map((v,j)=>{const N=d.createPropertyDef(v);if(v.getAlphaMode()!==Ht.AlphaMode.OPAQUE&&(N.alphaMode=v.getAlphaMode()),v.getAlphaMode()===Ht.AlphaMode.MASK&&(N.alphaCutoff=v.getAlphaCutoff()),v.getDoubleSided()&&(N.doubleSided=!0),N.pbrMetallicRoughness={},Ae.eq(v.getBaseColorFactor(),[1,1,1,1])||(N.pbrMetallicRoughness.baseColorFactor=v.getBaseColorFactor()),Ae.eq(v.getEmissiveFactor(),[0,0,0])||(N.emissiveFactor=v.getEmissiveFactor()),v.getRoughnessFactor()!==1&&(N.pbrMetallicRoughness.roughnessFactor=v.getRoughnessFactor()),v.getMetallicFactor()!==1&&(N.pbrMetallicRoughness.metallicFactor=v.getMetallicFactor()),v.getBaseColorTexture()){const _=v.getBaseColorTexture(),L=v.getBaseColorTextureInfo();N.pbrMetallicRoughness.baseColorTexture=d.createTextureInfoDef(_,L)}if(v.getEmissiveTexture()){const _=v.getEmissiveTexture(),L=v.getEmissiveTextureInfo();N.emissiveTexture=d.createTextureInfoDef(_,L)}if(v.getNormalTexture()){const _=v.getNormalTexture(),L=v.getNormalTextureInfo(),H=d.createTextureInfoDef(_,L);v.getNormalScale()!==1&&(H.scale=v.getNormalScale()),N.normalTexture=H}if(v.getOcclusionTexture()){const _=v.getOcclusionTexture(),L=v.getOcclusionTextureInfo(),H=d.createTextureInfoDef(_,L);v.getOcclusionStrength()!==1&&(H.strength=v.getOcclusionStrength()),N.occlusionTexture=H}if(v.getMetallicRoughnessTexture()){const _=v.getMetallicRoughnessTexture(),L=v.getMetallicRoughnessTextureInfo();N.pbrMetallicRoughness.metallicRoughnessTexture=d.createTextureInfoDef(_,L)}return d.materialIndexMap.set(v,j),N}),w.filter(v=>v.prewriteTypes.includes(te.MESH)).forEach(v=>v.prewrite(d,te.MESH)),u.meshes=c.listMeshes().map((v,j)=>{const N=d.createPropertyDef(v);let _=null;return N.primitives=v.listPrimitives().map(L=>{const H={attributes:{}};H.mode=L.getMode();const o=L.getMaterial();o&&(H.material=d.materialIndexMap.get(o)),Object.keys(L.getExtras()).length&&(H.extras=L.getExtras());const U=L.getIndices();U&&(H.indices=d.accessorIndexMap.get(U));for(const z of L.listSemantics())H.attributes[z]=d.accessorIndexMap.get(L.getAttribute(z));for(const z of L.listTargets()){const $={};for(const Q of z.listSemantics())$[Q]=d.accessorIndexMap.get(z.getAttribute(Q));H.targets=H.targets||[],H.targets.push($)}return L.listTargets().length&&!_&&(_=L.listTargets().map(z=>z.getName())),H}),v.getWeights().length&&(N.weights=v.getWeights()),_&&(N.extras=N.extras||{},N.extras.targetNames=_),d.meshIndexMap.set(v,j),N}),u.cameras=c.listCameras().map((v,j)=>{const N=d.createPropertyDef(v);if(N.type=v.getType(),N.type===qt.Type.PERSPECTIVE){N.perspective={znear:v.getZNear(),zfar:v.getZFar(),yfov:v.getYFov()};const _=v.getAspectRatio();_!==null&&(N.perspective.aspectRatio=_)}else N.orthographic={znear:v.getZNear(),zfar:v.getZFar(),xmag:v.getXMag(),ymag:v.getYMag()};return d.cameraIndexMap.set(v,j),N}),u.nodes=c.listNodes().map((v,j)=>{const N=d.createPropertyDef(v);return Ae.eq(v.getTranslation(),[0,0,0])||(N.translation=v.getTranslation()),Ae.eq(v.getRotation(),[0,0,0,1])||(N.rotation=v.getRotation()),Ae.eq(v.getScale(),[1,1,1])||(N.scale=v.getScale()),v.getWeights().length&&(N.weights=v.getWeights()),d.nodeIndexMap.set(v,j),N}),u.skins=c.listSkins().map((v,j)=>{const N=d.createPropertyDef(v),_=v.getInverseBindMatrices();_&&(N.inverseBindMatrices=d.accessorIndexMap.get(_));const L=v.getSkeleton();return L&&(N.skeleton=d.nodeIndexMap.get(L)),N.joints=v.listJoints().map(H=>d.nodeIndexMap.get(H)),d.skinIndexMap.set(v,j),N}),c.listNodes().forEach((v,j)=>{const N=u.nodes[j],_=v.getMesh();_&&(N.mesh=d.meshIndexMap.get(_));const L=v.getCamera();L&&(N.camera=d.cameraIndexMap.get(L));const H=v.getSkin();H&&(N.skin=d.skinIndexMap.get(H)),v.listChildren().length>0&&(N.children=v.listChildren().map(o=>d.nodeIndexMap.get(o)))}),u.animations=c.listAnimations().map((v,j)=>{const N=d.createPropertyDef(v),_=new Map;return N.samplers=v.listSamplers().map((L,H)=>{const o=d.createPropertyDef(L);return o.input=d.accessorIndexMap.get(L.getInput()),o.output=d.accessorIndexMap.get(L.getOutput()),o.interpolation=L.getInterpolation(),_.set(L,H),o}),N.channels=v.listChannels().map(L=>{const H=d.createPropertyDef(L);return H.sampler=_.get(L.getSampler()),H.target={node:d.nodeIndexMap.get(L.getTargetNode()),path:L.getTargetPath()},H}),d.animationIndexMap.set(v,j),N}),u.scenes=c.listScenes().map((v,j)=>{const N=d.createPropertyDef(v);return N.nodes=v.listChildren().map(_=>d.nodeIndexMap.get(_)),d.sceneIndexMap.set(v,j),N});const O=c.getDefaultScene();return O&&(u.scene=c.listScenes().indexOf(O)),u.extensionsUsed=w.map(v=>v.extensionName),u.extensionsRequired=T.map(v=>v.extensionName),w.forEach(v=>v.write(d)),Ca(u),p}}function Ca(s){const e=[];for(const n in s){const i=s[n];(Array.isArray(i)&&i.length===0||i===null||i===""||i&&typeof i=="object"&&Object.keys(i).length===0)&&e.push(n)}for(const n of e)delete s[n]}var rr;(function(s){s[s.JSON=1313821514]="JSON",s[s.BIN=5130562]="BIN"})(rr||(rr={}));class Ia{constructor(){this._logger=Ke.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=tr.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const n of e)this._extensions.add(n),n.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const n=await this.readURI(e,"view");this.lastReadBytes=n.byteLength;const i=Zi(n)?this._binaryToJSON(n):{json:JSON.parse(be.decodeText(n)),resources:{}};return await this._readResourcesExternal(i,this.dirname(e)),this._readResourcesInternal(i),i}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),ya.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const n=this._binaryToJSON(be.assertView(e));this._readResourcesInternal(n);const i=n.json;if(i.buffers&&i.buffers.some(c=>Ma(n,c)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(i.images&&i.images.some(c=>Ra(n,c)))throw new Error("Cannot resolve external images with binaryToJSON().");return n}async readBinary(e){return this.readJSON(await this.binaryToJSON(be.assertView(e)))}async writeJSON(e,n={}){if(n.format===At.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0â1 buffers.");return Aa.write(e,{format:n.format||At.GLTF,basename:n.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:_e({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:n,resources:i}=await this.writeJSON(e,{format:At.GLB}),c=new Uint32Array([1179937895,2,12]),u=JSON.stringify(n),p=be.pad(be.encodeText(u),32),d=be.toView(new Uint32Array([p.byteLength,1313821514])),m=be.concat([d,p]);c[c.length-1]+=m.byteLength;const y=Object.values(i)[0];if(!y||!y.byteLength)return be.concat([be.toView(c),m]);const w=be.pad(y,0),T=be.toView(new Uint32Array([w.byteLength,5130562])),M=be.concat([T,w]);return c[c.length-1]+=M.byteLength,be.concat([be.toView(c),m,M])}async _readResourcesExternal(e,n){var i=this;const c=e.json.images||[],u=e.json.buffers||[],p=[...c,...u].map(async function(d){const m=d.uri;if(!m||m.match(/data:/))return Promise.resolve();e.resources[m]=await i.readURI(i.resolve(n,m),"view"),i.lastReadBytes+=e.resources[m].byteLength});await Promise.all(p)}_readResourcesInternal(e){function n(u){if(u.uri){if(u.uri in e.resources){be.assertView(e.resources[u.uri]);return}if(u.uri.match(/data:/)){const p=`__${ca()}.${an.extension(u.uri)}`;e.resources[p]=be.createBufferFromDataURI(u.uri),u.uri=p}}}(e.json.images||[]).forEach(u=>{if(u.bufferView===void 0&&u.uri===void 0)throw new Error("Missing resource URI or buffer view.");n(u)}),(e.json.buffers||[]).forEach(n)}_copyJSON(e){const{images:n,buffers:i}=e.json;return e={json:_e({},e.json),resources:_e({},e.resources)},n&&(e.json.images=n.map(c=>_e({},c))),i&&(e.json.buffers=i.map(c=>_e({},c))),e}_binaryToJSON(e){if(!Zi(e))throw new Error("Invalid glTF 2.0 binary.");const n=new Uint32Array(e.buffer,e.byteOffset+12,2);if(n[1]!==rr.JSON)throw new Error("Missing required GLB JSON chunk.");const i=20,c=n[0],u=be.decodeText(be.toView(e,i,c)),p=JSON.parse(u),d=i+c;if(e.byteLength<=d)return{json:p,resources:{}};const m=new Uint32Array(e.buffer,e.byteOffset+d,2);if(m[1]!==rr.BIN)return{json:p,resources:{}};const y=m[0],w=be.toView(e,d+8,y);return{json:p,resources:{[er]:w}}}}function Ma(s,e){return e.uri!==void 0&&!(e.uri in s.resources)}function Ra(s,e){return e.uri!==void 0&&!(e.uri in s.resources)&&e.bufferView===void 0}function Zi(s){if(s.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(s.buffer,s.byteOffset,3);return e[0]===1179937895&&e[1]===2}class Pa extends Ia{constructor(e=In.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=e}async readURI(e,n){const i=await fetch(e,this._fetchConfig);switch(n){case"view":return new Uint8Array(await i.arrayBuffer());case"text":return i.text()}}resolve(e,n){return In.resolve(e,n)}dirname(e){return In.dirname(e)}}class yt{static triangle(e){const n=new Float32Array([0,0,.5,.5,0,0,-.5,-.5,0,1,0,.5,-.5,1,1]);return _t(e,n)}static quad(e,n=1){const i=n/2,c=new Float32Array([-i,-i,0,0,0,i,-i,0,1,0,i,i,0,1,1,-i,i,0,0,1]),u=new Uint32Array([0,1,2,0,2,3]);return _t(e,c,u)}static customQuad(e,n,i=1){if(n.length!==4)throw new Error(`customQuad requires exactly 4 points, got ${n.length}`);const c=i+1,u=i+1,p=c*u,d=new Float32Array(p*5);for(let T=0;T<c;T++)for(let M=0;M<u;M++){const E=M/i,A=T/i,R=(T*u+M)*5,O=(1-E)*(1-A)*n[0][0]+E*(1-A)*n[1][0]+E*A*n[2][0]+(1-E)*A*n[3][0],v=(1-E)*(1-A)*n[0][1]+E*(1-A)*n[1][1]+E*A*n[2][1]+(1-E)*A*n[3][1],j=(1-E)*(1-A)*n[0][2]+E*(1-A)*n[1][2]+E*A*n[2][2]+(1-E)*A*n[3][2];d[R+0]=O,d[R+1]=v,d[R+2]=j,d[R+3]=E,d[R+4]=A}const m=i*i,y=new Uint32Array(m*6);let w=0;for(let T=0;T<i;T++)for(let M=0;M<i;M++){const E=T*u+M,A=E+1,R=(T+1)*u+M,O=R+1;y[w++]=E,y[w++]=R,y[w++]=A,y[w++]=A,y[w++]=R,y[w++]=O}return _t(e,d,y)}static plane(e,n=1,i=1){const c=n/2,u=i/2,p=new Float32Array([-c,0,-u,0,0,c,0,-u,1,0,c,0,u,1,1,-c,0,u,0,1]),d=new Uint32Array([0,2,1,0,3,2]);return _t(e,p,d)}static parsePrimitive(e,n,i){var w,T,M;const c=(w=n.getAttribute("POSITION"))==null?void 0:w.getArray(),u=(T=n.getAttribute("TEXCOORD_0"))==null?void 0:T.getArray(),p=(M=n.getIndices())==null?void 0:M.getArray();if(!c)throw new Error(`Missing position data in primitive: ${i}`);const d=c.length/3,m=new Float32Array(d*5);for(let E=0;E<d;E++)m[E*5+0]=c[E*3+0],m[E*5+1]=c[E*3+1],m[E*5+2]=c[E*3+2],m[E*5+3]=u?u[E*2+0]:0,m[E*5+4]=u?u[E*2+1]:0;const y=p?new Uint32Array(p):void 0;return _t(e,m,y)}static async fromGLTF(e,n){const p=(await new Pa().read(n)).getRoot().listMeshes();if(p.length===0)throw new Error(`No meshes found in glTF file: ${n}`);const d=[];for(let m=0;m<p.length;m++){const w=p[m].listPrimitives();for(let T=0;T<w.length;T++){const M=`${n}[mesh=${m}, primitive=${T}]`;d.push(this.parsePrimitive(e,w[T],M))}}return console.log(`MeshFactory: Loaded ${d.length} submeshes from ${n}`),d}static fromHeightmap(e,n,i,c,u={}){const{targetSize:p=20,heightScale:d=.001}=u;if(n.length!==i*c)throw new Error(`Heightmap data size mismatch: expected ${i*c}, got ${n.length}`);const m=i,y=c,w=p/2;let T=n[0],M=n[0];for(let _=1;_<n.length;_++)n[_]<T&&(T=n[_]),n[_]>M&&(M=n[_]);const E=(_,L)=>_<0||_>=y||L<0||L>=m?0:n[_*m+L]*d,A=new Float32Array(y*m*8),R=p/(m-1),O=p/(y-1);for(let _=0;_<y;_++)for(let L=0;L<m;L++){const H=(_*m+L)*8,o=L/(m-1)*p-w,U=_/(y-1)*p-w,z=E(_,L),$=z,Q=L>0?E(_,L-1)-$:0,J=L>0?he(-R,0,Q):he(0,0,0),Y=L<m-1?E(_,L+1)-$:0,me=L<m-1?he(R,0,Y):he(0,0,0),re=_>0?E(_-1,L)-$:0,ue=_>0?he(0,-O,re):he(0,0,0),de=_<y-1?E(_+1,L)-$:0,Ce=_<y-1?he(0,O,de):he(0,0,0),ce=he(0,0,0),Re=Ft();L>0&&_>0&&(nn(Re,J,ue),Sn(ce,ce,Re)),L<m-1&&_>0&&(nn(Re,ue,me),Sn(ce,ce,Re)),L<m-1&&_<y-1&&(nn(Re,me,Ce),Sn(ce,ce,Re)),L>0&&_<y-1&&(nn(Re,Ce,J),Sn(ce,ce,Re)),Vo(ce,ce),jo(ce)<.001&&Qn(ce,0,0,1),A[H+0]=o,A[H+1]=U,A[H+2]=z,A[H+3]=ce[0],A[H+4]=ce[1],A[H+5]=ce[2],A[H+6]=L/(m-1),A[H+7]=_/(y-1)}const v=(y-1)*(m-1),j=new Uint32Array(v*6);let N=0;for(let _=0;_<y-1;_++)for(let L=0;L<m-1;L++){const H=_*m+L,o=H+1,U=(_+1)*m+L,z=U+1;j[N++]=H,j[N++]=U,j[N++]=o,j[N++]=o,j[N++]=U,j[N++]=z}return console.log(`MeshFactory: Terrain ${m}x${y} with normals, height: ${T.toFixed(1)}m - ${M.toFixed(1)}m`),_t(e,A,j,Fr,GPUBufferUsage.STORAGE)}static fromRawData(e,n,i,c){return _t(e,n,i,c??An)}}class lt{static async fromSatelliteImage(e,n,i,c,u){const{zoom:p=15,size:d=640,apiKey:m,scale:y=2}=u,w=`https://maps.googleapis.com/maps/api/staticmap?center=${n},${i}&zoom=${p}&size=${d}x${d}&scale=${y}&maptype=satellite&key=${m}`;console.log(`ð°ï¸ Fetching satellite image: zoom=${p}, size=${d}x${d}`),console.log(`ð°ï¸ URL: ${w}`);try{const T=await fetch(w);if(!T.ok){const N=await T.text();throw console.error("â Static Maps API error:",T.status,N),new Error(`Failed to fetch satellite image: ${T.status} - Check if "Maps Static API" is enabled in Google Cloud Console`)}const M=T.headers.get("content-type");if(!(M!=null&&M.includes("image"))){const N=await T.text();throw console.error("â Static Maps API returned non-image:",N),new Error("Static Maps API error - Check console for details")}const E=await T.blob(),A=await createImageBitmap(E);console.log(`â Satellite image loaded: ${A.width}x${A.height}`);const R=e.createTexture({size:{width:A.width,height:A.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});e.queue.copyExternalImageToTexture({source:A},{texture:R},[A.width,A.height]);const O=R.createView({format:"rgba8unorm",dimension:"2d",aspect:"all",baseMipLevel:0,mipLevelCount:1}),v=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear"}),j=e.createBindGroup({layout:c,entries:[{binding:0,resource:O},{binding:1,resource:v}]});return console.log(`â Satellite texture created: ${A.width}x${A.height}`),{bindGroup:j,texture:R,sampler:v,view:O}}catch(T){throw console.error("â Satellite image fetch failed:",T),T}}static async fromTexture(e,n,i,c={}){const{addressMode:u="repeat",filterMode:p="linear"}=c,m=await(await fetch(n)).blob(),y=await createImageBitmap(m),w=e.createTexture({size:{width:y.width,height:y.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});e.queue.copyExternalImageToTexture({source:y},{texture:w},[y.width,y.height]);const T=w.createView({format:"rgba8unorm",dimension:"2d",aspect:"all",baseMipLevel:0,mipLevelCount:1}),M=e.createSampler({addressModeU:u,addressModeV:u,magFilter:p,minFilter:p});return{bindGroup:e.createBindGroup({layout:i,entries:[{binding:0,resource:T},{binding:1,resource:M}]}),texture:w,sampler:M,view:T}}static fromColor(e,n,i){const c=new Uint8Array([Math.floor(n[0]*255),Math.floor(n[1]*255),Math.floor(n[2]*255),Math.floor(n[3]*255)]),u=e.createTexture({size:{width:1,height:1},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST});e.queue.writeTexture({texture:u},c,{bytesPerRow:4},{width:1,height:1});const p=u.createView(),d=e.createSampler({magFilter:"nearest",minFilter:"nearest"});return{bindGroup:e.createBindGroup({layout:i,entries:[{binding:0,resource:p},{binding:1,resource:d}]}),texture:u,sampler:d,view:p}}static fromGHIData(e,n,i,c,u,p,d){const m=new Uint8Array(i*c*4);for(let E=0;E<n.length;E++){const A=(n[E]-u)/(p-u);let R,O,v;if(A<.5){const N=A*2;R=0,O=Math.floor(N*255),v=Math.floor((1-N)*255)}else{const N=(A-.5)*2;R=Math.floor(N*255),O=255,v=0}const j=E*4;m[j+0]=R,m[j+1]=O,m[j+2]=v,m[j+3]=255}const y=e.createTexture({size:{width:i,height:c},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});e.queue.writeTexture({texture:y},m,{bytesPerRow:i*4},{width:i,height:c});const w=y.createView({format:"rgba8unorm",dimension:"2d"}),T=e.createSampler({magFilter:"linear",minFilter:"linear"});return{bindGroup:e.createBindGroup({layout:d,entries:[{binding:0,resource:w},{binding:1,resource:T}]}),texture:y,sampler:T,view:w}}static fromRawData(e,n,i,c,u,p={}){const{format:d="rgba8unorm",filterMode:m="linear"}=p,y=e.createTexture({size:{width:i,height:c},format:d,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST});e.queue.writeTexture({texture:y},n,{bytesPerRow:i*4},{width:i,height:c});const w=y.createView(),T=e.createSampler({magFilter:m,minFilter:m});return{bindGroup:e.createBindGroup({layout:u,entries:[{binding:0,resource:w},{binding:1,resource:T}]}),texture:y,sampler:T,view:w}}static createTerrainMaterial(e,n,i,c,u,p){const d=new Uint8Array(n.width*n.height*4);for(let R=0;R<n.data.length;R++){const O=(n.data[R]-n.minGHI)/(n.maxGHI-n.minGHI);let v,j,N;if(O<.5){const L=O*2;v=0,j=Math.floor(L*255),N=Math.floor((1-L)*255)}else{const L=(O-.5)*2;v=Math.floor(L*255),j=255,N=0}const _=R*4;d[_+0]=v,d[_+1]=j,d[_+2]=N,d[_+3]=255}const m=e.createTexture({size:{width:n.width,height:n.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST});e.queue.writeTexture({texture:m},d,{bytesPerRow:n.width*4},{width:n.width,height:n.height});const y=m.createView(),w=e.createSampler({magFilter:"linear",minFilter:"linear"});let T,M;i.data?(T=e.createTexture({size:{width:i.data.width,height:i.data.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),e.queue.copyExternalImageToTexture({source:i.data},{texture:T},[i.data.width,i.data.height]),M=T.createView()):(T=e.createTexture({size:{width:1,height:1},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST}),e.queue.writeTexture({texture:T},new Uint8Array([0,0,0,0]),{bytesPerRow:4},{width:1,height:1}),M=T.createView());const E=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear"}),A=e.createBindGroup({layout:c,entries:[{binding:0,resource:y},{binding:1,resource:w},{binding:2,resource:M},{binding:3,resource:E},{binding:4,resource:{buffer:u}},{binding:5,resource:{buffer:p}}]});return console.log(`Terrain material created: GHI ${n.width}x${n.height}, Satellite: ${i.data?"loaded":"placeholder"}`),{bindGroup:A,texture:m,sampler:w,view:y}}static async fetchSatelliteImage(e,n,i,c={}){const{zoom:u=17,size:p=640,scale:d=2}=c,m=`https://maps.googleapis.com/maps/api/staticmap?center=${e},${n}&zoom=${u}&size=${p}x${p}&scale=${d}&maptype=satellite&key=${i}`;try{const y=await fetch(m);if(!y.ok)return console.error("â Failed to fetch satellite image:",y.status),null;const w=y.headers.get("content-type");if(!(w!=null&&w.includes("image")))return console.error("â Static Maps API returned non-image response"),null;const T=await y.blob(),M=await createImageBitmap(T);return console.log(`â Satellite image fetched: ${M.width}x${M.height}`),M}catch(y){return console.error("â Satellite fetch error:",y),null}}}class Ba{constructor(e){k(this,"canvas");k(this,"renderer");k(this,"scene");k(this,"keyLabel");k(this,"mouseXLabel");k(this,"mouseYLabel");k(this,"forwardsAmount",0);k(this,"rightAmount",0);k(this,"upAmount",0);k(this,"lastFrameTime",0);k(this,"frameCount",0);k(this,"fpsElement",null);k(this,"cameraControlActive",!1);k(this,"billboardPositions",[]);k(this,"quadCreated",!1);k(this,"terrainVertexBuffer",null);k(this,"terrainVertexCount",0);k(this,"panelMeshes",null);k(this,"panelMaterial",null);k(this,"panelInstances",null);k(this,"testInstancedMesh",null);k(this,"terrainMetadata",null);k(this,"ghiData",null);k(this,"run",()=>{this.frameCount++;const e=performance.now();e-this.lastFrameTime>=1e3&&(this.fpsElement||(this.fpsElement=document.getElementById("fps-counter")),this.fpsElement&&(this.fpsElement.textContent=String(this.frameCount)),this.frameCount=0,this.lastFrameTime=e),this.scene.moveCamera(this.forwardsAmount,this.rightAmount,this.upAmount),this.scene.update(),this.renderer.render(this.scene.getRenderData()),requestAnimationFrame(this.run)});k(this,"billboardMaterial",null);k(this,"quadMaterial",null);this.canvas=e,this.renderer=new zo(e),this.scene=new qo,this.keyLabel=document.getElementById("keyboardKey"),this.mouseXLabel=document.getElementById("mousex"),this.mouseYLabel=document.getElementById("mousey"),Ui(document).on("keydown",i=>this.handleKeyPress(i)),Ui(document).on("keyup",i=>this.handleKeyRelease(i)),this.canvas.addEventListener("mousemove",i=>this.handleMouseMove(i)),this.canvas.addEventListener("click",i=>this.handleClick(i)),document.addEventListener("pointerlockchange",()=>{this.cameraControlActive=document.pointerLockElement===this.canvas,console.log(`ð® Camera control: ${this.cameraControlActive?"ON":"OFF"}`)}),window.addEventListener("resize",()=>this.resizeCanvas());const n=document.getElementById("show-panels");n&&n.addEventListener("change",()=>{this.togglePanelVisibility(n.checked)})}async init(){this.resizeCanvas(),await this.renderer.init(),await this.createInitialObjects(),this.panelMeshes=await yt.fromGLTF(this.renderer.getDevice(),"models/panel.glb"),this.panelMaterial=await lt.fromTexture(this.renderer.getDevice(),"img/panelbaked.png",this.renderer.getMaterialGroupLayout())}resizeCanvas(){const e=this.canvas.parentElement;if(!e)return;const n=e.clientWidth,i=e.clientHeight;(this.canvas.width!==n||this.canvas.height!==i)&&(this.canvas.width=n,this.canvas.height=i,this.renderer.getDevice()&&this.renderer.resize(),console.log(`ð Canvas resized to ${n}x${i}`))}async createInitialObjects(){const e=this.renderer.getDevice(),n=this.renderer.getMaterialGroupLayout(),i=await yt.fromGLTF(e,"models/flat_vase.glb"),c=await lt.fromTexture(e,"img/floor.jpg",n),u=await yt.fromGLTF(e,"models/panel.glb"),p=await lt.fromTexture(e,"img/panelbaked.png",n);for(const R of u){const O=new ft({mesh:R,material:p.bindGroup,transform:new We(he(0,1,2),he(0,45,90),he(.01,.01,.01))});this.scene.add(O)}const d=i[0],m=new ft({mesh:d,material:c.bindGroup,transform:new We(he(0,0,0),he(0,0,0),he(1,1,1)),onUpdate:(R,O)=>{R.transform.rotate(0,0,6)}}),y=new ft({mesh:d,material:c.bindGroup,transform:new We(he(0,0,.5),he(0,0,0),he(1,1,1)),onUpdate:(R,O)=>{R.transform.rotate(0,0,6)}});this.scene.add(m),this.scene.add(y);const w=yt.quad(e,.15),T=await lt.fromColor(e,[1,.2,0,1],n),M=new ft({mesh:w,material:T.bindGroup,renderType:ze.Billboard,transform:new We(he(2,1,3),he(0,0,0))});this.scene.add(M);for(let R=-5;R<=5;R++){const O=yt.triangle(e),v=await lt.fromTexture(e,"img/floor.jpg",n),j=new ft({mesh:O,material:v.bindGroup,transform:new We(he(2,R,0),he(0,0,0)),onUpdate:(N,_)=>{N.transform.rotate(0,0,6)}});this.scene.add(j)}const E=await yt.fromGLTF(e,"models/flat_vase.glb"),A=await lt.fromTexture(e,"img/floor.jpg",n);this.testInstancedMesh=new qi({device:e,submeshes:E.map(R=>({mesh:R,material:A.bindGroup})),maxInstances:1e4}),this.setTestInstanceCount(500),this.scene.addInstanced(this.testInstancedMesh),this.setupInstanceTestButtons()}handleKeyPress(e){if(this.keyLabel.innerHTML=e.code,e.code==="KeyC"){this.toggleCameraControl();return}if(this.cameraControlActive)switch(e.code){case"KeyW":this.forwardsAmount=.1;break;case"KeyS":this.forwardsAmount=-.1;break;case"KeyA":this.rightAmount=-.1;break;case"KeyD":this.rightAmount=.1;break;case"KeyE":this.upAmount=.1;break;case"KeyQ":this.upAmount=-.1;break}}handleKeyRelease(e){switch(this.keyLabel.innerHTML=e.code,e.code){case"KeyW":case"KeyS":this.forwardsAmount=0;break;case"KeyA":case"KeyD":this.rightAmount=0;break;case"KeyE":case"KeyQ":this.upAmount=0;break}}handleMouseMove(e){this.mouseXLabel.innerHTML=e.clientX.toString(),this.mouseYLabel.innerHTML=e.clientY.toString(),this.cameraControlActive&&this.scene.spinCamera(e.movementX/10,-e.movementY/10)}toggleCameraControl(){this.cameraControlActive?document.exitPointerLock():this.canvas.requestPointerLock()}async handleClick(e){if(this.cameraControlActive)return;if(this.quadCreated){console.log("â Quad already created, no more billboards");return}const n=this.canvas.getBoundingClientRect(),i=e.clientX-n.left,c=e.clientY-n.top;this.renderer.renderPickingPass(this.scene.getRenderData());const u=await this.renderer.readWorldPosition(i,c);if(!u){console.log(`â Click at (${i.toFixed(0)}, ${c.toFixed(0)}) - no terrain hit`);return}if(this.billboardPositions.push(Dt(u)),await this.spawnBillboard(u),console.log(`ð Billboard ${this.billboardPositions.length}/4 at (${u[0].toFixed(2)}, ${u[1].toFixed(2)}, ${u[2].toFixed(2)})`),this.billboardPositions.length===4){this.renderer.updateSelectionQuad(this.billboardPositions),this.quadCreated=!0;const p=this.calculateSelectionArea(this.billboardPositions);if(this.terrainVertexBuffer&&this.terrainVertexCount>0){const d=await this.renderer.runSelectionCompute(this.terrainVertexBuffer,this.terrainVertexCount);if(d&&p){const y=d.length/3/this.terrainVertexCount,w=p.realAreaM2*y;this.updateSolarPanel(w),await this.createPanelInstances(d)}}}}async createQuadFromPoints(e){console.log("ð· createQuadFromPoints called with:",e.map(p=>`(${p[0].toFixed(2)}, ${p[1].toFixed(2)}, ${p[2].toFixed(2)})`));const n=this.renderer.getDevice(),i=this.renderer.getMaterialGroupLayout();this.quadMaterial||(this.quadMaterial=await lt.fromColor(n,[1,.2,.2,1],i));const c=yt.customQuad(n,e);console.log(`   Mesh created: ${c.vertexCount} vertices, ${c.indexCount} indices`);const u=new ft({mesh:c,material:this.quadMaterial.bindGroup,renderType:ze.Standard,transform:new We});this.scene.add(u),console.log("â Quad added to scene")}async spawnBillboard(e){const n=this.renderer.getDevice(),i=this.renderer.getMaterialGroupLayout();this.billboardMaterial||(this.billboardMaterial=await lt.fromColor(n,[1,.2,0,1],i));const c=yt.quad(n,.15),u=new ft({mesh:c,material:this.billboardMaterial.bindGroup,renderType:ze.Billboard,transform:new We(he(e[0],e[1]+.08,e[2]),he(0,0,0),he(1,1,1))});this.scene.add(u),console.log(` Billboard at (${e[0].toFixed(2)}, ${e[1].toFixed(2)}, ${e[2].toFixed(2)})`)}setTerrainComputeInfo(e,n){this.terrainVertexBuffer=e,this.terrainVertexCount=n,console.log(`Terrain compute info set: ${n} vertices`)}setTerrainMetadata(e,n=20){this.terrainMetadata={bounds:e,worldSize:n}}setGHIData(e,n,i,c,u){this.ghiData={data:e,width:n,height:i,minGHI:c,maxGHI:u}}calculateAverageGHI(){if(!this.ghiData)return null;const{data:e}=this.ghiData;let n=0,i=0;for(let c=0;c<e.length;c++)e[c]>0&&(n+=e[c],i++);return i>0?n/i:null}updateSolarPanel(e){const n=document.getElementById("solar-guidance"),i=document.getElementById("solar-data");if(!n||!i)return;const c=this.calculateAverageGHI();if(c===null){n.style.display="block",i.style.display="none";return}const u=e*c,y=u*.2*.6*.85;document.getElementById("solar-area").textContent=e.toFixed(0),document.getElementById("solar-ghi").textContent=c.toFixed(2),document.getElementById("solar-power-raw").textContent=u.toFixed(0),document.getElementById("solar-power-est").textContent=y.toFixed(0),n.style.display="none",i.style.display="flex"}togglePanelVisibility(e){this.panelInstances&&(this.panelInstances.visible=e)}setupInstanceTestButtons(){[5e3,2500,1e3,500].forEach(n=>{const i=document.getElementById(`inst-${n}`);i&&i.addEventListener("click",()=>this.setTestInstanceCount(n))})}setTestInstanceCount(e){if(!this.testInstancedMesh)return;this.testInstancedMesh.clear();for(let i=0;i<e;i++)this.testInstancedMesh.addInstance({position:[(Math.random()-.5)*20,Math.random()*5,(Math.random()-.5)*20],rotation:[Math.random()*360,Math.random()*360,Math.random()*360],scale:[1,1,1]});this.testInstancedMesh.updateBuffer();const n=document.getElementById("inst-count");n&&(n.textContent=String(e))}calculateSelectionArea(e){if(e.length!==4||!this.terrainMetadata)return null;const[n,i,c,u]=e,p=.5*Math.abs(n[0]*(i[1]-u[1])+i[0]*(c[1]-n[1])+c[0]*(u[1]-i[1])+u[0]*(n[1]-c[1])),{bounds:d,worldSize:m}=this.terrainMetadata,y=(d.north+d.south)/2,w=111320,T=111320*Math.cos(y*Math.PI/180),M=(d.east-d.west)*T,E=(d.north-d.south)*w,A=(M+E)/2/m,R=p*A*A;return{worldArea:p,realAreaM2:R}}async createPanelInstances(e){if(!this.panelMeshes||!this.panelMaterial){console.error("Panel mesh or material not loaded");return}const n=this.renderer.getDevice(),i=e.length/3;this.panelInstances&&(this.scene.removeInstanced(this.panelInstances),this.panelInstances.destroy()),this.panelInstances=new qi({device:n,submeshes:this.panelMeshes.map(u=>({mesh:u,material:this.panelMaterial.bindGroup})),maxInstances:Math.max(i,1e3)});const c=Math.max(1,Math.floor(i/500));for(let u=0;u<i;u+=c){const p=e[u*3],d=e[u*3+1],m=e[u*3+2];this.panelInstances.addInstance({position:[p,d,m-4.9],rotation:[45,0,0],scale:[3e-4,3e-4,3e-4]})}this.panelInstances.updateBuffer(),this.scene.addInstanced(this.panelInstances),console.log(`â Created ${this.panelInstances.getInstanceCount()} panel instances`)}}function Be(s){return(e,...n)=>Na(s,e,n)}function cn(s,e){return Be(ys(s,e).get)}const{apply:Na,getOwnPropertyDescriptor:ys,getPrototypeOf:Wr,ownKeys:Oa}=Reflect,{iterator:On,toStringTag:La}=Symbol,_a=Object,{create:Kr,defineProperty:Da}=_a,Ua=Array,Fa=Ua.prototype,xs=Fa[On],Ga=Be(xs),vs=ArrayBuffer,ka=vs.prototype;cn(ka,"byteLength");const es=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;es&&cn(es.prototype,"byteLength");const bs=Wr(Uint8Array);bs.from;const Ue=bs.prototype;Ue[On];Be(Ue.keys);Be(Ue.values);Be(Ue.entries);Be(Ue.set);Be(Ue.reverse);Be(Ue.fill);Be(Ue.copyWithin);Be(Ue.sort);Be(Ue.slice);Be(Ue.subarray);cn(Ue,"buffer");cn(Ue,"byteOffset");cn(Ue,"length");cn(Ue,La);const ja=Uint8Array,ws=Uint16Array,Xr=Uint32Array,Va=Float32Array,Bn=Wr([][On]()),Ts=Be(Bn.next),za=Be(function*(){}().next),Ha=Wr(Bn),qa=DataView.prototype,$a=Be(qa.getUint16),Qr=WeakMap,Es=Qr.prototype,Ss=Be(Es.get),Ya=Be(Es.set),As=new Qr,Wa=Kr(null,{next:{value:function(){const e=Ss(As,this);return Ts(e)}},[On]:{value:function(){return this}}});function Ka(s){if(s[On]===xs&&Bn.next===Ts)return s;const e=Kr(Wa);return Ya(As,e,Ga(s)),e}const Xa=new Qr,Qa=Kr(Ha,{next:{value:function(){const e=Ss(Xa,this);return za(e)},writable:!0,configurable:!0}});for(const s of Oa(Bn))s!=="next"&&Da(Qa,s,ys(Bn,s));const Cs=new vs(4),Ja=new Va(Cs),Za=new Xr(Cs),at=new ws(512),ct=new ja(512);for(let s=0;s<256;++s){const e=s-127;e<-24?(at[s]=0,at[s|256]=32768,ct[s]=24,ct[s|256]=24):e<-14?(at[s]=1024>>-e-14,at[s|256]=1024>>-e-14|32768,ct[s]=-e-1,ct[s|256]=-e-1):e<=15?(at[s]=e+15<<10,at[s|256]=e+15<<10|32768,ct[s]=13,ct[s|256]=13):e<128?(at[s]=31744,at[s|256]=64512,ct[s]=24,ct[s|256]=24):(at[s]=31744,at[s|256]=64512,ct[s]=13,ct[s|256]=13)}const Jr=new Xr(2048);for(let s=1;s<1024;++s){let e=s<<13,n=0;for(;!(e&8388608);)e<<=1,n-=8388608;e&=-8388609,n+=947912704,Jr[s]=e|n}for(let s=1024;s<2048;++s)Jr[s]=939524096+(s-1024<<13);const un=new Xr(64);for(let s=1;s<31;++s)un[s]=s<<23;un[31]=1199570944;un[32]=2147483648;for(let s=33;s<63;++s)un[s]=2147483648+(s-32<<23);un[63]=3347054592;const Is=new ws(64);for(let s=1;s<64;++s)s!==32&&(Is[s]=1024);function ec(s){const e=s>>10;return Za[0]=Jr[Is[e]+(s&1023)]+un[e],Ja[0]}function Ms(s,e,...n){return ec($a(s,e,...Ka(n)))}function _r(s,e,n){const i=typeof s=="object"?s.outer:s,c=i.slice(0,i.indexOf(">")+1),u=['"',"'"];for(let p=0;p<u.length;p++){const d=u[p],m=e+"\\="+d+"([^"+d+"]*)"+d,w=new RegExp(m).exec(c);if(w)return w[1]}}function tc(s,e,n){const c=new RegExp(e).exec(s.slice(n));return c?n+c.index:-1}function Dr(s,e,n){const c=new RegExp(e).exec(s.slice(n));return c?n+c.index+c[0].length-1:-1}function ts(s,e){const n=new RegExp(e,"g"),i=s.match(n);return i?i.length:0}function nc(s,e,n){const i=n&&n.debug||!1,c=!(n&&typeof n.nested===!1),u=n&&n.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",e," and ",n);const p=tc(s,`<${e}[ 
>/]`,u);if(i&&console.log("[xml-utils] start:",p),p===-1)return;const d=s.slice(p+e.length);let m=Dr(d,"^[^<]*[ /]>",0);const y=m!==-1&&d[m-1]==="/";if(i&&console.log("[xml-utils] selfClosing:",y),y===!1)if(c){let E=0,A=1,R=0;for(;(m=Dr(d,"[ /]"+e+">",E))!==-1;){const O=d.substring(E,m+1);if(A+=ts(O,"<"+e+`[ 
	>]`),R+=ts(O,"</"+e+">"),R>=A)break;E=m}}else m=Dr(d,"[ /]"+e+">",0);const w=p+e.length+m+1;if(i&&console.log("[xml-utils] end:",w),w===-1)return;const T=s.slice(p,w);let M;return y?M=null:M=T.slice(T.indexOf(">")+1,T.lastIndexOf("<")),{inner:M,outer:T,start:p,end:w}}function rc(s,e,n){const i=[];let u=0,p;for(;p=nc(s,e,{debug:!1,startIndex:u});)u=p.start+1+e.length,i.push(p);return i}const Mn={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34412:"CZ_LSMINFO",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},ut={};for(const s in Mn)Mn.hasOwnProperty(s)&&(ut[Mn[s]]=parseInt(s,10));const ic=[ut.BitsPerSample,ut.ExtraSamples,ut.SampleFormat,ut.StripByteCounts,ut.StripOffsets,ut.StripRowCounts,ut.TileByteCounts,ut.TileOffsets,ut.SubIFDs],Ur={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},le={};for(const s in Ur)Ur.hasOwnProperty(s)&&(le[Ur[s]]=parseInt(s,10));const Ve={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8},sc={Unspecified:0},qc={AddCompression:1},$c={None:0,Deflate:1,Zstandard:2},oc={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function ac(s,e){const{width:n,height:i}=s,c=new Uint8Array(n*i*3);let u;for(let p=0,d=0;p<s.length;++p,d+=3)u=256-s[p]/e*256,c[d]=u,c[d+1]=u,c[d+2]=u;return c}function cc(s,e){const{width:n,height:i}=s,c=new Uint8Array(n*i*3);let u;for(let p=0,d=0;p<s.length;++p,d+=3)u=s[p]/e*256,c[d]=u,c[d+1]=u,c[d+2]=u;return c}function uc(s,e){const{width:n,height:i}=s,c=new Uint8Array(n*i*3),u=e.length/3,p=e.length/3*2;for(let d=0,m=0;d<s.length;++d,m+=3){const y=s[d];c[m]=e[y]/65536*256,c[m+1]=e[y+u]/65536*256,c[m+2]=e[y+p]/65536*256}return c}function lc(s){const{width:e,height:n}=s,i=new Uint8Array(e*n*3);for(let c=0,u=0;c<s.length;c+=4,u+=3){const p=s[c],d=s[c+1],m=s[c+2],y=s[c+3];i[u]=255*((255-p)/256)*((255-y)/256),i[u+1]=255*((255-d)/256)*((255-y)/256),i[u+2]=255*((255-m)/256)*((255-y)/256)}return i}function fc(s){const{width:e,height:n}=s,i=new Uint8ClampedArray(e*n*3);for(let c=0,u=0;c<s.length;c+=3,u+=3){const p=s[c],d=s[c+1],m=s[c+2];i[u]=p+1.402*(m-128),i[u+1]=p-.34414*(d-128)-.71414*(m-128),i[u+2]=p+1.772*(d-128)}return i}const hc=.95047,dc=1,pc=1.08883;function gc(s){const{width:e,height:n}=s,i=new Uint8Array(e*n*3);for(let c=0,u=0;c<s.length;c+=3,u+=3){const p=s[c+0],d=s[c+1]<<24>>24,m=s[c+2]<<24>>24;let y=(p+16)/116,w=d/500+y,T=y-m/200,M,E,A;w=hc*(w*w*w>.008856?w*w*w:(w-16/116)/7.787),y=dc*(y*y*y>.008856?y*y*y:(y-16/116)/7.787),T=pc*(T*T*T>.008856?T*T*T:(T-16/116)/7.787),M=w*3.2406+y*-1.5372+T*-.4986,E=w*-.9689+y*1.8758+T*.0415,A=w*.0557+y*-.204+T*1.057,M=M>.0031308?1.055*M**(1/2.4)-.055:12.92*M,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,i[u]=Math.max(0,Math.min(1,M))*255,i[u+1]=Math.max(0,Math.min(1,E))*255,i[u+2]=Math.max(0,Math.min(1,A))*255}return i}const Rs=new Map,mc=new Map;function xt(s,e,n=!0){Array.isArray(s)||(s=[s]),s.forEach(i=>{Rs.set(i,e),mc.set(i,n)})}async function yc(s){const e=Rs.get(s.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${s.Compression}`);const n=await e();return new n(s)}xt([void 0,1],()=>It(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1]),import.meta.url).then(s=>s.default),!1);xt(5,()=>It(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1]),import.meta.url).then(s=>s.default));xt(6,()=>{throw new Error("old style JPEG compression is not supported.")});xt(7,()=>It(()=>import("./jpeg-JhJy4lL1.js"),__vite__mapDeps([3,1]),import.meta.url).then(s=>s.default));xt([8,32946],()=>It(()=>import("./deflate-Dthki0TA.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(s=>s.default));xt(32773,()=>It(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1]),import.meta.url).then(s=>s.default));xt(34887,()=>It(()=>import("./lerc-suXJbs2Z.js"),__vite__mapDeps([7,5,1]),import.meta.url).then(async s=>(await s.zstd.init(),s)).then(s=>s.default));xt(5e4,()=>It(()=>import("./zstd-DD6JHAQz.js"),__vite__mapDeps([8,1]),import.meta.url).then(async s=>(await s.zstd.init(),s)).then(s=>s.default));xt(50001,()=>It(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([9,1]),import.meta.url).then(s=>s.default),!1);function cr(s,e,n,i=1){return new(Object.getPrototypeOf(s)).constructor(e*n*i)}function xc(s,e,n,i,c){const u=e/i,p=n/c;return s.map(d=>{const m=cr(d,i,c);for(let y=0;y<c;++y){const w=Math.min(Math.round(p*y),n-1);for(let T=0;T<i;++T){const M=Math.min(Math.round(u*T),e-1),E=d[w*e+M];m[y*i+T]=E}}return m})}function sn(s,e,n){return(1-n)*s+n*e}function vc(s,e,n,i,c){const u=e/i,p=n/c;return s.map(d=>{const m=cr(d,i,c);for(let y=0;y<c;++y){const w=p*y,T=Math.floor(w),M=Math.min(Math.ceil(w),n-1);for(let E=0;E<i;++E){const A=u*E,R=A%1,O=Math.floor(A),v=Math.min(Math.ceil(A),e-1),j=d[T*e+O],N=d[T*e+v],_=d[M*e+O],L=d[M*e+v],H=sn(sn(j,N,R),sn(_,L,R),w%1);m[y*i+E]=H}}return m})}function bc(s,e,n,i,c,u="nearest"){switch(u.toLowerCase()){case"nearest":return xc(s,e,n,i,c);case"bilinear":case"linear":return vc(s,e,n,i,c);default:throw new Error(`Unsupported resampling method: '${u}'`)}}function wc(s,e,n,i,c,u){const p=e/i,d=n/c,m=cr(s,i,c,u);for(let y=0;y<c;++y){const w=Math.min(Math.round(d*y),n-1);for(let T=0;T<i;++T){const M=Math.min(Math.round(p*T),e-1);for(let E=0;E<u;++E){const A=s[w*e*u+M*u+E];m[y*i*u+T*u+E]=A}}}return m}function Tc(s,e,n,i,c,u){const p=e/i,d=n/c,m=cr(s,i,c,u);for(let y=0;y<c;++y){const w=d*y,T=Math.floor(w),M=Math.min(Math.ceil(w),n-1);for(let E=0;E<i;++E){const A=p*E,R=A%1,O=Math.floor(A),v=Math.min(Math.ceil(A),e-1);for(let j=0;j<u;++j){const N=s[T*e*u+O*u+j],_=s[T*e*u+v*u+j],L=s[M*e*u+O*u+j],H=s[M*e*u+v*u+j],o=sn(sn(N,_,R),sn(L,H,R),w%1);m[y*i*u+E*u+j]=o}}}return m}function Ec(s,e,n,i,c,u,p="nearest"){switch(p.toLowerCase()){case"nearest":return wc(s,e,n,i,c,u);case"bilinear":case"linear":return Tc(s,e,n,i,c,u);default:throw new Error(`Unsupported resampling method: '${p}'`)}}function Sc(s,e,n){let i=0;for(let c=e;c<n;++c)i+=s[c];return i}function zr(s,e,n){switch(s){case 1:if(e<=8)return new Uint8Array(n);if(e<=16)return new Uint16Array(n);if(e<=32)return new Uint32Array(n);break;case 2:if(e===8)return new Int8Array(n);if(e===16)return new Int16Array(n);if(e===32)return new Int32Array(n);break;case 3:switch(e){case 16:case 32:return new Float32Array(n);case 64:return new Float64Array(n)}break}throw Error("Unsupported data format/bitsPerSample")}function Ac(s,e){return(s===1||s===2)&&e<=32&&e%8===0?!1:!(s===3&&(e===16||e===32||e===64))}function Cc(s,e,n,i,c,u,p){const d=new DataView(s),m=n===2?p*u:p*u*i,y=n===2?1:i,w=zr(e,c,m),T=parseInt("1".repeat(c),2);if(e===1){let M;n===1?M=i*c:M=c;let E=u*M;E&7&&(E=E+7&-8);for(let A=0;A<p;++A){const R=A*E;for(let O=0;O<u;++O){const v=R+O*y*c;for(let j=0;j<y;++j){const N=v+j*c,_=(A*u+O)*y+j,L=Math.floor(N/8),H=N%8;if(H+c<=8)w[_]=d.getUint8(L)>>8-c-H&T;else if(H+c<=16)w[_]=d.getUint16(L)>>16-c-H&T;else if(H+c<=24){const o=d.getUint16(L)<<8|d.getUint8(L+2);w[_]=o>>24-c-H&T}else w[_]=d.getUint32(L)>>32-c-H&T}}}}return w.buffer}class Ic{constructor(e,n,i,c,u,p){this.fileDirectory=e,this.geoKeys=n,this.dataView=i,this.littleEndian=c,this.tiles=u?{}:null,this.isTiled=!e.StripOffsets;const d=e.PlanarConfiguration;if(this.planarConfiguration=typeof d>"u"?1:d,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=p}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let n=0;n<this.fileDirectory.BitsPerSample.length;++n)e+=this.getSampleByteSize(n);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const n=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(n){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(c,u){return Ms(this,c,u)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,n){const i=this.getSampleFormat(e),c=this.getBitsPerSample(e);return zr(i,c,n)}async getTileOrStrip(e,n,i,c,u){const p=Math.ceil(this.getWidth()/this.getTileWidth()),d=Math.ceil(this.getHeight()/this.getTileHeight());let m;const{tiles:y}=this;this.planarConfiguration===1?m=n*p+e:this.planarConfiguration===2&&(m=i*p*d+n*p+e);let w,T;if(this.isTiled?(w=this.fileDirectory.TileOffsets[m],T=this.fileDirectory.TileByteCounts[m]):(w=this.fileDirectory.StripOffsets[m],T=this.fileDirectory.StripByteCounts[m]),T===0){const A=this.getBlockHeight(n)*this.getTileWidth(),R=this.planarConfiguration===2?this.getSampleByteSize(i):this.getBytesPerPixel(),O=new ArrayBuffer(A*R);return this.getArrayForSample(i,O).fill(this.getGDALNoData()||0),{x:e,y:n,sample:i,data:O}}const M=(await this.source.fetch([{offset:w,length:T}],u))[0];let E;return y===null||!y[m]?(E=(async()=>{let A=await c.decode(this.fileDirectory,M);const R=this.getSampleFormat(),O=this.getBitsPerSample();return Ac(R,O)&&(A=Cc(A,R,this.planarConfiguration,this.getSamplesPerPixel(),O,this.getTileWidth(),this.getBlockHeight(n))),A})(),y!==null&&(y[m]=E)):E=y[m],{x:e,y:n,sample:i,data:await E}}async _readRaster(e,n,i,c,u,p,d,m,y){const w=this.getTileWidth(),T=this.getTileHeight(),M=this.getWidth(),E=this.getHeight(),A=Math.max(Math.floor(e[0]/w),0),R=Math.min(Math.ceil(e[2]/w),Math.ceil(M/w)),O=Math.max(Math.floor(e[1]/T),0),v=Math.min(Math.ceil(e[3]/T),Math.ceil(E/T)),j=e[2]-e[0];let N=this.getBytesPerPixel();const _=[],L=[];for(let U=0;U<n.length;++U)this.planarConfiguration===1?_.push(Sc(this.fileDirectory.BitsPerSample,0,n[U])/8):_.push(0),L.push(this.getReaderForSample(n[U]));const H=[],{littleEndian:o}=this;for(let U=O;U<v;++U)for(let z=A;z<R;++z){let $;this.planarConfiguration===1&&($=this.getTileOrStrip(z,U,0,u,y));for(let Q=0;Q<n.length;++Q){const J=Q,Y=n[Q];this.planarConfiguration===2&&(N=this.getSampleByteSize(Y),$=this.getTileOrStrip(z,U,Y,u,y));const me=$.then(re=>{const ue=re.data,de=new DataView(ue),Ce=this.getBlockHeight(re.y),ce=re.y*T,Re=re.x*w,vt=ce+Ce,bt=(re.x+1)*w,Mt=L[J],et=Math.min(Ce,Ce-(vt-e[3]),E-ce),ln=Math.min(w,w-(bt-e[2]),M-Re);for(let Xe=Math.max(0,e[1]-ce);Xe<et;++Xe)for(let Rt=Math.max(0,e[0]-Re);Rt<ln;++Rt){const ur=(Xe*w+Rt)*N,fn=Mt.call(de,ur+_[J],o);let Oe;c?(Oe=(Xe+ce-e[1])*j*n.length+(Rt+Re-e[0])*n.length+J,i[Oe]=fn):(Oe=(Xe+ce-e[1])*j+Rt+Re-e[0],i[J][Oe]=fn)}});H.push(me)}}if(await Promise.all(H),p&&e[2]-e[0]!==p||d&&e[3]-e[1]!==d){let U;return c?U=Ec(i,e[2]-e[0],e[3]-e[1],p,d,n.length,m):U=bc(i,e[2]-e[0],e[3]-e[1],p,d,m),U.width=p,U.height=d,U}return i.width=p||e[2]-e[0],i.height=d||e[3]-e[1],i}async readRasters({window:e,samples:n=[],interleave:i,pool:c=null,width:u,height:p,resampleMethod:d,fillValue:m,signal:y}={}){const w=e||[0,0,this.getWidth(),this.getHeight()];if(w[0]>w[2]||w[1]>w[3])throw new Error("Invalid subsets");const T=w[2]-w[0],M=w[3]-w[1],E=T*M,A=this.getSamplesPerPixel();if(!n||!n.length)for(let j=0;j<A;++j)n.push(j);else for(let j=0;j<n.length;++j)if(n[j]>=A)return Promise.reject(new RangeError(`Invalid sample index '${n[j]}'.`));let R;if(i){const j=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,N=Math.max.apply(null,this.fileDirectory.BitsPerSample);R=zr(j,N,E*n.length),m&&R.fill(m)}else{R=[];for(let j=0;j<n.length;++j){const N=this.getArrayForSample(n[j],E);Array.isArray(m)&&j<m.length?N.fill(m[j]):m&&!Array.isArray(m)&&N.fill(m),R.push(N)}}const O=c||await yc(this.fileDirectory);return await this._readRaster(w,n,R,i,O,u,p,d,y)}async readRGB({window:e,interleave:n=!0,pool:i=null,width:c,height:u,resampleMethod:p,enableAlpha:d=!1,signal:m}={}){const y=e||[0,0,this.getWidth(),this.getHeight()];if(y[0]>y[2]||y[1]>y[3])throw new Error("Invalid subsets");const w=this.fileDirectory.PhotometricInterpretation;if(w===Ve.RGB){let v=[0,1,2];if(this.fileDirectory.ExtraSamples!==sc.Unspecified&&d){v=[];for(let j=0;j<this.fileDirectory.BitsPerSample.length;j+=1)v.push(j)}return this.readRasters({window:e,interleave:n,samples:v,pool:i,width:c,height:u,resampleMethod:p,signal:m})}let T;switch(w){case Ve.WhiteIsZero:case Ve.BlackIsZero:case Ve.Palette:T=[0];break;case Ve.CMYK:T=[0,1,2,3];break;case Ve.YCbCr:case Ve.CIELab:T=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const M={window:y,interleave:!0,samples:T,pool:i,width:c,height:u,resampleMethod:p,signal:m},{fileDirectory:E}=this,A=await this.readRasters(M),R=2**this.fileDirectory.BitsPerSample[0];let O;switch(w){case Ve.WhiteIsZero:O=ac(A,R);break;case Ve.BlackIsZero:O=cc(A,R);break;case Ve.Palette:O=uc(A,E.ColorMap);break;case Ve.CMYK:O=lc(A);break;case Ve.YCbCr:O=fc(A);break;case Ve.CIELab:O=gc(A);break;default:throw new Error("Unsupported photometric interpretation.")}if(!n){const v=new Uint8Array(O.length/3),j=new Uint8Array(O.length/3),N=new Uint8Array(O.length/3);for(let _=0,L=0;_<O.length;_+=3,++L)v[L]=O[_],j[L]=O[_+1],N[L]=O[_+2];O=[v,j,N]}return O.width=A.width,O.height=A.height,O}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let n=0;n<this.fileDirectory.ModelTiepoint.length;n+=6)e.push({i:this.fileDirectory.ModelTiepoint[n],j:this.fileDirectory.ModelTiepoint[n+1],k:this.fileDirectory.ModelTiepoint[n+2],x:this.fileDirectory.ModelTiepoint[n+3],y:this.fileDirectory.ModelTiepoint[n+4],z:this.fileDirectory.ModelTiepoint[n+5]});return e}getGDALMetadata(e=null){const n={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let c=rc(i,"Item");e===null?c=c.filter(u=>_r(u,"sample")===void 0):c=c.filter(u=>Number(_r(u,"sample"))===e);for(let u=0;u<c.length;++u){const p=c[u];n[_r(p,"name")]=p.inner}return n}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,n=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(n)return[n[3],n[7],n[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const n=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(n)return[n[0],-n[1],n[2]];if(i)return i[1]===0&&i[4]===0?[i[0],-i[5],i[10]]:[Math.sqrt(i[0]*i[0]+i[4]*i[4]),-Math.sqrt(i[1]*i[1]+i[5]*i[5]),i[10]];if(e){const[c,u,p]=e.getResolution();return[c*e.getWidth()/this.getWidth(),u*e.getHeight()/this.getHeight(),p*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const n=this.getHeight(),i=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[c,u,p,d,m,y,w,T]=this.fileDirectory.ModelTransformation,E=[[0,0],[0,n],[i,0],[i,n]].map(([O,v])=>[d+c*O+u*v,T+m*O+y*v]),A=E.map(O=>O[0]),R=E.map(O=>O[1]);return[Math.min(...A),Math.min(...R),Math.max(...A),Math.max(...R)]}else{const c=this.getOrigin(),u=this.getResolution(),p=c[0],d=c[1],m=p+u[0]*i,y=d+u[1]*n;return[Math.min(p,m),Math.min(d,y),Math.max(p,m),Math.max(d,y)]}}}class Mc{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,n){const i=this.getUint32(e,n),c=this.getUint32(e+4,n);let u;if(n){if(u=i+2**32*c,!Number.isSafeInteger(u))throw new Error(`${u} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return u}if(u=2**32*i+c,!Number.isSafeInteger(u))throw new Error(`${u} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return u}getInt64(e,n){let i=0;const c=(this._dataView.getUint8(e+(n?7:0))&128)>0;let u=!0;for(let p=0;p<8;p++){let d=this._dataView.getUint8(e+(n?p:7-p));c&&(u?d!==0&&(d=~(d-1)&255,u=!1):d=~d&255),i+=d*256**p}return c&&(i=-i),i}getUint8(e,n){return this._dataView.getUint8(e,n)}getInt8(e,n){return this._dataView.getInt8(e,n)}getUint16(e,n){return this._dataView.getUint16(e,n)}getInt16(e,n){return this._dataView.getInt16(e,n)}getUint32(e,n){return this._dataView.getUint32(e,n)}getInt32(e,n){return this._dataView.getInt32(e,n)}getFloat16(e,n){return Ms(this._dataView,e,n)}getFloat32(e,n){return this._dataView.getFloat32(e,n)}getFloat64(e,n){return this._dataView.getFloat64(e,n)}}class Rc{constructor(e,n,i,c){this._dataView=new DataView(e),this._sliceOffset=n,this._littleEndian=i,this._bigTiff=c}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,n){return this.sliceOffset<=e&&this.sliceTop>=e+n}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const n=this.readUint32(e),i=this.readUint32(e+4);let c;if(this._littleEndian){if(c=n+2**32*i,!Number.isSafeInteger(c))throw new Error(`${c} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return c}if(c=2**32*n+i,!Number.isSafeInteger(c))throw new Error(`${c} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return c}readInt64(e){let n=0;const i=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let c=!0;for(let u=0;u<8;u++){let p=this._dataView.getUint8(e+(this._littleEndian?u:7-u));i&&(c?p!==0&&(p=~(p-1)&255,c=!1):p=~p&255),n+=p*256**u}return i&&(n=-n),n}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}class Pc{async fetch(e,n=void 0){return Promise.all(e.map(i=>this.fetchSlice(i,n)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class Zr extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Zr),this.name="AbortError"}}class Bc extends Pc{constructor(e){super(),this.arrayBuffer=e}fetchSlice(e,n){if(n&&n.aborted)throw new Zr("Request aborted");return this.arrayBuffer.slice(e.offset,e.offset+e.length)}}function Nc(s){return new Bc(s)}function Hr(s){switch(s){case le.BYTE:case le.ASCII:case le.SBYTE:case le.UNDEFINED:return 1;case le.SHORT:case le.SSHORT:return 2;case le.LONG:case le.SLONG:case le.FLOAT:case le.IFD:return 4;case le.RATIONAL:case le.SRATIONAL:case le.DOUBLE:case le.LONG8:case le.SLONG8:case le.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${s}`)}}function Oc(s){const e=s.GeoKeyDirectory;if(!e)return null;const n={};for(let i=4;i<=e[3]*4;i+=4){const c=oc[e[i]],u=e[i+1]?Mn[e[i+1]]:null,p=e[i+2],d=e[i+3];let m=null;if(!u)m=d;else{if(m=s[u],typeof m>"u"||m===null)throw new Error(`Could not get value of geoKey '${c}'.`);typeof m=="string"?m=m.substring(d,d+p-1):m.subarray&&(m=m.subarray(d,d+p),p===1&&(m=m[0]))}n[c]=m}return n}function tn(s,e,n,i){let c=null,u=null;const p=Hr(e);switch(e){case le.BYTE:case le.ASCII:case le.UNDEFINED:c=new Uint8Array(n),u=s.readUint8;break;case le.SBYTE:c=new Int8Array(n),u=s.readInt8;break;case le.SHORT:c=new Uint16Array(n),u=s.readUint16;break;case le.SSHORT:c=new Int16Array(n),u=s.readInt16;break;case le.LONG:case le.IFD:c=new Uint32Array(n),u=s.readUint32;break;case le.SLONG:c=new Int32Array(n),u=s.readInt32;break;case le.LONG8:case le.IFD8:c=new Array(n),u=s.readUint64;break;case le.SLONG8:c=new Array(n),u=s.readInt64;break;case le.RATIONAL:c=new Uint32Array(n*2),u=s.readUint32;break;case le.SRATIONAL:c=new Int32Array(n*2),u=s.readInt32;break;case le.FLOAT:c=new Float32Array(n),u=s.readFloat32;break;case le.DOUBLE:c=new Float64Array(n),u=s.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===le.RATIONAL||e===le.SRATIONAL)for(let d=0;d<n;d+=2)c[d]=u.call(s,i+d*p),c[d+1]=u.call(s,i+(d*p+4));else for(let d=0;d<n;++d)c[d]=u.call(s,i+d*p);return e===le.ASCII?new TextDecoder("utf-8").decode(c):c}class Lc{constructor(e,n,i,c){this.fileDirectory=e,this.rawFileDirectory=n,this.geoKeyDirectory=i,this.nextIFDByteOffset=c}}class Kn extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class _c{async readRasters(e={}){const{window:n,width:i,height:c}=e;let{resX:u,resY:p,bbox:d}=e;const m=await this.getImage();let y=m;const w=await this.getImageCount(),T=m.getBoundingBox();if(n&&d)throw new Error('Both "bbox" and "window" passed.');if(i||c){if(n){const[A,R]=m.getOrigin(),[O,v]=m.getResolution();d=[A+n[0]*O,R+n[1]*v,A+n[2]*O,R+n[3]*v]}const E=d||T;if(i){if(u)throw new Error("Both width and resX passed");u=(E[2]-E[0])/i}if(c){if(p)throw new Error("Both width and resY passed");p=(E[3]-E[1])/c}}if(u||p){const E=[];for(let A=0;A<w;++A){const R=await this.getImage(A),{SubfileType:O,NewSubfileType:v}=R.fileDirectory;(A===0||O===2||v&1)&&E.push(R)}E.sort((A,R)=>A.getWidth()-R.getWidth());for(let A=0;A<E.length;++A){const R=E[A],O=(T[2]-T[0])/R.getWidth(),v=(T[3]-T[1])/R.getHeight();if(y=R,u&&u>O||p&&p>v)break}}let M=n;if(d){const[E,A]=m.getOrigin(),[R,O]=y.getResolution(m);M=[Math.round((d[0]-E)/R),Math.round((d[1]-A)/O),Math.round((d[2]-E)/R),Math.round((d[3]-A)/O)],M=[Math.min(M[0],M[2]),Math.min(M[1],M[3]),Math.max(M[0],M[2]),Math.max(M[1],M[3])]}return y.readRasters({...e,window:M})}}class ei extends _c{constructor(e,n,i,c,u={}){super(),this.source=e,this.littleEndian=n,this.bigTiff=i,this.firstIFDOffset=c,this.cache=u.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,n){const i=this.bigTiff?4048:1024;return new Rc((await this.source.fetch([{offset:e,length:typeof n<"u"?n:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const n=this.bigTiff?20:12,i=this.bigTiff?8:2;let c=await this.getSlice(e);const u=this.bigTiff?c.readUint64(e):c.readUint16(e),p=u*n+(this.bigTiff?16:6);c.covers(e,p)||(c=await this.getSlice(e,p));const d={},m=new Map;let y=e+(this.bigTiff?8:2);for(let M=0;M<u;y+=n,++M){const E=c.readUint16(y),A=c.readUint16(y+2),R=this.bigTiff?c.readUint64(y+4):c.readUint32(y+4);let O,v;const j=Hr(A),N=y+(this.bigTiff?12:8);if(j*R<=(this.bigTiff?8:4))O=tn(c,A,R,N);else{const L=c.readOffset(N),H=Hr(A)*R;if(c.covers(L,H))O=tn(c,A,R,L);else{const o=await this.getSlice(L,H);O=tn(o,A,R,L)}}R===1&&ic.indexOf(E)===-1&&!(A===le.RATIONAL||A===le.SRATIONAL)?v=O[0]:v=O;const _=Mn[E];_&&(d[_]=v),m.set(E,v)}const w=Oc(d),T=c.readOffset(e+i+n*u);return new Lc(d,m,w,T)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(n){throw n instanceof Kn?new Kn(e):n}return this.ifdRequests[e]=(async()=>{const n=await this.ifdRequests[e-1];if(n.nextIFDByteOffset===0)throw new Kn(e);return this.parseFileDirectoryAt(n.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const n=await this.requestIFD(e);return new Ic(n.fileDirectory,n.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,n=!0;for(;n;)try{await this.requestIFD(e),++e}catch(i){if(i instanceof Kn)n=!1;else throw i}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const n="GDAL_STRUCTURAL_METADATA_SIZE=",i=n.length+100;let c=await this.getSlice(e,i);if(n===tn(c,le.ASCII,n.length,e)){const p=tn(c,le.ASCII,i,e).split(`
`)[0],d=Number(p.split("=")[1].split(" ")[0])+p.length;d>i&&(c=await this.getSlice(e,d));const m=tn(c,le.ASCII,d,e);this.ghostValues={},m.split(`
`).filter(y=>y.length>0).map(y=>y.split("=")).forEach(([y,w])=>{this.ghostValues[y]=w})}return this.ghostValues}static async fromSource(e,n,i){const c=(await e.fetch([{offset:0,length:1024}],i))[0],u=new Mc(c),p=u.getUint16(0,0);let d;if(p===18761)d=!0;else if(p===19789)d=!1;else throw new TypeError("Invalid byte order value.");const m=u.getUint16(2,d);let y;if(m===42)y=!1;else if(m===43){if(y=!0,u.getUint16(4,d)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const w=y?u.getUint64(8,d):u.getUint32(4,d);return new ei(e,d,y,w,n)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function ns(s,e){return ei.fromSource(Nc(s),e)}const kt=class kt{constructor(){k(this,"baseUrl");this.baseUrl="http://147.93.127.105:3000",console.log("ð API Service initialized with base URL:",this.baseUrl)}static getInstance(){return kt.instance||(kt.instance=new kt),kt.instance}getBaseUrl(){return this.baseUrl}getEndpoint(e){return`${this.baseUrl}${e.startsWith("/")?e:"/"+e}`}};k(kt,"instance");let qr=kt;class Dc{constructor(){k(this,"config");this.config=qr.getInstance()}async testConnection(){try{console.log("ð Testing backend connection...");const e=await fetch(this.config.getEndpoint("/terrain/test-r2"),{method:"GET"});return console.log("â Backend health check:",e.status),e.ok}catch(e){return console.error("â Backend connection test failed:",e),!1}}async generateTile(e){return console.log("ð Generating terrain tile...",e),fetch(this.config.getEndpoint("/terrain/generate-tile"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async downloadFile(e){console.log("ð¥ Downloading file:",e);const n=e.startsWith("http")?e:this.config.getEndpoint(e);return fetch(n)}async downloadSolarData(e){console.log("âï¸ Downloading solar data:",e);const n=e.startsWith("http")?e:this.config.getEndpoint(e);return fetch(n)}getFileDownloadUrl(e){return this.config.getEndpoint(`/terrain/files/${e}`)}getGHIDataUrl(e){return this.config.getEndpoint(e)}getBaseUrl(){return this.config.getBaseUrl()}async makeRequest(e,n={}){const i=this.config.getEndpoint(e);return console.log(`ð Making request to: ${i}`),fetch(i,{headers:{"Content-Type":"application/json",...n.headers},...n})}getEnvironmentInfo(){return{baseUrl:this.config.getBaseUrl(),environment:"production",devMode:!1}}}const Ut=new Dc;console.log("ð API Service Environment:",Ut.getEnvironmentInfo());class Uc{constructor(){k(this,"tileCache",new Map);console.log("ð SolarTerrainService initialized with API service"),console.log("ð Environment:",Ut.getEnvironmentInfo())}async generateCompleteTile(e){var n,i,c,u,p;try{console.log("ð Requesting complete tile...",e);const d=await Ut.generateTile(e);if(!d.ok)throw new Error(`Backend error: ${d.status} ${d.statusText}`);const m=await d.json();console.log("â Backend response received:",m),console.log("ð Checking GHI data in response:"),console.log("  - GHI Success:",(n=m.ghiResult)==null?void 0:n.success),console.log("  - GHI Filename:",(i=m.ghiResult)==null?void 0:i.filename),console.log("  - GHI URL:",(c=m.cacheInfo)==null?void 0:c.ghiTileUrl),console.log("  - GHI Resolution:",(u=m.ghiResult)==null?void 0:u.resolution),console.log("  - GHI Data Shape:",(p=m.ghiResult)==null?void 0:p.dataShape);const[y,w]=await Promise.all([this.downloadAndProcessHeightmap(m.cacheInfo.downloadUrl),this.downloadAndProcessSolarData(Ut.getGHIDataUrl(m.cacheInfo.ghiTileUrl))]),T=this.generateTileId(e),M={tileId:T,bounds:m.cacheInfo.region,center:m.cacheInfo.centerCoordinates,heightmap:y,solarData:w,heightmapUrl:m.cacheInfo.downloadUrl,solarUrl:Ut.getGHIDataUrl(m.cacheInfo.ghiTileUrl)};return this.tileCache.set(T,M),console.log("â Complete tile processed:",{tileId:T,heightmapSize:`${y.width}x${y.height}`,solarSize:`${w.width}x${w.height}`,heightRange:`${y.minHeight.toFixed(1)}m to ${y.maxHeight.toFixed(1)}m`,ghiRange:`${w.minGHI.toFixed(2)} to ${w.maxGHI.toFixed(2)} ${w.unit}`}),M}catch(d){throw console.error("â Failed to generate complete tile:",d),d}}async downloadAndProcessHeightmap(e){try{console.log("ð¥ Downloading heightmap:",e);const n=await Ut.downloadFile(e);if(!n.ok)throw new Error(`Failed to download heightmap: ${n.status}`);const i=await n.arrayBuffer();console.log("ð Heightmap downloaded, size:",i.byteLength);const u=await(await ns(i)).getImage(),p=await u.readRasters(),d=u.getWidth(),m=u.getHeight(),y=new Float32Array(p[0]);let w=y[0],T=y[0];for(let M=1;M<y.length;M++){const E=y[M];E<w&&(w=E),E>T&&(T=E)}return console.log("â Heightmap processed:",{width:d,height:m,minHeight:w.toFixed(1)+"m",maxHeight:T.toFixed(1)+"m"}),{width:d,height:m,elevationData:y,minHeight:w,maxHeight:T}}catch(n){throw console.error("â Failed to process heightmap:",n),n}}async downloadAndProcessSolarData(e){try{console.log("âï¸ Downloading solar data:",e),console.log("âï¸ Full GHI URL:",e);const n=await Ut.downloadSolarData(e);if(console.log("âï¸ GHI Response status:",n.status,n.statusText),!n.ok)throw new Error(`Failed to download solar data: ${n.status} ${n.statusText}`);const i=await n.arrayBuffer();console.log("ð Solar data downloaded successfully!"),console.log("  - Size:",i.byteLength,"bytes"),console.log("  - First 16 bytes:",new Uint8Array(i.slice(0,16))),console.log("âï¸ Processing GHI TIF with geotiff library...");const c=await ns(i);console.log("âï¸ GeoTIFF object created successfully");const u=await c.getImage();console.log("âï¸ GeoTIFF image loaded"),console.log("  - Width:",u.getWidth()),console.log("  - Height:",u.getHeight()),console.log("  - Samples per pixel:",u.getSamplesPerPixel()),console.log("  - Bits per sample:",u.getBitsPerSample());const p=await u.readRasters();console.log("âï¸ Rasters read successfully"),console.log("  - Raster type:",p[0].constructor.name),console.log("  - Raster length:",p[0].length);const d=u.getWidth(),m=u.getHeight(),y=new Float32Array(p[0]);console.log("âï¸ GHI data converted to Float32Array"),console.log("  - Array length:",y.length),console.log("  - First 5 values:",Array.from(y.slice(0,5)));let w=y[0],T=y[0];for(let M=1;M<y.length;M++){const E=y[M];E<w&&(w=E),E>T&&(T=E)}return console.log("â Solar data processed:",{width:d,height:m,minGHI:w.toFixed(2)+" kWh/mÂ²/day",maxGHI:T.toFixed(2)+" kWh/mÂ²/day"}),{width:d,height:m,ghiData:y,minGHI:w,maxGHI:T,unit:"kWh/mÂ²/day"}}catch(n){throw console.error("â Failed to process solar data:",n),n}}generateTileId(e){return`tile_${e.centerLat}_${e.centerLng}_${e.scale}`}getCachedTile(e){const n=this.generateTileId(e);return this.tileCache.get(n)||null}getCacheStats(){let e=0;return this.tileCache.forEach(n=>{e+=n.heightmap.elevationData.byteLength,e+=n.solarData.ghiData.byteLength}),{count:this.tileCache.size,totalSize:e}}clearCache(){this.tileCache.clear(),console.log("ð§¹ Tile cache cleared")}async generateTileGrid(e,n,i=3,c=30){const u=[],d=[];for(let y=0;y<i;y++)for(let w=0;w<i;w++){const T=(y-Math.floor(i/2))*.1,M=(w-Math.floor(i/2))*.1,E=e+M,A=n+T,R={centerLat:E,centerLng:A,scale:c};d.push(this.generateCompleteTile(R))}return(await Promise.allSettled(d)).forEach((y,w)=>{y.status==="fulfilled"?u.push(y.value):console.error(`â Failed to load tile ${w}:`,y.reason)}),console.log(`â Generated ${u.length}/${i*i} tiles in grid`),u}}const Fc=new Uc;class Gc{constructor(e,n={}){k(this,"app");k(this,"map",null);k(this,"marker",null);k(this,"inputLat");k(this,"inputLng");k(this,"inputScale");k(this,"scaleValue");k(this,"btnGenerate");k(this,"statusMessage");k(this,"objectCount");k(this,"searchInput");k(this,"searchResults");k(this,"useSatelliteCheckbox");k(this,"satelliteOpacitySlider");k(this,"satelliteOpacityValue");k(this,"currentLat");k(this,"currentLng");k(this,"currentScale",30);k(this,"isGenerating",!1);k(this,"mapId");k(this,"apiKey");k(this,"searchDebounceTimer",null);this.app=e,this.currentLat=n.defaultLat??39.925,this.currentLng=n.defaultLng??32.837,this.mapId=n.mapId??"DEMO_MAP_ID",this.apiKey=n.apiKey??"",this.inputLat=document.getElementById("input-lat"),this.inputLng=document.getElementById("input-lng"),this.inputScale=document.getElementById("input-scale"),this.scaleValue=document.getElementById("scale-value"),this.btnGenerate=document.getElementById("btn-generate"),this.statusMessage=document.getElementById("status-message"),this.objectCount=document.getElementById("object-count"),this.searchInput=document.getElementById("place-search"),this.searchResults=document.getElementById("search-results"),this.useSatelliteCheckbox=document.getElementById("use-satellite"),this.satelliteOpacitySlider=document.getElementById("satellite-opacity"),this.satelliteOpacityValue=document.getElementById("satellite-opacity-value"),this.setupEventListeners(),this.setupPlacesSearch(),this.setupSatelliteToggle(),this.initGoogleMaps(n.defaultZoom??10)}setupEventListeners(){this.inputLat.addEventListener("change",()=>{this.currentLat=parseFloat(this.inputLat.value),this.updateMarker()}),this.inputLng.addEventListener("change",()=>{this.currentLng=parseFloat(this.inputLng.value),this.updateMarker()}),this.inputScale.addEventListener("input",()=>{this.currentScale=parseInt(this.inputScale.value),this.scaleValue.textContent=this.currentScale.toString()}),this.btnGenerate.addEventListener("click",()=>{this.generateTerrain()}),document.querySelectorAll(".quick-loc-btn").forEach(e=>{e.addEventListener("click",n=>{const i=n.target,c=parseFloat(i.dataset.lat||"0"),u=parseFloat(i.dataset.lng||"0");this.setLocation(c,u)})}),setInterval(()=>{this.objectCount.textContent=this.app.scene.count.toString()},500)}initGoogleMaps(e){window.google&&window.google.maps?this.createMap(e):window.addEventListener("google-maps-ready",()=>{this.createMap(e)})}async createMap(e){const n=document.getElementById("google-map");if(!n)return;this.map=new google.maps.Map(n,{center:{lat:this.currentLat,lng:this.currentLng},zoom:e,mapId:this.mapId,mapTypeId:"terrain",disableDefaultUI:!0,zoomControl:!0});const i=document.createElement("div");i.innerHTML=`
            <div style = "
            width: 24px;
            height: 24px;
            background: #4ecdc4;
            border: 3px solid #fff;
            border - radius: 50 %;
            box - shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            cursor: grab;
            border-radius: 100%;
            "></div>
        `;const{AdvancedMarkerElement:c}=await google.maps.importLibrary("marker");this.marker=new c({position:{lat:this.currentLat,lng:this.currentLng},map:this.map,gmpDraggable:!0,content:i,title:"Selected Location"}),this.map.addListener("click",u=>{u.latLng&&this.setLocation(u.latLng.lat(),u.latLng.lng())}),this.marker.addListener("gmp-dragend",()=>{var p;const u=(p=this.marker)==null?void 0:p.position;u&&typeof u=="object"&&"lat"in u&&(this.currentLat=u.lat,this.currentLng=u.lng,this.updateInputs())}),console.log("ðºï¸ Google Maps initialized with AdvancedMarkerElement")}setupPlacesSearch(){!this.searchInput||!this.searchResults||(this.searchInput.addEventListener("input",()=>{const e=this.searchInput.value.trim();if(this.searchDebounceTimer&&clearTimeout(this.searchDebounceTimer),e.length<2){this.hideSearchResults();return}this.searchDebounceTimer=setTimeout(()=>{this.searchPlaces(e)},300)}),document.addEventListener("click",e=>{!this.searchInput.contains(e.target)&&!this.searchResults.contains(e.target)&&this.hideSearchResults()}),this.searchInput.addEventListener("keydown",e=>{e.key==="Escape"&&this.hideSearchResults()}),console.log("ð Places API (New) search initialized"))}async searchPlaces(e){this.searchResults.innerHTML='<div class="search-loading">Searching...</div>',this.searchResults.classList.add("visible");try{const n=await fetch("https://places.googleapis.com/v1/places:searchText",{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":this.apiKey,"X-Goog-FieldMask":"places.displayName,places.formattedAddress,places.location"},body:JSON.stringify({textQuery:e,maxResultCount:5})});if(!n.ok)throw new Error(`Places API error: ${n.status} `);const i=await n.json();this.displaySearchResults(i.places||[])}catch(n){console.error("Places search error:",n),this.searchResults.innerHTML='<div class="search-loading">Search failed</div>'}}displaySearchResults(e){if(e.length===0){this.searchResults.innerHTML='<div class="search-loading">No results found</div>';return}this.searchResults.innerHTML=e.map(n=>{var i,c,u;return`
            <div class="search-result-item" data-lat="${(i=n.location)==null?void 0:i.latitude}" data-lng="${(c=n.location)==null?void 0:c.longitude}">
                <div class="name">${((u=n.displayName)==null?void 0:u.text)||"Unknown"}</div>
                <div class="address">${n.formattedAddress||""}</div>
            </div>
        `}).join(""),this.searchResults.querySelectorAll(".search-result-item").forEach(n=>{n.addEventListener("click",()=>{var p;const i=parseFloat(n.dataset.lat||"0"),c=parseFloat(n.dataset.lng||"0"),u=((p=n.querySelector(".name"))==null?void 0:p.textContent)||"";this.setLocation(i,c),this.searchInput.value=u,this.hideSearchResults(),this.map&&this.map.setZoom(12),console.log(`ð Selected: ${u} `)})})}hideSearchResults(){this.searchResults.classList.remove("visible")}setLocation(e,n){this.currentLat=e,this.currentLng=n,this.updateInputs(),this.updateMarker(),this.map&&this.map.panTo({lat:e,lng:n})}updateInputs(){this.inputLat.value=this.currentLat.toFixed(4),this.inputLng.value=this.currentLng.toFixed(4)}updateMarker(){this.marker&&(this.marker.position={lat:this.currentLat,lng:this.currentLng}),this.map&&this.map.panTo({lat:this.currentLat,lng:this.currentLng})}showStatus(e,n){this.statusMessage.textContent=e,this.statusMessage.className=`status visible ${n} `}hideStatus(){this.statusMessage.className="status"}async generateTerrain(){var e,n;if(!this.isGenerating){this.isGenerating=!0,this.btnGenerate.disabled=!0,this.showStatus("ð Fetching terrain data...","loading");try{console.log(`ðï¸ Generating terrain at ${this.currentLat}, ${this.currentLng} (scale: ${this.currentScale}m)`);const i=await Fc.generateCompleteTile({centerLat:this.currentLat,centerLng:this.currentLng,scale:this.currentScale});this.showStatus("ð¨ Building 3D mesh...","loading");const c=this.app.renderer.getDevice(),u=this.app.renderer.getTerrainMaterialGroupLayout(),p=this.app.renderer.getBlendSettingsBuffer(),d=yt.fromHeightmap(c,i.heightmap.elevationData,i.heightmap.width,i.heightmap.height,{targetSize:20,heightScale:.003});this.showStatus("ð°ï¸ Fetching satellite imagery...","loading");const m=this.calculateSatelliteZoom(this.currentScale),y=await lt.fetchSatelliteImage(this.currentLat,this.currentLng,this.apiKey,{zoom:m,size:640,scale:2}),w=((e=this.useSatelliteCheckbox)==null?void 0:e.checked)??!1,T=parseInt(((n=this.satelliteOpacitySlider)==null?void 0:n.value)??"20")/100;this.app.renderer.updateBlendSettings(w?T:0);const M=lt.createTerrainMaterial(c,{data:i.solarData.ghiData,width:i.solarData.width,height:i.solarData.height,minGHI:i.solarData.minGHI,maxGHI:i.solarData.maxGHI},{data:y},u,p,this.app.renderer.getSelectionQuadBuffer());for(const A of this.app.scene.getAll())this.app.scene.removeById(A.id);const E=new ft({mesh:d,material:M.bindGroup,renderType:ze.Terrain,transform:new We(he(0,0,-5),he(0,0,0),he(1,1,1))});this.app.scene.add(E),this.app.setTerrainComputeInfo(d.vertexBuffer,d.vertexCount),this.app.setTerrainMetadata(i.bounds,20),this.app.setGHIData(i.solarData.ghiData,i.solarData.width,i.solarData.height,i.solarData.minGHI,i.solarData.maxGHI),this.showStatus(`â Terrain loaded!(${i.heightmap.width}x${i.heightmap.height})`,"success"),console.log("â Terrain added to scene"),setTimeout(()=>this.hideStatus(),3e3)}catch(i){console.error("â Failed to generate terrain:",i),this.showStatus(`â Error: ${i instanceof Error?i.message:"Unknown error"} `,"error")}finally{this.isGenerating=!1,this.btnGenerate.disabled=!1}}}setupSatelliteToggle(){const e=()=>{var i;return parseInt(((i=this.satelliteOpacitySlider)==null?void 0:i.value)??"20")/100},n=i=>{this.satelliteOpacityValue&&(this.satelliteOpacityValue.textContent=`${Math.round(i*100)}%`)};this.useSatelliteCheckbox&&this.useSatelliteCheckbox.addEventListener("change",()=>{const i=this.useSatelliteCheckbox.checked?e():0;this.app.renderer.updateBlendSettings(i)}),this.satelliteOpacitySlider&&this.satelliteOpacitySlider.addEventListener("input",()=>{var c;const i=e();n(i),(c=this.useSatelliteCheckbox)!=null&&c.checked&&this.app.renderer.updateBlendSettings(i)}),document.addEventListener("keydown",i=>{i.code==="KeyV"&&!this.isInputFocused()&&(this.useSatelliteCheckbox?(this.useSatelliteCheckbox.checked=!this.useSatelliteCheckbox.checked,this.useSatelliteCheckbox.dispatchEvent(new Event("change"))):this.app.renderer.toggleSatellite())})}isInputFocused(){const e=document.activeElement;return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement}getCoordinates(){return{lat:this.currentLat,lng:this.currentLng,scale:this.currentScale}}calculateSatelliteZoom(e){return e<=10?19:e<=20?18:e<=30?17:e<=50?16:e<=75?15:14}}const rs="AIzaSyC8gyUcO5dg76rRJti1ypgyIAyRZQd7FjA";function kc(s){return new Promise((e,n)=>{var c;if((c=window.google)!=null&&c.maps){e();return}const i=document.createElement("script");i.src=`https://maps.googleapis.com/maps/api/js?key=${s}&callback=initMap&v=weekly&libraries=marker`,i.async=!0,i.defer=!0,i.onerror=()=>n(new Error("Failed to load Google Maps API")),document.head.appendChild(i),window.addEventListener("google-maps-ready",()=>e(),{once:!0})})}const jc=document.getElementById("gfx-main");(async()=>{try{await kc(rs),console.log("â Google Maps API loaded")}catch(n){console.error("â Failed to load Google Maps API:",n)}const s=new Ba(jc);await s.init(),s.run();const e=new Gc(s,{defaultLat:39.925,defaultLng:32.837,defaultZoom:10,apiKey:rs});console.log("ð¯ Application initialized with Google Maps integration"),console.log(`ð¦ Scene contains ${s.scene.count} objects`),console.log('ðºï¸ Click the map to select a location, then click "Generate Terrain"'),window.app=s,window.mapController=e})();export{qc as L,$c as a,Po as g};
