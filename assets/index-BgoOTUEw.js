const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./raw-in9isEBO.js","./basedecoder-B2c5_Eok.js","./lzw-_aCqfs4w.js","./jpeg-JhJy4lL1.js","./deflate-Dthki0TA.js","./pako.esm-BkaqWuDM.js","./packbits-DDWKfGV_.js","./lerc-DHHWfi8f.js","./zstd-DD6JHAQz.js","./webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
var Eo=Object.defineProperty;var So=(s,e,r)=>e in s?Eo(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var q=(s,e,r)=>So(s,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&o(p)}).observe(document,{childList:!0,subtree:!0});function r(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(c){if(c.ep)return;c.ep=!0;const u=r(c);fetch(c.href,u)}})();function Ao(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Yr={exports:{}};/*!
 * jQuery JavaScript Library v3.7.1
 * https://jquery.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2023-08-28T13:37Z
 */var Ro=Yr.exports,Li;function Co(){return Li||(Li=1,function(s){(function(e,r){s.exports=e.document?r(e,!0):function(o){if(!o.document)throw new Error("jQuery requires a window with a document");return r(o)}})(typeof window<"u"?window:Ro,function(e,r){var o=[],c=Object.getPrototypeOf,u=o.slice,p=o.flat?function(t){return o.flat.call(t)}:function(t){return o.concat.apply([],t)},d=o.push,x=o.indexOf,b={},T=b.toString,S=b.hasOwnProperty,M=S.toString,E=M.call(Object),A={},I=function(n){return typeof n=="function"&&typeof n.nodeType!="number"&&typeof n.item!="function"},L=function(n){return n!=null&&n===n.window},m=e.document,F={type:!0,src:!0,nonce:!0,noModule:!0};function N(t,n,a){a=a||m;var l,f,h=a.createElement("script");if(h.text=t,n)for(l in F)f=n[l]||n.getAttribute&&n.getAttribute(l),f&&h.setAttribute(l,f);a.head.appendChild(h).parentNode.removeChild(h)}function j(t){return t==null?t+"":typeof t=="object"||typeof t=="function"?b[T.call(t)]||"object":typeof t}var U="3.7.1",H=/HTML$/i,i=function(t,n){return new i.fn.init(t,n)};i.fn=i.prototype={jquery:U,constructor:i,length:0,toArray:function(){return u.call(this)},get:function(t){return t==null?u.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var n=i.merge(this.constructor(),t);return n.prevObject=this,n},each:function(t){return i.each(this,t)},map:function(t){return this.pushStack(i.map(this,function(n,a){return t.call(n,a,n)}))},slice:function(){return this.pushStack(u.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(i.grep(this,function(t,n){return(n+1)%2}))},odd:function(){return this.pushStack(i.grep(this,function(t,n){return n%2}))},eq:function(t){var n=this.length,a=+t+(t<0?n:0);return this.pushStack(a>=0&&a<n?[this[a]]:[])},end:function(){return this.prevObject||this.constructor()},push:d,sort:o.sort,splice:o.splice},i.extend=i.fn.extend=function(){var t,n,a,l,f,h,g=arguments[0]||{},w=1,v=arguments.length,C=!1;for(typeof g=="boolean"&&(C=g,g=arguments[w]||{},w++),typeof g!="object"&&!I(g)&&(g={}),w===v&&(g=this,w--);w<v;w++)if((t=arguments[w])!=null)for(n in t)l=t[n],!(n==="__proto__"||g===l)&&(C&&l&&(i.isPlainObject(l)||(f=Array.isArray(l)))?(a=g[n],f&&!Array.isArray(a)?h=[]:!f&&!i.isPlainObject(a)?h={}:h=a,f=!1,g[n]=i.extend(C,h,l)):l!==void 0&&(g[n]=l));return g},i.extend({expando:"jQuery"+(U+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var n,a;return!t||T.call(t)!=="[object Object]"?!1:(n=c(t),n?(a=S.call(n,"constructor")&&n.constructor,typeof a=="function"&&M.call(a)===E):!0)},isEmptyObject:function(t){var n;for(n in t)return!1;return!0},globalEval:function(t,n,a){N(t,{nonce:n&&n.nonce},a)},each:function(t,n){var a,l=0;if(D(t))for(a=t.length;l<a&&n.call(t[l],l,t[l])!==!1;l++);else for(l in t)if(n.call(t[l],l,t[l])===!1)break;return t},text:function(t){var n,a="",l=0,f=t.nodeType;if(!f)for(;n=t[l++];)a+=i.text(n);return f===1||f===11?t.textContent:f===9?t.documentElement.textContent:f===3||f===4?t.nodeValue:a},makeArray:function(t,n){var a=n||[];return t!=null&&(D(Object(t))?i.merge(a,typeof t=="string"?[t]:t):d.call(a,t)),a},inArray:function(t,n,a){return n==null?-1:x.call(n,t,a)},isXMLDoc:function(t){var n=t&&t.namespaceURI,a=t&&(t.ownerDocument||t).documentElement;return!H.test(n||a&&a.nodeName||"HTML")},merge:function(t,n){for(var a=+n.length,l=0,f=t.length;l<a;l++)t[f++]=n[l];return t.length=f,t},grep:function(t,n,a){for(var l,f=[],h=0,g=t.length,w=!a;h<g;h++)l=!n(t[h],h),l!==w&&f.push(t[h]);return f},map:function(t,n,a){var l,f,h=0,g=[];if(D(t))for(l=t.length;h<l;h++)f=n(t[h],h,a),f!=null&&g.push(f);else for(h in t)f=n(t[h],h,a),f!=null&&g.push(f);return p(g)},guid:1,support:A}),typeof Symbol=="function"&&(i.fn[Symbol.iterator]=o[Symbol.iterator]),i.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,n){b["[object "+n+"]"]=n.toLowerCase()});function D(t){var n=!!t&&"length"in t&&t.length,a=j(t);return I(t)||L(t)?!1:a==="array"||n===0||typeof n=="number"&&n>0&&n-1 in t}function V(t,n){return t.nodeName&&t.nodeName.toLowerCase()===n.toLowerCase()}var $=o.pop,J=o.sort,Q=o.splice,Y="[\\x20\\t\\r\\n\\f]",me=new RegExp("^"+Y+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Y+"+$","g");i.contains=function(t,n){var a=n&&n.parentNode;return t===a||!!(a&&a.nodeType===1&&(t.contains?t.contains(a):t.compareDocumentPosition&&t.compareDocumentPosition(a)&16))};var ie=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function le(t,n){return n?t==="\0"?"ï¿½":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}i.escapeSelector=function(t){return(t+"").replace(ie,le)};var pe=m,Ce=d;(function(){var t,n,a,l,f,h=Ce,g,w,v,C,B,k=i.expando,O=0,z=0,se=Ur(),ge=Ur(),ue=Ur(),Me=Ur(),Ie=function(y,R){return y===R&&(f=!0),0},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",tt="(?:\\\\[\\da-fA-F]{1,6}"+Y+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",de="\\["+Y+"*("+tt+")(?:"+Y+"*([*^$|!~]?=)"+Y+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+tt+"))|)"+Y+"*\\]",Ot=":("+tt+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+de+")*)|.*)\\)|)",ye=new RegExp(Y+"+","g"),Re=new RegExp("^"+Y+"*,"+Y+"*"),br=new RegExp("^"+Y+"*([>+~]|"+Y+")"+Y+"*"),wn=new RegExp(Y+"|>"),rt=new RegExp(Ot),vr=new RegExp("^"+tt+"$"),nt={ID:new RegExp("^#("+tt+")"),CLASS:new RegExp("^\\.("+tt+")"),TAG:new RegExp("^("+tt+"|[*])"),ATTR:new RegExp("^"+de),PSEUDO:new RegExp("^"+Ot),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Y+"*(even|odd|(([+-]|)(\\d*)n|)"+Y+"*(?:([+-]|)"+Y+"*(\\d+)|))"+Y+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+Y+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Y+"*((?:-\\d)?\\d*)"+Y+"*\\)|)(?=[^-]|$)","i")},bt=/^(?:input|select|textarea|button)$/i,vt=/^h\d$/i,ze=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,En=/[+~]/,pt=new RegExp("\\\\[\\da-fA-F]{1,6}"+Y+"?|\\\\([^\\r\\n\\f])","g"),gt=function(y,R){var P="0x"+y.slice(1)-65536;return R||(P<0?String.fromCharCode(P+65536):String.fromCharCode(P>>10|55296,P&1023|56320))},mo=function(){Tt()},yo=kr(function(y){return y.disabled===!0&&V(y,"fieldset")},{dir:"parentNode",next:"legend"});function xo(){try{return g.activeElement}catch{}}try{h.apply(o=u.call(pe.childNodes),pe.childNodes),o[pe.childNodes.length].nodeType}catch{h={apply:function(R,P){Ce.apply(R,u.call(P))},call:function(R){Ce.apply(R,u.call(arguments,1))}}}function ve(y,R,P,_){var G,K,W,Z,X,fe,ne,oe=R&&R.ownerDocument,he=R?R.nodeType:9;if(P=P||[],typeof y!="string"||!y||he!==1&&he!==9&&he!==11)return P;if(!_&&(Tt(R),R=R||g,v)){if(he!==11&&(X=ze.exec(y)))if(G=X[1]){if(he===9)if(W=R.getElementById(G)){if(W.id===G)return h.call(P,W),P}else return P;else if(oe&&(W=oe.getElementById(G))&&ve.contains(R,W)&&W.id===G)return h.call(P,W),P}else{if(X[2])return h.apply(P,R.getElementsByTagName(y)),P;if((G=X[3])&&R.getElementsByClassName)return h.apply(P,R.getElementsByClassName(G)),P}if(!Me[y+" "]&&(!C||!C.test(y))){if(ne=y,oe=R,he===1&&(wn.test(y)||br.test(y))){for(oe=En.test(y)&&Sn(R.parentNode)||R,(oe!=R||!A.scope)&&((Z=R.getAttribute("id"))?Z=i.escapeSelector(Z):R.setAttribute("id",Z=k)),fe=Tr(y),K=fe.length;K--;)fe[K]=(Z?"#"+Z:":scope")+" "+Gr(fe[K]);ne=fe.join(",")}try{return h.apply(P,oe.querySelectorAll(ne)),P}catch{Me(y,!0)}finally{Z===k&&R.removeAttribute("id")}}}return Oi(y.replace(me,"$1"),R,P,_)}function Ur(){var y=[];function R(P,_){return y.push(P+" ")>n.cacheLength&&delete R[y.shift()],R[P+" "]=_}return R}function We(y){return y[k]=!0,y}function Zt(y){var R=g.createElement("fieldset");try{return!!y(R)}catch{return!1}finally{R.parentNode&&R.parentNode.removeChild(R),R=null}}function bo(y){return function(R){return V(R,"input")&&R.type===y}}function vo(y){return function(R){return(V(R,"input")||V(R,"button"))&&R.type===y}}function Pi(y){return function(R){return"form"in R?R.parentNode&&R.disabled===!1?"label"in R?"label"in R.parentNode?R.parentNode.disabled===y:R.disabled===y:R.isDisabled===y||R.isDisabled!==!y&&yo(R)===y:R.disabled===y:"label"in R?R.disabled===y:!1}}function Lt(y){return We(function(R){return R=+R,We(function(P,_){for(var G,K=y([],P.length,R),W=K.length;W--;)P[G=K[W]]&&(P[G]=!(_[G]=P[G]))})})}function Sn(y){return y&&typeof y.getElementsByTagName<"u"&&y}function Tt(y){var R,P=y?y.ownerDocument||y:pe;return P==g||P.nodeType!==9||!P.documentElement||(g=P,w=g.documentElement,v=!i.isXMLDoc(g),B=w.matches||w.webkitMatchesSelector||w.msMatchesSelector,w.msMatchesSelector&&pe!=g&&(R=g.defaultView)&&R.top!==R&&R.addEventListener("unload",mo),A.getById=Zt(function(_){return w.appendChild(_).id=i.expando,!g.getElementsByName||!g.getElementsByName(i.expando).length}),A.disconnectedMatch=Zt(function(_){return B.call(_,"*")}),A.scope=Zt(function(){return g.querySelectorAll(":scope")}),A.cssHas=Zt(function(){try{return g.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),A.getById?(n.filter.ID=function(_){var G=_.replace(pt,gt);return function(K){return K.getAttribute("id")===G}},n.find.ID=function(_,G){if(typeof G.getElementById<"u"&&v){var K=G.getElementById(_);return K?[K]:[]}}):(n.filter.ID=function(_){var G=_.replace(pt,gt);return function(K){var W=typeof K.getAttributeNode<"u"&&K.getAttributeNode("id");return W&&W.value===G}},n.find.ID=function(_,G){if(typeof G.getElementById<"u"&&v){var K,W,Z,X=G.getElementById(_);if(X){if(K=X.getAttributeNode("id"),K&&K.value===_)return[X];for(Z=G.getElementsByName(_),W=0;X=Z[W++];)if(K=X.getAttributeNode("id"),K&&K.value===_)return[X]}return[]}}),n.find.TAG=function(_,G){return typeof G.getElementsByTagName<"u"?G.getElementsByTagName(_):G.querySelectorAll(_)},n.find.CLASS=function(_,G){if(typeof G.getElementsByClassName<"u"&&v)return G.getElementsByClassName(_)},C=[],Zt(function(_){var G;w.appendChild(_).innerHTML="<a id='"+k+"' href='' disabled='disabled'></a><select id='"+k+"-\r\\' disabled='disabled'><option selected=''></option></select>",_.querySelectorAll("[selected]").length||C.push("\\["+Y+"*(?:value|"+et+")"),_.querySelectorAll("[id~="+k+"-]").length||C.push("~="),_.querySelectorAll("a#"+k+"+*").length||C.push(".#.+[+~]"),_.querySelectorAll(":checked").length||C.push(":checked"),G=g.createElement("input"),G.setAttribute("type","hidden"),_.appendChild(G).setAttribute("name","D"),w.appendChild(_).disabled=!0,_.querySelectorAll(":disabled").length!==2&&C.push(":enabled",":disabled"),G=g.createElement("input"),G.setAttribute("name",""),_.appendChild(G),_.querySelectorAll("[name='']").length||C.push("\\["+Y+"*name"+Y+"*="+Y+`*(?:''|"")`)}),A.cssHas||C.push(":has"),C=C.length&&new RegExp(C.join("|")),Ie=function(_,G){if(_===G)return f=!0,0;var K=!_.compareDocumentPosition-!G.compareDocumentPosition;return K||(K=(_.ownerDocument||_)==(G.ownerDocument||G)?_.compareDocumentPosition(G):1,K&1||!A.sortDetached&&G.compareDocumentPosition(_)===K?_===g||_.ownerDocument==pe&&ve.contains(pe,_)?-1:G===g||G.ownerDocument==pe&&ve.contains(pe,G)?1:l?x.call(l,_)-x.call(l,G):0:K&4?-1:1)}),g}ve.matches=function(y,R){return ve(y,null,null,R)},ve.matchesSelector=function(y,R){if(Tt(y),v&&!Me[R+" "]&&(!C||!C.test(R)))try{var P=B.call(y,R);if(P||A.disconnectedMatch||y.document&&y.document.nodeType!==11)return P}catch{Me(R,!0)}return ve(R,g,null,[y]).length>0},ve.contains=function(y,R){return(y.ownerDocument||y)!=g&&Tt(y),i.contains(y,R)},ve.attr=function(y,R){(y.ownerDocument||y)!=g&&Tt(y);var P=n.attrHandle[R.toLowerCase()],_=P&&S.call(n.attrHandle,R.toLowerCase())?P(y,R,!v):void 0;return _!==void 0?_:y.getAttribute(R)},ve.error=function(y){throw new Error("Syntax error, unrecognized expression: "+y)},i.uniqueSort=function(y){var R,P=[],_=0,G=0;if(f=!A.sortStable,l=!A.sortStable&&u.call(y,0),J.call(y,Ie),f){for(;R=y[G++];)R===y[G]&&(_=P.push(G));for(;_--;)Q.call(y,P[_],1)}return l=null,y},i.fn.uniqueSort=function(){return this.pushStack(i.uniqueSort(u.apply(this)))},n=i.expr={cacheLength:50,createPseudo:We,match:nt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(y){return y[1]=y[1].replace(pt,gt),y[3]=(y[3]||y[4]||y[5]||"").replace(pt,gt),y[2]==="~="&&(y[3]=" "+y[3]+" "),y.slice(0,4)},CHILD:function(y){return y[1]=y[1].toLowerCase(),y[1].slice(0,3)==="nth"?(y[3]||ve.error(y[0]),y[4]=+(y[4]?y[5]+(y[6]||1):2*(y[3]==="even"||y[3]==="odd")),y[5]=+(y[7]+y[8]||y[3]==="odd")):y[3]&&ve.error(y[0]),y},PSEUDO:function(y){var R,P=!y[6]&&y[2];return nt.CHILD.test(y[0])?null:(y[3]?y[2]=y[4]||y[5]||"":P&&rt.test(P)&&(R=Tr(P,!0))&&(R=P.indexOf(")",P.length-R)-P.length)&&(y[0]=y[0].slice(0,R),y[2]=P.slice(0,R)),y.slice(0,3))}},filter:{TAG:function(y){var R=y.replace(pt,gt).toLowerCase();return y==="*"?function(){return!0}:function(P){return V(P,R)}},CLASS:function(y){var R=se[y+" "];return R||(R=new RegExp("(^|"+Y+")"+y+"("+Y+"|$)"))&&se(y,function(P){return R.test(typeof P.className=="string"&&P.className||typeof P.getAttribute<"u"&&P.getAttribute("class")||"")})},ATTR:function(y,R,P){return function(_){var G=ve.attr(_,y);return G==null?R==="!=":R?(G+="",R==="="?G===P:R==="!="?G!==P:R==="^="?P&&G.indexOf(P)===0:R==="*="?P&&G.indexOf(P)>-1:R==="$="?P&&G.slice(-P.length)===P:R==="~="?(" "+G.replace(ye," ")+" ").indexOf(P)>-1:R==="|="?G===P||G.slice(0,P.length+1)===P+"-":!1):!0}},CHILD:function(y,R,P,_,G){var K=y.slice(0,3)!=="nth",W=y.slice(-4)!=="last",Z=R==="of-type";return _===1&&G===0?function(X){return!!X.parentNode}:function(X,fe,ne){var oe,he,re,we,ke,Ne=K!==W?"nextSibling":"previousSibling",qe=X.parentNode,it=Z&&X.nodeName.toLowerCase(),Qt=!ne&&!Z,Le=!1;if(qe){if(K){for(;Ne;){for(re=X;re=re[Ne];)if(Z?V(re,it):re.nodeType===1)return!1;ke=Ne=y==="only"&&!ke&&"nextSibling"}return!0}if(ke=[W?qe.firstChild:qe.lastChild],W&&Qt){for(he=qe[k]||(qe[k]={}),oe=he[y]||[],we=oe[0]===O&&oe[1],Le=we&&oe[2],re=we&&qe.childNodes[we];re=++we&&re&&re[Ne]||(Le=we=0)||ke.pop();)if(re.nodeType===1&&++Le&&re===X){he[y]=[O,we,Le];break}}else if(Qt&&(he=X[k]||(X[k]={}),oe=he[y]||[],we=oe[0]===O&&oe[1],Le=we),Le===!1)for(;(re=++we&&re&&re[Ne]||(Le=we=0)||ke.pop())&&!((Z?V(re,it):re.nodeType===1)&&++Le&&(Qt&&(he=re[k]||(re[k]={}),he[y]=[O,Le]),re===X)););return Le-=G,Le===_||Le%_===0&&Le/_>=0}}},PSEUDO:function(y,R){var P,_=n.pseudos[y]||n.setFilters[y.toLowerCase()]||ve.error("unsupported pseudo: "+y);return _[k]?_(R):_.length>1?(P=[y,y,"",R],n.setFilters.hasOwnProperty(y.toLowerCase())?We(function(G,K){for(var W,Z=_(G,R),X=Z.length;X--;)W=x.call(G,Z[X]),G[W]=!(K[W]=Z[X])}):function(G){return _(G,0,P)}):_}},pseudos:{not:We(function(y){var R=[],P=[],_=In(y.replace(me,"$1"));return _[k]?We(function(G,K,W,Z){for(var X,fe=_(G,null,Z,[]),ne=G.length;ne--;)(X=fe[ne])&&(G[ne]=!(K[ne]=X))}):function(G,K,W){return R[0]=G,_(R,null,W,P),R[0]=null,!P.pop()}}),has:We(function(y){return function(R){return ve(y,R).length>0}}),contains:We(function(y){return y=y.replace(pt,gt),function(R){return(R.textContent||i.text(R)).indexOf(y)>-1}}),lang:We(function(y){return vr.test(y||"")||ve.error("unsupported lang: "+y),y=y.replace(pt,gt).toLowerCase(),function(R){var P;do if(P=v?R.lang:R.getAttribute("xml:lang")||R.getAttribute("lang"))return P=P.toLowerCase(),P===y||P.indexOf(y+"-")===0;while((R=R.parentNode)&&R.nodeType===1);return!1}}),target:function(y){var R=e.location&&e.location.hash;return R&&R.slice(1)===y.id},root:function(y){return y===w},focus:function(y){return y===xo()&&g.hasFocus()&&!!(y.type||y.href||~y.tabIndex)},enabled:Pi(!1),disabled:Pi(!0),checked:function(y){return V(y,"input")&&!!y.checked||V(y,"option")&&!!y.selected},selected:function(y){return y.parentNode&&y.parentNode.selectedIndex,y.selected===!0},empty:function(y){for(y=y.firstChild;y;y=y.nextSibling)if(y.nodeType<6)return!1;return!0},parent:function(y){return!n.pseudos.empty(y)},header:function(y){return vt.test(y.nodeName)},input:function(y){return bt.test(y.nodeName)},button:function(y){return V(y,"input")&&y.type==="button"||V(y,"button")},text:function(y){var R;return V(y,"input")&&y.type==="text"&&((R=y.getAttribute("type"))==null||R.toLowerCase()==="text")},first:Lt(function(){return[0]}),last:Lt(function(y,R){return[R-1]}),eq:Lt(function(y,R,P){return[P<0?P+R:P]}),even:Lt(function(y,R){for(var P=0;P<R;P+=2)y.push(P);return y}),odd:Lt(function(y,R){for(var P=1;P<R;P+=2)y.push(P);return y}),lt:Lt(function(y,R,P){var _;for(P<0?_=P+R:P>R?_=R:_=P;--_>=0;)y.push(_);return y}),gt:Lt(function(y,R,P){for(var _=P<0?P+R:P;++_<R;)y.push(_);return y})}},n.pseudos.nth=n.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[t]=bo(t);for(t in{submit:!0,reset:!0})n.pseudos[t]=vo(t);function Ni(){}Ni.prototype=n.filters=n.pseudos,n.setFilters=new Ni;function Tr(y,R){var P,_,G,K,W,Z,X,fe=ge[y+" "];if(fe)return R?0:fe.slice(0);for(W=y,Z=[],X=n.preFilter;W;){(!P||(_=Re.exec(W)))&&(_&&(W=W.slice(_[0].length)||W),Z.push(G=[])),P=!1,(_=br.exec(W))&&(P=_.shift(),G.push({value:P,type:_[0].replace(me," ")}),W=W.slice(P.length));for(K in n.filter)(_=nt[K].exec(W))&&(!X[K]||(_=X[K](_)))&&(P=_.shift(),G.push({value:P,type:K,matches:_}),W=W.slice(P.length));if(!P)break}return R?W.length:W?ve.error(y):ge(y,Z).slice(0)}function Gr(y){for(var R=0,P=y.length,_="";R<P;R++)_+=y[R].value;return _}function kr(y,R,P){var _=R.dir,G=R.next,K=G||_,W=P&&K==="parentNode",Z=z++;return R.first?function(X,fe,ne){for(;X=X[_];)if(X.nodeType===1||W)return y(X,fe,ne);return!1}:function(X,fe,ne){var oe,he,re=[O,Z];if(ne){for(;X=X[_];)if((X.nodeType===1||W)&&y(X,fe,ne))return!0}else for(;X=X[_];)if(X.nodeType===1||W)if(he=X[k]||(X[k]={}),G&&V(X,G))X=X[_]||X;else{if((oe=he[K])&&oe[0]===O&&oe[1]===Z)return re[2]=oe[2];if(he[K]=re,re[2]=y(X,fe,ne))return!0}return!1}}function An(y){return y.length>1?function(R,P,_){for(var G=y.length;G--;)if(!y[G](R,P,_))return!1;return!0}:y[0]}function To(y,R,P){for(var _=0,G=R.length;_<G;_++)ve(y,R[_],P);return P}function jr(y,R,P,_,G){for(var K,W=[],Z=0,X=y.length,fe=R!=null;Z<X;Z++)(K=y[Z])&&(!P||P(K,_,G))&&(W.push(K),fe&&R.push(Z));return W}function Rn(y,R,P,_,G,K){return _&&!_[k]&&(_=Rn(_)),G&&!G[k]&&(G=Rn(G,K)),We(function(W,Z,X,fe){var ne,oe,he,re,we=[],ke=[],Ne=Z.length,qe=W||To(R||"*",X.nodeType?[X]:X,[]),it=y&&(W||!R)?jr(qe,we,y,X,fe):qe;if(P?(re=G||(W?y:Ne||_)?[]:Z,P(it,re,X,fe)):re=it,_)for(ne=jr(re,ke),_(ne,[],X,fe),oe=ne.length;oe--;)(he=ne[oe])&&(re[ke[oe]]=!(it[ke[oe]]=he));if(W){if(G||y){if(G){for(ne=[],oe=re.length;oe--;)(he=re[oe])&&ne.push(it[oe]=he);G(null,re=[],ne,fe)}for(oe=re.length;oe--;)(he=re[oe])&&(ne=G?x.call(W,he):we[oe])>-1&&(W[ne]=!(Z[ne]=he))}}else re=jr(re===Z?re.splice(Ne,re.length):re),G?G(null,Z,re,fe):h.apply(Z,re)})}function Cn(y){for(var R,P,_,G=y.length,K=n.relative[y[0].type],W=K||n.relative[" "],Z=K?1:0,X=kr(function(oe){return oe===R},W,!0),fe=kr(function(oe){return x.call(R,oe)>-1},W,!0),ne=[function(oe,he,re){var we=!K&&(re||he!=a)||((R=he).nodeType?X(oe,he,re):fe(oe,he,re));return R=null,we}];Z<G;Z++)if(P=n.relative[y[Z].type])ne=[kr(An(ne),P)];else{if(P=n.filter[y[Z].type].apply(null,y[Z].matches),P[k]){for(_=++Z;_<G&&!n.relative[y[_].type];_++);return Rn(Z>1&&An(ne),Z>1&&Gr(y.slice(0,Z-1).concat({value:y[Z-2].type===" "?"*":""})).replace(me,"$1"),P,Z<_&&Cn(y.slice(Z,_)),_<G&&Cn(y=y.slice(_)),_<G&&Gr(y))}ne.push(P)}return An(ne)}function wo(y,R){var P=R.length>0,_=y.length>0,G=function(K,W,Z,X,fe){var ne,oe,he,re=0,we="0",ke=K&&[],Ne=[],qe=a,it=K||_&&n.find.TAG("*",fe),Qt=O+=qe==null?1:Math.random()||.1,Le=it.length;for(fe&&(a=W==g||W||fe);we!==Le&&(ne=it[we])!=null;we++){if(_&&ne){for(oe=0,!W&&ne.ownerDocument!=g&&(Tt(ne),Z=!v);he=y[oe++];)if(he(ne,W||g,Z)){h.call(X,ne);break}fe&&(O=Qt)}P&&((ne=!he&&ne)&&re--,K&&ke.push(ne))}if(re+=we,P&&we!==re){for(oe=0;he=R[oe++];)he(ke,Ne,W,Z);if(K){if(re>0)for(;we--;)ke[we]||Ne[we]||(Ne[we]=$.call(X));Ne=jr(Ne)}h.apply(X,Ne),fe&&!K&&Ne.length>0&&re+R.length>1&&i.uniqueSort(X)}return fe&&(O=Qt,a=qe),ke};return P?We(G):G}function In(y,R){var P,_=[],G=[],K=ue[y+" "];if(!K){for(R||(R=Tr(y)),P=R.length;P--;)K=Cn(R[P]),K[k]?_.push(K):G.push(K);K=ue(y,wo(G,_)),K.selector=y}return K}function Oi(y,R,P,_){var G,K,W,Z,X,fe=typeof y=="function"&&y,ne=!_&&Tr(y=fe.selector||y);if(P=P||[],ne.length===1){if(K=ne[0]=ne[0].slice(0),K.length>2&&(W=K[0]).type==="ID"&&R.nodeType===9&&v&&n.relative[K[1].type]){if(R=(n.find.ID(W.matches[0].replace(pt,gt),R)||[])[0],R)fe&&(R=R.parentNode);else return P;y=y.slice(K.shift().value.length)}for(G=nt.needsContext.test(y)?0:K.length;G--&&(W=K[G],!n.relative[Z=W.type]);)if((X=n.find[Z])&&(_=X(W.matches[0].replace(pt,gt),En.test(K[0].type)&&Sn(R.parentNode)||R))){if(K.splice(G,1),y=_.length&&Gr(K),!y)return h.apply(P,_),P;break}}return(fe||In(y,ne))(_,R,!v,P,!R||En.test(y)&&Sn(R.parentNode)||R),P}A.sortStable=k.split("").sort(Ie).join("")===k,Tt(),A.sortDetached=Zt(function(y){return y.compareDocumentPosition(g.createElement("fieldset"))&1}),i.find=ve,i.expr[":"]=i.expr.pseudos,i.unique=i.uniqueSort,ve.compile=In,ve.select=Oi,ve.setDocument=Tt,ve.tokenize=Tr,ve.escape=i.escapeSelector,ve.getText=i.text,ve.isXML=i.isXMLDoc,ve.selectors=i.expr,ve.support=i.support,ve.uniqueSort=i.uniqueSort})();var Te=function(t,n,a){for(var l=[],f=a!==void 0;(t=t[n])&&t.nodeType!==9;)if(t.nodeType===1){if(f&&i(t).is(a))break;l.push(t)}return l},ft=function(t,n){for(var a=[];t;t=t.nextSibling)t.nodeType===1&&t!==n&&a.push(t);return a},yt=i.expr.match.needsContext,xt=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Ct(t,n,a){return I(n)?i.grep(t,function(l,f){return!!n.call(l,f,l)!==a}):n.nodeType?i.grep(t,function(l){return l===n!==a}):typeof n!="string"?i.grep(t,function(l){return x.call(n,l)>-1!==a}):i.filter(n,t,a)}i.filter=function(t,n,a){var l=n[0];return a&&(t=":not("+t+")"),n.length===1&&l.nodeType===1?i.find.matchesSelector(l,t)?[l]:[]:i.find.matches(t,i.grep(n,function(f){return f.nodeType===1}))},i.fn.extend({find:function(t){var n,a,l=this.length,f=this;if(typeof t!="string")return this.pushStack(i(t).filter(function(){for(n=0;n<l;n++)if(i.contains(f[n],this))return!0}));for(a=this.pushStack([]),n=0;n<l;n++)i.find(t,f[n],a);return l>1?i.uniqueSort(a):a},filter:function(t){return this.pushStack(Ct(this,t||[],!1))},not:function(t){return this.pushStack(Ct(this,t||[],!0))},is:function(t){return!!Ct(this,typeof t=="string"&&yt.test(t)?i(t):t||[],!1).length}});var Ze,ur=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Ye=i.fn.init=function(t,n,a){var l,f;if(!t)return this;if(a=a||Ze,typeof t=="string")if(t[0]==="<"&&t[t.length-1]===">"&&t.length>=3?l=[null,t,null]:l=ur.exec(t),l&&(l[1]||!n))if(l[1]){if(n=n instanceof i?n[0]:n,i.merge(this,i.parseHTML(l[1],n&&n.nodeType?n.ownerDocument||n:m,!0)),xt.test(l[1])&&i.isPlainObject(n))for(l in n)I(this[l])?this[l](n[l]):this.attr(l,n[l]);return this}else return f=m.getElementById(l[2]),f&&(this[0]=f,this.length=1),this;else return!n||n.jquery?(n||a).find(t):this.constructor(n).find(t);else{if(t.nodeType)return this[0]=t,this.length=1,this;if(I(t))return a.ready!==void 0?a.ready(t):t(i)}return i.makeArray(t,this)};Ye.prototype=i.fn,Ze=i(m);var It=/^(?:parents|prev(?:Until|All))/,on={children:!0,contents:!0,next:!0,prev:!0};i.fn.extend({has:function(t){var n=i(t,this),a=n.length;return this.filter(function(){for(var l=0;l<a;l++)if(i.contains(this,n[l]))return!0})},closest:function(t,n){var a,l=0,f=this.length,h=[],g=typeof t!="string"&&i(t);if(!yt.test(t)){for(;l<f;l++)for(a=this[l];a&&a!==n;a=a.parentNode)if(a.nodeType<11&&(g?g.index(a)>-1:a.nodeType===1&&i.find.matchesSelector(a,t))){h.push(a);break}}return this.pushStack(h.length>1?i.uniqueSort(h):h)},index:function(t){return t?typeof t=="string"?x.call(i(t),this[0]):x.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,n){return this.pushStack(i.uniqueSort(i.merge(this.get(),i(t,n))))},addBack:function(t){return this.add(t==null?this.prevObject:this.prevObject.filter(t))}});function lr(t,n){for(;(t=t[n])&&t.nodeType!==1;);return t}i.each({parent:function(t){var n=t.parentNode;return n&&n.nodeType!==11?n:null},parents:function(t){return Te(t,"parentNode")},parentsUntil:function(t,n,a){return Te(t,"parentNode",a)},next:function(t){return lr(t,"nextSibling")},prev:function(t){return lr(t,"previousSibling")},nextAll:function(t){return Te(t,"nextSibling")},prevAll:function(t){return Te(t,"previousSibling")},nextUntil:function(t,n,a){return Te(t,"nextSibling",a)},prevUntil:function(t,n,a){return Te(t,"previousSibling",a)},siblings:function(t){return ft((t.parentNode||{}).firstChild,t)},children:function(t){return ft(t.firstChild)},contents:function(t){return t.contentDocument!=null&&c(t.contentDocument)?t.contentDocument:(V(t,"template")&&(t=t.content||t),i.merge([],t.childNodes))}},function(t,n){i.fn[t]=function(a,l){var f=i.map(this,n,a);return t.slice(-5)!=="Until"&&(l=a),l&&typeof l=="string"&&(f=i.filter(l,f)),this.length>1&&(on[t]||i.uniqueSort(f),It.test(t)&&f.reverse()),this.pushStack(f)}});var Oe=/[^\x20\t\r\n\f]+/g;function As(t){var n={};return i.each(t.match(Oe)||[],function(a,l){n[l]=!0}),n}i.Callbacks=function(t){t=typeof t=="string"?As(t):i.extend({},t);var n,a,l,f,h=[],g=[],w=-1,v=function(){for(f=f||t.once,l=n=!0;g.length;w=-1)for(a=g.shift();++w<h.length;)h[w].apply(a[0],a[1])===!1&&t.stopOnFalse&&(w=h.length,a=!1);t.memory||(a=!1),n=!1,f&&(a?h=[]:h="")},C={add:function(){return h&&(a&&!n&&(w=h.length-1,g.push(a)),function B(k){i.each(k,function(O,z){I(z)?(!t.unique||!C.has(z))&&h.push(z):z&&z.length&&j(z)!=="string"&&B(z)})}(arguments),a&&!n&&v()),this},remove:function(){return i.each(arguments,function(B,k){for(var O;(O=i.inArray(k,h,O))>-1;)h.splice(O,1),O<=w&&w--}),this},has:function(B){return B?i.inArray(B,h)>-1:h.length>0},empty:function(){return h&&(h=[]),this},disable:function(){return f=g=[],h=a="",this},disabled:function(){return!h},lock:function(){return f=g=[],!a&&!n&&(h=a=""),this},locked:function(){return!!f},fireWith:function(B,k){return f||(k=k||[],k=[B,k.slice?k.slice():k],g.push(k),n||v()),this},fire:function(){return C.fireWith(this,arguments),this},fired:function(){return!!l}};return C};function qt(t){return t}function Nr(t){throw t}function Zn(t,n,a,l){var f;try{t&&I(f=t.promise)?f.call(t).done(n).fail(a):t&&I(f=t.then)?f.call(t,n,a):n.apply(void 0,[t].slice(l))}catch(h){a.apply(void 0,[h])}}i.extend({Deferred:function(t){var n=[["notify","progress",i.Callbacks("memory"),i.Callbacks("memory"),2],["resolve","done",i.Callbacks("once memory"),i.Callbacks("once memory"),0,"resolved"],["reject","fail",i.Callbacks("once memory"),i.Callbacks("once memory"),1,"rejected"]],a="pending",l={state:function(){return a},always:function(){return f.done(arguments).fail(arguments),this},catch:function(h){return l.then(null,h)},pipe:function(){var h=arguments;return i.Deferred(function(g){i.each(n,function(w,v){var C=I(h[v[4]])&&h[v[4]];f[v[1]](function(){var B=C&&C.apply(this,arguments);B&&I(B.promise)?B.promise().progress(g.notify).done(g.resolve).fail(g.reject):g[v[0]+"With"](this,C?[B]:arguments)})}),h=null}).promise()},then:function(h,g,w){var v=0;function C(B,k,O,z){return function(){var se=this,ge=arguments,ue=function(){var Ie,et;if(!(B<v)){if(Ie=O.apply(se,ge),Ie===k.promise())throw new TypeError("Thenable self-resolution");et=Ie&&(typeof Ie=="object"||typeof Ie=="function")&&Ie.then,I(et)?z?et.call(Ie,C(v,k,qt,z),C(v,k,Nr,z)):(v++,et.call(Ie,C(v,k,qt,z),C(v,k,Nr,z),C(v,k,qt,k.notifyWith))):(O!==qt&&(se=void 0,ge=[Ie]),(z||k.resolveWith)(se,ge))}},Me=z?ue:function(){try{ue()}catch(Ie){i.Deferred.exceptionHook&&i.Deferred.exceptionHook(Ie,Me.error),B+1>=v&&(O!==Nr&&(se=void 0,ge=[Ie]),k.rejectWith(se,ge))}};B?Me():(i.Deferred.getErrorHook?Me.error=i.Deferred.getErrorHook():i.Deferred.getStackHook&&(Me.error=i.Deferred.getStackHook()),e.setTimeout(Me))}}return i.Deferred(function(B){n[0][3].add(C(0,B,I(w)?w:qt,B.notifyWith)),n[1][3].add(C(0,B,I(h)?h:qt)),n[2][3].add(C(0,B,I(g)?g:Nr))}).promise()},promise:function(h){return h!=null?i.extend(h,l):l}},f={};return i.each(n,function(h,g){var w=g[2],v=g[5];l[g[1]]=w.add,v&&w.add(function(){a=v},n[3-h][2].disable,n[3-h][3].disable,n[0][2].lock,n[0][3].lock),w.add(g[3].fire),f[g[0]]=function(){return f[g[0]+"With"](this===f?void 0:this,arguments),this},f[g[0]+"With"]=w.fireWith}),l.promise(f),t&&t.call(f,f),f},when:function(t){var n=arguments.length,a=n,l=Array(a),f=u.call(arguments),h=i.Deferred(),g=function(w){return function(v){l[w]=this,f[w]=arguments.length>1?u.call(arguments):v,--n||h.resolveWith(l,f)}};if(n<=1&&(Zn(t,h.done(g(a)).resolve,h.reject,!n),h.state()==="pending"||I(f[a]&&f[a].then)))return h.then();for(;a--;)Zn(f[a],g(a),h.reject);return h.promise()}});var Rs=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;i.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&Rs.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},i.readyException=function(t){e.setTimeout(function(){throw t})};var an=i.Deferred();i.fn.ready=function(t){return an.then(t).catch(function(n){i.readyException(n)}),this},i.extend({isReady:!1,readyWait:1,ready:function(t){(t===!0?--i.readyWait:i.isReady)||(i.isReady=!0,!(t!==!0&&--i.readyWait>0)&&an.resolveWith(m,[i]))}}),i.ready.then=an.then;function Or(){m.removeEventListener("DOMContentLoaded",Or),e.removeEventListener("load",Or),i.ready()}m.readyState==="complete"||m.readyState!=="loading"&&!m.documentElement.doScroll?e.setTimeout(i.ready):(m.addEventListener("DOMContentLoaded",Or),e.addEventListener("load",Or));var ht=function(t,n,a,l,f,h,g){var w=0,v=t.length,C=a==null;if(j(a)==="object"){f=!0;for(w in a)ht(t,n,w,a[w],!0,h,g)}else if(l!==void 0&&(f=!0,I(l)||(g=!0),C&&(g?(n.call(t,l),n=null):(C=n,n=function(B,k,O){return C.call(i(B),O)})),n))for(;w<v;w++)n(t[w],a,g?l:l.call(t[w],w,n(t[w],a)));return f?t:C?n.call(t):v?n(t[0],a):h},Cs=/^-ms-/,Is=/-([a-z])/g;function Ms(t,n){return n.toUpperCase()}function Qe(t){return t.replace(Cs,"ms-").replace(Is,Ms)}var fr=function(t){return t.nodeType===1||t.nodeType===9||!+t.nodeType};function hr(){this.expando=i.expando+hr.uid++}hr.uid=1,hr.prototype={cache:function(t){var n=t[this.expando];return n||(n={},fr(t)&&(t.nodeType?t[this.expando]=n:Object.defineProperty(t,this.expando,{value:n,configurable:!0}))),n},set:function(t,n,a){var l,f=this.cache(t);if(typeof n=="string")f[Qe(n)]=a;else for(l in n)f[Qe(l)]=n[l];return f},get:function(t,n){return n===void 0?this.cache(t):t[this.expando]&&t[this.expando][Qe(n)]},access:function(t,n,a){return n===void 0||n&&typeof n=="string"&&a===void 0?this.get(t,n):(this.set(t,n,a),a!==void 0?a:n)},remove:function(t,n){var a,l=t[this.expando];if(l!==void 0){if(n!==void 0)for(Array.isArray(n)?n=n.map(Qe):(n=Qe(n),n=n in l?[n]:n.match(Oe)||[]),a=n.length;a--;)delete l[n[a]];(n===void 0||i.isEmptyObject(l))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var n=t[this.expando];return n!==void 0&&!i.isEmptyObject(n)}};var ee=new hr,Fe=new hr,Ps=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ns=/[A-Z]/g;function Os(t){return t==="true"?!0:t==="false"?!1:t==="null"?null:t===+t+""?+t:Ps.test(t)?JSON.parse(t):t}function Qn(t,n,a){var l;if(a===void 0&&t.nodeType===1)if(l="data-"+n.replace(Ns,"-$&").toLowerCase(),a=t.getAttribute(l),typeof a=="string"){try{a=Os(a)}catch{}Fe.set(t,n,a)}else a=void 0;return a}i.extend({hasData:function(t){return Fe.hasData(t)||ee.hasData(t)},data:function(t,n,a){return Fe.access(t,n,a)},removeData:function(t,n){Fe.remove(t,n)},_data:function(t,n,a){return ee.access(t,n,a)},_removeData:function(t,n){ee.remove(t,n)}}),i.fn.extend({data:function(t,n){var a,l,f,h=this[0],g=h&&h.attributes;if(t===void 0){if(this.length&&(f=Fe.get(h),h.nodeType===1&&!ee.get(h,"hasDataAttrs"))){for(a=g.length;a--;)g[a]&&(l=g[a].name,l.indexOf("data-")===0&&(l=Qe(l.slice(5)),Qn(h,l,f[l])));ee.set(h,"hasDataAttrs",!0)}return f}return typeof t=="object"?this.each(function(){Fe.set(this,t)}):ht(this,function(w){var v;if(h&&w===void 0)return v=Fe.get(h,t),v!==void 0||(v=Qn(h,t),v!==void 0)?v:void 0;this.each(function(){Fe.set(this,t,w)})},null,n,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){Fe.remove(this,t)})}}),i.extend({queue:function(t,n,a){var l;if(t)return n=(n||"fx")+"queue",l=ee.get(t,n),a&&(!l||Array.isArray(a)?l=ee.access(t,n,i.makeArray(a)):l.push(a)),l||[]},dequeue:function(t,n){n=n||"fx";var a=i.queue(t,n),l=a.length,f=a.shift(),h=i._queueHooks(t,n),g=function(){i.dequeue(t,n)};f==="inprogress"&&(f=a.shift(),l--),f&&(n==="fx"&&a.unshift("inprogress"),delete h.stop,f.call(t,g,h)),!l&&h&&h.empty.fire()},_queueHooks:function(t,n){var a=n+"queueHooks";return ee.get(t,a)||ee.access(t,a,{empty:i.Callbacks("once memory").add(function(){ee.remove(t,[n+"queue",a])})})}}),i.fn.extend({queue:function(t,n){var a=2;return typeof t!="string"&&(n=t,t="fx",a--),arguments.length<a?i.queue(this[0],t):n===void 0?this:this.each(function(){var l=i.queue(this,t,n);i._queueHooks(this,t),t==="fx"&&l[0]!=="inprogress"&&i.dequeue(this,t)})},dequeue:function(t){return this.each(function(){i.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,n){var a,l=1,f=i.Deferred(),h=this,g=this.length,w=function(){--l||f.resolveWith(h,[h])};for(typeof t!="string"&&(n=t,t=void 0),t=t||"fx";g--;)a=ee.get(h[g],t+"queueHooks"),a&&a.empty&&(l++,a.empty.add(w));return w(),f.promise(n)}});var ei=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,dr=new RegExp("^(?:([+-])=|)("+ei+")([a-z%]*)$","i"),dt=["Top","Right","Bottom","Left"],Mt=m.documentElement,$t=function(t){return i.contains(t.ownerDocument,t)},Ls={composed:!0};Mt.getRootNode&&($t=function(t){return i.contains(t.ownerDocument,t)||t.getRootNode(Ls)===t.ownerDocument});var Lr=function(t,n){return t=n||t,t.style.display==="none"||t.style.display===""&&$t(t)&&i.css(t,"display")==="none"};function ti(t,n,a,l){var f,h,g=20,w=l?function(){return l.cur()}:function(){return i.css(t,n,"")},v=w(),C=a&&a[3]||(i.cssNumber[n]?"":"px"),B=t.nodeType&&(i.cssNumber[n]||C!=="px"&&+v)&&dr.exec(i.css(t,n));if(B&&B[3]!==C){for(v=v/2,C=C||B[3],B=+v||1;g--;)i.style(t,n,B+C),(1-h)*(1-(h=w()/v||.5))<=0&&(g=0),B=B/h;B=B*2,i.style(t,n,B+C),a=a||[]}return a&&(B=+B||+v||0,f=a[1]?B+(a[1]+1)*a[2]:+a[2],l&&(l.unit=C,l.start=B,l.end=f)),f}var ri={};function _s(t){var n,a=t.ownerDocument,l=t.nodeName,f=ri[l];return f||(n=a.body.appendChild(a.createElement(l)),f=i.css(n,"display"),n.parentNode.removeChild(n),f==="none"&&(f="block"),ri[l]=f,f)}function Yt(t,n){for(var a,l,f=[],h=0,g=t.length;h<g;h++)l=t[h],l.style&&(a=l.style.display,n?(a==="none"&&(f[h]=ee.get(l,"display")||null,f[h]||(l.style.display="")),l.style.display===""&&Lr(l)&&(f[h]=_s(l))):a!=="none"&&(f[h]="none",ee.set(l,"display",a)));for(h=0;h<g;h++)f[h]!=null&&(t[h].style.display=f[h]);return t}i.fn.extend({show:function(){return Yt(this,!0)},hide:function(){return Yt(this)},toggle:function(t){return typeof t=="boolean"?t?this.show():this.hide():this.each(function(){Lr(this)?i(this).show():i(this).hide()})}});var pr=/^(?:checkbox|radio)$/i,ni=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ii=/^$|^module$|\/(?:java|ecma)script/i;(function(){var t=m.createDocumentFragment(),n=t.appendChild(m.createElement("div")),a=m.createElement("input");a.setAttribute("type","radio"),a.setAttribute("checked","checked"),a.setAttribute("name","t"),n.appendChild(a),A.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,n.innerHTML="<textarea>x</textarea>",A.noCloneChecked=!!n.cloneNode(!0).lastChild.defaultValue,n.innerHTML="<option></option>",A.option=!!n.lastChild})();var He={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};He.tbody=He.tfoot=He.colgroup=He.caption=He.thead,He.th=He.td,A.option||(He.optgroup=He.option=[1,"<select multiple='multiple'>","</select>"]);function Ue(t,n){var a;return typeof t.getElementsByTagName<"u"?a=t.getElementsByTagName(n||"*"):typeof t.querySelectorAll<"u"?a=t.querySelectorAll(n||"*"):a=[],n===void 0||n&&V(t,n)?i.merge([t],a):a}function cn(t,n){for(var a=0,l=t.length;a<l;a++)ee.set(t[a],"globalEval",!n||ee.get(n[a],"globalEval"))}var Bs=/<|&#?\w+;/;function si(t,n,a,l,f){for(var h,g,w,v,C,B,k=n.createDocumentFragment(),O=[],z=0,se=t.length;z<se;z++)if(h=t[z],h||h===0)if(j(h)==="object")i.merge(O,h.nodeType?[h]:h);else if(!Bs.test(h))O.push(n.createTextNode(h));else{for(g=g||k.appendChild(n.createElement("div")),w=(ni.exec(h)||["",""])[1].toLowerCase(),v=He[w]||He._default,g.innerHTML=v[1]+i.htmlPrefilter(h)+v[2],B=v[0];B--;)g=g.lastChild;i.merge(O,g.childNodes),g=k.firstChild,g.textContent=""}for(k.textContent="",z=0;h=O[z++];){if(l&&i.inArray(h,l)>-1){f&&f.push(h);continue}if(C=$t(h),g=Ue(k.appendChild(h),"script"),C&&cn(g),a)for(B=0;h=g[B++];)ii.test(h.type||"")&&a.push(h)}return k}var oi=/^([^.]*)(?:\.(.+)|)/;function Kt(){return!0}function Wt(){return!1}function un(t,n,a,l,f,h){var g,w;if(typeof n=="object"){typeof a!="string"&&(l=l||a,a=void 0);for(w in n)un(t,w,a,l,n[w],h);return t}if(l==null&&f==null?(f=a,l=a=void 0):f==null&&(typeof a=="string"?(f=l,l=void 0):(f=l,l=a,a=void 0)),f===!1)f=Wt;else if(!f)return t;return h===1&&(g=f,f=function(v){return i().off(v),g.apply(this,arguments)},f.guid=g.guid||(g.guid=i.guid++)),t.each(function(){i.event.add(this,n,f,l,a)})}i.event={global:{},add:function(t,n,a,l,f){var h,g,w,v,C,B,k,O,z,se,ge,ue=ee.get(t);if(fr(t))for(a.handler&&(h=a,a=h.handler,f=h.selector),f&&i.find.matchesSelector(Mt,f),a.guid||(a.guid=i.guid++),(v=ue.events)||(v=ue.events=Object.create(null)),(g=ue.handle)||(g=ue.handle=function(Me){return typeof i<"u"&&i.event.triggered!==Me.type?i.event.dispatch.apply(t,arguments):void 0}),n=(n||"").match(Oe)||[""],C=n.length;C--;)w=oi.exec(n[C])||[],z=ge=w[1],se=(w[2]||"").split(".").sort(),z&&(k=i.event.special[z]||{},z=(f?k.delegateType:k.bindType)||z,k=i.event.special[z]||{},B=i.extend({type:z,origType:ge,data:l,handler:a,guid:a.guid,selector:f,needsContext:f&&i.expr.match.needsContext.test(f),namespace:se.join(".")},h),(O=v[z])||(O=v[z]=[],O.delegateCount=0,(!k.setup||k.setup.call(t,l,se,g)===!1)&&t.addEventListener&&t.addEventListener(z,g)),k.add&&(k.add.call(t,B),B.handler.guid||(B.handler.guid=a.guid)),f?O.splice(O.delegateCount++,0,B):O.push(B),i.event.global[z]=!0)},remove:function(t,n,a,l,f){var h,g,w,v,C,B,k,O,z,se,ge,ue=ee.hasData(t)&&ee.get(t);if(!(!ue||!(v=ue.events))){for(n=(n||"").match(Oe)||[""],C=n.length;C--;){if(w=oi.exec(n[C])||[],z=ge=w[1],se=(w[2]||"").split(".").sort(),!z){for(z in v)i.event.remove(t,z+n[C],a,l,!0);continue}for(k=i.event.special[z]||{},z=(l?k.delegateType:k.bindType)||z,O=v[z]||[],w=w[2]&&new RegExp("(^|\\.)"+se.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=h=O.length;h--;)B=O[h],(f||ge===B.origType)&&(!a||a.guid===B.guid)&&(!w||w.test(B.namespace))&&(!l||l===B.selector||l==="**"&&B.selector)&&(O.splice(h,1),B.selector&&O.delegateCount--,k.remove&&k.remove.call(t,B));g&&!O.length&&((!k.teardown||k.teardown.call(t,se,ue.handle)===!1)&&i.removeEvent(t,z,ue.handle),delete v[z])}i.isEmptyObject(v)&&ee.remove(t,"handle events")}},dispatch:function(t){var n,a,l,f,h,g,w=new Array(arguments.length),v=i.event.fix(t),C=(ee.get(this,"events")||Object.create(null))[v.type]||[],B=i.event.special[v.type]||{};for(w[0]=v,n=1;n<arguments.length;n++)w[n]=arguments[n];if(v.delegateTarget=this,!(B.preDispatch&&B.preDispatch.call(this,v)===!1)){for(g=i.event.handlers.call(this,v,C),n=0;(f=g[n++])&&!v.isPropagationStopped();)for(v.currentTarget=f.elem,a=0;(h=f.handlers[a++])&&!v.isImmediatePropagationStopped();)(!v.rnamespace||h.namespace===!1||v.rnamespace.test(h.namespace))&&(v.handleObj=h,v.data=h.data,l=((i.event.special[h.origType]||{}).handle||h.handler).apply(f.elem,w),l!==void 0&&(v.result=l)===!1&&(v.preventDefault(),v.stopPropagation()));return B.postDispatch&&B.postDispatch.call(this,v),v.result}},handlers:function(t,n){var a,l,f,h,g,w=[],v=n.delegateCount,C=t.target;if(v&&C.nodeType&&!(t.type==="click"&&t.button>=1)){for(;C!==this;C=C.parentNode||this)if(C.nodeType===1&&!(t.type==="click"&&C.disabled===!0)){for(h=[],g={},a=0;a<v;a++)l=n[a],f=l.selector+" ",g[f]===void 0&&(g[f]=l.needsContext?i(f,this).index(C)>-1:i.find(f,this,null,[C]).length),g[f]&&h.push(l);h.length&&w.push({elem:C,handlers:h})}}return C=this,v<n.length&&w.push({elem:C,handlers:n.slice(v)}),w},addProp:function(t,n){Object.defineProperty(i.Event.prototype,t,{enumerable:!0,configurable:!0,get:I(n)?function(){if(this.originalEvent)return n(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(a){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:a})}})},fix:function(t){return t[i.expando]?t:new i.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var n=this||t;return pr.test(n.type)&&n.click&&V(n,"input")&&_r(n,"click",!0),!1},trigger:function(t){var n=this||t;return pr.test(n.type)&&n.click&&V(n,"input")&&_r(n,"click"),!0},_default:function(t){var n=t.target;return pr.test(n.type)&&n.click&&V(n,"input")&&ee.get(n,"click")||V(n,"a")}},beforeunload:{postDispatch:function(t){t.result!==void 0&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}};function _r(t,n,a){if(!a){ee.get(t,n)===void 0&&i.event.add(t,n,Kt);return}ee.set(t,n,!1),i.event.add(t,n,{namespace:!1,handler:function(l){var f,h=ee.get(this,n);if(l.isTrigger&1&&this[n]){if(h)(i.event.special[n]||{}).delegateType&&l.stopPropagation();else if(h=u.call(arguments),ee.set(this,n,h),this[n](),f=ee.get(this,n),ee.set(this,n,!1),h!==f)return l.stopImmediatePropagation(),l.preventDefault(),f}else h&&(ee.set(this,n,i.event.trigger(h[0],h.slice(1),this)),l.stopPropagation(),l.isImmediatePropagationStopped=Kt)}})}i.removeEvent=function(t,n,a){t.removeEventListener&&t.removeEventListener(n,a)},i.Event=function(t,n){if(!(this instanceof i.Event))return new i.Event(t,n);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.defaultPrevented===void 0&&t.returnValue===!1?Kt:Wt,this.target=t.target&&t.target.nodeType===3?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,n&&i.extend(this,n),this.timeStamp=t&&t.timeStamp||Date.now(),this[i.expando]=!0},i.Event.prototype={constructor:i.Event,isDefaultPrevented:Wt,isPropagationStopped:Wt,isImmediatePropagationStopped:Wt,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Kt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Kt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Kt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},i.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},i.event.addProp),i.each({focus:"focusin",blur:"focusout"},function(t,n){function a(l){if(m.documentMode){var f=ee.get(this,"handle"),h=i.event.fix(l);h.type=l.type==="focusin"?"focus":"blur",h.isSimulated=!0,f(l),h.target===h.currentTarget&&f(h)}else i.event.simulate(n,l.target,i.event.fix(l))}i.event.special[t]={setup:function(){var l;if(_r(this,t,!0),m.documentMode)l=ee.get(this,n),l||this.addEventListener(n,a),ee.set(this,n,(l||0)+1);else return!1},trigger:function(){return _r(this,t),!0},teardown:function(){var l;if(m.documentMode)l=ee.get(this,n)-1,l?ee.set(this,n,l):(this.removeEventListener(n,a),ee.remove(this,n));else return!1},_default:function(l){return ee.get(l.target,t)},delegateType:n},i.event.special[n]={setup:function(){var l=this.ownerDocument||this.document||this,f=m.documentMode?this:l,h=ee.get(f,n);h||(m.documentMode?this.addEventListener(n,a):l.addEventListener(t,a,!0)),ee.set(f,n,(h||0)+1)},teardown:function(){var l=this.ownerDocument||this.document||this,f=m.documentMode?this:l,h=ee.get(f,n)-1;h?ee.set(f,n,h):(m.documentMode?this.removeEventListener(n,a):l.removeEventListener(t,a,!0),ee.remove(f,n))}}}),i.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,n){i.event.special[t]={delegateType:n,bindType:n,handle:function(a){var l,f=this,h=a.relatedTarget,g=a.handleObj;return(!h||h!==f&&!i.contains(f,h))&&(a.type=g.origType,l=g.handler.apply(this,arguments),a.type=n),l}}}),i.fn.extend({on:function(t,n,a,l){return un(this,t,n,a,l)},one:function(t,n,a,l){return un(this,t,n,a,l,1)},off:function(t,n,a){var l,f;if(t&&t.preventDefault&&t.handleObj)return l=t.handleObj,i(t.delegateTarget).off(l.namespace?l.origType+"."+l.namespace:l.origType,l.selector,l.handler),this;if(typeof t=="object"){for(f in t)this.off(f,n,t[f]);return this}return(n===!1||typeof n=="function")&&(a=n,n=void 0),a===!1&&(a=Wt),this.each(function(){i.event.remove(this,t,a,n)})}});var Ds=/<script|<style|<link/i,Fs=/checked\s*(?:[^=]|=\s*.checked.)/i,Us=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function ai(t,n){return V(t,"table")&&V(n.nodeType!==11?n:n.firstChild,"tr")&&i(t).children("tbody")[0]||t}function Gs(t){return t.type=(t.getAttribute("type")!==null)+"/"+t.type,t}function ks(t){return(t.type||"").slice(0,5)==="true/"?t.type=t.type.slice(5):t.removeAttribute("type"),t}function ci(t,n){var a,l,f,h,g,w,v;if(n.nodeType===1){if(ee.hasData(t)&&(h=ee.get(t),v=h.events,v)){ee.remove(n,"handle events");for(f in v)for(a=0,l=v[f].length;a<l;a++)i.event.add(n,f,v[f][a])}Fe.hasData(t)&&(g=Fe.access(t),w=i.extend({},g),Fe.set(n,w))}}function js(t,n){var a=n.nodeName.toLowerCase();a==="input"&&pr.test(t.type)?n.checked=t.checked:(a==="input"||a==="textarea")&&(n.defaultValue=t.defaultValue)}function Xt(t,n,a,l){n=p(n);var f,h,g,w,v,C,B=0,k=t.length,O=k-1,z=n[0],se=I(z);if(se||k>1&&typeof z=="string"&&!A.checkClone&&Fs.test(z))return t.each(function(ge){var ue=t.eq(ge);se&&(n[0]=z.call(this,ge,ue.html())),Xt(ue,n,a,l)});if(k&&(f=si(n,t[0].ownerDocument,!1,t,l),h=f.firstChild,f.childNodes.length===1&&(f=h),h||l)){for(g=i.map(Ue(f,"script"),Gs),w=g.length;B<k;B++)v=f,B!==O&&(v=i.clone(v,!0,!0),w&&i.merge(g,Ue(v,"script"))),a.call(t[B],v,B);if(w)for(C=g[g.length-1].ownerDocument,i.map(g,ks),B=0;B<w;B++)v=g[B],ii.test(v.type||"")&&!ee.access(v,"globalEval")&&i.contains(C,v)&&(v.src&&(v.type||"").toLowerCase()!=="module"?i._evalUrl&&!v.noModule&&i._evalUrl(v.src,{nonce:v.nonce||v.getAttribute("nonce")},C):N(v.textContent.replace(Us,""),v,C))}return t}function ui(t,n,a){for(var l,f=n?i.filter(n,t):t,h=0;(l=f[h])!=null;h++)!a&&l.nodeType===1&&i.cleanData(Ue(l)),l.parentNode&&(a&&$t(l)&&cn(Ue(l,"script")),l.parentNode.removeChild(l));return t}i.extend({htmlPrefilter:function(t){return t},clone:function(t,n,a){var l,f,h,g,w=t.cloneNode(!0),v=$t(t);if(!A.noCloneChecked&&(t.nodeType===1||t.nodeType===11)&&!i.isXMLDoc(t))for(g=Ue(w),h=Ue(t),l=0,f=h.length;l<f;l++)js(h[l],g[l]);if(n)if(a)for(h=h||Ue(t),g=g||Ue(w),l=0,f=h.length;l<f;l++)ci(h[l],g[l]);else ci(t,w);return g=Ue(w,"script"),g.length>0&&cn(g,!v&&Ue(t,"script")),w},cleanData:function(t){for(var n,a,l,f=i.event.special,h=0;(a=t[h])!==void 0;h++)if(fr(a)){if(n=a[ee.expando]){if(n.events)for(l in n.events)f[l]?i.event.remove(a,l):i.removeEvent(a,l,n.handle);a[ee.expando]=void 0}a[Fe.expando]&&(a[Fe.expando]=void 0)}}}),i.fn.extend({detach:function(t){return ui(this,t,!0)},remove:function(t){return ui(this,t)},text:function(t){return ht(this,function(n){return n===void 0?i.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=n)})},null,t,arguments.length)},append:function(){return Xt(this,arguments,function(t){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var n=ai(this,t);n.appendChild(t)}})},prepend:function(){return Xt(this,arguments,function(t){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var n=ai(this,t);n.insertBefore(t,n.firstChild)}})},before:function(){return Xt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return Xt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,n=0;(t=this[n])!=null;n++)t.nodeType===1&&(i.cleanData(Ue(t,!1)),t.textContent="");return this},clone:function(t,n){return t=t??!1,n=n??t,this.map(function(){return i.clone(this,t,n)})},html:function(t){return ht(this,function(n){var a=this[0]||{},l=0,f=this.length;if(n===void 0&&a.nodeType===1)return a.innerHTML;if(typeof n=="string"&&!Ds.test(n)&&!He[(ni.exec(n)||["",""])[1].toLowerCase()]){n=i.htmlPrefilter(n);try{for(;l<f;l++)a=this[l]||{},a.nodeType===1&&(i.cleanData(Ue(a,!1)),a.innerHTML=n);a=0}catch{}}a&&this.empty().append(n)},null,t,arguments.length)},replaceWith:function(){var t=[];return Xt(this,arguments,function(n){var a=this.parentNode;i.inArray(this,t)<0&&(i.cleanData(Ue(this)),a&&a.replaceChild(n,this))},t)}}),i.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,n){i.fn[t]=function(a){for(var l,f=[],h=i(a),g=h.length-1,w=0;w<=g;w++)l=w===g?this:this.clone(!0),i(h[w])[n](l),d.apply(f,l.get());return this.pushStack(f)}});var ln=new RegExp("^("+ei+")(?!px)[a-z%]+$","i"),fn=/^--/,Br=function(t){var n=t.ownerDocument.defaultView;return(!n||!n.opener)&&(n=e),n.getComputedStyle(t)},li=function(t,n,a){var l,f,h={};for(f in n)h[f]=t.style[f],t.style[f]=n[f];l=a.call(t);for(f in n)t.style[f]=h[f];return l},Vs=new RegExp(dt.join("|"),"i");(function(){function t(){if(C){v.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",C.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Mt.appendChild(v).appendChild(C);var B=e.getComputedStyle(C);a=B.top!=="1%",w=n(B.marginLeft)===12,C.style.right="60%",h=n(B.right)===36,l=n(B.width)===36,C.style.position="absolute",f=n(C.offsetWidth/3)===12,Mt.removeChild(v),C=null}}function n(B){return Math.round(parseFloat(B))}var a,l,f,h,g,w,v=m.createElement("div"),C=m.createElement("div");C.style&&(C.style.backgroundClip="content-box",C.cloneNode(!0).style.backgroundClip="",A.clearCloneStyle=C.style.backgroundClip==="content-box",i.extend(A,{boxSizingReliable:function(){return t(),l},pixelBoxStyles:function(){return t(),h},pixelPosition:function(){return t(),a},reliableMarginLeft:function(){return t(),w},scrollboxSize:function(){return t(),f},reliableTrDimensions:function(){var B,k,O,z;return g==null&&(B=m.createElement("table"),k=m.createElement("tr"),O=m.createElement("div"),B.style.cssText="position:absolute;left:-11111px;border-collapse:separate",k.style.cssText="box-sizing:content-box;border:1px solid",k.style.height="1px",O.style.height="9px",O.style.display="block",Mt.appendChild(B).appendChild(k).appendChild(O),z=e.getComputedStyle(k),g=parseInt(z.height,10)+parseInt(z.borderTopWidth,10)+parseInt(z.borderBottomWidth,10)===k.offsetHeight,Mt.removeChild(B)),g}}))})();function gr(t,n,a){var l,f,h,g,w=fn.test(n),v=t.style;return a=a||Br(t),a&&(g=a.getPropertyValue(n)||a[n],w&&g&&(g=g.replace(me,"$1")||void 0),g===""&&!$t(t)&&(g=i.style(t,n)),!A.pixelBoxStyles()&&ln.test(g)&&Vs.test(n)&&(l=v.width,f=v.minWidth,h=v.maxWidth,v.minWidth=v.maxWidth=v.width=g,g=a.width,v.width=l,v.minWidth=f,v.maxWidth=h)),g!==void 0?g+"":g}function fi(t,n){return{get:function(){if(t()){delete this.get;return}return(this.get=n).apply(this,arguments)}}}var hi=["Webkit","Moz","ms"],di=m.createElement("div").style,pi={};function Hs(t){for(var n=t[0].toUpperCase()+t.slice(1),a=hi.length;a--;)if(t=hi[a]+n,t in di)return t}function hn(t){var n=i.cssProps[t]||pi[t];return n||(t in di?t:pi[t]=Hs(t)||t)}var zs=/^(none|table(?!-c[ea]).+)/,qs={position:"absolute",visibility:"hidden",display:"block"},gi={letterSpacing:"0",fontWeight:"400"};function mi(t,n,a){var l=dr.exec(n);return l?Math.max(0,l[2]-(a||0))+(l[3]||"px"):n}function dn(t,n,a,l,f,h){var g=n==="width"?1:0,w=0,v=0,C=0;if(a===(l?"border":"content"))return 0;for(;g<4;g+=2)a==="margin"&&(C+=i.css(t,a+dt[g],!0,f)),l?(a==="content"&&(v-=i.css(t,"padding"+dt[g],!0,f)),a!=="margin"&&(v-=i.css(t,"border"+dt[g]+"Width",!0,f))):(v+=i.css(t,"padding"+dt[g],!0,f),a!=="padding"?v+=i.css(t,"border"+dt[g]+"Width",!0,f):w+=i.css(t,"border"+dt[g]+"Width",!0,f));return!l&&h>=0&&(v+=Math.max(0,Math.ceil(t["offset"+n[0].toUpperCase()+n.slice(1)]-h-v-w-.5))||0),v+C}function yi(t,n,a){var l=Br(t),f=!A.boxSizingReliable()||a,h=f&&i.css(t,"boxSizing",!1,l)==="border-box",g=h,w=gr(t,n,l),v="offset"+n[0].toUpperCase()+n.slice(1);if(ln.test(w)){if(!a)return w;w="auto"}return(!A.boxSizingReliable()&&h||!A.reliableTrDimensions()&&V(t,"tr")||w==="auto"||!parseFloat(w)&&i.css(t,"display",!1,l)==="inline")&&t.getClientRects().length&&(h=i.css(t,"boxSizing",!1,l)==="border-box",g=v in t,g&&(w=t[v])),w=parseFloat(w)||0,w+dn(t,n,a||(h?"border":"content"),g,l,w)+"px"}i.extend({cssHooks:{opacity:{get:function(t,n){if(n){var a=gr(t,"opacity");return a===""?"1":a}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(t,n,a,l){if(!(!t||t.nodeType===3||t.nodeType===8||!t.style)){var f,h,g,w=Qe(n),v=fn.test(n),C=t.style;if(v||(n=hn(w)),g=i.cssHooks[n]||i.cssHooks[w],a!==void 0){if(h=typeof a,h==="string"&&(f=dr.exec(a))&&f[1]&&(a=ti(t,n,f),h="number"),a==null||a!==a)return;h==="number"&&!v&&(a+=f&&f[3]||(i.cssNumber[w]?"":"px")),!A.clearCloneStyle&&a===""&&n.indexOf("background")===0&&(C[n]="inherit"),(!g||!("set"in g)||(a=g.set(t,a,l))!==void 0)&&(v?C.setProperty(n,a):C[n]=a)}else return g&&"get"in g&&(f=g.get(t,!1,l))!==void 0?f:C[n]}},css:function(t,n,a,l){var f,h,g,w=Qe(n),v=fn.test(n);return v||(n=hn(w)),g=i.cssHooks[n]||i.cssHooks[w],g&&"get"in g&&(f=g.get(t,!0,a)),f===void 0&&(f=gr(t,n,l)),f==="normal"&&n in gi&&(f=gi[n]),a===""||a?(h=parseFloat(f),a===!0||isFinite(h)?h||0:f):f}}),i.each(["height","width"],function(t,n){i.cssHooks[n]={get:function(a,l,f){if(l)return zs.test(i.css(a,"display"))&&(!a.getClientRects().length||!a.getBoundingClientRect().width)?li(a,qs,function(){return yi(a,n,f)}):yi(a,n,f)},set:function(a,l,f){var h,g=Br(a),w=!A.scrollboxSize()&&g.position==="absolute",v=w||f,C=v&&i.css(a,"boxSizing",!1,g)==="border-box",B=f?dn(a,n,f,C,g):0;return C&&w&&(B-=Math.ceil(a["offset"+n[0].toUpperCase()+n.slice(1)]-parseFloat(g[n])-dn(a,n,"border",!1,g)-.5)),B&&(h=dr.exec(l))&&(h[3]||"px")!=="px"&&(a.style[n]=l,l=i.css(a,n)),mi(a,l,B)}}}),i.cssHooks.marginLeft=fi(A.reliableMarginLeft,function(t,n){if(n)return(parseFloat(gr(t,"marginLeft"))||t.getBoundingClientRect().left-li(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),i.each({margin:"",padding:"",border:"Width"},function(t,n){i.cssHooks[t+n]={expand:function(a){for(var l=0,f={},h=typeof a=="string"?a.split(" "):[a];l<4;l++)f[t+dt[l]+n]=h[l]||h[l-2]||h[0];return f}},t!=="margin"&&(i.cssHooks[t+n].set=mi)}),i.fn.extend({css:function(t,n){return ht(this,function(a,l,f){var h,g,w={},v=0;if(Array.isArray(l)){for(h=Br(a),g=l.length;v<g;v++)w[l[v]]=i.css(a,l[v],!1,h);return w}return f!==void 0?i.style(a,l,f):i.css(a,l)},t,n,arguments.length>1)}});function Ge(t,n,a,l,f){return new Ge.prototype.init(t,n,a,l,f)}i.Tween=Ge,Ge.prototype={constructor:Ge,init:function(t,n,a,l,f,h){this.elem=t,this.prop=a,this.easing=f||i.easing._default,this.options=n,this.start=this.now=this.cur(),this.end=l,this.unit=h||(i.cssNumber[a]?"":"px")},cur:function(){var t=Ge.propHooks[this.prop];return t&&t.get?t.get(this):Ge.propHooks._default.get(this)},run:function(t){var n,a=Ge.propHooks[this.prop];return this.options.duration?this.pos=n=i.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=n=t,this.now=(this.end-this.start)*n+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),a&&a.set?a.set(this):Ge.propHooks._default.set(this),this}},Ge.prototype.init.prototype=Ge.prototype,Ge.propHooks={_default:{get:function(t){var n;return t.elem.nodeType!==1||t.elem[t.prop]!=null&&t.elem.style[t.prop]==null?t.elem[t.prop]:(n=i.css(t.elem,t.prop,""),!n||n==="auto"?0:n)},set:function(t){i.fx.step[t.prop]?i.fx.step[t.prop](t):t.elem.nodeType===1&&(i.cssHooks[t.prop]||t.elem.style[hn(t.prop)]!=null)?i.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},Ge.propHooks.scrollTop=Ge.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},i.easing={linear:function(t){return t},swing:function(t){return .5-Math.cos(t*Math.PI)/2},_default:"swing"},i.fx=Ge.prototype.init,i.fx.step={};var Jt,Dr,$s=/^(?:toggle|show|hide)$/,Ys=/queueHooks$/;function pn(){Dr&&(m.hidden===!1&&e.requestAnimationFrame?e.requestAnimationFrame(pn):e.setTimeout(pn,i.fx.interval),i.fx.tick())}function xi(){return e.setTimeout(function(){Jt=void 0}),Jt=Date.now()}function Fr(t,n){var a,l=0,f={height:t};for(n=n?1:0;l<4;l+=2-n)a=dt[l],f["margin"+a]=f["padding"+a]=t;return n&&(f.opacity=f.width=t),f}function bi(t,n,a){for(var l,f=(Ke.tweeners[n]||[]).concat(Ke.tweeners["*"]),h=0,g=f.length;h<g;h++)if(l=f[h].call(a,n,t))return l}function Ks(t,n,a){var l,f,h,g,w,v,C,B,k="width"in n||"height"in n,O=this,z={},se=t.style,ge=t.nodeType&&Lr(t),ue=ee.get(t,"fxshow");a.queue||(g=i._queueHooks(t,"fx"),g.unqueued==null&&(g.unqueued=0,w=g.empty.fire,g.empty.fire=function(){g.unqueued||w()}),g.unqueued++,O.always(function(){O.always(function(){g.unqueued--,i.queue(t,"fx").length||g.empty.fire()})}));for(l in n)if(f=n[l],$s.test(f)){if(delete n[l],h=h||f==="toggle",f===(ge?"hide":"show"))if(f==="show"&&ue&&ue[l]!==void 0)ge=!0;else continue;z[l]=ue&&ue[l]||i.style(t,l)}if(v=!i.isEmptyObject(n),!(!v&&i.isEmptyObject(z))){k&&t.nodeType===1&&(a.overflow=[se.overflow,se.overflowX,se.overflowY],C=ue&&ue.display,C==null&&(C=ee.get(t,"display")),B=i.css(t,"display"),B==="none"&&(C?B=C:(Yt([t],!0),C=t.style.display||C,B=i.css(t,"display"),Yt([t]))),(B==="inline"||B==="inline-block"&&C!=null)&&i.css(t,"float")==="none"&&(v||(O.done(function(){se.display=C}),C==null&&(B=se.display,C=B==="none"?"":B)),se.display="inline-block")),a.overflow&&(se.overflow="hidden",O.always(function(){se.overflow=a.overflow[0],se.overflowX=a.overflow[1],se.overflowY=a.overflow[2]})),v=!1;for(l in z)v||(ue?"hidden"in ue&&(ge=ue.hidden):ue=ee.access(t,"fxshow",{display:C}),h&&(ue.hidden=!ge),ge&&Yt([t],!0),O.done(function(){ge||Yt([t]),ee.remove(t,"fxshow");for(l in z)i.style(t,l,z[l])})),v=bi(ge?ue[l]:0,l,O),l in ue||(ue[l]=v.start,ge&&(v.end=v.start,v.start=0))}}function Ws(t,n){var a,l,f,h,g;for(a in t)if(l=Qe(a),f=n[l],h=t[a],Array.isArray(h)&&(f=h[1],h=t[a]=h[0]),a!==l&&(t[l]=h,delete t[a]),g=i.cssHooks[l],g&&"expand"in g){h=g.expand(h),delete t[l];for(a in h)a in t||(t[a]=h[a],n[a]=f)}else n[l]=f}function Ke(t,n,a){var l,f,h=0,g=Ke.prefilters.length,w=i.Deferred().always(function(){delete v.elem}),v=function(){if(f)return!1;for(var k=Jt||xi(),O=Math.max(0,C.startTime+C.duration-k),z=O/C.duration||0,se=1-z,ge=0,ue=C.tweens.length;ge<ue;ge++)C.tweens[ge].run(se);return w.notifyWith(t,[C,se,O]),se<1&&ue?O:(ue||w.notifyWith(t,[C,1,0]),w.resolveWith(t,[C]),!1)},C=w.promise({elem:t,props:i.extend({},n),opts:i.extend(!0,{specialEasing:{},easing:i.easing._default},a),originalProperties:n,originalOptions:a,startTime:Jt||xi(),duration:a.duration,tweens:[],createTween:function(k,O){var z=i.Tween(t,C.opts,k,O,C.opts.specialEasing[k]||C.opts.easing);return C.tweens.push(z),z},stop:function(k){var O=0,z=k?C.tweens.length:0;if(f)return this;for(f=!0;O<z;O++)C.tweens[O].run(1);return k?(w.notifyWith(t,[C,1,0]),w.resolveWith(t,[C,k])):w.rejectWith(t,[C,k]),this}}),B=C.props;for(Ws(B,C.opts.specialEasing);h<g;h++)if(l=Ke.prefilters[h].call(C,t,B,C.opts),l)return I(l.stop)&&(i._queueHooks(C.elem,C.opts.queue).stop=l.stop.bind(l)),l;return i.map(B,bi,C),I(C.opts.start)&&C.opts.start.call(t,C),C.progress(C.opts.progress).done(C.opts.done,C.opts.complete).fail(C.opts.fail).always(C.opts.always),i.fx.timer(i.extend(v,{elem:t,anim:C,queue:C.opts.queue})),C}i.Animation=i.extend(Ke,{tweeners:{"*":[function(t,n){var a=this.createTween(t,n);return ti(a.elem,t,dr.exec(n),a),a}]},tweener:function(t,n){I(t)?(n=t,t=["*"]):t=t.match(Oe);for(var a,l=0,f=t.length;l<f;l++)a=t[l],Ke.tweeners[a]=Ke.tweeners[a]||[],Ke.tweeners[a].unshift(n)},prefilters:[Ks],prefilter:function(t,n){n?Ke.prefilters.unshift(t):Ke.prefilters.push(t)}}),i.speed=function(t,n,a){var l=t&&typeof t=="object"?i.extend({},t):{complete:a||!a&&n||I(t)&&t,duration:t,easing:a&&n||n&&!I(n)&&n};return i.fx.off?l.duration=0:typeof l.duration!="number"&&(l.duration in i.fx.speeds?l.duration=i.fx.speeds[l.duration]:l.duration=i.fx.speeds._default),(l.queue==null||l.queue===!0)&&(l.queue="fx"),l.old=l.complete,l.complete=function(){I(l.old)&&l.old.call(this),l.queue&&i.dequeue(this,l.queue)},l},i.fn.extend({fadeTo:function(t,n,a,l){return this.filter(Lr).css("opacity",0).show().end().animate({opacity:n},t,a,l)},animate:function(t,n,a,l){var f=i.isEmptyObject(t),h=i.speed(n,a,l),g=function(){var w=Ke(this,i.extend({},t),h);(f||ee.get(this,"finish"))&&w.stop(!0)};return g.finish=g,f||h.queue===!1?this.each(g):this.queue(h.queue,g)},stop:function(t,n,a){var l=function(f){var h=f.stop;delete f.stop,h(a)};return typeof t!="string"&&(a=n,n=t,t=void 0),n&&this.queue(t||"fx",[]),this.each(function(){var f=!0,h=t!=null&&t+"queueHooks",g=i.timers,w=ee.get(this);if(h)w[h]&&w[h].stop&&l(w[h]);else for(h in w)w[h]&&w[h].stop&&Ys.test(h)&&l(w[h]);for(h=g.length;h--;)g[h].elem===this&&(t==null||g[h].queue===t)&&(g[h].anim.stop(a),f=!1,g.splice(h,1));(f||!a)&&i.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var n,a=ee.get(this),l=a[t+"queue"],f=a[t+"queueHooks"],h=i.timers,g=l?l.length:0;for(a.finish=!0,i.queue(this,t,[]),f&&f.stop&&f.stop.call(this,!0),n=h.length;n--;)h[n].elem===this&&h[n].queue===t&&(h[n].anim.stop(!0),h.splice(n,1));for(n=0;n<g;n++)l[n]&&l[n].finish&&l[n].finish.call(this);delete a.finish})}}),i.each(["toggle","show","hide"],function(t,n){var a=i.fn[n];i.fn[n]=function(l,f,h){return l==null||typeof l=="boolean"?a.apply(this,arguments):this.animate(Fr(n,!0),l,f,h)}}),i.each({slideDown:Fr("show"),slideUp:Fr("hide"),slideToggle:Fr("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,n){i.fn[t]=function(a,l,f){return this.animate(n,a,l,f)}}),i.timers=[],i.fx.tick=function(){var t,n=0,a=i.timers;for(Jt=Date.now();n<a.length;n++)t=a[n],!t()&&a[n]===t&&a.splice(n--,1);a.length||i.fx.stop(),Jt=void 0},i.fx.timer=function(t){i.timers.push(t),i.fx.start()},i.fx.interval=13,i.fx.start=function(){Dr||(Dr=!0,pn())},i.fx.stop=function(){Dr=null},i.fx.speeds={slow:600,fast:200,_default:400},i.fn.delay=function(t,n){return t=i.fx&&i.fx.speeds[t]||t,n=n||"fx",this.queue(n,function(a,l){var f=e.setTimeout(a,t);l.stop=function(){e.clearTimeout(f)}})},function(){var t=m.createElement("input"),n=m.createElement("select"),a=n.appendChild(m.createElement("option"));t.type="checkbox",A.checkOn=t.value!=="",A.optSelected=a.selected,t=m.createElement("input"),t.value="t",t.type="radio",A.radioValue=t.value==="t"}();var vi,mr=i.expr.attrHandle;i.fn.extend({attr:function(t,n){return ht(this,i.attr,t,n,arguments.length>1)},removeAttr:function(t){return this.each(function(){i.removeAttr(this,t)})}}),i.extend({attr:function(t,n,a){var l,f,h=t.nodeType;if(!(h===3||h===8||h===2)){if(typeof t.getAttribute>"u")return i.prop(t,n,a);if((h!==1||!i.isXMLDoc(t))&&(f=i.attrHooks[n.toLowerCase()]||(i.expr.match.bool.test(n)?vi:void 0)),a!==void 0){if(a===null){i.removeAttr(t,n);return}return f&&"set"in f&&(l=f.set(t,a,n))!==void 0?l:(t.setAttribute(n,a+""),a)}return f&&"get"in f&&(l=f.get(t,n))!==null?l:(l=i.find.attr(t,n),l??void 0)}},attrHooks:{type:{set:function(t,n){if(!A.radioValue&&n==="radio"&&V(t,"input")){var a=t.value;return t.setAttribute("type",n),a&&(t.value=a),n}}}},removeAttr:function(t,n){var a,l=0,f=n&&n.match(Oe);if(f&&t.nodeType===1)for(;a=f[l++];)t.removeAttribute(a)}}),vi={set:function(t,n,a){return n===!1?i.removeAttr(t,a):t.setAttribute(a,a),a}},i.each(i.expr.match.bool.source.match(/\w+/g),function(t,n){var a=mr[n]||i.find.attr;mr[n]=function(l,f,h){var g,w,v=f.toLowerCase();return h||(w=mr[v],mr[v]=g,g=a(l,f,h)!=null?v:null,mr[v]=w),g}});var Xs=/^(?:input|select|textarea|button)$/i,Js=/^(?:a|area)$/i;i.fn.extend({prop:function(t,n){return ht(this,i.prop,t,n,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[i.propFix[t]||t]})}}),i.extend({prop:function(t,n,a){var l,f,h=t.nodeType;if(!(h===3||h===8||h===2))return(h!==1||!i.isXMLDoc(t))&&(n=i.propFix[n]||n,f=i.propHooks[n]),a!==void 0?f&&"set"in f&&(l=f.set(t,a,n))!==void 0?l:t[n]=a:f&&"get"in f&&(l=f.get(t,n))!==null?l:t[n]},propHooks:{tabIndex:{get:function(t){var n=i.find.attr(t,"tabindex");return n?parseInt(n,10):Xs.test(t.nodeName)||Js.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),A.optSelected||(i.propHooks.selected={get:function(t){var n=t.parentNode;return n&&n.parentNode&&n.parentNode.selectedIndex,null},set:function(t){var n=t.parentNode;n&&(n.selectedIndex,n.parentNode&&n.parentNode.selectedIndex)}}),i.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){i.propFix[this.toLowerCase()]=this});function Pt(t){var n=t.match(Oe)||[];return n.join(" ")}function Nt(t){return t.getAttribute&&t.getAttribute("class")||""}function gn(t){return Array.isArray(t)?t:typeof t=="string"?t.match(Oe)||[]:[]}i.fn.extend({addClass:function(t){var n,a,l,f,h,g;return I(t)?this.each(function(w){i(this).addClass(t.call(this,w,Nt(this)))}):(n=gn(t),n.length?this.each(function(){if(l=Nt(this),a=this.nodeType===1&&" "+Pt(l)+" ",a){for(h=0;h<n.length;h++)f=n[h],a.indexOf(" "+f+" ")<0&&(a+=f+" ");g=Pt(a),l!==g&&this.setAttribute("class",g)}}):this)},removeClass:function(t){var n,a,l,f,h,g;return I(t)?this.each(function(w){i(this).removeClass(t.call(this,w,Nt(this)))}):arguments.length?(n=gn(t),n.length?this.each(function(){if(l=Nt(this),a=this.nodeType===1&&" "+Pt(l)+" ",a){for(h=0;h<n.length;h++)for(f=n[h];a.indexOf(" "+f+" ")>-1;)a=a.replace(" "+f+" "," ");g=Pt(a),l!==g&&this.setAttribute("class",g)}}):this):this.attr("class","")},toggleClass:function(t,n){var a,l,f,h,g=typeof t,w=g==="string"||Array.isArray(t);return I(t)?this.each(function(v){i(this).toggleClass(t.call(this,v,Nt(this),n),n)}):typeof n=="boolean"&&w?n?this.addClass(t):this.removeClass(t):(a=gn(t),this.each(function(){if(w)for(h=i(this),f=0;f<a.length;f++)l=a[f],h.hasClass(l)?h.removeClass(l):h.addClass(l);else(t===void 0||g==="boolean")&&(l=Nt(this),l&&ee.set(this,"__className__",l),this.setAttribute&&this.setAttribute("class",l||t===!1?"":ee.get(this,"__className__")||""))}))},hasClass:function(t){var n,a,l=0;for(n=" "+t+" ";a=this[l++];)if(a.nodeType===1&&(" "+Pt(Nt(a))+" ").indexOf(n)>-1)return!0;return!1}});var Zs=/\r/g;i.fn.extend({val:function(t){var n,a,l,f=this[0];return arguments.length?(l=I(t),this.each(function(h){var g;this.nodeType===1&&(l?g=t.call(this,h,i(this).val()):g=t,g==null?g="":typeof g=="number"?g+="":Array.isArray(g)&&(g=i.map(g,function(w){return w==null?"":w+""})),n=i.valHooks[this.type]||i.valHooks[this.nodeName.toLowerCase()],(!n||!("set"in n)||n.set(this,g,"value")===void 0)&&(this.value=g))})):f?(n=i.valHooks[f.type]||i.valHooks[f.nodeName.toLowerCase()],n&&"get"in n&&(a=n.get(f,"value"))!==void 0?a:(a=f.value,typeof a=="string"?a.replace(Zs,""):a??"")):void 0}}),i.extend({valHooks:{option:{get:function(t){var n=i.find.attr(t,"value");return n??Pt(i.text(t))}},select:{get:function(t){var n,a,l,f=t.options,h=t.selectedIndex,g=t.type==="select-one",w=g?null:[],v=g?h+1:f.length;for(h<0?l=v:l=g?h:0;l<v;l++)if(a=f[l],(a.selected||l===h)&&!a.disabled&&(!a.parentNode.disabled||!V(a.parentNode,"optgroup"))){if(n=i(a).val(),g)return n;w.push(n)}return w},set:function(t,n){for(var a,l,f=t.options,h=i.makeArray(n),g=f.length;g--;)l=f[g],(l.selected=i.inArray(i.valHooks.option.get(l),h)>-1)&&(a=!0);return a||(t.selectedIndex=-1),h}}}}),i.each(["radio","checkbox"],function(){i.valHooks[this]={set:function(t,n){if(Array.isArray(n))return t.checked=i.inArray(i(t).val(),n)>-1}},A.checkOn||(i.valHooks[this].get=function(t){return t.getAttribute("value")===null?"on":t.value})});var yr=e.location,Ti={guid:Date.now()},mn=/\?/;i.parseXML=function(t){var n,a;if(!t||typeof t!="string")return null;try{n=new e.DOMParser().parseFromString(t,"text/xml")}catch{}return a=n&&n.getElementsByTagName("parsererror")[0],(!n||a)&&i.error("Invalid XML: "+(a?i.map(a.childNodes,function(l){return l.textContent}).join(`
`):t)),n};var wi=/^(?:focusinfocus|focusoutblur)$/,Ei=function(t){t.stopPropagation()};i.extend(i.event,{trigger:function(t,n,a,l){var f,h,g,w,v,C,B,k,O=[a||m],z=S.call(t,"type")?t.type:t,se=S.call(t,"namespace")?t.namespace.split("."):[];if(h=k=g=a=a||m,!(a.nodeType===3||a.nodeType===8)&&!wi.test(z+i.event.triggered)&&(z.indexOf(".")>-1&&(se=z.split("."),z=se.shift(),se.sort()),v=z.indexOf(":")<0&&"on"+z,t=t[i.expando]?t:new i.Event(z,typeof t=="object"&&t),t.isTrigger=l?2:3,t.namespace=se.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+se.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=a),n=n==null?[t]:i.makeArray(n,[t]),B=i.event.special[z]||{},!(!l&&B.trigger&&B.trigger.apply(a,n)===!1))){if(!l&&!B.noBubble&&!L(a)){for(w=B.delegateType||z,wi.test(w+z)||(h=h.parentNode);h;h=h.parentNode)O.push(h),g=h;g===(a.ownerDocument||m)&&O.push(g.defaultView||g.parentWindow||e)}for(f=0;(h=O[f++])&&!t.isPropagationStopped();)k=h,t.type=f>1?w:B.bindType||z,C=(ee.get(h,"events")||Object.create(null))[t.type]&&ee.get(h,"handle"),C&&C.apply(h,n),C=v&&h[v],C&&C.apply&&fr(h)&&(t.result=C.apply(h,n),t.result===!1&&t.preventDefault());return t.type=z,!l&&!t.isDefaultPrevented()&&(!B._default||B._default.apply(O.pop(),n)===!1)&&fr(a)&&v&&I(a[z])&&!L(a)&&(g=a[v],g&&(a[v]=null),i.event.triggered=z,t.isPropagationStopped()&&k.addEventListener(z,Ei),a[z](),t.isPropagationStopped()&&k.removeEventListener(z,Ei),i.event.triggered=void 0,g&&(a[v]=g)),t.result}},simulate:function(t,n,a){var l=i.extend(new i.Event,a,{type:t,isSimulated:!0});i.event.trigger(l,null,n)}}),i.fn.extend({trigger:function(t,n){return this.each(function(){i.event.trigger(t,n,this)})},triggerHandler:function(t,n){var a=this[0];if(a)return i.event.trigger(t,n,a,!0)}});var Qs=/\[\]$/,Si=/\r?\n/g,eo=/^(?:submit|button|image|reset|file)$/i,to=/^(?:input|select|textarea|keygen)/i;function yn(t,n,a,l){var f;if(Array.isArray(n))i.each(n,function(h,g){a||Qs.test(t)?l(t,g):yn(t+"["+(typeof g=="object"&&g!=null?h:"")+"]",g,a,l)});else if(!a&&j(n)==="object")for(f in n)yn(t+"["+f+"]",n[f],a,l);else l(t,n)}i.param=function(t,n){var a,l=[],f=function(h,g){var w=I(g)?g():g;l[l.length]=encodeURIComponent(h)+"="+encodeURIComponent(w??"")};if(t==null)return"";if(Array.isArray(t)||t.jquery&&!i.isPlainObject(t))i.each(t,function(){f(this.name,this.value)});else for(a in t)yn(a,t[a],n,f);return l.join("&")},i.fn.extend({serialize:function(){return i.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=i.prop(this,"elements");return t?i.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!i(this).is(":disabled")&&to.test(this.nodeName)&&!eo.test(t)&&(this.checked||!pr.test(t))}).map(function(t,n){var a=i(this).val();return a==null?null:Array.isArray(a)?i.map(a,function(l){return{name:n.name,value:l.replace(Si,`\r
`)}}):{name:n.name,value:a.replace(Si,`\r
`)}}).get()}});var ro=/%20/g,no=/#.*$/,io=/([?&])_=[^&]*/,so=/^(.*?):[ \t]*([^\r\n]*)$/mg,oo=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ao=/^(?:GET|HEAD)$/,co=/^\/\//,Ai={},xn={},Ri="*/".concat("*"),bn=m.createElement("a");bn.href=yr.href;function Ci(t){return function(n,a){typeof n!="string"&&(a=n,n="*");var l,f=0,h=n.toLowerCase().match(Oe)||[];if(I(a))for(;l=h[f++];)l[0]==="+"?(l=l.slice(1)||"*",(t[l]=t[l]||[]).unshift(a)):(t[l]=t[l]||[]).push(a)}}function Ii(t,n,a,l){var f={},h=t===xn;function g(w){var v;return f[w]=!0,i.each(t[w]||[],function(C,B){var k=B(n,a,l);if(typeof k=="string"&&!h&&!f[k])return n.dataTypes.unshift(k),g(k),!1;if(h)return!(v=k)}),v}return g(n.dataTypes[0])||!f["*"]&&g("*")}function vn(t,n){var a,l,f=i.ajaxSettings.flatOptions||{};for(a in n)n[a]!==void 0&&((f[a]?t:l||(l={}))[a]=n[a]);return l&&i.extend(!0,t,l),t}function uo(t,n,a){for(var l,f,h,g,w=t.contents,v=t.dataTypes;v[0]==="*";)v.shift(),l===void 0&&(l=t.mimeType||n.getResponseHeader("Content-Type"));if(l){for(f in w)if(w[f]&&w[f].test(l)){v.unshift(f);break}}if(v[0]in a)h=v[0];else{for(f in a){if(!v[0]||t.converters[f+" "+v[0]]){h=f;break}g||(g=f)}h=h||g}if(h)return h!==v[0]&&v.unshift(h),a[h]}function lo(t,n,a,l){var f,h,g,w,v,C={},B=t.dataTypes.slice();if(B[1])for(g in t.converters)C[g.toLowerCase()]=t.converters[g];for(h=B.shift();h;)if(t.responseFields[h]&&(a[t.responseFields[h]]=n),!v&&l&&t.dataFilter&&(n=t.dataFilter(n,t.dataType)),v=h,h=B.shift(),h){if(h==="*")h=v;else if(v!=="*"&&v!==h){if(g=C[v+" "+h]||C["* "+h],!g){for(f in C)if(w=f.split(" "),w[1]===h&&(g=C[v+" "+w[0]]||C["* "+w[0]],g)){g===!0?g=C[f]:C[f]!==!0&&(h=w[0],B.unshift(w[1]));break}}if(g!==!0)if(g&&t.throws)n=g(n);else try{n=g(n)}catch(k){return{state:"parsererror",error:g?k:"No conversion from "+v+" to "+h}}}}return{state:"success",data:n}}i.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yr.href,type:"GET",isLocal:oo.test(yr.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ri,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":i.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,n){return n?vn(vn(t,i.ajaxSettings),n):vn(i.ajaxSettings,t)},ajaxPrefilter:Ci(Ai),ajaxTransport:Ci(xn),ajax:function(t,n){typeof t=="object"&&(n=t,t=void 0),n=n||{};var a,l,f,h,g,w,v,C,B,k,O=i.ajaxSetup({},n),z=O.context||O,se=O.context&&(z.nodeType||z.jquery)?i(z):i.event,ge=i.Deferred(),ue=i.Callbacks("once memory"),Me=O.statusCode||{},Ie={},et={},tt="canceled",de={readyState:0,getResponseHeader:function(ye){var Re;if(v){if(!h)for(h={};Re=so.exec(f);)h[Re[1].toLowerCase()+" "]=(h[Re[1].toLowerCase()+" "]||[]).concat(Re[2]);Re=h[ye.toLowerCase()+" "]}return Re==null?null:Re.join(", ")},getAllResponseHeaders:function(){return v?f:null},setRequestHeader:function(ye,Re){return v==null&&(ye=et[ye.toLowerCase()]=et[ye.toLowerCase()]||ye,Ie[ye]=Re),this},overrideMimeType:function(ye){return v==null&&(O.mimeType=ye),this},statusCode:function(ye){var Re;if(ye)if(v)de.always(ye[de.status]);else for(Re in ye)Me[Re]=[Me[Re],ye[Re]];return this},abort:function(ye){var Re=ye||tt;return a&&a.abort(Re),Ot(0,Re),this}};if(ge.promise(de),O.url=((t||O.url||yr.href)+"").replace(co,yr.protocol+"//"),O.type=n.method||n.type||O.method||O.type,O.dataTypes=(O.dataType||"*").toLowerCase().match(Oe)||[""],O.crossDomain==null){w=m.createElement("a");try{w.href=O.url,w.href=w.href,O.crossDomain=bn.protocol+"//"+bn.host!=w.protocol+"//"+w.host}catch{O.crossDomain=!0}}if(O.data&&O.processData&&typeof O.data!="string"&&(O.data=i.param(O.data,O.traditional)),Ii(Ai,O,n,de),v)return de;C=i.event&&O.global,C&&i.active++===0&&i.event.trigger("ajaxStart"),O.type=O.type.toUpperCase(),O.hasContent=!ao.test(O.type),l=O.url.replace(no,""),O.hasContent?O.data&&O.processData&&(O.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(O.data=O.data.replace(ro,"+")):(k=O.url.slice(l.length),O.data&&(O.processData||typeof O.data=="string")&&(l+=(mn.test(l)?"&":"?")+O.data,delete O.data),O.cache===!1&&(l=l.replace(io,"$1"),k=(mn.test(l)?"&":"?")+"_="+Ti.guid+++k),O.url=l+k),O.ifModified&&(i.lastModified[l]&&de.setRequestHeader("If-Modified-Since",i.lastModified[l]),i.etag[l]&&de.setRequestHeader("If-None-Match",i.etag[l])),(O.data&&O.hasContent&&O.contentType!==!1||n.contentType)&&de.setRequestHeader("Content-Type",O.contentType),de.setRequestHeader("Accept",O.dataTypes[0]&&O.accepts[O.dataTypes[0]]?O.accepts[O.dataTypes[0]]+(O.dataTypes[0]!=="*"?", "+Ri+"; q=0.01":""):O.accepts["*"]);for(B in O.headers)de.setRequestHeader(B,O.headers[B]);if(O.beforeSend&&(O.beforeSend.call(z,de,O)===!1||v))return de.abort();if(tt="abort",ue.add(O.complete),de.done(O.success),de.fail(O.error),a=Ii(xn,O,n,de),!a)Ot(-1,"No Transport");else{if(de.readyState=1,C&&se.trigger("ajaxSend",[de,O]),v)return de;O.async&&O.timeout>0&&(g=e.setTimeout(function(){de.abort("timeout")},O.timeout));try{v=!1,a.send(Ie,Ot)}catch(ye){if(v)throw ye;Ot(-1,ye)}}function Ot(ye,Re,br,wn){var rt,vr,nt,bt,vt,ze=Re;v||(v=!0,g&&e.clearTimeout(g),a=void 0,f=wn||"",de.readyState=ye>0?4:0,rt=ye>=200&&ye<300||ye===304,br&&(bt=uo(O,de,br)),!rt&&i.inArray("script",O.dataTypes)>-1&&i.inArray("json",O.dataTypes)<0&&(O.converters["text script"]=function(){}),bt=lo(O,bt,de,rt),rt?(O.ifModified&&(vt=de.getResponseHeader("Last-Modified"),vt&&(i.lastModified[l]=vt),vt=de.getResponseHeader("etag"),vt&&(i.etag[l]=vt)),ye===204||O.type==="HEAD"?ze="nocontent":ye===304?ze="notmodified":(ze=bt.state,vr=bt.data,nt=bt.error,rt=!nt)):(nt=ze,(ye||!ze)&&(ze="error",ye<0&&(ye=0))),de.status=ye,de.statusText=(Re||ze)+"",rt?ge.resolveWith(z,[vr,ze,de]):ge.rejectWith(z,[de,ze,nt]),de.statusCode(Me),Me=void 0,C&&se.trigger(rt?"ajaxSuccess":"ajaxError",[de,O,rt?vr:nt]),ue.fireWith(z,[de,ze]),C&&(se.trigger("ajaxComplete",[de,O]),--i.active||i.event.trigger("ajaxStop")))}return de},getJSON:function(t,n,a){return i.get(t,n,a,"json")},getScript:function(t,n){return i.get(t,void 0,n,"script")}}),i.each(["get","post"],function(t,n){i[n]=function(a,l,f,h){return I(l)&&(h=h||f,f=l,l=void 0),i.ajax(i.extend({url:a,type:n,dataType:h,data:l,success:f},i.isPlainObject(a)&&a))}}),i.ajaxPrefilter(function(t){var n;for(n in t.headers)n.toLowerCase()==="content-type"&&(t.contentType=t.headers[n]||"")}),i._evalUrl=function(t,n,a){return i.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(l){i.globalEval(l,n,a)}})},i.fn.extend({wrapAll:function(t){var n;return this[0]&&(I(t)&&(t=t.call(this[0])),n=i(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&n.insertBefore(this[0]),n.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(t){return I(t)?this.each(function(n){i(this).wrapInner(t.call(this,n))}):this.each(function(){var n=i(this),a=n.contents();a.length?a.wrapAll(t):n.append(t)})},wrap:function(t){var n=I(t);return this.each(function(a){i(this).wrapAll(n?t.call(this,a):t)})},unwrap:function(t){return this.parent(t).not("body").each(function(){i(this).replaceWith(this.childNodes)}),this}}),i.expr.pseudos.hidden=function(t){return!i.expr.pseudos.visible(t)},i.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},i.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch{}};var fo={0:200,1223:204},xr=i.ajaxSettings.xhr();A.cors=!!xr&&"withCredentials"in xr,A.ajax=xr=!!xr,i.ajaxTransport(function(t){var n,a;if(A.cors||xr&&!t.crossDomain)return{send:function(l,f){var h,g=t.xhr();if(g.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(h in t.xhrFields)g[h]=t.xhrFields[h];t.mimeType&&g.overrideMimeType&&g.overrideMimeType(t.mimeType),!t.crossDomain&&!l["X-Requested-With"]&&(l["X-Requested-With"]="XMLHttpRequest");for(h in l)g.setRequestHeader(h,l[h]);n=function(w){return function(){n&&(n=a=g.onload=g.onerror=g.onabort=g.ontimeout=g.onreadystatechange=null,w==="abort"?g.abort():w==="error"?typeof g.status!="number"?f(0,"error"):f(g.status,g.statusText):f(fo[g.status]||g.status,g.statusText,(g.responseType||"text")!=="text"||typeof g.responseText!="string"?{binary:g.response}:{text:g.responseText},g.getAllResponseHeaders()))}},g.onload=n(),a=g.onerror=g.ontimeout=n("error"),g.onabort!==void 0?g.onabort=a:g.onreadystatechange=function(){g.readyState===4&&e.setTimeout(function(){n&&a()})},n=n("abort");try{g.send(t.hasContent&&t.data||null)}catch(w){if(n)throw w}},abort:function(){n&&n()}}}),i.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),i.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return i.globalEval(t),t}}}),i.ajaxPrefilter("script",function(t){t.cache===void 0&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),i.ajaxTransport("script",function(t){if(t.crossDomain||t.scriptAttrs){var n,a;return{send:function(l,f){n=i("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",a=function(h){n.remove(),a=null,h&&f(h.type==="error"?404:200,h.type)}),m.head.appendChild(n[0])},abort:function(){a&&a()}}}});var Mi=[],Tn=/(=)\?(?=&|$)|\?\?/;i.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Mi.pop()||i.expando+"_"+Ti.guid++;return this[t]=!0,t}}),i.ajaxPrefilter("json jsonp",function(t,n,a){var l,f,h,g=t.jsonp!==!1&&(Tn.test(t.url)?"url":typeof t.data=="string"&&(t.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Tn.test(t.data)&&"data");if(g||t.dataTypes[0]==="jsonp")return l=t.jsonpCallback=I(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,g?t[g]=t[g].replace(Tn,"$1"+l):t.jsonp!==!1&&(t.url+=(mn.test(t.url)?"&":"?")+t.jsonp+"="+l),t.converters["script json"]=function(){return h||i.error(l+" was not called"),h[0]},t.dataTypes[0]="json",f=e[l],e[l]=function(){h=arguments},a.always(function(){f===void 0?i(e).removeProp(l):e[l]=f,t[l]&&(t.jsonpCallback=n.jsonpCallback,Mi.push(l)),h&&I(f)&&f(h[0]),h=f=void 0}),"script"}),A.createHTMLDocument=function(){var t=m.implementation.createHTMLDocument("").body;return t.innerHTML="<form></form><form></form>",t.childNodes.length===2}(),i.parseHTML=function(t,n,a){if(typeof t!="string")return[];typeof n=="boolean"&&(a=n,n=!1);var l,f,h;return n||(A.createHTMLDocument?(n=m.implementation.createHTMLDocument(""),l=n.createElement("base"),l.href=m.location.href,n.head.appendChild(l)):n=m),f=xt.exec(t),h=!a&&[],f?[n.createElement(f[1])]:(f=si([t],n,h),h&&h.length&&i(h).remove(),i.merge([],f.childNodes))},i.fn.load=function(t,n,a){var l,f,h,g=this,w=t.indexOf(" ");return w>-1&&(l=Pt(t.slice(w)),t=t.slice(0,w)),I(n)?(a=n,n=void 0):n&&typeof n=="object"&&(f="POST"),g.length>0&&i.ajax({url:t,type:f||"GET",dataType:"html",data:n}).done(function(v){h=arguments,g.html(l?i("<div>").append(i.parseHTML(v)).find(l):v)}).always(a&&function(v,C){g.each(function(){a.apply(this,h||[v.responseText,C,v])})}),this},i.expr.pseudos.animated=function(t){return i.grep(i.timers,function(n){return t===n.elem}).length},i.offset={setOffset:function(t,n,a){var l,f,h,g,w,v,C,B=i.css(t,"position"),k=i(t),O={};B==="static"&&(t.style.position="relative"),w=k.offset(),h=i.css(t,"top"),v=i.css(t,"left"),C=(B==="absolute"||B==="fixed")&&(h+v).indexOf("auto")>-1,C?(l=k.position(),g=l.top,f=l.left):(g=parseFloat(h)||0,f=parseFloat(v)||0),I(n)&&(n=n.call(t,a,i.extend({},w))),n.top!=null&&(O.top=n.top-w.top+g),n.left!=null&&(O.left=n.left-w.left+f),"using"in n?n.using.call(t,O):k.css(O)}},i.fn.extend({offset:function(t){if(arguments.length)return t===void 0?this:this.each(function(f){i.offset.setOffset(this,t,f)});var n,a,l=this[0];if(l)return l.getClientRects().length?(n=l.getBoundingClientRect(),a=l.ownerDocument.defaultView,{top:n.top+a.pageYOffset,left:n.left+a.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var t,n,a,l=this[0],f={top:0,left:0};if(i.css(l,"position")==="fixed")n=l.getBoundingClientRect();else{for(n=this.offset(),a=l.ownerDocument,t=l.offsetParent||a.documentElement;t&&(t===a.body||t===a.documentElement)&&i.css(t,"position")==="static";)t=t.parentNode;t&&t!==l&&t.nodeType===1&&(f=i(t).offset(),f.top+=i.css(t,"borderTopWidth",!0),f.left+=i.css(t,"borderLeftWidth",!0))}return{top:n.top-f.top-i.css(l,"marginTop",!0),left:n.left-f.left-i.css(l,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&i.css(t,"position")==="static";)t=t.offsetParent;return t||Mt})}}),i.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var a=n==="pageYOffset";i.fn[t]=function(l){return ht(this,function(f,h,g){var w;if(L(f)?w=f:f.nodeType===9&&(w=f.defaultView),g===void 0)return w?w[n]:f[h];w?w.scrollTo(a?w.pageXOffset:g,a?g:w.pageYOffset):f[h]=g},t,l,arguments.length)}}),i.each(["top","left"],function(t,n){i.cssHooks[n]=fi(A.pixelPosition,function(a,l){if(l)return l=gr(a,n),ln.test(l)?i(a).position()[n]+"px":l})}),i.each({Height:"height",Width:"width"},function(t,n){i.each({padding:"inner"+t,content:n,"":"outer"+t},function(a,l){i.fn[l]=function(f,h){var g=arguments.length&&(a||typeof f!="boolean"),w=a||(f===!0||h===!0?"margin":"border");return ht(this,function(v,C,B){var k;return L(v)?l.indexOf("outer")===0?v["inner"+t]:v.document.documentElement["client"+t]:v.nodeType===9?(k=v.documentElement,Math.max(v.body["scroll"+t],k["scroll"+t],v.body["offset"+t],k["offset"+t],k["client"+t])):B===void 0?i.css(v,C,w):i.style(v,C,B,w)},n,g?f:void 0,g)}})}),i.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,n){i.fn[n]=function(a){return this.on(n,a)}}),i.fn.extend({bind:function(t,n,a){return this.on(t,null,n,a)},unbind:function(t,n){return this.off(t,null,n)},delegate:function(t,n,a,l){return this.on(n,t,a,l)},undelegate:function(t,n,a){return arguments.length===1?this.off(t,"**"):this.off(n,t||"**",a)},hover:function(t,n){return this.on("mouseenter",t).on("mouseleave",n||t)}}),i.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,n){i.fn[n]=function(a,l){return arguments.length>0?this.on(n,null,a,l):this.trigger(n)}});var ho=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;i.proxy=function(t,n){var a,l,f;if(typeof n=="string"&&(a=t[n],n=t,t=a),!!I(t))return l=u.call(arguments,2),f=function(){return t.apply(n||this,l.concat(u.call(arguments)))},f.guid=t.guid=t.guid||i.guid++,f},i.holdReady=function(t){t?i.readyWait++:i.ready(!0)},i.isArray=Array.isArray,i.parseJSON=JSON.parse,i.nodeName=V,i.isFunction=I,i.isWindow=L,i.camelCase=Qe,i.type=j,i.now=Date.now,i.isNumeric=function(t){var n=i.type(t);return(n==="number"||n==="string")&&!isNaN(t-parseFloat(t))},i.trim=function(t){return t==null?"":(t+"").replace(ho,"$1")};var po=e.jQuery,go=e.$;return i.noConflict=function(t){return e.$===i&&(e.$=go),t&&e.jQuery===i&&(e.jQuery=po),i},typeof r>"u"&&(e.jQuery=e.$=i),i})}(Yr)),Yr.exports}var Io=Co();const _i=Ao(Io);var Mn=1e-6,sr=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});function Wr(){var s=new sr(16);return sr!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s}function Qi(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Mo(s,e,r){var o=r[0],c=r[1],u=r[2],p,d,x,b,T,S,M,E,A,I,L,m;return e===s?(s[12]=e[0]*o+e[4]*c+e[8]*u+e[12],s[13]=e[1]*o+e[5]*c+e[9]*u+e[13],s[14]=e[2]*o+e[6]*c+e[10]*u+e[14],s[15]=e[3]*o+e[7]*c+e[11]*u+e[15]):(p=e[0],d=e[1],x=e[2],b=e[3],T=e[4],S=e[5],M=e[6],E=e[7],A=e[8],I=e[9],L=e[10],m=e[11],s[0]=p,s[1]=d,s[2]=x,s[3]=b,s[4]=T,s[5]=S,s[6]=M,s[7]=E,s[8]=A,s[9]=I,s[10]=L,s[11]=m,s[12]=p*o+T*c+A*u+e[12],s[13]=d*o+S*c+I*u+e[13],s[14]=x*o+M*c+L*u+e[14],s[15]=b*o+E*c+m*u+e[15]),s}function Po(s,e,r){var o=r[0],c=r[1],u=r[2];return s[0]=e[0]*o,s[1]=e[1]*o,s[2]=e[2]*o,s[3]=e[3]*o,s[4]=e[4]*c,s[5]=e[5]*c,s[6]=e[6]*c,s[7]=e[7]*c,s[8]=e[8]*u,s[9]=e[9]*u,s[10]=e[10]*u,s[11]=e[11]*u,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s}function No(s,e,r){var o=Math.sin(r),c=Math.cos(r),u=e[4],p=e[5],d=e[6],x=e[7],b=e[8],T=e[9],S=e[10],M=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=u*c+b*o,s[5]=p*c+T*o,s[6]=d*c+S*o,s[7]=x*c+M*o,s[8]=b*c-u*o,s[9]=T*c-p*o,s[10]=S*c-d*o,s[11]=M*c-x*o,s}function Oo(s,e,r){var o=Math.sin(r),c=Math.cos(r),u=e[0],p=e[1],d=e[2],x=e[3],b=e[8],T=e[9],S=e[10],M=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=u*c-b*o,s[1]=p*c-T*o,s[2]=d*c-S*o,s[3]=x*c-M*o,s[8]=u*o+b*c,s[9]=p*o+T*c,s[10]=d*o+S*c,s[11]=x*o+M*c,s}function Lo(s,e,r){var o=Math.sin(r),c=Math.cos(r),u=e[0],p=e[1],d=e[2],x=e[3],b=e[4],T=e[5],S=e[6],M=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=u*c+b*o,s[1]=p*c+T*o,s[2]=d*c+S*o,s[3]=x*c+M*o,s[4]=b*c-u*o,s[5]=T*c-p*o,s[6]=S*c-d*o,s[7]=M*c-x*o,s}function _o(s,e,r,o,c){var u=1/Math.tan(e/2),p;return s[0]=u/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=u,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,c!=null&&c!==1/0?(p=1/(o-c),s[10]=(c+o)*p,s[14]=2*c*o*p):(s[10]=-1,s[14]=-2*o),s}var Bi=_o;function Bo(s,e,r,o){var c,u,p,d,x,b,T,S,M,E,A=e[0],I=e[1],L=e[2],m=o[0],F=o[1],N=o[2],j=r[0],U=r[1],H=r[2];return Math.abs(A-j)<Mn&&Math.abs(I-U)<Mn&&Math.abs(L-H)<Mn?Qi(s):(T=A-j,S=I-U,M=L-H,E=1/Math.hypot(T,S,M),T*=E,S*=E,M*=E,c=F*M-N*S,u=N*T-m*M,p=m*S-F*T,E=Math.hypot(c,u,p),E?(E=1/E,c*=E,u*=E,p*=E):(c=0,u=0,p=0),d=S*p-M*u,x=M*c-T*p,b=T*u-S*c,E=Math.hypot(d,x,b),E?(E=1/E,d*=E,x*=E,b*=E):(d=0,x=0,b=0),s[0]=c,s[1]=d,s[2]=T,s[3]=0,s[4]=u,s[5]=x,s[6]=S,s[7]=0,s[8]=p,s[9]=b,s[10]=M,s[11]=0,s[12]=-(c*A+u*I+p*L),s[13]=-(d*A+x*I+b*L),s[14]=-(T*A+S*I+M*L),s[15]=1,s)}function tr(){var s=new sr(3);return sr!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Bt(s){var e=new sr(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e}function Se(s,e,r){var o=new sr(3);return o[0]=s,o[1]=e,o[2]=r,o}function Pn(s,e,r,o){return s[0]=e,s[1]=r,s[2]=o,s}function Do(s,e,r){return s[0]=e[0]+r[0],s[1]=e[1]+r[1],s[2]=e[2]+r[2],s}function Nn(s,e,r,o){return s[0]=e[0]+r[0]*o,s[1]=e[1]+r[1]*o,s[2]=e[2]+r[2]*o,s}function Di(s,e,r){var o=e[0],c=e[1],u=e[2],p=r[0],d=r[1],x=r[2];return s[0]=c*x-u*d,s[1]=u*p-o*x,s[2]=o*d-c*p,s}(function(){var s=tr();return function(e,r,o,c,u,p){var d,x;for(r||(r=3),o||(o=0),c?x=Math.min(c*r+o,e.length):x=e.length,d=o;d<x;d+=r)s[0]=e[d],s[1]=e[d+1],s[2]=e[d+2],u(s,s,p),e[d]=s[0],e[d+1]=s[1],e[d+2]=s[2];return e}})();const Fi=`

struct TransformData{
    view: mat4x4<f32>,
    projection: mat4x4<f32>,
};

struct ObjectData{
    model: array<mat4x4<f32>>
}

@binding(0) @group(0) var<uniform> transformUBO: TransformData;
@binding(1) @group(0) var<storage,read> objects: ObjectData;

@binding(0) @group(1) var myTexture: texture_2d<f32>;
@binding(1) @group(1) var mySampler: sampler;

struct Fragment{
    @builtin(position) Position: vec4<f32>,
    @location(0) TexCoord: vec2<f32>,
};

@vertex
fn vs_main(
    @builtin(instance_index) ID: u32,
    @location(0) vertexPosition: vec3<f32>, 
    @location(1) vertexTexCoord: vec2<f32>) -> Fragment {

    var output : Fragment;
    output.Position = transformUBO.projection * transformUBO.view * objects.model[ID] * vec4<f32>(vertexPosition, 1.0);
    output.TexCoord = vertexTexCoord;
    
    return output;
}

@fragment
fn fs_main(@location(0) TexCoord: vec2<f32>) -> @location(0) vec4<f32>{
    let textureColor = textureSample(myTexture, mySampler, TexCoord);
    return textureColor;
}


`,Ui=`struct TransformData {
  view: mat4x4<f32>,
  projection: mat4x4<f32>,
};

struct ObjectData {
  model: array<mat4x4<f32>>
};

@group(0) @binding(0) var<uniform> transformUBO: TransformData;
@group(0) @binding(1) var<storage, read> objects: ObjectData;

@group(1) @binding(0) var myTexture: texture_2d<f32>;
@group(1) @binding(1) var mySampler: sampler;

struct VSOut {
  @builtin(position) Position: vec4<f32>,
  @location(0) TexCoord: vec2<f32>,
};

@vertex
fn vs_main(
  @builtin(instance_index) ID: u32,
  @location(0) vertexPosition: vec3<f32>,
  @location(1) vertexTexCoord: vec2<f32>
) -> VSOut {
  let model = objects.model[ID];

  // World-space center from model translation
  let centerWS = vec3<f32>(model[3].x, model[3].y, model[3].z);

  let sx = length(vec3<f32>(model[0].x, model[0].y, model[0].z));
  let sy = length(vec3<f32>(model[1].x, model[1].y, model[1].z));
  let v = transformUBO.view;

// Camera direction
  let rightWS = normalize(vec3<f32>(v[0].x, v[1].x, v[2].x));
  let upWS    = normalize(vec3<f32>(v[0].y, v[1].y, v[2].y));

  let local = vertexPosition.xy; // expect -0.5..0.5
  let worldPos =
    centerWS
    + rightWS * (local.x * sx)
    + upWS    * (local.y * sy);

  var out: VSOut;
  out.Position = transformUBO.projection * transformUBO.view * vec4<f32>(worldPos, 1.0);
  out.TexCoord = vertexTexCoord;
  return out;
}

@fragment
fn fs_main(@location(0) TexCoord: vec2<f32>) -> @location(0) vec4<f32> {
  return textureSample(myTexture, mySampler, TexCoord);
}
`,Gi=`// Terrain Shader with Dual Texture Blending
// Blends GHI heatmap with satellite imagery

struct TransformData {
    view: mat4x4<f32>,
    projection: mat4x4<f32>,
};

struct ObjectData {
    model: array<mat4x4<f32>>
};

struct BlendSettings {
    satelliteOpacity: f32,  // 0.0 = GHI only, 1.0 = satellite only
    _padding1: f32,
    _padding2: f32,
    _padding3: f32,
};

// Group 0: Frame data (shared)
@binding(0) @group(0) var<uniform> transformUBO: TransformData;
@binding(1) @group(0) var<storage, read> objects: ObjectData;

// Group 1: Terrain material (dual textures + blend)
@binding(0) @group(1) var ghiTexture: texture_2d<f32>;
@binding(1) @group(1) var ghiSampler: sampler;
@binding(2) @group(1) var satelliteTexture: texture_2d<f32>;
@binding(3) @group(1) var satelliteSampler: sampler;
@binding(4) @group(1) var<uniform> blendSettings: BlendSettings;

struct Fragment {
    @builtin(position) Position: vec4<f32>,
    @location(0) TexCoord: vec2<f32>,
};

@vertex
fn vs_main(
    @builtin(instance_index) ID: u32,
    @location(0) vertexPosition: vec3<f32>,
    @location(1) vertexTexCoord: vec2<f32>
) -> Fragment {
    var output: Fragment;
    output.Position = transformUBO.projection * transformUBO.view * objects.model[ID] * vec4<f32>(vertexPosition, 1.0);
    output.TexCoord = vertexTexCoord;
    return output;
}

@fragment
fn fs_main(@location(0) TexCoord: vec2<f32>) -> @location(0) vec4<f32> {
    // Sample both textures
    let ghiColor = textureSample(ghiTexture, ghiSampler, TexCoord);
    let satelliteColor = textureSample(satelliteTexture, satelliteSampler, TexCoord);
    
    // Blend: GHI * (1 - opacity) + Satellite * opacity
    let blendedColor = mix(ghiColor, satelliteColor, blendSettings.satelliteOpacity);
    
    return blendedColor;
}

`,ki=`struct TransformData {
    view: mat4x4<f32>,
    projection: mat4x4<f32>,
};

struct ObjectData {
    model: array<mat4x4<f32>>
};

@group(0) @binding(0) var<uniform> transformUBO: TransformData;
@group(0) @binding(1) var<storage, read> objects: ObjectData;

struct VSOut {
    @builtin(position) Position: vec4<f32>,
    @location(0) worldPosition: vec3<f32>,
};

@vertex
fn vs_main(
    @builtin(instance_index) ID: u32,
    @location(0) vertexPosition: vec3<f32>,
    @location(1) vertexTexCoord: vec2<f32>
) -> VSOut {
    let model = objects.model[ID];
    let worldPos = model * vec4<f32>(vertexPosition, 1.0);
    
    var out: VSOut;
    out.Position = transformUBO.projection * transformUBO.view * worldPos;
    out.worldPosition = worldPos.xyz;
    return out;
}

@fragment
fn fs_main(@location(0) worldPosition: vec3<f32>) -> @location(0) vec4<f32> {
    return vec4<f32>(worldPosition, 1.0);
}


`,rr={arrayStride:5*4,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:3*4}]};function _t(s,e,r,o=rr){const c=s.createBuffer({size:e.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(c.getMappedRange()).set(e),c.unmap();let u=null;return r&&r.length>0&&(u=s.createBuffer({size:r.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),new Uint32Array(u.getMappedRange()).set(r),u.unmap()),{vertexBuffer:c,indexBuffer:u,vertexCount:e.length/5,indexCount:(r==null?void 0:r.length)??0,bufferLayout:o,useIndexBuffer:r!==void 0&&r.length>0}}class Xe{constructor(e=Se(0,0,0),r=Se(0,0,0),o=Se(1,1,1)){q(this,"position");q(this,"rotation");q(this,"scale");q(this,"_modelMatrix");q(this,"_dirty",!0);this.position=Bt(e),this.rotation=Bt(r),this.scale=Bt(o),this._modelMatrix=Wr()}setPosition(e,r,o){return Pn(this.position,e,r,o),this._dirty=!0,this}setRotation(e,r,o){return Pn(this.rotation,e,r,o),this._dirty=!0,this}setScale(e,r,o){return Pn(this.scale,e,r,o),this._dirty=!0,this}translate(e,r,o){return this.position[0]+=e,this.position[1]+=r,this.position[2]+=o,this._dirty=!0,this}rotate(e,r,o){return this.rotation[0]+=e,this.rotation[1]+=r,this.rotation[2]+=o,this._dirty=!0,this}getModelMatrix(){return this._dirty&&(this._recalculateMatrix(),this._dirty=!1),this._modelMatrix}markDirty(){this._dirty=!0}_recalculateMatrix(){const e=r=>r*Math.PI/180;Qi(this._modelMatrix),Mo(this._modelMatrix,this._modelMatrix,this.position),No(this._modelMatrix,this._modelMatrix,e(this.rotation[0])),Oo(this._modelMatrix,this._modelMatrix,e(this.rotation[1])),Lo(this._modelMatrix,this._modelMatrix,e(this.rotation[2])),Po(this._modelMatrix,this._modelMatrix,this.scale)}clone(){return new Xe(Bt(this.position),Bt(this.rotation),Bt(this.scale))}}var ut=(s=>(s.Standard="standard",s.Terrain="terrain",s.Billboard="billboard",s))(ut||{});const en=class en{constructor(e){q(this,"id");q(this,"mesh");q(this,"material");q(this,"transform");q(this,"visible");q(this,"renderType");q(this,"onUpdate");this.id=en._idCounter++,this.mesh=e.mesh,this.material=e.material,this.transform=e.transform??new Xe,this.visible=e.visible??!0,this.renderType=e.renderType??"standard",this.onUpdate=e.onUpdate}getModelMatrix(){return this.transform.getModelMatrix()}update(e=0){this.onUpdate&&this.onUpdate(this,e)}bind(e){e.setVertexBuffer(0,this.mesh.vertexBuffer),this.mesh.useIndexBuffer&&this.mesh.indexBuffer&&e.setIndexBuffer(this.mesh.indexBuffer,"uint32")}draw(e,r=0){this.mesh.useIndexBuffer?e.drawIndexed(this.mesh.indexCount,1,0,0,r):e.draw(this.mesh.vertexCount,1,0,r)}setVisible(e){return this.visible=e,this}setMaterial(e){return this.material=e,this}destroy(){this.mesh.vertexBuffer.destroy(),this.mesh.indexBuffer&&this.mesh.indexBuffer.destroy()}};q(en,"_idCounter",0);let ct=en;class Fo{constructor(e){q(this,"canvas");q(this,"adapter");q(this,"device");q(this,"context");q(this,"format");q(this,"pipeline");q(this,"billboardPipeline");q(this,"terrainPipeline");q(this,"frameGroupLayout");q(this,"materialGroupLayout");q(this,"terrainMaterialGroupLayout");q(this,"frameBindGroup");q(this,"blendSettingsBuffer");q(this,"_satelliteOpacity",.1);q(this,"uniformBuffer");q(this,"objectBuffer");q(this,"depthStencilState");q(this,"depthStencilBuffer");q(this,"depthStencilView");q(this,"depthStencilAttachment");q(this,"pickingPipeline");q(this,"pickingTexture");q(this,"pickingDepthTexture");q(this,"pickingReadBuffer");q(this,"instancedBindGroups",new WeakMap);this.canvas=e}async init(){await this.setupDevice(),this.setupBindGroupLayouts(),this.setupBuffers(),this.setupDepthBuffer(),this.setupPipeline(),this.setupBindGroup(),this.setupPicking()}async setupDevice(){var e;if(this.adapter=await((e=navigator.gpu)==null?void 0:e.requestAdapter()),!this.adapter)throw new Error("WebGPU is not supported on this device!");this.device=await this.adapter.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}setupBindGroupLayouts(){this.frameGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage",hasDynamicOffset:!1}}]}),this.materialGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]}),this.terrainMaterialGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:4,visibility:GPUShaderStage.FRAGMENT,buffer:{}}]})}setupBuffers(){this.uniformBuffer=this.device.createBuffer({size:64*2,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.objectBuffer=this.device.createBuffer({size:64*1024,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.blendSettingsBuffer=this.device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.updateBlendSettings(this._satelliteOpacity)}setupDepthBuffer(){this.depthStencilState={format:"depth24plus-stencil8",depthWriteEnabled:!0,depthCompare:"less-equal"},this.depthStencilBuffer=this.device.createTexture({size:{width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1},format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthStencilView=this.depthStencilBuffer.createView({format:"depth24plus-stencil8",dimension:"2d",aspect:"all"}),this.depthStencilAttachment={view:this.depthStencilView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilLoadOp:"clear",stencilStoreOp:"discard"}}setupPipeline(){const e=this.device.createPipelineLayout({bindGroupLayouts:[this.frameGroupLayout,this.materialGroupLayout]});this.pipeline=this.device.createRenderPipeline({layout:e,vertex:{module:this.device.createShaderModule({code:Fi}),entryPoint:"vs_main",buffers:[rr]},fragment:{module:this.device.createShaderModule({code:Fi}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},depthStencil:this.depthStencilState});const r=this.device.createPipelineLayout({bindGroupLayouts:[this.frameGroupLayout,this.materialGroupLayout]});this.billboardPipeline=this.device.createRenderPipeline({layout:r,vertex:{module:this.device.createShaderModule({code:Ui}),entryPoint:"vs_main",buffers:[rr]},fragment:{module:this.device.createShaderModule({code:Ui}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus-stencil8",depthWriteEnabled:!1,depthCompare:"always"}});const o=this.device.createPipelineLayout({bindGroupLayouts:[this.frameGroupLayout,this.terrainMaterialGroupLayout]});this.terrainPipeline=this.device.createRenderPipeline({layout:o,vertex:{module:this.device.createShaderModule({code:Gi}),entryPoint:"vs_main",buffers:[rr]},fragment:{module:this.device.createShaderModule({code:Gi}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},depthStencil:this.depthStencilState})}setupBindGroup(){this.frameBindGroup=this.device.createBindGroup({layout:this.frameGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:this.objectBuffer}}]})}getMaterialGroupLayout(){return this.materialGroupLayout}getTerrainMaterialGroupLayout(){return this.terrainMaterialGroupLayout}getBlendSettingsBuffer(){return this.blendSettingsBuffer}updateBlendSettings(e){this._satelliteOpacity=Math.max(0,Math.min(1,e));const r=new Float32Array([this._satelliteOpacity,0,0,0]);this.device.queue.writeBuffer(this.blendSettingsBuffer,0,r)}get satelliteOpacity(){return this._satelliteOpacity}toggleSatellite(){this._satelliteOpacity>0?this.updateBlendSettings(0):this.updateBlendSettings(.1),console.log(`ð°ï¸ Satellite opacity: ${Math.round(this._satelliteOpacity*100)}%`)}getTerrainPipeline(){return this.terrainPipeline}getInstancedBindGroup(e){let r=this.instancedBindGroups.get(e);return r||(r=this.device.createBindGroup({layout:this.frameGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:e.getInstanceBuffer()}}]}),this.instancedBindGroups.set(e,r)),r}render(e){if(!this.device||!this.pipeline){console.error("Renderer not initialized");return}const{viewTransform:r,objects:o}=e,c=Wr();Bi(c,Math.PI/4,this.canvas.width/this.canvas.height,.1,100),this.device.queue.writeBuffer(this.uniformBuffer,0,new Float32Array(r)),this.device.queue.writeBuffer(this.uniformBuffer,64,new Float32Array(c));const u=new Float32Array(o.length*16);o.forEach((E,A)=>{const I=E.getModelMatrix();for(let L=0;L<16;L++)u[A*16+L]=I[L]}),this.device.queue.writeBuffer(this.objectBuffer,0,u);const p=this.device.createCommandEncoder(),d=o.filter(E=>E.renderType===ut.Standard),x=o.filter(E=>E.renderType===ut.Terrain),b=o.filter(E=>E.renderType===ut.Billboard),T=this.context.getCurrentTexture().createView(),S=p.beginRenderPass({colorAttachments:[{view:T,clearValue:{r:.1,g:.1,b:.15,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:this.depthStencilAttachment});S.setBindGroup(0,this.frameBindGroup),d.length>0&&(S.setPipeline(this.pipeline),d.forEach(E=>{const A=o.indexOf(E);S.setBindGroup(1,E.material),E.bind(S),E.draw(S,A)})),x.length>0&&(S.setPipeline(this.terrainPipeline),x.forEach(E=>{const A=o.indexOf(E);S.setBindGroup(1,E.material),E.bind(S),E.draw(S,A)})),b.length>0&&(S.setPipeline(this.billboardPipeline),b.forEach(E=>{const A=o.indexOf(E);S.setBindGroup(1,E.material),E.bind(S),E.draw(S,A)}));const M=e.instancedMeshes??[];for(const E of M){if(E.getInstanceCount()===0)continue;switch(E.renderType){case ut.Billboard:S.setPipeline(this.billboardPipeline);break;case ut.Terrain:S.setPipeline(this.terrainPipeline);break;default:S.setPipeline(this.pipeline)}const A=this.getInstancedBindGroup(E);S.setBindGroup(0,A),E.drawAll(S)}M.length>0&&S.setBindGroup(0,this.frameBindGroup),S.end(),this.device.queue.submit([p.finish()])}resize(){var e,r;this.depthStencilBuffer.destroy(),this.setupDepthBuffer(),(e=this.pickingTexture)==null||e.destroy(),(r=this.pickingDepthTexture)==null||r.destroy(),this.setupPickingTextures()}setupPicking(){this.setupPickingTextures();const e=this.device.createPipelineLayout({bindGroupLayouts:[this.frameGroupLayout]});this.pickingPipeline=this.device.createRenderPipeline({layout:e,vertex:{module:this.device.createShaderModule({code:ki}),entryPoint:"vs_main",buffers:[rr]},fragment:{module:this.device.createShaderModule({code:ki}),entryPoint:"fs_main",targets:[{format:"rgba32float"}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less-equal"}}),this.pickingReadBuffer=this.device.createBuffer({size:16,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}setupPickingTextures(){this.pickingTexture=this.device.createTexture({size:[this.canvas.width,this.canvas.height],format:"rgba32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.pickingDepthTexture=this.device.createTexture({size:[this.canvas.width,this.canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT})}renderPickingPass(e){const{viewTransform:r,objects:o}=e,c=Wr();Bi(c,Math.PI/4,this.canvas.width/this.canvas.height,.1,100),this.device.queue.writeBuffer(this.uniformBuffer,0,new Float32Array(r)),this.device.queue.writeBuffer(this.uniformBuffer,64,new Float32Array(c));const u=new Float32Array(o.length*16);o.forEach((x,b)=>{const T=x.getModelMatrix();for(let S=0;S<16;S++)u[b*16+S]=T[S]}),this.device.queue.writeBuffer(this.objectBuffer,0,u);const p=this.device.createCommandEncoder(),d=p.beginRenderPass({colorAttachments:[{view:this.pickingTexture.createView(),clearValue:{r:-9999,g:-9999,b:-9999,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.pickingDepthTexture.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});d.setPipeline(this.pickingPipeline),d.setBindGroup(0,this.frameBindGroup),o.forEach((x,b)=>{x.bind(d),x.draw(d,b)}),d.end(),this.device.queue.submit([p.finish()])}async readWorldPosition(e,r){const o=Math.floor(e),c=Math.floor(r);if(o<0||o>=this.canvas.width||c<0||c>=this.canvas.height)return null;const u=this.device.createCommandEncoder();u.copyTextureToBuffer({texture:this.pickingTexture,origin:{x:o,y:c,z:0}},{buffer:this.pickingReadBuffer,bytesPerRow:256},{width:1,height:1}),this.device.queue.submit([u.finish()]),await this.pickingReadBuffer.mapAsync(GPUMapMode.READ);const p=new Float32Array(this.pickingReadBuffer.getMappedRange().slice(0));return this.pickingReadBuffer.unmap(),p[0]<-9e3?null:Se(p[0],p[1],p[2])}getDevice(){return this.device}}function wr(s){return s*Math.PI/180}let Uo=class{constructor(e,r,o){q(this,"position");q(this,"eulers");q(this,"view");q(this,"forwards");q(this,"right");q(this,"up");this.position=e,this.eulers=tr(),this.eulers=[0,o,r],this.forwards=tr(),this.right=tr(),this.up=tr()}update(){this.forwards=[Math.cos(wr(this.eulers[2]))*Math.cos(wr(this.eulers[1])),Math.sin(wr(this.eulers[2]))*Math.cos(wr(this.eulers[1])),Math.sin(wr(this.eulers[1]))],Di(this.right,this.forwards,[0,0,1]),Di(this.up,this.right,this.forwards);const e=tr();Do(e,this.position,this.forwards),this.view=Wr(),Bo(this.view,this.position,e,this.up)}getView(){return this.view}},Go=class{constructor(){q(this,"_objects",new Map);q(this,"_instancedMeshes",[]);q(this,"_camera");q(this,"_lastTime",0);this._camera=new Uo([-10,0,1],0,0)}add(e){return this._objects.set(e.id,e),console.log(`Scene: Added object ${e.id}`),this}addInstanced(e){return this._instancedMeshes.push(e),console.log(`Scene: Added instanced mesh with ${e.getInstanceCount()} instances`),this}removeInstanced(e){const r=this._instancedMeshes.indexOf(e);return r!==-1&&this._instancedMeshes.splice(r,1),this}getInstancedMeshes(){return this._instancedMeshes.filter(e=>e.visible)}remove(e){return this._objects.delete(e.id),this}removeById(e){return this._objects.delete(e),this}get(e){return this._objects.get(e)}has(e){return this._objects.has(e.id)}getAll(){return Array.from(this._objects.values())}getVisible(){return this.getAll().filter(e=>e.visible)}get count(){return this._objects.size}update(){const e=performance.now(),r=this._lastTime?(e-this._lastTime)/1e3:0;this._lastTime=e;for(const o of this._objects.values())o.update(r);for(const o of this._instancedMeshes)o.updateBuffer();this._camera.update()}getRenderData(){return{viewTransform:this._camera.getView(),objects:this.getVisible(),instancedMeshes:this.getInstancedMeshes()}}get camera(){return this._camera}spinCamera(e,r){this._camera.eulers[2]-=e,this._camera.eulers[2]%=360,this._camera.eulers[1]=Math.min(89,Math.max(-89,this._camera.eulers[1]+r))}moveCamera(e,r,o){Nn(this._camera.position,this._camera.position,this._camera.forwards,e),Nn(this._camera.position,this._camera.position,this._camera.right,r),Nn(this._camera.position,this._camera.position,this._camera.up,o)}clear(){for(const e of this._objects.values())e.destroy();this._objects.clear()}find(e){return this.getAll().filter(e)}};const ko="modulepreload",jo=function(s,e){return new URL(s,e).href},ji={},Rt=function(e,r,o){let c=Promise.resolve();if(r&&r.length>0){const p=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),x=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));c=Promise.allSettled(r.map(b=>{if(b=jo(b,o),b in ji)return;ji[b]=!0;const T=b.endsWith(".css"),S=T?'[rel="stylesheet"]':"";if(!!o)for(let A=p.length-1;A>=0;A--){const I=p[A];if(I.href===b&&(!T||I.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${S}`))return;const E=document.createElement("link");if(E.rel=T?"stylesheet":ko,T||(E.as="script"),E.crossOrigin="",E.href=b,x&&E.setAttribute("nonce",x),document.head.appendChild(E),T)return new Promise((A,I)=>{E.addEventListener("load",A),E.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${b}`)))})}))}function u(p){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=p,window.dispatchEvent(d),!d.defaultPrevented)throw p}return c.then(p=>{for(const d of p||[])d.status==="rejected"&&u(d.reason);return e().catch(u)})};class es{constructor(){this._listeners={}}addEventListener(e,r){const o=this._listeners;return o[e]===void 0&&(o[e]=[]),o[e].indexOf(r)===-1&&o[e].push(r),this}removeEventListener(e,r){const c=this._listeners[e];if(c!==void 0){const u=c.indexOf(r);u!==-1&&c.splice(u,1)}return this}dispatchEvent(e){const o=this._listeners[e.type];if(o!==void 0){const c=o.slice(0);for(let u=0,p=c.length;u<p;u++)c[u].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class nr{constructor(e,r,o,c={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=r,this._child=o,this._attributes=c,!r.isOnGraph(o))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class Vo extends es{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const r=new Set;for(const o of this.listParentEdges(e))r.add(o.getParent());return Array.from(r)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const r=new Set;for(const o of this.listChildEdges(e))r.add(o.getChild());return Array.from(r)}disconnectParents(e,r){for(const o of this.listParentEdges(e))(!r||r(o.getParent()))&&o.dispose();return this}_createEdge(e,r,o,c){const u=new nr(e,r,o,c);this._edges.add(u);const p=u.getParent();this._parentEdges.has(p)||this._parentEdges.set(p,new Set),this._parentEdges.get(p).add(u);const d=u.getChild();return this._childEdges.has(d)||this._childEdges.set(d,new Set),this._childEdges.get(d).add(u),u}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Er(){return Er=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])}return s},Er.apply(this,arguments)}class Et{constructor(e){if(this.list=[],e)for(const r of e)this.list.push(r)}add(e){this.list.push(e)}remove(e){const r=this.list.indexOf(e);r>=0&&this.list.splice(r,1)}removeChild(e){const r=[];for(const o of this.list)o.getChild()===e&&r.push(o);for(const o of r)this.remove(o);return r}listRefsByChild(e){const r=[];for(const o of this.list)o.getChild()===e&&r.push(o);return r}values(){return this.list}}class Ee{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const r of e)this.add(r)}add(e){const r=e.getChild();this.removeChild(r),this.set.add(e),this.map.set(r,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const r=this.map.get(e)||null;return r&&this.remove(r),r}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class lt{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,r){this.map[e]=r}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const be=Symbol("attributes"),Ut=Symbol("immutableKeys");class Hn extends es{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[be]=void 0,this[Ut]=void 0,this.graph=e,this[Ut]=new Set,this[be]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),r={};for(const o in e){const c=e[o];if(c instanceof Hn){const u=this.graph._createEdge(o,this,c);this[Ut].add(o),r[o]=u}else r[o]=c}return r}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,r){for(const o in this[be]){const c=this[be][o];if(c instanceof nr){const u=c;u.getChild()===e&&this.setRef(o,r,u.getAttributes())}else if(c instanceof Et)for(const u of c.listRefsByChild(e)){const p=u.getAttributes();this.removeRef(o,e),this.addRef(o,r,p)}else if(c instanceof Ee){const u=c.getRefByChild(e);if(u){const p=u.getAttributes();this.removeRef(o,e),this.addRef(o,r,p)}}else if(c instanceof lt)for(const u of c.keys()){const p=c.get(u);p.getChild()===e&&this.setRefMap(o,u,r,p.getAttributes())}}return this}get(e){return this[be][e]}set(e,r){return this[be][e]=r,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const r=this[be][e];return r?r.getChild():null}setRef(e,r,o){if(this[Ut].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const c=this[be][e];if(c&&c.dispose(),!r)return this;const u=this.graph._createEdge(e,this,r,o);return this[be][e]=u,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(o=>o.getChild())}addRef(e,r,o){const c=this.graph._createEdge(e,this,r,o);return this.assertRefList(e).add(c),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,r){const o=this.assertRefList(e);if(o instanceof Et)for(const c of o.listRefsByChild(r))c.dispose();else{const c=o.getRefByChild(r);c&&c.dispose()}return this}assertRefList(e){const r=this[be][e];if(r instanceof Et||r instanceof Ee)return r;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(r=>r.getChild())}getRefMap(e,r){const c=this.assertRefMap(e).get(r);return c?c.getChild():null}setRefMap(e,r,o,c){const u=this.assertRefMap(e),p=u.get(r);if(p&&p.dispose(),!o)return this;c=Object.assign(c||{},{key:r});const d=this.graph._createEdge(e,this,o,Er({},c,{key:r}));return u.set(r,d),this.dispatchEvent({type:"change",attribute:e,key:r})}assertRefMap(e){const r=this[be][e];if(r instanceof lt)return r;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(Er({},e,{target:this})),this.graph.dispatchEvent(Er({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const r=e.getName();if(this[be][r]===e)this[be][r]=null,this[Ut].has(r)&&e.getChild().dispose();else if(this[be][r]instanceof Et)this[be][r].remove(e);else if(this[be][r]instanceof Ee)this[be][r].remove(e);else if(this[be][r]instanceof lt){const o=this[be][r];for(const c of o.keys())o.get(c)===e&&o.delete(c)}else return;this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:r})}}const ts="v4.2.1",Xr="@glb.bin";var te;(function(s){s.ACCESSOR="Accessor",s.ANIMATION="Animation",s.ANIMATION_CHANNEL="AnimationChannel",s.ANIMATION_SAMPLER="AnimationSampler",s.BUFFER="Buffer",s.CAMERA="Camera",s.MATERIAL="Material",s.MESH="Mesh",s.PRIMITIVE="Primitive",s.PRIMITIVE_TARGET="PrimitiveTarget",s.NODE="Node",s.ROOT="Root",s.SCENE="Scene",s.SKIN="Skin",s.TEXTURE="Texture",s.TEXTURE_INFO="TextureInfo"})(te||(te={}));var Jr;(function(s){s.INTERLEAVED="interleaved",s.SEPARATE="separate"})(Jr||(Jr={}));var Ve;(function(s){s.ARRAY_BUFFER="ARRAY_BUFFER",s.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",s.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",s.OTHER="OTHER",s.SPARSE="SPARSE"})(Ve||(Ve={}));var Dn;(function(s){s[s.R=4096]="R",s[s.G=256]="G",s[s.B=16]="B",s[s.A=1]="A"})(Dn||(Dn={}));var St;(function(s){s.GLTF="GLTF",s.GLB="GLB"})(St||(St={}));const tn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class xe{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const r=atob(e.split(",")[1]),o=new Uint8Array(r.length);for(let c=0;c<r.length;c++)o[c]=r.charCodeAt(c);return o}else{const r=e.split(",")[1],o=e.indexOf("base64")>=0;return Buffer.from(r,o?"base64":"utf8")}}static encodeText(e){return new TextEncoder().encode(e)}static decodeText(e){return new TextDecoder().decode(e)}static concat(e){let r=0;for(const u of e)r+=u.byteLength;const o=new Uint8Array(r);let c=0;for(const u of e)o.set(u,c),c+=u.byteLength;return o}static pad(e,r=0){const o=this.padNumber(e.byteLength);if(o===e.byteLength)return e;const c=new Uint8Array(o);if(c.set(e),r!==0)for(let u=e.byteLength;u<o;u++)c[u]=r;return c}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,r){if(e===r)return!0;if(e.byteLength!==r.byteLength)return!1;let o=e.byteLength;for(;o--;)if(e[o]!==r[o])return!1;return!0}static toView(e,r=0,o=1/0){return new Uint8Array(e.buffer,e.byteOffset+r,Math.min(e.byteLength,o))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Ho{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let r=new DataView(e.buffer,e.byteOffset+4),o,c;for(;r.byteLength;){if(o=r.getUint16(0,!1),zo(r,o),c=r.getUint8(o+1),c===192||c===193||c===194)return[r.getUint16(o+7,!1),r.getUint16(o+5,!1)];r=new DataView(e.buffer,r.byteOffset+o+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class rn{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const r=new DataView(e.buffer,e.byteOffset);return xe.decodeText(e.slice(12,16))===rn.PNG_FRIED_CHUNK_NAME?[r.getUint32(32,!1),r.getUint32(36,!1)]:[r.getUint32(16,!1),r.getUint32(20,!1)]}getChannels(e){return 4}}rn.PNG_FRIED_CHUNK_NAME="CgBI";class jt{static registerFormat(e,r){this.impls[e]=r}static getMimeType(e){for(const r in this.impls)if(this.impls[r].match(e))return r;return null}static getSize(e,r){return this.impls[r]?this.impls[r].getSize(e):null}static getChannels(e,r){return this.impls[r]?this.impls[r].getChannels(e):null}static getVRAMByteLength(e,r){if(!this.impls[r])return null;if(this.impls[r].getVRAMByteLength)return this.impls[r].getVRAMByteLength(e);let o=0;const c=4,u=this.getSize(e,r);if(!u)return null;for(;u[0]>1||u[1]>1;)o+=u[0]*u[1]*c,u[0]=Math.max(Math.floor(u[0]/2),1),u[1]=Math.max(Math.floor(u[1]/2),1);return o+=1*1*c,o}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}jt.impls={"image/jpeg":new Ho,"image/png":new rn};function zo(s,e){if(e>s.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(s.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return s}class or{static basename(e){const r=e.split(/[\\/]/).pop();return r.substring(0,r.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const r=e.match(/data:(image\/\w+)/)[1];return jt.mimeTypeToExtension(r)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}var Fn=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});function qo(){var s=new Fn(3);return Fn!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function On(s){var e=s[0],r=s[1],o=s[2];return Math.hypot(e,r,o)}(function(){var s=qo();return function(e,r,o,c,u,p){var d,x;for(r||(r=3),o||(o=0),c?x=Math.min(c*r+o,e.length):x=e.length,d=o;d<x;d+=r)s[0]=e[d],s[1]=e[d+1],s[2]=e[d+2],u(s,s,p),e[d]=s[0],e[d+1]=s[1],e[d+2]=s[2];return e}})();const Vi="https://null.example";class Sr{static dirname(e){const r=e.lastIndexOf("/");return r===-1?"./":e.substring(0,r+1)}static basename(e){return or.basename(new URL(e,Vi).pathname)}static extension(e){return or.extension(new URL(e,Vi).pathname)}static resolve(e,r){if(!this.isRelativePath(r))return r;const o=e.split("/"),c=r.split("/");o.pop();for(let u=0;u<c.length;u++)c[u]!=="."&&(c[u]===".."?o.pop():o.push(c[u]));return o.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Sr.DEFAULT_INIT={};Sr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;function Hi(s){return Object.prototype.toString.call(s)==="[object Object]"}function kt(s){if(Hi(s)===!1)return!1;const e=s.constructor;if(e===void 0)return!0;const r=e.prototype;return!(Hi(r)===!1||Object.hasOwn(r,"isPrototypeOf")===!1)}var Un,Gn;(function(s){s[s.SILENT=4]="SILENT",s[s.ERROR=3]="ERROR",s[s.WARN=2]="WARN",s[s.INFO=1]="INFO",s[s.DEBUG=0]="DEBUG"})(Gn||(Gn={}));class $e{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=$e.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=$e.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=$e.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=$e.Verbosity.ERROR&&console.error(e)}}Un=$e;$e.Verbosity=Gn;$e.DEFAULT_INSTANCE=new Un(Un.Verbosity.INFO);function $o(s){var e=s[0],r=s[1],o=s[2],c=s[3],u=s[4],p=s[5],d=s[6],x=s[7],b=s[8],T=s[9],S=s[10],M=s[11],E=s[12],A=s[13],I=s[14],L=s[15],m=e*p-r*u,F=e*d-o*u,N=e*x-c*u,j=r*d-o*p,U=r*x-c*p,H=o*x-c*d,i=b*A-T*E,D=b*I-S*E,V=b*L-M*E,$=T*I-S*A,J=T*L-M*A,Q=S*L-M*I;return m*Q-F*J+N*$+j*V-U*D+H*i}function Yo(s,e,r){var o=e[0],c=e[1],u=e[2],p=e[3],d=e[4],x=e[5],b=e[6],T=e[7],S=e[8],M=e[9],E=e[10],A=e[11],I=e[12],L=e[13],m=e[14],F=e[15],N=r[0],j=r[1],U=r[2],H=r[3];return s[0]=N*o+j*d+U*S+H*I,s[1]=N*c+j*x+U*M+H*L,s[2]=N*u+j*b+U*E+H*m,s[3]=N*p+j*T+U*A+H*F,N=r[4],j=r[5],U=r[6],H=r[7],s[4]=N*o+j*d+U*S+H*I,s[5]=N*c+j*x+U*M+H*L,s[6]=N*u+j*b+U*E+H*m,s[7]=N*p+j*T+U*A+H*F,N=r[8],j=r[9],U=r[10],H=r[11],s[8]=N*o+j*d+U*S+H*I,s[9]=N*c+j*x+U*M+H*L,s[10]=N*u+j*b+U*E+H*m,s[11]=N*p+j*T+U*A+H*F,N=r[12],j=r[13],U=r[14],H=r[15],s[12]=N*o+j*d+U*S+H*I,s[13]=N*c+j*x+U*M+H*L,s[14]=N*u+j*b+U*E+H*m,s[15]=N*p+j*T+U*A+H*F,s}function Ko(s,e){var r=e[0],o=e[1],c=e[2],u=e[4],p=e[5],d=e[6],x=e[8],b=e[9],T=e[10];return s[0]=Math.hypot(r,o,c),s[1]=Math.hypot(u,p,d),s[2]=Math.hypot(x,b,T),s}function Wo(s,e){var r=new Fn(3);Ko(r,e);var o=1/r[0],c=1/r[1],u=1/r[2],p=e[0]*o,d=e[1]*c,x=e[2]*u,b=e[4]*o,T=e[5]*c,S=e[6]*u,M=e[8]*o,E=e[9]*c,A=e[10]*u,I=p+T+A,L=0;return I>0?(L=Math.sqrt(I+1)*2,s[3]=.25*L,s[0]=(S-E)/L,s[1]=(M-x)/L,s[2]=(d-b)/L):p>T&&p>A?(L=Math.sqrt(1+p-T-A)*2,s[3]=(S-E)/L,s[0]=.25*L,s[1]=(d+b)/L,s[2]=(M+x)/L):T>A?(L=Math.sqrt(1+T-p-A)*2,s[3]=(M-x)/L,s[0]=(d+b)/L,s[1]=.25*L,s[2]=(S+E)/L):(L=Math.sqrt(1+A-p-T)*2,s[3]=(d-b)/L,s[0]=(M+x)/L,s[1]=(S+E)/L,s[2]=.25*L),s}class Ae{static identity(e){return e}static eq(e,r,o=1e-5){if(e.length!==r.length)return!1;for(let c=0;c<e.length;c++)if(Math.abs(e[c]-r[c])>o)return!1;return!0}static clamp(e,r,o){return e<r?r:e>o?o:e}static decodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return Math.round(Ae.clamp(e,0,1)*65535);case 5121:return Math.round(Ae.clamp(e,0,1)*255);case 5122:return Math.round(Ae.clamp(e,-1,1)*32767);case 5120:return Math.round(Ae.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,r,o,c){let u=On([e[0],e[1],e[2]]);const p=On([e[4],e[5],e[6]]),d=On([e[8],e[9],e[10]]);$o(e)<0&&(u=-u),r[0]=e[12],r[1]=e[13],r[2]=e[14];const b=e.slice(),T=1/u,S=1/p,M=1/d;b[0]*=T,b[1]*=T,b[2]*=T,b[4]*=S,b[5]*=S,b[6]*=S,b[8]*=M,b[9]*=M,b[10]*=M,Wo(o,b),c[0]=u,c[1]=p,c[2]=d}static compose(e,r,o,c){const u=c,p=r[0],d=r[1],x=r[2],b=r[3],T=p+p,S=d+d,M=x+x,E=p*T,A=p*S,I=p*M,L=d*S,m=d*M,F=x*M,N=b*T,j=b*S,U=b*M,H=o[0],i=o[1],D=o[2];return u[0]=(1-(L+F))*H,u[1]=(A+U)*H,u[2]=(I-j)*H,u[3]=0,u[4]=(A-U)*i,u[5]=(1-(E+F))*i,u[6]=(m+N)*i,u[7]=0,u[8]=(I+j)*D,u[9]=(m-N)*D,u[10]=(1-(E+L))*D,u[11]=0,u[12]=e[0],u[13]=e[1],u[14]=e[2],u[15]=1,u}}function Xo(s,e){if(!!s!=!!e)return!1;const r=s.getChild(),o=e.getChild();return r===o||r.equals(o)}function Jo(s,e){if(!!s!=!!e)return!1;const r=s.values(),o=e.values();if(r.length!==o.length)return!1;for(let c=0;c<r.length;c++){const u=r[c],p=o[c];if(u.getChild()!==p.getChild()&&!u.getChild().equals(p.getChild()))return!1}return!0}function Zo(s,e){if(!!s!=!!e)return!1;const r=s.keys(),o=e.keys();if(r.length!==o.length)return!1;for(const c of r){const u=s.get(c),p=e.get(c);if(!!u!=!!p)return!1;const d=u.getChild(),x=p.getChild();if(d!==x&&!d.equals(x))return!1}return!0}function rs(s,e){if(s===e)return!0;if(!!s!=!!e||!s||!e||s.length!==e.length)return!1;for(let r=0;r<s.length;r++)if(s[r]!==e[r])return!1;return!0}function ns(s,e){if(s===e)return!0;if(!!s!=!!e)return!1;if(!kt(s)||!kt(e))return s===e;const r=s,o=e;let c=0,u=0,p;for(p in r)c++;for(p in o)u++;if(c!==u)return!1;for(p in r){const d=r[p],x=o[p];if(Zr(d)&&Zr(x)){if(!rs(d,x))return!1}else if(kt(d)&&kt(x)){if(!ns(d,x))return!1}else if(d!==x)return!1}return!0}function Zr(s){return Array.isArray(s)||ArrayBuffer.isView(s)}const zi="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",Qo=999,ea=6,qi=new Set,ta=function(){let e="";for(let r=0;r<ea;r++)e+=zi.charAt(Math.floor(Math.random()*zi.length));return e},ra=function(){for(let e=0;e<Qo;e++){const r=ta();if(!qi.has(r))return qi.add(r),r}return""},At=s=>s,na=new Set;class zn extends Hn{constructor(e,r=""){super(e),this[be].name=r,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,r){return Array.isArray(r)&&(r=r.slice()),super.set(e,r)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,At)}copy(e,r=At){for(const o in this[be]){const c=this[be][o];if(c instanceof nr)this[Ut].has(o)||c.dispose();else if(c instanceof Et||c instanceof Ee)for(const u of c.values())u.dispose();else if(c instanceof lt)for(const u of c.values())u.dispose()}for(const o in e[be]){const c=this[be][o],u=e[be][o];if(u instanceof nr)this[Ut].has(o)?c.getChild().copy(r(u.getChild()),r):this.setRef(o,r(u.getChild()),u.getAttributes());else if(u instanceof Ee||u instanceof Et)for(const p of u.values())this.addRef(o,r(p.getChild()),p.getAttributes());else if(u instanceof lt)for(const p of u.keys()){const d=u.get(p);this.setRefMap(o,p,r(d.getChild()),d.getAttributes())}else kt(u)?this[be][o]=JSON.parse(JSON.stringify(u)):Array.isArray(u)||u instanceof ArrayBuffer||ArrayBuffer.isView(u)?this[be][o]=u.slice():this[be][o]=u}return this}equals(e,r=na){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const o in this[be]){if(r.has(o))continue;const c=this[be][o],u=e[be][o];if(c instanceof nr||u instanceof nr){if(!Xo(c,u))return!1}else if(c instanceof Ee||u instanceof Ee||c instanceof Et||u instanceof Et){if(!Jo(c,u))return!1}else if(c instanceof lt||u instanceof lt){if(!Zo(c,u))return!1}else if(kt(c)||kt(u)){if(!ns(c,u))return!1}else if(Zr(c)||Zr(u)){if(!rs(c,u))return!1}else if(c!==u)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Be extends zn{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new lt})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,r){return r&&r._validateParent(this),this.setRefMap("extensions",e,r)}listExtensions(){return this.listRefMapValues("extensions")}}class ae extends Be{init(){this.propertyType=te.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:ae.Type.SCALAR,componentType:ae.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case ae.Type.SCALAR:return 1;case ae.Type.VEC2:return 2;case ae.Type.VEC3:return 3;case ae.Type.VEC4:return 4;case ae.Type.MAT2:return 4;case ae.Type.MAT3:return 9;case ae.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case ae.ComponentType.BYTE:return 1;case ae.ComponentType.UNSIGNED_BYTE:return 1;case ae.ComponentType.SHORT:return 2;case ae.ComponentType.UNSIGNED_SHORT:return 2;case ae.ComponentType.UNSIGNED_INT:return 4;case ae.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const r=this.getNormalized(),o=this.getElementSize(),c=this.getComponentType();if(this.getMin(e),r)for(let u=0;u<o;u++)e[u]=Ae.decodeNormalizedInt(e[u],c);return e}getMin(e){const r=this.getArray(),o=this.getCount(),c=this.getElementSize();for(let u=0;u<c;u++)e[u]=1/0;for(let u=0;u<o*c;u+=c)for(let p=0;p<c;p++){const d=r[u+p];Number.isFinite(d)&&(e[p]=Math.min(e[p],d))}return e}getMaxNormalized(e){const r=this.getNormalized(),o=this.getElementSize(),c=this.getComponentType();if(this.getMax(e),r)for(let u=0;u<o;u++)e[u]=Ae.decodeNormalizedInt(e[u],c);return e}getMax(e){const r=this.get("array"),o=this.getCount(),c=this.getElementSize();for(let u=0;u<c;u++)e[u]=-1/0;for(let u=0;u<o*c;u+=c)for(let p=0;p<c;p++){const d=r[u+p];Number.isFinite(d)&&(e[p]=Math.max(e[p],d))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return ae.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const r=this.getElementSize(),o=this.getComponentType(),c=this.getArray();return this.getNormalized()?Ae.decodeNormalizedInt(c[e*r],o):c[e*r]}setScalar(e,r){const o=this.getElementSize(),c=this.getComponentType(),u=this.getArray();return this.getNormalized()?u[e*o]=Ae.encodeNormalizedInt(r,c):u[e*o]=r,this}getElement(e,r){const o=this.getNormalized(),c=this.getElementSize(),u=this.getComponentType(),p=this.getArray();for(let d=0;d<c;d++)o?r[d]=Ae.decodeNormalizedInt(p[e*c+d],u):r[d]=p[e*c+d];return r}setElement(e,r){const o=this.getNormalized(),c=this.getElementSize(),u=this.getComponentType(),p=this.getArray();for(let d=0;d<c;d++)o?p[e*c+d]=Ae.encodeNormalizedInt(r[d],u):p[e*c+d]=r[d];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?ia(e):ae.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}ae.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};ae.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function ia(s){switch(s.constructor){case Float32Array:return ae.ComponentType.FLOAT;case Uint32Array:return ae.ComponentType.UNSIGNED_INT;case Uint16Array:return ae.ComponentType.UNSIGNED_SHORT;case Uint8Array:return ae.ComponentType.UNSIGNED_BYTE;case Int16Array:return ae.ComponentType.SHORT;case Int8Array:return ae.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class is extends Be{init(){this.propertyType=te.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new Ee,samplers:new Ee})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class ss extends Be{init(){this.propertyType=te.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}ss.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class Mr extends Be{init(){this.propertyType=te.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Mr.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Ve.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Ve.OTHER})}}Mr.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class os extends Be{init(){this.propertyType=te.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class zt extends Be{init(){this.propertyType=te.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:zt.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}zt.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class sa extends zn{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}sa.EXTENSION_NAME=void 0;class Je extends Be{init(){this.propertyType=te.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Je.WrapMode.REPEAT,wrapT:Je.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Je.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Je.MagFilter={NEAREST:9728,LINEAR:9729};Je.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Vr,G:Hr,B:zr,A:oa}=Dn;class Ht extends Be{init(){this.propertyType=te.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Ht.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Je(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Je(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Je(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Je(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Je(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const r=this.get("baseColorFactor").slice();return r[3]=e,this.set("baseColorFactor",r)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Vr|Hr|zr|oa,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Vr|Hr|zr,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Vr|Hr|zr})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Vr})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Hr|zr})}}Ht.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class as extends Be{init(){this.propertyType=te.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new Ee})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class cs extends Be{init(){this.propertyType=te.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new Ee})}copy(e,r=At){if(r===At)throw new Error("Node cannot be copied.");return super.copy(e,r)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Ae.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const r=this.get("translation").slice(),o=this.get("rotation").slice(),c=this.get("scale").slice();return Ae.decompose(e,r,o,c),this.set("translation",r).set("rotation",o).set("scale",c)}getWorldTranslation(){const e=[0,0,0];return Ae.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Ae.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Ae.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let c=this;c!=null;c=c.getParentNode())e.push(c);let r;const o=e.pop().getMatrix();for(;r=e.pop();)Yo(o,o,r.getMatrix());return o}addChild(e){const r=e.getParentNode();r&&r.removeChild(e);for(const o of e.listParents())o.propertyType===te.SCENE&&o.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===te.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const r of this.listChildren())r.traverse(e);return this}}class nn extends Be{init(){this.propertyType=te.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:nn.Mode.TRIANGLES,material:null,indices:null,attributes:new lt,targets:new Ee})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Ve.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:Ve.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}nn.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class aa extends zn{init(){this.propertyType=te.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new lt})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:Ve.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function _e(){return _e=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)({}).hasOwnProperty.call(r,o)&&(s[o]=r[o])}return s},_e.apply(null,arguments)}class us extends Be{init(){this.propertyType=te.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new Ee})}copy(e,r=At){if(r===At)throw new Error("Scene cannot be copied.");return super.copy(e,r)}addChild(e){const r=e.getParentNode();return r&&r.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const r of this.listChildren())r.traverse(e);return this}}class ls extends Be{init(){this.propertyType=te.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new Ee})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Ve.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class fs extends Be{init(){this.propertyType=te.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||jt.extensionToMimeType(or.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const r=jt.extensionToMimeType(or.extension(e));return r&&this.set("mimeType",r),this}getImage(){return this.get("image")}setImage(e){return this.set("image",xe.assertView(e))}getSize(){const e=this.get("image");return e?jt.getSize(e,this.getMimeType()):null}}class ca extends Be{init(){this.propertyType=te.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${ts}`,version:"2.0"},defaultScene:null,accessors:new Ee,animations:new Ee,buffers:new Ee,cameras:new Ee,materials:new Ee,meshes:new Ee,nodes:new Ee,scenes:new Ee,skins:new Ee,textures:new Ee})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",r=>{this._addChildOfRoot(r.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,r=At){if(r===At)throw new Error("Root cannot be copied.");this.set("asset",_e({},e.get("asset"))),this.setName(e.getName()),this.setExtras(_e({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?r(e.getDefaultScene()):null);for(const o of e.listRefMapKeys("extensions")){const c=e.getExtension(o);this.setExtension(o,r(c))}return this}_addChildOfRoot(e){return e instanceof us?this.addRef("scenes",e):e instanceof cs?this.addRef("nodes",e):e instanceof zt?this.addRef("cameras",e):e instanceof ls?this.addRef("skins",e):e instanceof as?this.addRef("meshes",e):e instanceof Ht?this.addRef("materials",e):e instanceof fs?this.addRef("textures",e):e instanceof is?this.addRef("animations",e):e instanceof ae?this.addRef("accessors",e):e instanceof os&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Rr{static fromGraph(e){return Rr._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new Vo,this._root=new ca(this._graph),this._logger=$e.DEFAULT_INSTANCE,Rr._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const r=e.map(o=>o.name);for(const o of e)await o(this,{stack:r});return this}createExtension(e){const r=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(c=>c.extensionName===r)||new e(this)}createScene(e=""){return new us(this._graph,e)}createNode(e=""){return new cs(this._graph,e)}createCamera(e=""){return new zt(this._graph,e)}createSkin(e=""){return new ls(this._graph,e)}createMesh(e=""){return new as(this._graph,e)}createPrimitive(){return new nn(this._graph)}createPrimitiveTarget(e=""){return new aa(this._graph,e)}createMaterial(e=""){return new Ht(this._graph,e)}createTexture(e=""){return new fs(this._graph,e)}createAnimation(e=""){return new is(this._graph,e)}createAnimationChannel(e=""){return new ss(this._graph,e)}createAnimationSampler(e=""){return new Mr(this._graph,e)}createAccessor(e="",r=null){return r||(r=this.getRoot().listBuffers()[0]),new ae(this._graph,e).setBuffer(r)}createBuffer(e=""){return new os(this._graph,e)}}Rr._GRAPH_DOCUMENTS=new WeakMap;class ua{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,r){this.textureInfos.set(e,r),r.texCoord!==void 0&&e.setTexCoord(r.texCoord),r.extras!==void 0&&e.setExtras(r.extras);const o=this.jsonDoc.json.textures[r.index];if(o.sampler===void 0)return;const c=this.jsonDoc.json.samplers[o.sampler];c.magFilter!==void 0&&e.setMagFilter(c.magFilter),c.minFilter!==void 0&&e.setMinFilter(c.minFilter),c.wrapS!==void 0&&e.setWrapS(c.wrapS),c.wrapT!==void 0&&e.setWrapT(c.wrapT)}}const $i={logger:$e.DEFAULT_INSTANCE,extensions:[],dependencies:{}},la=new Set([te.BUFFER,te.TEXTURE,te.MATERIAL,te.MESH,te.PRIMITIVE,te.NODE,te.SCENE]);class fa{static read(e,r=$i){const o=_e({},$i,r),{json:c}=e,u=new Rr().setLogger(o.logger);this.validate(e,o);const p=new ua(e),d=c.asset,x=u.getRoot().getAsset();d.copyright&&(x.copyright=d.copyright),d.extras&&(x.extras=d.extras),c.extras!==void 0&&u.getRoot().setExtras(_e({},c.extras));const b=c.extensionsUsed||[],T=c.extensionsRequired||[];o.extensions.sort((i,D)=>i.EXTENSION_NAME>D.EXTENSION_NAME?1:-1);for(const i of o.extensions)if(b.includes(i.EXTENSION_NAME)){const D=u.createExtension(i).setRequired(T.includes(i.EXTENSION_NAME)),V=D.prereadTypes.filter($=>!la.has($));V.length&&o.logger.warn(`Preread hooks for some types (${V.join()}), requested by extension ${D.extensionName}, are unsupported. Please file an issue or a PR.`);for(const $ of D.readDependencies)D.install($,o.dependencies[$])}const S=c.buffers||[];u.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.BUFFER)).forEach(i=>i.preread(p,te.BUFFER)),p.buffers=S.map(i=>{const D=u.createBuffer(i.name);return i.extras&&D.setExtras(i.extras),i.uri&&i.uri.indexOf("__")!==0&&D.setURI(i.uri),D});const M=c.bufferViews||[];p.bufferViewBuffers=M.map((i,D)=>{if(!p.bufferViews[D]){const V=e.json.buffers[i.buffer],$=V.uri?e.resources[V.uri]:e.resources[Xr],J=i.byteOffset||0;p.bufferViews[D]=xe.toView($,J,i.byteLength)}return p.buffers[i.buffer]});const E=c.accessors||[];p.accessors=E.map(i=>{const D=p.bufferViewBuffers[i.bufferView],V=u.createAccessor(i.name,D).setType(i.type);return i.extras&&V.setExtras(i.extras),i.normalized!==void 0&&V.setNormalized(i.normalized),i.bufferView===void 0||V.setArray(Kr(i,p)),V});const A=c.images||[],I=c.textures||[];u.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.TEXTURE)).forEach(i=>i.preread(p,te.TEXTURE)),p.textures=A.map(i=>{const D=u.createTexture(i.name);if(i.extras&&D.setExtras(i.extras),i.bufferView!==void 0){const V=c.bufferViews[i.bufferView],$=e.json.buffers[V.buffer],J=$.uri?e.resources[$.uri]:e.resources[Xr],Q=V.byteOffset||0,Y=V.byteLength,me=J.slice(Q,Q+Y);D.setImage(me)}else i.uri!==void 0&&(D.setImage(e.resources[i.uri]),i.uri.indexOf("__")!==0&&D.setURI(i.uri));if(i.mimeType!==void 0)D.setMimeType(i.mimeType);else if(i.uri){const V=or.extension(i.uri);D.setMimeType(jt.extensionToMimeType(V))}return D}),u.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.MATERIAL)).forEach(i=>i.preread(p,te.MATERIAL));const L=c.materials||[];p.materials=L.map(i=>{const D=u.createMaterial(i.name);i.extras&&D.setExtras(i.extras),i.alphaMode!==void 0&&D.setAlphaMode(i.alphaMode),i.alphaCutoff!==void 0&&D.setAlphaCutoff(i.alphaCutoff),i.doubleSided!==void 0&&D.setDoubleSided(i.doubleSided);const V=i.pbrMetallicRoughness||{};if(V.baseColorFactor!==void 0&&D.setBaseColorFactor(V.baseColorFactor),i.emissiveFactor!==void 0&&D.setEmissiveFactor(i.emissiveFactor),V.metallicFactor!==void 0&&D.setMetallicFactor(V.metallicFactor),V.roughnessFactor!==void 0&&D.setRoughnessFactor(V.roughnessFactor),V.baseColorTexture!==void 0){const $=V.baseColorTexture,J=p.textures[I[$.index].source];D.setBaseColorTexture(J),p.setTextureInfo(D.getBaseColorTextureInfo(),$)}if(i.emissiveTexture!==void 0){const $=i.emissiveTexture,J=p.textures[I[$.index].source];D.setEmissiveTexture(J),p.setTextureInfo(D.getEmissiveTextureInfo(),$)}if(i.normalTexture!==void 0){const $=i.normalTexture,J=p.textures[I[$.index].source];D.setNormalTexture(J),p.setTextureInfo(D.getNormalTextureInfo(),$),i.normalTexture.scale!==void 0&&D.setNormalScale(i.normalTexture.scale)}if(i.occlusionTexture!==void 0){const $=i.occlusionTexture,J=p.textures[I[$.index].source];D.setOcclusionTexture(J),p.setTextureInfo(D.getOcclusionTextureInfo(),$),i.occlusionTexture.strength!==void 0&&D.setOcclusionStrength(i.occlusionTexture.strength)}if(V.metallicRoughnessTexture!==void 0){const $=V.metallicRoughnessTexture,J=p.textures[I[$.index].source];D.setMetallicRoughnessTexture(J),p.setTextureInfo(D.getMetallicRoughnessTextureInfo(),$)}return D}),u.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.MESH)).forEach(i=>i.preread(p,te.MESH));const m=c.meshes||[];u.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.PRIMITIVE)).forEach(i=>i.preread(p,te.PRIMITIVE)),p.meshes=m.map(i=>{const D=u.createMesh(i.name);return i.extras&&D.setExtras(i.extras),i.weights!==void 0&&D.setWeights(i.weights),(i.primitives||[]).forEach($=>{const J=u.createPrimitive();$.extras&&J.setExtras($.extras),$.material!==void 0&&J.setMaterial(p.materials[$.material]),$.mode!==void 0&&J.setMode($.mode);for(const[me,ie]of Object.entries($.attributes||{}))J.setAttribute(me,p.accessors[ie]);$.indices!==void 0&&J.setIndices(p.accessors[$.indices]);const Q=i.extras&&i.extras.targetNames||[];($.targets||[]).forEach((me,ie)=>{const le=Q[ie]||ie.toString(),pe=u.createPrimitiveTarget(le);for(const[Ce,Te]of Object.entries(me))pe.setAttribute(Ce,p.accessors[Te]);J.addTarget(pe)}),D.addPrimitive(J)}),D});const F=c.cameras||[];p.cameras=F.map(i=>{const D=u.createCamera(i.name).setType(i.type);if(i.extras&&D.setExtras(i.extras),i.type===zt.Type.PERSPECTIVE){const V=i.perspective;D.setYFov(V.yfov),D.setZNear(V.znear),V.zfar!==void 0&&D.setZFar(V.zfar),V.aspectRatio!==void 0&&D.setAspectRatio(V.aspectRatio)}else{const V=i.orthographic;D.setZNear(V.znear).setZFar(V.zfar).setXMag(V.xmag).setYMag(V.ymag)}return D});const N=c.nodes||[];u.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.NODE)).forEach(i=>i.preread(p,te.NODE)),p.nodes=N.map(i=>{const D=u.createNode(i.name);if(i.extras&&D.setExtras(i.extras),i.translation!==void 0&&D.setTranslation(i.translation),i.rotation!==void 0&&D.setRotation(i.rotation),i.scale!==void 0&&D.setScale(i.scale),i.matrix!==void 0){const V=[0,0,0],$=[0,0,0,1],J=[1,1,1];Ae.decompose(i.matrix,V,$,J),D.setTranslation(V),D.setRotation($),D.setScale(J)}return i.weights!==void 0&&D.setWeights(i.weights),D});const j=c.skins||[];p.skins=j.map(i=>{const D=u.createSkin(i.name);i.extras&&D.setExtras(i.extras),i.inverseBindMatrices!==void 0&&D.setInverseBindMatrices(p.accessors[i.inverseBindMatrices]),i.skeleton!==void 0&&D.setSkeleton(p.nodes[i.skeleton]);for(const V of i.joints)D.addJoint(p.nodes[V]);return D}),N.map((i,D)=>{const V=p.nodes[D];(i.children||[]).forEach(J=>V.addChild(p.nodes[J])),i.mesh!==void 0&&V.setMesh(p.meshes[i.mesh]),i.camera!==void 0&&V.setCamera(p.cameras[i.camera]),i.skin!==void 0&&V.setSkin(p.skins[i.skin])});const U=c.animations||[];p.animations=U.map(i=>{const D=u.createAnimation(i.name);i.extras&&D.setExtras(i.extras);const $=(i.samplers||[]).map(Q=>{const Y=u.createAnimationSampler().setInput(p.accessors[Q.input]).setOutput(p.accessors[Q.output]).setInterpolation(Q.interpolation||Mr.Interpolation.LINEAR);return Q.extras&&Y.setExtras(Q.extras),D.addSampler(Y),Y});return(i.channels||[]).forEach(Q=>{const Y=u.createAnimationChannel().setSampler($[Q.sampler]).setTargetPath(Q.target.path);Q.target.node!==void 0&&Y.setTargetNode(p.nodes[Q.target.node]),Q.extras&&Y.setExtras(Q.extras),D.addChannel(Y)}),D});const H=c.scenes||[];return u.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.SCENE)).forEach(i=>i.preread(p,te.SCENE)),p.scenes=H.map(i=>{const D=u.createScene(i.name);return i.extras&&D.setExtras(i.extras),(i.nodes||[]).map($=>p.nodes[$]).forEach($=>D.addChild($)),D}),c.scene!==void 0&&u.getRoot().setDefaultScene(p.scenes[c.scene]),u.getRoot().listExtensionsUsed().forEach(i=>i.read(p)),E.forEach((i,D)=>{const V=p.accessors[D],$=!!i.sparse,J=!i.bufferView&&!V.getArray();($||J)&&V.setSparse(!0).setArray(da(i,p))}),u}static validate(e,r){const o=e.json;if(o.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${o.asset.version}".`);if(o.extensionsRequired){for(const c of o.extensionsRequired)if(!r.extensions.find(u=>u.EXTENSION_NAME===c))throw new Error(`Missing required extension, "${c}".`)}if(o.extensionsUsed)for(const c of o.extensionsUsed)r.extensions.find(u=>u.EXTENSION_NAME===c)||r.logger.warn(`Missing optional extension, "${c}".`)}}function ha(s,e){const r=e.jsonDoc,o=e.bufferViews[s.bufferView],c=r.json.bufferViews[s.bufferView],u=tn[s.componentType],p=ae.getElementSize(s.type),d=u.BYTES_PER_ELEMENT,x=s.byteOffset||0,b=new u(s.count*p),T=new DataView(o.buffer,o.byteOffset,o.byteLength),S=c.byteStride;for(let M=0;M<s.count;M++)for(let E=0;E<p;E++){const A=x+M*S+E*d;let I;switch(s.componentType){case ae.ComponentType.FLOAT:I=T.getFloat32(A,!0);break;case ae.ComponentType.UNSIGNED_INT:I=T.getUint32(A,!0);break;case ae.ComponentType.UNSIGNED_SHORT:I=T.getUint16(A,!0);break;case ae.ComponentType.UNSIGNED_BYTE:I=T.getUint8(A);break;case ae.ComponentType.SHORT:I=T.getInt16(A,!0);break;case ae.ComponentType.BYTE:I=T.getInt8(A);break;default:throw new Error(`Unexpected componentType "${s.componentType}".`)}b[M*p+E]=I}return b}function Kr(s,e){const r=e.jsonDoc,o=e.bufferViews[s.bufferView],c=r.json.bufferViews[s.bufferView],u=tn[s.componentType],p=ae.getElementSize(s.type),d=u.BYTES_PER_ELEMENT,x=p*d;if(c.byteStride!==void 0&&c.byteStride!==x)return ha(s,e);const b=o.byteOffset+(s.byteOffset||0),T=s.count*p*d;return new u(o.buffer.slice(b,b+T))}function da(s,e){const r=tn[s.componentType],o=ae.getElementSize(s.type);let c;s.bufferView!==void 0?c=Kr(s,e):c=new r(s.count*o);const u=s.sparse;if(!u)return c;const p=u.count,d=_e({},s,u.indices,{count:p,type:"SCALAR"}),x=_e({},s,u.values,{count:p}),b=Kr(d,e),T=Kr(x,e);for(let S=0;S<d.count;S++)for(let M=0;M<o;M++)c[b[S]*o+M]=T[S*o+M];return c}var Cr;(function(s){s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Cr||(Cr={}));class Vt{constructor(e,r,o){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=r,this.options=o;const c=e.getRoot(),u=c.listBuffers().length,p=c.listTextures().length;this.bufferURIGenerator=new Yi(u>1,()=>o.basename||"buffer"),this.imageURIGenerator=new Yi(p>1,d=>pa(e,d)||o.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,r){const o={magFilter:r.getMagFilter()||void 0,minFilter:r.getMinFilter()||void 0,wrapS:r.getWrapS(),wrapT:r.getWrapT()},c=JSON.stringify(o);this.samplerDefIndexMap.has(c)||(this.samplerDefIndexMap.set(c,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(o));const u={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(c)},p=JSON.stringify(u);this.textureDefIndexMap.has(p)||(this.textureDefIndexMap.set(p,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(u));const d={index:this.textureDefIndexMap.get(p)};return r.getTexCoord()!==0&&(d.texCoord=r.getTexCoord()),Object.keys(r.getExtras()).length>0&&(d.extras=r.getExtras()),this.textureInfoDefMap.set(r,d),d}createPropertyDef(e){const r={};return e.getName()&&(r.name=e.getName()),Object.keys(e.getExtras()).length>0&&(r.extras=e.getExtras()),r}createAccessorDef(e){const r=this.createPropertyDef(e);return r.type=e.getType(),r.componentType=e.getComponentType(),r.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(c=>c.getName()==="attributes"&&c.getAttributes().key==="POSITION"||c.getName()==="input")&&(r.max=e.getMax([]).map(Math.fround),r.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(r.normalized=e.getNormalized()),r}createImageData(e,r,o){if(this.options.format===St.GLB)this.imageBufferViews.push(r),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:r.byteLength});else{const c=jt.mimeTypeToExtension(o.getMimeType());e.uri=this.imageURIGenerator.createURI(o,c),this.assignResourceURI(e.uri,r,!1)}}assignResourceURI(e,r,o){const c=this.jsonDoc.resources;if(!(e in c)){c[e]=r;return}if(r===c[e]){this.logger.warn(`Duplicate resource URI, "${e}".`);return}const u=`Resource URI "${e}" already assigned to different data.`;if(!o){this.logger.warn(u);return}throw new Error(u)}getAccessorUsage(e){const r=this._accessorUsageMap.get(e);if(r)return r;if(e.getSparse())return Ve.SPARSE;for(const o of this._doc.getGraph().listParentEdges(e)){const{usage:c}=o.getAttributes();if(c)return c;o.getParent().propertyType!==te.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${o.getName()}".`)}return Ve.OTHER}addAccessorToUsageGroup(e,r){const o=this._accessorUsageMap.get(e);if(o&&o!==r)throw new Error(`Accessor with usage "${o}" cannot be reused as "${r}".`);return this._accessorUsageMap.set(e,r),this}}Vt.BufferViewTarget=Cr;Vt.BufferViewUsage=Ve;Vt.USAGE_TO_TARGET={[Ve.ARRAY_BUFFER]:Cr.ARRAY_BUFFER,[Ve.ELEMENT_ARRAY_BUFFER]:Cr.ELEMENT_ARRAY_BUFFER};class Yi{constructor(e,r){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=r}createURI(e,r){if(e.getURI())return e.getURI();if(this.multiple){const o=this.basename(e);return this.counter[o]=this.counter[o]||1,`${o}_${this.counter[o]++}.${r}`}else return`${this.basename(e)}.${r}`}}function pa(s,e){const r=s.getGraph().listParentEdges(e).find(o=>o.getParent()!==s.getRoot());return r?r.getName().replace(/texture$/i,""):""}const{BufferViewUsage:qr}=Vt,{UNSIGNED_INT:ga,UNSIGNED_SHORT:ma,UNSIGNED_BYTE:ya}=ae.ComponentType,xa=new Set([te.ACCESSOR,te.BUFFER,te.MATERIAL,te.MESH]);class ba{static write(e,r){const o=e.getGraph(),c=e.getRoot(),u={asset:_e({generator:`glTF-Transform ${ts}`},c.getAsset()),extras:_e({},c.getExtras())},p={json:u,resources:{}},d=new Vt(e,p,r),x=r.logger||$e.DEFAULT_INSTANCE,b=new Set(r.extensions.map(m=>m.EXTENSION_NAME)),T=e.getRoot().listExtensionsUsed().filter(m=>b.has(m.extensionName)).sort((m,F)=>m.extensionName>F.extensionName?1:-1),S=e.getRoot().listExtensionsRequired().filter(m=>b.has(m.extensionName)).sort((m,F)=>m.extensionName>F.extensionName?1:-1);T.length<e.getRoot().listExtensionsUsed().length&&x.warn("Some extensions were not registered for I/O, and will not be written.");for(const m of T){const F=m.prewriteTypes.filter(N=>!xa.has(N));F.length&&x.warn(`Prewrite hooks for some types (${F.join()}), requested by extension ${m.extensionName}, are unsupported. Please file an issue or a PR.`);for(const N of m.writeDependencies)m.install(N,r.dependencies[N])}function M(m,F,N,j){const U=[];let H=0;for(const V of m){const $=d.createAccessorDef(V);$.bufferView=u.bufferViews.length;const J=V.getArray(),Q=xe.pad(xe.toView(J));$.byteOffset=H,H+=Q.byteLength,U.push(Q),d.accessorIndexMap.set(V,u.accessors.length),u.accessors.push($)}const i=xe.concat(U),D={buffer:F,byteOffset:N,byteLength:i.byteLength};return j&&(D.target=j),u.bufferViews.push(D),{buffers:U,byteLength:H}}function E(m,F,N){const j=m[0].getCount();let U=0;for(const $ of m){const J=d.createAccessorDef($);J.bufferView=u.bufferViews.length,J.byteOffset=U;const Q=$.getElementSize(),Y=$.getComponentSize();U+=xe.padNumber(Q*Y),d.accessorIndexMap.set($,u.accessors.length),u.accessors.push(J)}const H=j*U,i=new ArrayBuffer(H),D=new DataView(i);for(let $=0;$<j;$++){let J=0;for(const Q of m){const Y=Q.getElementSize(),me=Q.getComponentSize(),ie=Q.getComponentType(),le=Q.getArray();for(let pe=0;pe<Y;pe++){const Ce=$*U+J+pe*me,Te=le[$*Y+pe];switch(ie){case ae.ComponentType.FLOAT:D.setFloat32(Ce,Te,!0);break;case ae.ComponentType.BYTE:D.setInt8(Ce,Te);break;case ae.ComponentType.SHORT:D.setInt16(Ce,Te,!0);break;case ae.ComponentType.UNSIGNED_BYTE:D.setUint8(Ce,Te);break;case ae.ComponentType.UNSIGNED_SHORT:D.setUint16(Ce,Te,!0);break;case ae.ComponentType.UNSIGNED_INT:D.setUint32(Ce,Te,!0);break;default:throw new Error("Unexpected component type: "+ie)}}J+=xe.padNumber(Y*me)}}const V={buffer:F,byteOffset:N,byteLength:H,byteStride:U,target:Vt.BufferViewTarget.ARRAY_BUFFER};return u.bufferViews.push(V),{byteLength:H,buffers:[new Uint8Array(i)]}}function A(m,F,N){const j=[];let U=0;const H=new Map;let i=-1/0,D=!1;for(const ie of m){const le=d.createAccessorDef(ie);u.accessors.push(le),d.accessorIndexMap.set(ie,u.accessors.length-1);const pe=[],Ce=[],Te=[],ft=new Array(ie.getElementSize()).fill(0);for(let Ze=0,ur=ie.getCount();Ze<ur;Ze++)if(ie.getElement(Ze,Te),!Ae.eq(Te,ft,0)){i=Math.max(Ze,i),pe.push(Ze);for(let Ye=0;Ye<Te.length;Ye++)Ce.push(Te[Ye])}const yt=pe.length,xt={accessorDef:le,count:yt};if(H.set(ie,xt),yt===0)continue;yt>ie.getCount()/2&&(D=!0);const Ct=tn[ie.getComponentType()];xt.indices=pe,xt.values=new Ct(Ce)}if(!Number.isFinite(i))return{buffers:j,byteLength:U};D&&x.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const V=i<255?Uint8Array:i<65535?Uint16Array:Uint32Array,$=i<255?ya:i<65535?ma:ga,J={buffer:F,byteOffset:N+U,byteLength:0};for(const ie of m){const le=H.get(ie);if(le.count===0)continue;le.indicesByteOffset=J.byteLength;const pe=xe.pad(xe.toView(new V(le.indices)));j.push(pe),U+=pe.byteLength,J.byteLength+=pe.byteLength}u.bufferViews.push(J);const Q=u.bufferViews.length-1,Y={buffer:F,byteOffset:N+U,byteLength:0};for(const ie of m){const le=H.get(ie);if(le.count===0)continue;le.valuesByteOffset=Y.byteLength;const pe=xe.pad(xe.toView(le.values));j.push(pe),U+=pe.byteLength,Y.byteLength+=pe.byteLength}u.bufferViews.push(Y);const me=u.bufferViews.length-1;for(const ie of m){const le=H.get(ie);le.count!==0&&(le.accessorDef.sparse={count:le.count,indices:{bufferView:Q,byteOffset:le.indicesByteOffset,componentType:$},values:{bufferView:me,byteOffset:le.valuesByteOffset}})}return{buffers:j,byteLength:U}}if(u.accessors=[],u.bufferViews=[],u.samplers=[],u.textures=[],u.images=c.listTextures().map((m,F)=>{const N=d.createPropertyDef(m);m.getMimeType()&&(N.mimeType=m.getMimeType());const j=m.getImage();return j&&d.createImageData(N,j,m),d.imageIndexMap.set(m,F),N}),T.filter(m=>m.prewriteTypes.includes(te.ACCESSOR)).forEach(m=>m.prewrite(d,te.ACCESSOR)),c.listAccessors().forEach(m=>{const F=d.accessorUsageGroupedByParent,N=d.accessorParents;if(d.accessorIndexMap.has(m))return;const j=d.getAccessorUsage(m);if(d.addAccessorToUsageGroup(m,j),F.has(j)){const U=o.listParents(m).find(H=>H.propertyType!==te.ROOT);N.set(m,U)}}),T.filter(m=>m.prewriteTypes.includes(te.BUFFER)).forEach(m=>m.prewrite(d,te.BUFFER)),(c.listAccessors().length>0||d.otherBufferViews.size>0||c.listTextures().length>0&&r.format===St.GLB)&&c.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");u.buffers=[],c.listBuffers().forEach((m,F)=>{const N=d.createPropertyDef(m),j=d.accessorUsageGroupedByParent,U=m.listParents().filter(Y=>Y instanceof ae),H=new Set(U.map(Y=>d.accessorParents.get(Y))),i=new Map(Array.from(H).map((Y,me)=>[Y,me])),D={};for(const Y of U){var V;if(d.accessorIndexMap.has(Y))continue;const me=d.getAccessorUsage(Y);let ie=me;if(j.has(me)){const le=d.accessorParents.get(Y);ie+=`:${i.get(le)}`}D[V=ie]||(D[V]={usage:me,accessors:[]}),D[ie].accessors.push(Y)}const $=[],J=u.buffers.length;let Q=0;for(const{usage:Y,accessors:me}of Object.values(D))if(Y===qr.ARRAY_BUFFER&&r.vertexLayout===Jr.INTERLEAVED){const ie=E(me,J,Q);Q+=ie.byteLength;for(const le of ie.buffers)$.push(le)}else if(Y===qr.ARRAY_BUFFER)for(const ie of me){const le=E([ie],J,Q);Q+=le.byteLength;for(const pe of le.buffers)$.push(pe)}else if(Y===qr.SPARSE){const ie=A(me,J,Q);Q+=ie.byteLength;for(const le of ie.buffers)$.push(le)}else if(Y===qr.ELEMENT_ARRAY_BUFFER){const ie=Vt.BufferViewTarget.ELEMENT_ARRAY_BUFFER,le=M(me,J,Q,ie);Q+=le.byteLength;for(const pe of le.buffers)$.push(pe)}else{const ie=M(me,J,Q);Q+=ie.byteLength;for(const le of ie.buffers)$.push(le)}if(d.imageBufferViews.length&&F===0){for(let Y=0;Y<d.imageBufferViews.length;Y++)if(u.bufferViews[u.images[Y].bufferView].byteOffset=Q,Q+=d.imageBufferViews[Y].byteLength,$.push(d.imageBufferViews[Y]),Q%8){const me=8-Q%8;Q+=me,$.push(new Uint8Array(me))}}if(d.otherBufferViews.has(m))for(const Y of d.otherBufferViews.get(m))u.bufferViews.push({buffer:J,byteOffset:Q,byteLength:Y.byteLength}),d.otherBufferViewsIndexMap.set(Y,u.bufferViews.length-1),Q+=Y.byteLength,$.push(Y);if(Q){let Y;r.format===St.GLB?Y=Xr:(Y=d.bufferURIGenerator.createURI(m,"bin"),N.uri=Y),N.byteLength=Q,d.assignResourceURI(Y,xe.concat($),!0)}u.buffers.push(N),d.bufferIndexMap.set(m,F)}),c.listAccessors().find(m=>!m.getBuffer())&&x.warn("Skipped writing one or more Accessors: no Buffer assigned."),T.filter(m=>m.prewriteTypes.includes(te.MATERIAL)).forEach(m=>m.prewrite(d,te.MATERIAL)),u.materials=c.listMaterials().map((m,F)=>{const N=d.createPropertyDef(m);if(m.getAlphaMode()!==Ht.AlphaMode.OPAQUE&&(N.alphaMode=m.getAlphaMode()),m.getAlphaMode()===Ht.AlphaMode.MASK&&(N.alphaCutoff=m.getAlphaCutoff()),m.getDoubleSided()&&(N.doubleSided=!0),N.pbrMetallicRoughness={},Ae.eq(m.getBaseColorFactor(),[1,1,1,1])||(N.pbrMetallicRoughness.baseColorFactor=m.getBaseColorFactor()),Ae.eq(m.getEmissiveFactor(),[0,0,0])||(N.emissiveFactor=m.getEmissiveFactor()),m.getRoughnessFactor()!==1&&(N.pbrMetallicRoughness.roughnessFactor=m.getRoughnessFactor()),m.getMetallicFactor()!==1&&(N.pbrMetallicRoughness.metallicFactor=m.getMetallicFactor()),m.getBaseColorTexture()){const j=m.getBaseColorTexture(),U=m.getBaseColorTextureInfo();N.pbrMetallicRoughness.baseColorTexture=d.createTextureInfoDef(j,U)}if(m.getEmissiveTexture()){const j=m.getEmissiveTexture(),U=m.getEmissiveTextureInfo();N.emissiveTexture=d.createTextureInfoDef(j,U)}if(m.getNormalTexture()){const j=m.getNormalTexture(),U=m.getNormalTextureInfo(),H=d.createTextureInfoDef(j,U);m.getNormalScale()!==1&&(H.scale=m.getNormalScale()),N.normalTexture=H}if(m.getOcclusionTexture()){const j=m.getOcclusionTexture(),U=m.getOcclusionTextureInfo(),H=d.createTextureInfoDef(j,U);m.getOcclusionStrength()!==1&&(H.strength=m.getOcclusionStrength()),N.occlusionTexture=H}if(m.getMetallicRoughnessTexture()){const j=m.getMetallicRoughnessTexture(),U=m.getMetallicRoughnessTextureInfo();N.pbrMetallicRoughness.metallicRoughnessTexture=d.createTextureInfoDef(j,U)}return d.materialIndexMap.set(m,F),N}),T.filter(m=>m.prewriteTypes.includes(te.MESH)).forEach(m=>m.prewrite(d,te.MESH)),u.meshes=c.listMeshes().map((m,F)=>{const N=d.createPropertyDef(m);let j=null;return N.primitives=m.listPrimitives().map(U=>{const H={attributes:{}};H.mode=U.getMode();const i=U.getMaterial();i&&(H.material=d.materialIndexMap.get(i)),Object.keys(U.getExtras()).length&&(H.extras=U.getExtras());const D=U.getIndices();D&&(H.indices=d.accessorIndexMap.get(D));for(const V of U.listSemantics())H.attributes[V]=d.accessorIndexMap.get(U.getAttribute(V));for(const V of U.listTargets()){const $={};for(const J of V.listSemantics())$[J]=d.accessorIndexMap.get(V.getAttribute(J));H.targets=H.targets||[],H.targets.push($)}return U.listTargets().length&&!j&&(j=U.listTargets().map(V=>V.getName())),H}),m.getWeights().length&&(N.weights=m.getWeights()),j&&(N.extras=N.extras||{},N.extras.targetNames=j),d.meshIndexMap.set(m,F),N}),u.cameras=c.listCameras().map((m,F)=>{const N=d.createPropertyDef(m);if(N.type=m.getType(),N.type===zt.Type.PERSPECTIVE){N.perspective={znear:m.getZNear(),zfar:m.getZFar(),yfov:m.getYFov()};const j=m.getAspectRatio();j!==null&&(N.perspective.aspectRatio=j)}else N.orthographic={znear:m.getZNear(),zfar:m.getZFar(),xmag:m.getXMag(),ymag:m.getYMag()};return d.cameraIndexMap.set(m,F),N}),u.nodes=c.listNodes().map((m,F)=>{const N=d.createPropertyDef(m);return Ae.eq(m.getTranslation(),[0,0,0])||(N.translation=m.getTranslation()),Ae.eq(m.getRotation(),[0,0,0,1])||(N.rotation=m.getRotation()),Ae.eq(m.getScale(),[1,1,1])||(N.scale=m.getScale()),m.getWeights().length&&(N.weights=m.getWeights()),d.nodeIndexMap.set(m,F),N}),u.skins=c.listSkins().map((m,F)=>{const N=d.createPropertyDef(m),j=m.getInverseBindMatrices();j&&(N.inverseBindMatrices=d.accessorIndexMap.get(j));const U=m.getSkeleton();return U&&(N.skeleton=d.nodeIndexMap.get(U)),N.joints=m.listJoints().map(H=>d.nodeIndexMap.get(H)),d.skinIndexMap.set(m,F),N}),c.listNodes().forEach((m,F)=>{const N=u.nodes[F],j=m.getMesh();j&&(N.mesh=d.meshIndexMap.get(j));const U=m.getCamera();U&&(N.camera=d.cameraIndexMap.get(U));const H=m.getSkin();H&&(N.skin=d.skinIndexMap.get(H)),m.listChildren().length>0&&(N.children=m.listChildren().map(i=>d.nodeIndexMap.get(i)))}),u.animations=c.listAnimations().map((m,F)=>{const N=d.createPropertyDef(m),j=new Map;return N.samplers=m.listSamplers().map((U,H)=>{const i=d.createPropertyDef(U);return i.input=d.accessorIndexMap.get(U.getInput()),i.output=d.accessorIndexMap.get(U.getOutput()),i.interpolation=U.getInterpolation(),j.set(U,H),i}),N.channels=m.listChannels().map(U=>{const H=d.createPropertyDef(U);return H.sampler=j.get(U.getSampler()),H.target={node:d.nodeIndexMap.get(U.getTargetNode()),path:U.getTargetPath()},H}),d.animationIndexMap.set(m,F),N}),u.scenes=c.listScenes().map((m,F)=>{const N=d.createPropertyDef(m);return N.nodes=m.listChildren().map(j=>d.nodeIndexMap.get(j)),d.sceneIndexMap.set(m,F),N});const L=c.getDefaultScene();return L&&(u.scene=c.listScenes().indexOf(L)),u.extensionsUsed=T.map(m=>m.extensionName),u.extensionsRequired=S.map(m=>m.extensionName),T.forEach(m=>m.write(d)),va(u),p}}function va(s){const e=[];for(const r in s){const o=s[r];(Array.isArray(o)&&o.length===0||o===null||o===""||o&&typeof o=="object"&&Object.keys(o).length===0)&&e.push(r)}for(const r of e)delete s[r]}var Qr;(function(s){s[s.JSON=1313821514]="JSON",s[s.BIN=5130562]="BIN"})(Qr||(Qr={}));class Ta{constructor(){this._logger=$e.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=Jr.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const r of e)this._extensions.add(r),r.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const r=await this.readURI(e,"view");this.lastReadBytes=r.byteLength;const o=Ki(r)?this._binaryToJSON(r):{json:JSON.parse(xe.decodeText(r)),resources:{}};return await this._readResourcesExternal(o,this.dirname(e)),this._readResourcesInternal(o),o}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),fa.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const r=this._binaryToJSON(xe.assertView(e));this._readResourcesInternal(r);const o=r.json;if(o.buffers&&o.buffers.some(c=>wa(r,c)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(o.images&&o.images.some(c=>Ea(r,c)))throw new Error("Cannot resolve external images with binaryToJSON().");return r}async readBinary(e){return this.readJSON(await this.binaryToJSON(xe.assertView(e)))}async writeJSON(e,r={}){if(r.format===St.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0â1 buffers.");return ba.write(e,{format:r.format||St.GLTF,basename:r.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:_e({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:r,resources:o}=await this.writeJSON(e,{format:St.GLB}),c=new Uint32Array([1179937895,2,12]),u=JSON.stringify(r),p=xe.pad(xe.encodeText(u),32),d=xe.toView(new Uint32Array([p.byteLength,1313821514])),x=xe.concat([d,p]);c[c.length-1]+=x.byteLength;const b=Object.values(o)[0];if(!b||!b.byteLength)return xe.concat([xe.toView(c),x]);const T=xe.pad(b,0),S=xe.toView(new Uint32Array([T.byteLength,5130562])),M=xe.concat([S,T]);return c[c.length-1]+=M.byteLength,xe.concat([xe.toView(c),x,M])}async _readResourcesExternal(e,r){var o=this;const c=e.json.images||[],u=e.json.buffers||[],p=[...c,...u].map(async function(d){const x=d.uri;if(!x||x.match(/data:/))return Promise.resolve();e.resources[x]=await o.readURI(o.resolve(r,x),"view"),o.lastReadBytes+=e.resources[x].byteLength});await Promise.all(p)}_readResourcesInternal(e){function r(u){if(u.uri){if(u.uri in e.resources){xe.assertView(e.resources[u.uri]);return}if(u.uri.match(/data:/)){const p=`__${ra()}.${or.extension(u.uri)}`;e.resources[p]=xe.createBufferFromDataURI(u.uri),u.uri=p}}}(e.json.images||[]).forEach(u=>{if(u.bufferView===void 0&&u.uri===void 0)throw new Error("Missing resource URI or buffer view.");r(u)}),(e.json.buffers||[]).forEach(r)}_copyJSON(e){const{images:r,buffers:o}=e.json;return e={json:_e({},e.json),resources:_e({},e.resources)},r&&(e.json.images=r.map(c=>_e({},c))),o&&(e.json.buffers=o.map(c=>_e({},c))),e}_binaryToJSON(e){if(!Ki(e))throw new Error("Invalid glTF 2.0 binary.");const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==Qr.JSON)throw new Error("Missing required GLB JSON chunk.");const o=20,c=r[0],u=xe.decodeText(xe.toView(e,o,c)),p=JSON.parse(u),d=o+c;if(e.byteLength<=d)return{json:p,resources:{}};const x=new Uint32Array(e.buffer,e.byteOffset+d,2);if(x[1]!==Qr.BIN)return{json:p,resources:{}};const b=x[0],T=xe.toView(e,d+8,b);return{json:p,resources:{[Xr]:T}}}}function wa(s,e){return e.uri!==void 0&&!(e.uri in s.resources)}function Ea(s,e){return e.uri!==void 0&&!(e.uri in s.resources)&&e.bufferView===void 0}function Ki(s){if(s.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(s.buffer,s.byteOffset,3);return e[0]===1179937895&&e[1]===2}class Sa extends Ta{constructor(e=Sr.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=e}async readURI(e,r){const o=await fetch(e,this._fetchConfig);switch(r){case"view":return new Uint8Array(await o.arrayBuffer());case"text":return o.text()}}resolve(e,r){return Sr.resolve(e,r)}dirname(e){return Sr.dirname(e)}}class Dt{static triangle(e){const r=new Float32Array([0,0,.5,.5,0,0,-.5,-.5,0,1,0,.5,-.5,1,1]);return _t(e,r)}static quad(e,r=1){const o=r/2,c=new Float32Array([-o,-o,0,0,0,o,-o,0,1,0,o,o,0,1,1,-o,o,0,0,1]),u=new Uint32Array([0,1,2,0,2,3]);return _t(e,c,u)}static customQuad(e,r,o=1){if(r.length!==4)throw new Error(`customQuad requires exactly 4 points, got ${r.length}`);const c=o+1,u=o+1,p=c*u,d=new Float32Array(p*5);for(let S=0;S<c;S++)for(let M=0;M<u;M++){const E=M/o,A=S/o,I=(S*u+M)*5,L=(1-E)*(1-A)*r[0][0]+E*(1-A)*r[1][0]+E*A*r[2][0]+(1-E)*A*r[3][0],m=(1-E)*(1-A)*r[0][1]+E*(1-A)*r[1][1]+E*A*r[2][1]+(1-E)*A*r[3][1],F=(1-E)*(1-A)*r[0][2]+E*(1-A)*r[1][2]+E*A*r[2][2]+(1-E)*A*r[3][2];d[I+0]=L,d[I+1]=m,d[I+2]=F,d[I+3]=E,d[I+4]=A}const x=o*o,b=new Uint32Array(x*6);let T=0;for(let S=0;S<o;S++)for(let M=0;M<o;M++){const E=S*u+M,A=E+1,I=(S+1)*u+M,L=I+1;b[T++]=E,b[T++]=I,b[T++]=A,b[T++]=A,b[T++]=I,b[T++]=L}return _t(e,d,b)}static plane(e,r=1,o=1){const c=r/2,u=o/2,p=new Float32Array([-c,0,-u,0,0,c,0,-u,1,0,c,0,u,1,1,-c,0,u,0,1]),d=new Uint32Array([0,2,1,0,3,2]);return _t(e,p,d)}static parsePrimitive(e,r,o){var T,S,M;const c=(T=r.getAttribute("POSITION"))==null?void 0:T.getArray(),u=(S=r.getAttribute("TEXCOORD_0"))==null?void 0:S.getArray(),p=(M=r.getIndices())==null?void 0:M.getArray();if(!c)throw new Error(`Missing position data in primitive: ${o}`);const d=c.length/3,x=new Float32Array(d*5);for(let E=0;E<d;E++)x[E*5+0]=c[E*3+0],x[E*5+1]=c[E*3+1],x[E*5+2]=c[E*3+2],x[E*5+3]=u?u[E*2+0]:0,x[E*5+4]=u?u[E*2+1]:0;const b=p?new Uint32Array(p):void 0;return _t(e,x,b)}static async fromGLTF(e,r){const p=(await new Sa().read(r)).getRoot().listMeshes();if(p.length===0)throw new Error(`No meshes found in glTF file: ${r}`);const d=[];for(let x=0;x<p.length;x++){const T=p[x].listPrimitives();for(let S=0;S<T.length;S++){const M=`${r}[mesh=${x}, primitive=${S}]`;d.push(this.parsePrimitive(e,T[S],M))}}return console.log(`MeshFactory: Loaded ${d.length} submeshes from ${r}`),d}static fromHeightmap(e,r,o,c,u={}){const{targetSize:p=20,heightScale:d=.001}=u;if(r.length!==o*c)throw new Error(`Heightmap data size mismatch: expected ${o*c}, got ${r.length}`);const x=o,b=c,T=p/2;let S=r[0],M=r[0];for(let m=1;m<r.length;m++)r[m]<S&&(S=r[m]),r[m]>M&&(M=r[m]);const E=new Float32Array(b*x*5);for(let m=0;m<b;m++)for(let F=0;F<x;F++){const N=(m*x+F)*5,j=F/(x-1)*p-T,U=m/(b-1)*p-T,H=r[m*x+F]*d;E[N+0]=j,E[N+1]=H,E[N+2]=U,E[N+3]=F/(x-1),E[N+4]=m/(b-1)}const A=(b-1)*(x-1),I=new Uint32Array(A*6);let L=0;for(let m=0;m<b-1;m++)for(let F=0;F<x-1;F++){const N=m*x+F,j=N+1,U=(m+1)*x+F,H=U+1;I[L++]=N,I[L++]=U,I[L++]=j,I[L++]=j,I[L++]=U,I[L++]=H}return console.log(`MeshFactory: Terrain ${x}x${b} in ${p}x${p} box, height: ${S.toFixed(1)}m - ${M.toFixed(1)}m`),_t(e,E,I)}static fromRawData(e,r,o,c){return _t(e,r,o,c??rr)}}class wt{static async fromSatelliteImage(e,r,o,c,u){const{zoom:p=15,size:d=640,apiKey:x,scale:b=2}=u,T=`https://maps.googleapis.com/maps/api/staticmap?center=${r},${o}&zoom=${p}&size=${d}x${d}&scale=${b}&maptype=satellite&key=${x}`;console.log(`ð°ï¸ Fetching satellite image: zoom=${p}, size=${d}x${d}`),console.log(`ð°ï¸ URL: ${T}`);try{const S=await fetch(T);if(!S.ok){const N=await S.text();throw console.error("â Static Maps API error:",S.status,N),new Error(`Failed to fetch satellite image: ${S.status} - Check if "Maps Static API" is enabled in Google Cloud Console`)}const M=S.headers.get("content-type");if(!(M!=null&&M.includes("image"))){const N=await S.text();throw console.error("â Static Maps API returned non-image:",N),new Error("Static Maps API error - Check console for details")}const E=await S.blob(),A=await createImageBitmap(E);console.log(`â Satellite image loaded: ${A.width}x${A.height}`);const I=e.createTexture({size:{width:A.width,height:A.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});e.queue.copyExternalImageToTexture({source:A},{texture:I},[A.width,A.height]);const L=I.createView({format:"rgba8unorm",dimension:"2d",aspect:"all",baseMipLevel:0,mipLevelCount:1}),m=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear"}),F=e.createBindGroup({layout:c,entries:[{binding:0,resource:L},{binding:1,resource:m}]});return console.log(`â Satellite texture created: ${A.width}x${A.height}`),{bindGroup:F,texture:I,sampler:m,view:L}}catch(S){throw console.error("â Satellite image fetch failed:",S),S}}static async fromTexture(e,r,o,c={}){const{addressMode:u="repeat",filterMode:p="linear"}=c,x=await(await fetch(r)).blob(),b=await createImageBitmap(x),T=e.createTexture({size:{width:b.width,height:b.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});e.queue.copyExternalImageToTexture({source:b},{texture:T},[b.width,b.height]);const S=T.createView({format:"rgba8unorm",dimension:"2d",aspect:"all",baseMipLevel:0,mipLevelCount:1}),M=e.createSampler({addressModeU:u,addressModeV:u,magFilter:p,minFilter:p});return{bindGroup:e.createBindGroup({layout:o,entries:[{binding:0,resource:S},{binding:1,resource:M}]}),texture:T,sampler:M,view:S}}static fromColor(e,r,o){const c=new Uint8Array([Math.floor(r[0]*255),Math.floor(r[1]*255),Math.floor(r[2]*255),Math.floor(r[3]*255)]),u=e.createTexture({size:{width:1,height:1},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST});e.queue.writeTexture({texture:u},c,{bytesPerRow:4},{width:1,height:1});const p=u.createView(),d=e.createSampler({magFilter:"nearest",minFilter:"nearest"});return{bindGroup:e.createBindGroup({layout:o,entries:[{binding:0,resource:p},{binding:1,resource:d}]}),texture:u,sampler:d,view:p}}static fromGHIData(e,r,o,c,u,p,d){const x=new Uint8Array(o*c*4);for(let E=0;E<r.length;E++){const A=(r[E]-u)/(p-u);let I,L,m;if(A<.5){const N=A*2;I=0,L=Math.floor(N*255),m=Math.floor((1-N)*255)}else{const N=(A-.5)*2;I=Math.floor(N*255),L=255,m=0}const F=E*4;x[F+0]=I,x[F+1]=L,x[F+2]=m,x[F+3]=255}const b=e.createTexture({size:{width:o,height:c},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});e.queue.writeTexture({texture:b},x,{bytesPerRow:o*4},{width:o,height:c});const T=b.createView({format:"rgba8unorm",dimension:"2d"}),S=e.createSampler({magFilter:"linear",minFilter:"linear"});return{bindGroup:e.createBindGroup({layout:d,entries:[{binding:0,resource:T},{binding:1,resource:S}]}),texture:b,sampler:S,view:T}}static fromRawData(e,r,o,c,u,p={}){const{format:d="rgba8unorm",filterMode:x="linear"}=p,b=e.createTexture({size:{width:o,height:c},format:d,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST});e.queue.writeTexture({texture:b},r,{bytesPerRow:o*4},{width:o,height:c});const T=b.createView(),S=e.createSampler({magFilter:x,minFilter:x});return{bindGroup:e.createBindGroup({layout:u,entries:[{binding:0,resource:T},{binding:1,resource:S}]}),texture:b,sampler:S,view:T}}static createTerrainMaterial(e,r,o,c,u){const p=new Uint8Array(r.width*r.height*4);for(let A=0;A<r.data.length;A++){const I=(r.data[A]-r.minGHI)/(r.maxGHI-r.minGHI);let L,m,F;if(I<.5){const j=I*2;L=0,m=Math.floor(j*255),F=Math.floor((1-j)*255)}else{const j=(I-.5)*2;L=Math.floor(j*255),m=255,F=0}const N=A*4;p[N+0]=L,p[N+1]=m,p[N+2]=F,p[N+3]=255}const d=e.createTexture({size:{width:r.width,height:r.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST});e.queue.writeTexture({texture:d},p,{bytesPerRow:r.width*4},{width:r.width,height:r.height});const x=d.createView(),b=e.createSampler({magFilter:"linear",minFilter:"linear"});let T,S;o.data?(T=e.createTexture({size:{width:o.data.width,height:o.data.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),e.queue.copyExternalImageToTexture({source:o.data},{texture:T},[o.data.width,o.data.height]),S=T.createView()):(T=e.createTexture({size:{width:1,height:1},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST}),e.queue.writeTexture({texture:T},new Uint8Array([0,0,0,0]),{bytesPerRow:4},{width:1,height:1}),S=T.createView());const M=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear"}),E=e.createBindGroup({layout:c,entries:[{binding:0,resource:x},{binding:1,resource:b},{binding:2,resource:S},{binding:3,resource:M},{binding:4,resource:{buffer:u}}]});return console.log(`ð¨ Terrain material created: GHI ${r.width}x${r.height}, Satellite: ${o.data?"loaded":"placeholder"}`),{bindGroup:E,texture:d,sampler:b,view:x}}static async fetchSatelliteImage(e,r,o,c={}){const{zoom:u=17,size:p=640,scale:d=2}=c,x=`https://maps.googleapis.com/maps/api/staticmap?center=${e},${r}&zoom=${u}&size=${p}x${p}&scale=${d}&maptype=satellite&key=${o}`;try{const b=await fetch(x);if(!b.ok)return console.error("â Failed to fetch satellite image:",b.status),null;const T=b.headers.get("content-type");if(!(T!=null&&T.includes("image")))return console.error("â Static Maps API returned non-image response"),null;const S=await b.blob(),M=await createImageBitmap(S);return console.log(`â Satellite image fetched: ${M.width}x${M.height}`),M}catch(b){return console.error("â Satellite fetch error:",b),null}}}class Aa{constructor(e){q(this,"canvas");q(this,"renderer");q(this,"scene");q(this,"keyLabel");q(this,"mouseXLabel");q(this,"mouseYLabel");q(this,"forwardsAmount",0);q(this,"rightAmount",0);q(this,"upAmount",0);q(this,"cameraControlActive",!1);q(this,"billboardPositions",[]);q(this,"quadCreated",!1);q(this,"run",()=>{this.scene.moveCamera(this.forwardsAmount,this.rightAmount,this.upAmount),this.scene.update(),this.renderer.render(this.scene.getRenderData()),requestAnimationFrame(this.run)});q(this,"billboardMaterial",null);q(this,"quadMaterial",null);this.canvas=e,this.renderer=new Fo(e),this.scene=new Go,this.keyLabel=document.getElementById("keyboardKey"),this.mouseXLabel=document.getElementById("mousex"),this.mouseYLabel=document.getElementById("mousey"),_i(document).on("keydown",r=>this.handleKeyPress(r)),_i(document).on("keyup",r=>this.handleKeyRelease(r)),this.canvas.addEventListener("mousemove",r=>this.handleMouseMove(r)),this.canvas.addEventListener("click",r=>this.handleClick(r)),document.addEventListener("pointerlockchange",()=>{this.cameraControlActive=document.pointerLockElement===this.canvas,console.log(`ð® Camera control: ${this.cameraControlActive?"ON":"OFF"}`)}),window.addEventListener("resize",()=>this.resizeCanvas())}async init(){this.resizeCanvas(),await this.renderer.init(),await this.createInitialObjects()}resizeCanvas(){const e=this.canvas.parentElement;if(!e)return;const r=e.clientWidth,o=e.clientHeight;(this.canvas.width!==r||this.canvas.height!==o)&&(this.canvas.width=r,this.canvas.height=o,this.renderer.getDevice()&&this.renderer.resize(),console.log(`ð Canvas resized to ${r}x${o}`))}async createInitialObjects(){const e=this.renderer.getDevice(),r=this.renderer.getMaterialGroupLayout(),o=await Dt.fromGLTF(e,"models/flat_vase.glb"),c=await wt.fromTexture(e,"img/floor.jpg",r),u=await Dt.fromGLTF(e,"models/panel.glb"),p=await wt.fromTexture(e,"img/panelbaked.png",r);for(const E of u){const A=new ct({mesh:E,material:p.bindGroup,transform:new Xe(Se(0,1,2),Se(0,45,90),Se(.01,.01,.01))});this.scene.add(A)}const d=o[0],x=new ct({mesh:d,material:c.bindGroup,transform:new Xe(Se(0,0,0),Se(0,0,0),Se(1,1,1)),onUpdate:(E,A)=>{E.transform.rotate(0,0,6)}}),b=new ct({mesh:d,material:c.bindGroup,transform:new Xe(Se(0,0,.5),Se(0,0,0),Se(1,1,1)),onUpdate:(E,A)=>{E.transform.rotate(0,0,6)}});this.scene.add(x),this.scene.add(b);const T=Dt.quad(e),S=await wt.fromColor(e,[1,0,0,1],r),M=new ct({mesh:T,material:S.bindGroup,renderType:ut.Billboard,transform:new Xe(Se(2,1,3),Se(0,0,0))});this.scene.add(M);for(let E=-5;E<=5;E++){const A=Dt.triangle(e),I=await wt.fromTexture(e,"img/floor.jpg",r),L=new ct({mesh:A,material:I.bindGroup,transform:new Xe(Se(2,E,0),Se(0,0,0)),onUpdate:(m,F)=>{m.transform.rotate(0,0,6)}});this.scene.add(L)}}handleKeyPress(e){if(this.keyLabel.innerHTML=e.code,e.code==="KeyC"){this.toggleCameraControl();return}if(this.cameraControlActive)switch(e.code){case"KeyW":this.forwardsAmount=.1;break;case"KeyS":this.forwardsAmount=-.1;break;case"KeyA":this.rightAmount=-.1;break;case"KeyD":this.rightAmount=.1;break;case"KeyE":this.upAmount=.1;break;case"KeyQ":this.upAmount=-.1;break}}handleKeyRelease(e){switch(this.keyLabel.innerHTML=e.code,e.code){case"KeyW":case"KeyS":this.forwardsAmount=0;break;case"KeyA":case"KeyD":this.rightAmount=0;break;case"KeyE":case"KeyQ":this.upAmount=0;break}}handleMouseMove(e){this.mouseXLabel.innerHTML=e.clientX.toString(),this.mouseYLabel.innerHTML=e.clientY.toString(),this.cameraControlActive&&this.scene.spinCamera(e.movementX/10,-e.movementY/10)}toggleCameraControl(){this.cameraControlActive?document.exitPointerLock():this.canvas.requestPointerLock()}async handleClick(e){if(this.cameraControlActive)return;if(this.quadCreated){console.log("â Quad already created, no more billboards");return}const r=this.canvas.getBoundingClientRect(),o=e.clientX-r.left,c=e.clientY-r.top;this.renderer.renderPickingPass(this.scene.getRenderData());const u=await this.renderer.readWorldPosition(o,c);if(!u){console.log(`â Click at (${o.toFixed(0)}, ${c.toFixed(0)}) - no terrain hit`);return}this.billboardPositions.push(Bt(u)),await this.spawnBillboard(u),console.log(`ð Billboard ${this.billboardPositions.length}/4 at (${u[0].toFixed(2)}, ${u[1].toFixed(2)}, ${u[2].toFixed(2)})`),this.billboardPositions.length===4&&(await this.createQuadFromPoints(this.billboardPositions),this.quadCreated=!0,console.log("â Quad created! No more billboards allowed."))}async createQuadFromPoints(e){console.log("ð· createQuadFromPoints called with:",e.map(p=>`(${p[0].toFixed(2)}, ${p[1].toFixed(2)}, ${p[2].toFixed(2)})`));const r=this.renderer.getDevice(),o=this.renderer.getMaterialGroupLayout();this.quadMaterial||(this.quadMaterial=await wt.fromColor(r,[1,.2,.2,1],o));const c=Dt.customQuad(r,e);console.log(`   Mesh created: ${c.vertexCount} vertices, ${c.indexCount} indices`);const u=new ct({mesh:c,material:this.quadMaterial.bindGroup,renderType:ut.Standard,transform:new Xe});this.scene.add(u),console.log("â Quad added to scene")}async spawnBillboard(e){const r=this.renderer.getDevice(),o=this.renderer.getMaterialGroupLayout();this.billboardMaterial||(this.billboardMaterial=await wt.fromColor(r,[1,.3,0,1],o));const c=Dt.quad(r,.3),u=new ct({mesh:c,material:this.billboardMaterial.bindGroup,renderType:ut.Billboard,transform:new Xe(Se(e[0],e[1]+.15,e[2]),Se(0,0,0),Se(1,1,1))});this.scene.add(u),console.log(` Billboard at (${e[0].toFixed(2)}, ${e[1].toFixed(2)}, ${e[2].toFixed(2)})`)}}function Pe(s){return(e,...r)=>Ra(s,e,r)}function ar(s,e){return Pe(hs(s,e).get)}const{apply:Ra,getOwnPropertyDescriptor:hs,getPrototypeOf:qn,ownKeys:Ca}=Reflect,{iterator:Pr,toStringTag:Ia}=Symbol,Ma=Object,{create:$n,defineProperty:Pa}=Ma,Na=Array,Oa=Na.prototype,ds=Oa[Pr],La=Pe(ds),ps=ArrayBuffer,_a=ps.prototype;ar(_a,"byteLength");const Wi=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Wi&&ar(Wi.prototype,"byteLength");const gs=qn(Uint8Array);gs.from;const De=gs.prototype;De[Pr];Pe(De.keys);Pe(De.values);Pe(De.entries);Pe(De.set);Pe(De.reverse);Pe(De.fill);Pe(De.copyWithin);Pe(De.sort);Pe(De.slice);Pe(De.subarray);ar(De,"buffer");ar(De,"byteOffset");ar(De,"length");ar(De,Ia);const Ba=Uint8Array,ms=Uint16Array,Yn=Uint32Array,Da=Float32Array,Ir=qn([][Pr]()),ys=Pe(Ir.next),Fa=Pe(function*(){}().next),Ua=qn(Ir),Ga=DataView.prototype,ka=Pe(Ga.getUint16),Kn=WeakMap,xs=Kn.prototype,bs=Pe(xs.get),ja=Pe(xs.set),vs=new Kn,Va=$n(null,{next:{value:function(){const e=bs(vs,this);return ys(e)}},[Pr]:{value:function(){return this}}});function Ha(s){if(s[Pr]===ds&&Ir.next===ys)return s;const e=$n(Va);return ja(vs,e,La(s)),e}const za=new Kn,qa=$n(Ua,{next:{value:function(){const e=bs(za,this);return Fa(e)},writable:!0,configurable:!0}});for(const s of Ca(Ir))s!=="next"&&Pa(qa,s,hs(Ir,s));const Ts=new ps(4),$a=new Da(Ts),Ya=new Yn(Ts),st=new ms(512),ot=new Ba(512);for(let s=0;s<256;++s){const e=s-127;e<-24?(st[s]=0,st[s|256]=32768,ot[s]=24,ot[s|256]=24):e<-14?(st[s]=1024>>-e-14,st[s|256]=1024>>-e-14|32768,ot[s]=-e-1,ot[s|256]=-e-1):e<=15?(st[s]=e+15<<10,st[s|256]=e+15<<10|32768,ot[s]=13,ot[s|256]=13):e<128?(st[s]=31744,st[s|256]=64512,ot[s]=24,ot[s|256]=24):(st[s]=31744,st[s|256]=64512,ot[s]=13,ot[s|256]=13)}const Wn=new Yn(2048);for(let s=1;s<1024;++s){let e=s<<13,r=0;for(;!(e&8388608);)e<<=1,r-=8388608;e&=-8388609,r+=947912704,Wn[s]=e|r}for(let s=1024;s<2048;++s)Wn[s]=939524096+(s-1024<<13);const cr=new Yn(64);for(let s=1;s<31;++s)cr[s]=s<<23;cr[31]=1199570944;cr[32]=2147483648;for(let s=33;s<63;++s)cr[s]=2147483648+(s-32<<23);cr[63]=3347054592;const ws=new ms(64);for(let s=1;s<64;++s)s!==32&&(ws[s]=1024);function Ka(s){const e=s>>10;return Ya[0]=Wn[ws[e]+(s&1023)]+cr[e],$a[0]}function Es(s,e,...r){return Ka(ka(s,e,...Ha(r)))}function Ln(s,e,r){const o=typeof s=="object"?s.outer:s,c=o.slice(0,o.indexOf(">")+1),u=['"',"'"];for(let p=0;p<u.length;p++){const d=u[p],x=e+"\\="+d+"([^"+d+"]*)"+d,T=new RegExp(x).exec(c);if(T)return T[1]}}function Wa(s,e,r){const c=new RegExp(e).exec(s.slice(r));return c?r+c.index:-1}function _n(s,e,r){const c=new RegExp(e).exec(s.slice(r));return c?r+c.index+c[0].length-1:-1}function Xi(s,e){const r=new RegExp(e,"g"),o=s.match(r);return o?o.length:0}function Xa(s,e,r){const o=r&&r.debug||!1,c=!(r&&typeof r.nested===!1),u=r&&r.startIndex||0;o&&console.log("[xml-utils] starting findTagByName with",e," and ",r);const p=Wa(s,`<${e}[ 
>/]`,u);if(o&&console.log("[xml-utils] start:",p),p===-1)return;const d=s.slice(p+e.length);let x=_n(d,"^[^<]*[ /]>",0);const b=x!==-1&&d[x-1]==="/";if(o&&console.log("[xml-utils] selfClosing:",b),b===!1)if(c){let E=0,A=1,I=0;for(;(x=_n(d,"[ /]"+e+">",E))!==-1;){const L=d.substring(E,x+1);if(A+=Xi(L,"<"+e+`[ 
	>]`),I+=Xi(L,"</"+e+">"),I>=A)break;E=x}}else x=_n(d,"[ /]"+e+">",0);const T=p+e.length+x+1;if(o&&console.log("[xml-utils] end:",T),T===-1)return;const S=s.slice(p,T);let M;return b?M=null:M=S.slice(S.indexOf(">")+1,S.lastIndexOf("<")),{inner:M,outer:S,start:p,end:T}}function Ja(s,e,r){const o=[];let u=0,p;for(;p=Xa(s,e,{debug:!1,startIndex:u});)u=p.start+1+e.length,o.push(p);return o}const Ar={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34412:"CZ_LSMINFO",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},at={};for(const s in Ar)Ar.hasOwnProperty(s)&&(at[Ar[s]]=parseInt(s,10));const Za=[at.BitsPerSample,at.ExtraSamples,at.SampleFormat,at.StripByteCounts,at.StripOffsets,at.StripRowCounts,at.TileByteCounts,at.TileOffsets,at.SubIFDs],Bn={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ce={};for(const s in Bn)Bn.hasOwnProperty(s)&&(ce[Bn[s]]=parseInt(s,10));const je={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8},Qa={Unspecified:0},Gc={AddCompression:1},kc={None:0,Deflate:1,Zstandard:2},ec={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function tc(s,e){const{width:r,height:o}=s,c=new Uint8Array(r*o*3);let u;for(let p=0,d=0;p<s.length;++p,d+=3)u=256-s[p]/e*256,c[d]=u,c[d+1]=u,c[d+2]=u;return c}function rc(s,e){const{width:r,height:o}=s,c=new Uint8Array(r*o*3);let u;for(let p=0,d=0;p<s.length;++p,d+=3)u=s[p]/e*256,c[d]=u,c[d+1]=u,c[d+2]=u;return c}function nc(s,e){const{width:r,height:o}=s,c=new Uint8Array(r*o*3),u=e.length/3,p=e.length/3*2;for(let d=0,x=0;d<s.length;++d,x+=3){const b=s[d];c[x]=e[b]/65536*256,c[x+1]=e[b+u]/65536*256,c[x+2]=e[b+p]/65536*256}return c}function ic(s){const{width:e,height:r}=s,o=new Uint8Array(e*r*3);for(let c=0,u=0;c<s.length;c+=4,u+=3){const p=s[c],d=s[c+1],x=s[c+2],b=s[c+3];o[u]=255*((255-p)/256)*((255-b)/256),o[u+1]=255*((255-d)/256)*((255-b)/256),o[u+2]=255*((255-x)/256)*((255-b)/256)}return o}function sc(s){const{width:e,height:r}=s,o=new Uint8ClampedArray(e*r*3);for(let c=0,u=0;c<s.length;c+=3,u+=3){const p=s[c],d=s[c+1],x=s[c+2];o[u]=p+1.402*(x-128),o[u+1]=p-.34414*(d-128)-.71414*(x-128),o[u+2]=p+1.772*(d-128)}return o}const oc=.95047,ac=1,cc=1.08883;function uc(s){const{width:e,height:r}=s,o=new Uint8Array(e*r*3);for(let c=0,u=0;c<s.length;c+=3,u+=3){const p=s[c+0],d=s[c+1]<<24>>24,x=s[c+2]<<24>>24;let b=(p+16)/116,T=d/500+b,S=b-x/200,M,E,A;T=oc*(T*T*T>.008856?T*T*T:(T-16/116)/7.787),b=ac*(b*b*b>.008856?b*b*b:(b-16/116)/7.787),S=cc*(S*S*S>.008856?S*S*S:(S-16/116)/7.787),M=T*3.2406+b*-1.5372+S*-.4986,E=T*-.9689+b*1.8758+S*.0415,A=T*.0557+b*-.204+S*1.057,M=M>.0031308?1.055*M**(1/2.4)-.055:12.92*M,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,o[u]=Math.max(0,Math.min(1,M))*255,o[u+1]=Math.max(0,Math.min(1,E))*255,o[u+2]=Math.max(0,Math.min(1,A))*255}return o}const Ss=new Map,lc=new Map;function mt(s,e,r=!0){Array.isArray(s)||(s=[s]),s.forEach(o=>{Ss.set(o,e),lc.set(o,r)})}async function fc(s){const e=Ss.get(s.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${s.Compression}`);const r=await e();return new r(s)}mt([void 0,1],()=>Rt(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1]),import.meta.url).then(s=>s.default),!1);mt(5,()=>Rt(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1]),import.meta.url).then(s=>s.default));mt(6,()=>{throw new Error("old style JPEG compression is not supported.")});mt(7,()=>Rt(()=>import("./jpeg-JhJy4lL1.js"),__vite__mapDeps([3,1]),import.meta.url).then(s=>s.default));mt([8,32946],()=>Rt(()=>import("./deflate-Dthki0TA.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(s=>s.default));mt(32773,()=>Rt(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1]),import.meta.url).then(s=>s.default));mt(34887,()=>Rt(()=>import("./lerc-DHHWfi8f.js"),__vite__mapDeps([7,5,1]),import.meta.url).then(async s=>(await s.zstd.init(),s)).then(s=>s.default));mt(5e4,()=>Rt(()=>import("./zstd-DD6JHAQz.js"),__vite__mapDeps([8,1]),import.meta.url).then(async s=>(await s.zstd.init(),s)).then(s=>s.default));mt(50001,()=>Rt(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([9,1]),import.meta.url).then(s=>s.default),!1);function sn(s,e,r,o=1){return new(Object.getPrototypeOf(s)).constructor(e*r*o)}function hc(s,e,r,o,c){const u=e/o,p=r/c;return s.map(d=>{const x=sn(d,o,c);for(let b=0;b<c;++b){const T=Math.min(Math.round(p*b),r-1);for(let S=0;S<o;++S){const M=Math.min(Math.round(u*S),e-1),E=d[T*e+M];x[b*o+S]=E}}return x})}function ir(s,e,r){return(1-r)*s+r*e}function dc(s,e,r,o,c){const u=e/o,p=r/c;return s.map(d=>{const x=sn(d,o,c);for(let b=0;b<c;++b){const T=p*b,S=Math.floor(T),M=Math.min(Math.ceil(T),r-1);for(let E=0;E<o;++E){const A=u*E,I=A%1,L=Math.floor(A),m=Math.min(Math.ceil(A),e-1),F=d[S*e+L],N=d[S*e+m],j=d[M*e+L],U=d[M*e+m],H=ir(ir(F,N,I),ir(j,U,I),T%1);x[b*o+E]=H}}return x})}function pc(s,e,r,o,c,u="nearest"){switch(u.toLowerCase()){case"nearest":return hc(s,e,r,o,c);case"bilinear":case"linear":return dc(s,e,r,o,c);default:throw new Error(`Unsupported resampling method: '${u}'`)}}function gc(s,e,r,o,c,u){const p=e/o,d=r/c,x=sn(s,o,c,u);for(let b=0;b<c;++b){const T=Math.min(Math.round(d*b),r-1);for(let S=0;S<o;++S){const M=Math.min(Math.round(p*S),e-1);for(let E=0;E<u;++E){const A=s[T*e*u+M*u+E];x[b*o*u+S*u+E]=A}}}return x}function mc(s,e,r,o,c,u){const p=e/o,d=r/c,x=sn(s,o,c,u);for(let b=0;b<c;++b){const T=d*b,S=Math.floor(T),M=Math.min(Math.ceil(T),r-1);for(let E=0;E<o;++E){const A=p*E,I=A%1,L=Math.floor(A),m=Math.min(Math.ceil(A),e-1);for(let F=0;F<u;++F){const N=s[S*e*u+L*u+F],j=s[S*e*u+m*u+F],U=s[M*e*u+L*u+F],H=s[M*e*u+m*u+F],i=ir(ir(N,j,I),ir(U,H,I),T%1);x[b*o*u+E*u+F]=i}}}return x}function yc(s,e,r,o,c,u,p="nearest"){switch(p.toLowerCase()){case"nearest":return gc(s,e,r,o,c,u);case"bilinear":case"linear":return mc(s,e,r,o,c,u);default:throw new Error(`Unsupported resampling method: '${p}'`)}}function xc(s,e,r){let o=0;for(let c=e;c<r;++c)o+=s[c];return o}function kn(s,e,r){switch(s){case 1:if(e<=8)return new Uint8Array(r);if(e<=16)return new Uint16Array(r);if(e<=32)return new Uint32Array(r);break;case 2:if(e===8)return new Int8Array(r);if(e===16)return new Int16Array(r);if(e===32)return new Int32Array(r);break;case 3:switch(e){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}break}throw Error("Unsupported data format/bitsPerSample")}function bc(s,e){return(s===1||s===2)&&e<=32&&e%8===0?!1:!(s===3&&(e===16||e===32||e===64))}function vc(s,e,r,o,c,u,p){const d=new DataView(s),x=r===2?p*u:p*u*o,b=r===2?1:o,T=kn(e,c,x),S=parseInt("1".repeat(c),2);if(e===1){let M;r===1?M=o*c:M=c;let E=u*M;E&7&&(E=E+7&-8);for(let A=0;A<p;++A){const I=A*E;for(let L=0;L<u;++L){const m=I+L*b*c;for(let F=0;F<b;++F){const N=m+F*c,j=(A*u+L)*b+F,U=Math.floor(N/8),H=N%8;if(H+c<=8)T[j]=d.getUint8(U)>>8-c-H&S;else if(H+c<=16)T[j]=d.getUint16(U)>>16-c-H&S;else if(H+c<=24){const i=d.getUint16(U)<<8|d.getUint8(U+2);T[j]=i>>24-c-H&S}else T[j]=d.getUint32(U)>>32-c-H&S}}}}return T.buffer}class Tc{constructor(e,r,o,c,u,p){this.fileDirectory=e,this.geoKeys=r,this.dataView=o,this.littleEndian=c,this.tiles=u?{}:null,this.isTiled=!e.StripOffsets;const d=e.PlanarConfiguration;if(this.planarConfiguration=typeof d>"u"?1:d,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=p}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let r=0;r<this.fileDirectory.BitsPerSample.length;++r)e+=this.getSampleByteSize(r);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const r=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,o=this.fileDirectory.BitsPerSample[e];switch(r){case 1:if(o<=8)return DataView.prototype.getUint8;if(o<=16)return DataView.prototype.getUint16;if(o<=32)return DataView.prototype.getUint32;break;case 2:if(o<=8)return DataView.prototype.getInt8;if(o<=16)return DataView.prototype.getInt16;if(o<=32)return DataView.prototype.getInt32;break;case 3:switch(o){case 16:return function(c,u){return Es(this,c,u)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,r){const o=this.getSampleFormat(e),c=this.getBitsPerSample(e);return kn(o,c,r)}async getTileOrStrip(e,r,o,c,u){const p=Math.ceil(this.getWidth()/this.getTileWidth()),d=Math.ceil(this.getHeight()/this.getTileHeight());let x;const{tiles:b}=this;this.planarConfiguration===1?x=r*p+e:this.planarConfiguration===2&&(x=o*p*d+r*p+e);let T,S;if(this.isTiled?(T=this.fileDirectory.TileOffsets[x],S=this.fileDirectory.TileByteCounts[x]):(T=this.fileDirectory.StripOffsets[x],S=this.fileDirectory.StripByteCounts[x]),S===0){const A=this.getBlockHeight(r)*this.getTileWidth(),I=this.planarConfiguration===2?this.getSampleByteSize(o):this.getBytesPerPixel(),L=new ArrayBuffer(A*I);return this.getArrayForSample(o,L).fill(this.getGDALNoData()||0),{x:e,y:r,sample:o,data:L}}const M=(await this.source.fetch([{offset:T,length:S}],u))[0];let E;return b===null||!b[x]?(E=(async()=>{let A=await c.decode(this.fileDirectory,M);const I=this.getSampleFormat(),L=this.getBitsPerSample();return bc(I,L)&&(A=vc(A,I,this.planarConfiguration,this.getSamplesPerPixel(),L,this.getTileWidth(),this.getBlockHeight(r))),A})(),b!==null&&(b[x]=E)):E=b[x],{x:e,y:r,sample:o,data:await E}}async _readRaster(e,r,o,c,u,p,d,x,b){const T=this.getTileWidth(),S=this.getTileHeight(),M=this.getWidth(),E=this.getHeight(),A=Math.max(Math.floor(e[0]/T),0),I=Math.min(Math.ceil(e[2]/T),Math.ceil(M/T)),L=Math.max(Math.floor(e[1]/S),0),m=Math.min(Math.ceil(e[3]/S),Math.ceil(E/S)),F=e[2]-e[0];let N=this.getBytesPerPixel();const j=[],U=[];for(let D=0;D<r.length;++D)this.planarConfiguration===1?j.push(xc(this.fileDirectory.BitsPerSample,0,r[D])/8):j.push(0),U.push(this.getReaderForSample(r[D]));const H=[],{littleEndian:i}=this;for(let D=L;D<m;++D)for(let V=A;V<I;++V){let $;this.planarConfiguration===1&&($=this.getTileOrStrip(V,D,0,u,b));for(let J=0;J<r.length;++J){const Q=J,Y=r[J];this.planarConfiguration===2&&(N=this.getSampleByteSize(Y),$=this.getTileOrStrip(V,D,Y,u,b));const me=$.then(ie=>{const le=ie.data,pe=new DataView(le),Ce=this.getBlockHeight(ie.y),Te=ie.y*S,ft=ie.x*T,yt=Te+Ce,xt=(ie.x+1)*T,Ct=U[Q],Ze=Math.min(Ce,Ce-(yt-e[3]),E-Te),ur=Math.min(T,T-(xt-e[2]),M-ft);for(let Ye=Math.max(0,e[1]-Te);Ye<Ze;++Ye)for(let It=Math.max(0,e[0]-ft);It<ur;++It){const on=(Ye*T+It)*N,lr=Ct.call(pe,on+j[Q],i);let Oe;c?(Oe=(Ye+Te-e[1])*F*r.length+(It+ft-e[0])*r.length+Q,o[Oe]=lr):(Oe=(Ye+Te-e[1])*F+It+ft-e[0],o[Q][Oe]=lr)}});H.push(me)}}if(await Promise.all(H),p&&e[2]-e[0]!==p||d&&e[3]-e[1]!==d){let D;return c?D=yc(o,e[2]-e[0],e[3]-e[1],p,d,r.length,x):D=pc(o,e[2]-e[0],e[3]-e[1],p,d,x),D.width=p,D.height=d,D}return o.width=p||e[2]-e[0],o.height=d||e[3]-e[1],o}async readRasters({window:e,samples:r=[],interleave:o,pool:c=null,width:u,height:p,resampleMethod:d,fillValue:x,signal:b}={}){const T=e||[0,0,this.getWidth(),this.getHeight()];if(T[0]>T[2]||T[1]>T[3])throw new Error("Invalid subsets");const S=T[2]-T[0],M=T[3]-T[1],E=S*M,A=this.getSamplesPerPixel();if(!r||!r.length)for(let F=0;F<A;++F)r.push(F);else for(let F=0;F<r.length;++F)if(r[F]>=A)return Promise.reject(new RangeError(`Invalid sample index '${r[F]}'.`));let I;if(o){const F=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,N=Math.max.apply(null,this.fileDirectory.BitsPerSample);I=kn(F,N,E*r.length),x&&I.fill(x)}else{I=[];for(let F=0;F<r.length;++F){const N=this.getArrayForSample(r[F],E);Array.isArray(x)&&F<x.length?N.fill(x[F]):x&&!Array.isArray(x)&&N.fill(x),I.push(N)}}const L=c||await fc(this.fileDirectory);return await this._readRaster(T,r,I,o,L,u,p,d,b)}async readRGB({window:e,interleave:r=!0,pool:o=null,width:c,height:u,resampleMethod:p,enableAlpha:d=!1,signal:x}={}){const b=e||[0,0,this.getWidth(),this.getHeight()];if(b[0]>b[2]||b[1]>b[3])throw new Error("Invalid subsets");const T=this.fileDirectory.PhotometricInterpretation;if(T===je.RGB){let m=[0,1,2];if(this.fileDirectory.ExtraSamples!==Qa.Unspecified&&d){m=[];for(let F=0;F<this.fileDirectory.BitsPerSample.length;F+=1)m.push(F)}return this.readRasters({window:e,interleave:r,samples:m,pool:o,width:c,height:u,resampleMethod:p,signal:x})}let S;switch(T){case je.WhiteIsZero:case je.BlackIsZero:case je.Palette:S=[0];break;case je.CMYK:S=[0,1,2,3];break;case je.YCbCr:case je.CIELab:S=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const M={window:b,interleave:!0,samples:S,pool:o,width:c,height:u,resampleMethod:p,signal:x},{fileDirectory:E}=this,A=await this.readRasters(M),I=2**this.fileDirectory.BitsPerSample[0];let L;switch(T){case je.WhiteIsZero:L=tc(A,I);break;case je.BlackIsZero:L=rc(A,I);break;case je.Palette:L=nc(A,E.ColorMap);break;case je.CMYK:L=ic(A);break;case je.YCbCr:L=sc(A);break;case je.CIELab:L=uc(A);break;default:throw new Error("Unsupported photometric interpretation.")}if(!r){const m=new Uint8Array(L.length/3),F=new Uint8Array(L.length/3),N=new Uint8Array(L.length/3);for(let j=0,U=0;j<L.length;j+=3,++U)m[U]=L[j],F[U]=L[j+1],N[U]=L[j+2];L=[m,F,N]}return L.width=A.width,L.height=A.height,L}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let r=0;r<this.fileDirectory.ModelTiepoint.length;r+=6)e.push({i:this.fileDirectory.ModelTiepoint[r],j:this.fileDirectory.ModelTiepoint[r+1],k:this.fileDirectory.ModelTiepoint[r+2],x:this.fileDirectory.ModelTiepoint[r+3],y:this.fileDirectory.ModelTiepoint[r+4],z:this.fileDirectory.ModelTiepoint[r+5]});return e}getGDALMetadata(e=null){const r={};if(!this.fileDirectory.GDAL_METADATA)return null;const o=this.fileDirectory.GDAL_METADATA;let c=Ja(o,"Item");e===null?c=c.filter(u=>Ln(u,"sample")===void 0):c=c.filter(u=>Number(Ln(u,"sample"))===e);for(let u=0;u<c.length;++u){const p=c[u];r[Ln(p,"name")]=p.inner}return r}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,r=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(r)return[r[3],r[7],r[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const r=this.fileDirectory.ModelPixelScale,o=this.fileDirectory.ModelTransformation;if(r)return[r[0],-r[1],r[2]];if(o)return o[1]===0&&o[4]===0?[o[0],-o[5],o[10]]:[Math.sqrt(o[0]*o[0]+o[4]*o[4]),-Math.sqrt(o[1]*o[1]+o[5]*o[5]),o[10]];if(e){const[c,u,p]=e.getResolution();return[c*e.getWidth()/this.getWidth(),u*e.getHeight()/this.getHeight(),p*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const r=this.getHeight(),o=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[c,u,p,d,x,b,T,S]=this.fileDirectory.ModelTransformation,E=[[0,0],[0,r],[o,0],[o,r]].map(([L,m])=>[d+c*L+u*m,S+x*L+b*m]),A=E.map(L=>L[0]),I=E.map(L=>L[1]);return[Math.min(...A),Math.min(...I),Math.max(...A),Math.max(...I)]}else{const c=this.getOrigin(),u=this.getResolution(),p=c[0],d=c[1],x=p+u[0]*o,b=d+u[1]*r;return[Math.min(p,x),Math.min(d,b),Math.max(p,x),Math.max(d,b)]}}}class wc{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,r){const o=this.getUint32(e,r),c=this.getUint32(e+4,r);let u;if(r){if(u=o+2**32*c,!Number.isSafeInteger(u))throw new Error(`${u} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return u}if(u=2**32*o+c,!Number.isSafeInteger(u))throw new Error(`${u} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return u}getInt64(e,r){let o=0;const c=(this._dataView.getUint8(e+(r?7:0))&128)>0;let u=!0;for(let p=0;p<8;p++){let d=this._dataView.getUint8(e+(r?p:7-p));c&&(u?d!==0&&(d=~(d-1)&255,u=!1):d=~d&255),o+=d*256**p}return c&&(o=-o),o}getUint8(e,r){return this._dataView.getUint8(e,r)}getInt8(e,r){return this._dataView.getInt8(e,r)}getUint16(e,r){return this._dataView.getUint16(e,r)}getInt16(e,r){return this._dataView.getInt16(e,r)}getUint32(e,r){return this._dataView.getUint32(e,r)}getInt32(e,r){return this._dataView.getInt32(e,r)}getFloat16(e,r){return Es(this._dataView,e,r)}getFloat32(e,r){return this._dataView.getFloat32(e,r)}getFloat64(e,r){return this._dataView.getFloat64(e,r)}}class Ec{constructor(e,r,o,c){this._dataView=new DataView(e),this._sliceOffset=r,this._littleEndian=o,this._bigTiff=c}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,r){return this.sliceOffset<=e&&this.sliceTop>=e+r}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const r=this.readUint32(e),o=this.readUint32(e+4);let c;if(this._littleEndian){if(c=r+2**32*o,!Number.isSafeInteger(c))throw new Error(`${c} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return c}if(c=2**32*r+o,!Number.isSafeInteger(c))throw new Error(`${c} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return c}readInt64(e){let r=0;const o=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let c=!0;for(let u=0;u<8;u++){let p=this._dataView.getUint8(e+(this._littleEndian?u:7-u));o&&(c?p!==0&&(p=~(p-1)&255,c=!1):p=~p&255),r+=p*256**u}return o&&(r=-r),r}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}class Sc{async fetch(e,r=void 0){return Promise.all(e.map(o=>this.fetchSlice(o,r)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class Xn extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Xn),this.name="AbortError"}}class Ac extends Sc{constructor(e){super(),this.arrayBuffer=e}fetchSlice(e,r){if(r&&r.aborted)throw new Xn("Request aborted");return this.arrayBuffer.slice(e.offset,e.offset+e.length)}}function Rc(s){return new Ac(s)}function jn(s){switch(s){case ce.BYTE:case ce.ASCII:case ce.SBYTE:case ce.UNDEFINED:return 1;case ce.SHORT:case ce.SSHORT:return 2;case ce.LONG:case ce.SLONG:case ce.FLOAT:case ce.IFD:return 4;case ce.RATIONAL:case ce.SRATIONAL:case ce.DOUBLE:case ce.LONG8:case ce.SLONG8:case ce.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${s}`)}}function Cc(s){const e=s.GeoKeyDirectory;if(!e)return null;const r={};for(let o=4;o<=e[3]*4;o+=4){const c=ec[e[o]],u=e[o+1]?Ar[e[o+1]]:null,p=e[o+2],d=e[o+3];let x=null;if(!u)x=d;else{if(x=s[u],typeof x>"u"||x===null)throw new Error(`Could not get value of geoKey '${c}'.`);typeof x=="string"?x=x.substring(d,d+p-1):x.subarray&&(x=x.subarray(d,d+p),p===1&&(x=x[0]))}r[c]=x}return r}function er(s,e,r,o){let c=null,u=null;const p=jn(e);switch(e){case ce.BYTE:case ce.ASCII:case ce.UNDEFINED:c=new Uint8Array(r),u=s.readUint8;break;case ce.SBYTE:c=new Int8Array(r),u=s.readInt8;break;case ce.SHORT:c=new Uint16Array(r),u=s.readUint16;break;case ce.SSHORT:c=new Int16Array(r),u=s.readInt16;break;case ce.LONG:case ce.IFD:c=new Uint32Array(r),u=s.readUint32;break;case ce.SLONG:c=new Int32Array(r),u=s.readInt32;break;case ce.LONG8:case ce.IFD8:c=new Array(r),u=s.readUint64;break;case ce.SLONG8:c=new Array(r),u=s.readInt64;break;case ce.RATIONAL:c=new Uint32Array(r*2),u=s.readUint32;break;case ce.SRATIONAL:c=new Int32Array(r*2),u=s.readInt32;break;case ce.FLOAT:c=new Float32Array(r),u=s.readFloat32;break;case ce.DOUBLE:c=new Float64Array(r),u=s.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===ce.RATIONAL||e===ce.SRATIONAL)for(let d=0;d<r;d+=2)c[d]=u.call(s,o+d*p),c[d+1]=u.call(s,o+(d*p+4));else for(let d=0;d<r;++d)c[d]=u.call(s,o+d*p);return e===ce.ASCII?new TextDecoder("utf-8").decode(c):c}class Ic{constructor(e,r,o,c){this.fileDirectory=e,this.rawFileDirectory=r,this.geoKeyDirectory=o,this.nextIFDByteOffset=c}}class $r extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Mc{async readRasters(e={}){const{window:r,width:o,height:c}=e;let{resX:u,resY:p,bbox:d}=e;const x=await this.getImage();let b=x;const T=await this.getImageCount(),S=x.getBoundingBox();if(r&&d)throw new Error('Both "bbox" and "window" passed.');if(o||c){if(r){const[A,I]=x.getOrigin(),[L,m]=x.getResolution();d=[A+r[0]*L,I+r[1]*m,A+r[2]*L,I+r[3]*m]}const E=d||S;if(o){if(u)throw new Error("Both width and resX passed");u=(E[2]-E[0])/o}if(c){if(p)throw new Error("Both width and resY passed");p=(E[3]-E[1])/c}}if(u||p){const E=[];for(let A=0;A<T;++A){const I=await this.getImage(A),{SubfileType:L,NewSubfileType:m}=I.fileDirectory;(A===0||L===2||m&1)&&E.push(I)}E.sort((A,I)=>A.getWidth()-I.getWidth());for(let A=0;A<E.length;++A){const I=E[A],L=(S[2]-S[0])/I.getWidth(),m=(S[3]-S[1])/I.getHeight();if(b=I,u&&u>L||p&&p>m)break}}let M=r;if(d){const[E,A]=x.getOrigin(),[I,L]=b.getResolution(x);M=[Math.round((d[0]-E)/I),Math.round((d[1]-A)/L),Math.round((d[2]-E)/I),Math.round((d[3]-A)/L)],M=[Math.min(M[0],M[2]),Math.min(M[1],M[3]),Math.max(M[0],M[2]),Math.max(M[1],M[3])]}return b.readRasters({...e,window:M})}}class Jn extends Mc{constructor(e,r,o,c,u={}){super(),this.source=e,this.littleEndian=r,this.bigTiff=o,this.firstIFDOffset=c,this.cache=u.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,r){const o=this.bigTiff?4048:1024;return new Ec((await this.source.fetch([{offset:e,length:typeof r<"u"?r:o}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const r=this.bigTiff?20:12,o=this.bigTiff?8:2;let c=await this.getSlice(e);const u=this.bigTiff?c.readUint64(e):c.readUint16(e),p=u*r+(this.bigTiff?16:6);c.covers(e,p)||(c=await this.getSlice(e,p));const d={},x=new Map;let b=e+(this.bigTiff?8:2);for(let M=0;M<u;b+=r,++M){const E=c.readUint16(b),A=c.readUint16(b+2),I=this.bigTiff?c.readUint64(b+4):c.readUint32(b+4);let L,m;const F=jn(A),N=b+(this.bigTiff?12:8);if(F*I<=(this.bigTiff?8:4))L=er(c,A,I,N);else{const U=c.readOffset(N),H=jn(A)*I;if(c.covers(U,H))L=er(c,A,I,U);else{const i=await this.getSlice(U,H);L=er(i,A,I,U)}}I===1&&Za.indexOf(E)===-1&&!(A===ce.RATIONAL||A===ce.SRATIONAL)?m=L[0]:m=L;const j=Ar[E];j&&(d[j]=m),x.set(E,m)}const T=Cc(d),S=c.readOffset(e+o+r*u);return new Ic(d,x,T,S)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(r){throw r instanceof $r?new $r(e):r}return this.ifdRequests[e]=(async()=>{const r=await this.ifdRequests[e-1];if(r.nextIFDByteOffset===0)throw new $r(e);return this.parseFileDirectoryAt(r.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const r=await this.requestIFD(e);return new Tc(r.fileDirectory,r.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,r=!0;for(;r;)try{await this.requestIFD(e),++e}catch(o){if(o instanceof $r)r=!1;else throw o}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const r="GDAL_STRUCTURAL_METADATA_SIZE=",o=r.length+100;let c=await this.getSlice(e,o);if(r===er(c,ce.ASCII,r.length,e)){const p=er(c,ce.ASCII,o,e).split(`
`)[0],d=Number(p.split("=")[1].split(" ")[0])+p.length;d>o&&(c=await this.getSlice(e,d));const x=er(c,ce.ASCII,d,e);this.ghostValues={},x.split(`
`).filter(b=>b.length>0).map(b=>b.split("=")).forEach(([b,T])=>{this.ghostValues[b]=T})}return this.ghostValues}static async fromSource(e,r,o){const c=(await e.fetch([{offset:0,length:1024}],o))[0],u=new wc(c),p=u.getUint16(0,0);let d;if(p===18761)d=!0;else if(p===19789)d=!1;else throw new TypeError("Invalid byte order value.");const x=u.getUint16(2,d);let b;if(x===42)b=!1;else if(x===43){if(b=!0,u.getUint16(4,d)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const T=b?u.getUint64(8,d):u.getUint32(4,d);return new Jn(e,d,b,T,r)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function Ji(s,e){return Jn.fromSource(Rc(s),e)}const Gt=class Gt{constructor(){q(this,"baseUrl");this.baseUrl="http://147.93.127.105:3000",console.log("ð API Service initialized with base URL:",this.baseUrl)}static getInstance(){return Gt.instance||(Gt.instance=new Gt),Gt.instance}getBaseUrl(){return this.baseUrl}getEndpoint(e){return`${this.baseUrl}${e.startsWith("/")?e:"/"+e}`}};q(Gt,"instance");let Vn=Gt;class Pc{constructor(){q(this,"config");this.config=Vn.getInstance()}async testConnection(){try{console.log("ð Testing backend connection...");const e=await fetch(this.config.getEndpoint("/terrain/test-r2"),{method:"GET"});return console.log("â Backend health check:",e.status),e.ok}catch(e){return console.error("â Backend connection test failed:",e),!1}}async generateTile(e){return console.log("ð Generating terrain tile...",e),fetch(this.config.getEndpoint("/terrain/generate-tile"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async downloadFile(e){console.log("ð¥ Downloading file:",e);const r=e.startsWith("http")?e:this.config.getEndpoint(e);return fetch(r)}async downloadSolarData(e){console.log("âï¸ Downloading solar data:",e);const r=e.startsWith("http")?e:this.config.getEndpoint(e);return fetch(r)}getFileDownloadUrl(e){return this.config.getEndpoint(`/terrain/files/${e}`)}getGHIDataUrl(e){return this.config.getEndpoint(e)}getBaseUrl(){return this.config.getBaseUrl()}async makeRequest(e,r={}){const o=this.config.getEndpoint(e);return console.log(`ð Making request to: ${o}`),fetch(o,{headers:{"Content-Type":"application/json",...r.headers},...r})}getEnvironmentInfo(){return{baseUrl:this.config.getBaseUrl(),environment:"production",devMode:!1}}}const Ft=new Pc;console.log("ð API Service Environment:",Ft.getEnvironmentInfo());class Nc{constructor(){q(this,"tileCache",new Map);console.log("ð SolarTerrainService initialized with API service"),console.log("ð Environment:",Ft.getEnvironmentInfo())}async generateCompleteTile(e){var r,o,c,u,p;try{console.log("ð Requesting complete tile...",e);const d=await Ft.generateTile(e);if(!d.ok)throw new Error(`Backend error: ${d.status} ${d.statusText}`);const x=await d.json();console.log("â Backend response received:",x),console.log("ð Checking GHI data in response:"),console.log("  - GHI Success:",(r=x.ghiResult)==null?void 0:r.success),console.log("  - GHI Filename:",(o=x.ghiResult)==null?void 0:o.filename),console.log("  - GHI URL:",(c=x.cacheInfo)==null?void 0:c.ghiTileUrl),console.log("  - GHI Resolution:",(u=x.ghiResult)==null?void 0:u.resolution),console.log("  - GHI Data Shape:",(p=x.ghiResult)==null?void 0:p.dataShape);const[b,T]=await Promise.all([this.downloadAndProcessHeightmap(x.cacheInfo.downloadUrl),this.downloadAndProcessSolarData(Ft.getGHIDataUrl(x.cacheInfo.ghiTileUrl))]),S=this.generateTileId(e),M={tileId:S,bounds:x.cacheInfo.region,center:x.cacheInfo.centerCoordinates,heightmap:b,solarData:T,heightmapUrl:x.cacheInfo.downloadUrl,solarUrl:Ft.getGHIDataUrl(x.cacheInfo.ghiTileUrl)};return this.tileCache.set(S,M),console.log("â Complete tile processed:",{tileId:S,heightmapSize:`${b.width}x${b.height}`,solarSize:`${T.width}x${T.height}`,heightRange:`${b.minHeight.toFixed(1)}m to ${b.maxHeight.toFixed(1)}m`,ghiRange:`${T.minGHI.toFixed(2)} to ${T.maxGHI.toFixed(2)} ${T.unit}`}),M}catch(d){throw console.error("â Failed to generate complete tile:",d),d}}async downloadAndProcessHeightmap(e){try{console.log("ð¥ Downloading heightmap:",e);const r=await Ft.downloadFile(e);if(!r.ok)throw new Error(`Failed to download heightmap: ${r.status}`);const o=await r.arrayBuffer();console.log("ð Heightmap downloaded, size:",o.byteLength);const u=await(await Ji(o)).getImage(),p=await u.readRasters(),d=u.getWidth(),x=u.getHeight(),b=new Float32Array(p[0]);let T=b[0],S=b[0];for(let M=1;M<b.length;M++){const E=b[M];E<T&&(T=E),E>S&&(S=E)}return console.log("â Heightmap processed:",{width:d,height:x,minHeight:T.toFixed(1)+"m",maxHeight:S.toFixed(1)+"m"}),{width:d,height:x,elevationData:b,minHeight:T,maxHeight:S}}catch(r){throw console.error("â Failed to process heightmap:",r),r}}async downloadAndProcessSolarData(e){try{console.log("âï¸ Downloading solar data:",e),console.log("âï¸ Full GHI URL:",e);const r=await Ft.downloadSolarData(e);if(console.log("âï¸ GHI Response status:",r.status,r.statusText),!r.ok)throw new Error(`Failed to download solar data: ${r.status} ${r.statusText}`);const o=await r.arrayBuffer();console.log("ð Solar data downloaded successfully!"),console.log("  - Size:",o.byteLength,"bytes"),console.log("  - First 16 bytes:",new Uint8Array(o.slice(0,16))),console.log("âï¸ Processing GHI TIF with geotiff library...");const c=await Ji(o);console.log("âï¸ GeoTIFF object created successfully");const u=await c.getImage();console.log("âï¸ GeoTIFF image loaded"),console.log("  - Width:",u.getWidth()),console.log("  - Height:",u.getHeight()),console.log("  - Samples per pixel:",u.getSamplesPerPixel()),console.log("  - Bits per sample:",u.getBitsPerSample());const p=await u.readRasters();console.log("âï¸ Rasters read successfully"),console.log("  - Raster type:",p[0].constructor.name),console.log("  - Raster length:",p[0].length);const d=u.getWidth(),x=u.getHeight(),b=new Float32Array(p[0]);console.log("âï¸ GHI data converted to Float32Array"),console.log("  - Array length:",b.length),console.log("  - First 5 values:",Array.from(b.slice(0,5)));let T=b[0],S=b[0];for(let M=1;M<b.length;M++){const E=b[M];E<T&&(T=E),E>S&&(S=E)}return console.log("â Solar data processed:",{width:d,height:x,minGHI:T.toFixed(2)+" kWh/mÂ²/day",maxGHI:S.toFixed(2)+" kWh/mÂ²/day"}),{width:d,height:x,ghiData:b,minGHI:T,maxGHI:S,unit:"kWh/mÂ²/day"}}catch(r){throw console.error("â Failed to process solar data:",r),r}}generateTileId(e){return`tile_${e.centerLat}_${e.centerLng}_${e.scale}`}getCachedTile(e){const r=this.generateTileId(e);return this.tileCache.get(r)||null}getCacheStats(){let e=0;return this.tileCache.forEach(r=>{e+=r.heightmap.elevationData.byteLength,e+=r.solarData.ghiData.byteLength}),{count:this.tileCache.size,totalSize:e}}clearCache(){this.tileCache.clear(),console.log("ð§¹ Tile cache cleared")}async generateTileGrid(e,r,o=3,c=30){const u=[],d=[];for(let b=0;b<o;b++)for(let T=0;T<o;T++){const S=(b-Math.floor(o/2))*.1,M=(T-Math.floor(o/2))*.1,E=e+M,A=r+S,I={centerLat:E,centerLng:A,scale:c};d.push(this.generateCompleteTile(I))}return(await Promise.allSettled(d)).forEach((b,T)=>{b.status==="fulfilled"?u.push(b.value):console.error(`â Failed to load tile ${T}:`,b.reason)}),console.log(`â Generated ${u.length}/${o*o} tiles in grid`),u}}const Oc=new Nc;class Lc{constructor(e,r={}){q(this,"app");q(this,"map",null);q(this,"marker",null);q(this,"inputLat");q(this,"inputLng");q(this,"inputScale");q(this,"scaleValue");q(this,"btnGenerate");q(this,"statusMessage");q(this,"objectCount");q(this,"searchInput");q(this,"searchResults");q(this,"useSatelliteCheckbox");q(this,"satelliteOpacitySlider");q(this,"satelliteOpacityValue");q(this,"currentLat");q(this,"currentLng");q(this,"currentScale",30);q(this,"isGenerating",!1);q(this,"mapId");q(this,"apiKey");q(this,"searchDebounceTimer",null);this.app=e,this.currentLat=r.defaultLat??39.925,this.currentLng=r.defaultLng??32.837,this.mapId=r.mapId??"DEMO_MAP_ID",this.apiKey=r.apiKey??"",this.inputLat=document.getElementById("input-lat"),this.inputLng=document.getElementById("input-lng"),this.inputScale=document.getElementById("input-scale"),this.scaleValue=document.getElementById("scale-value"),this.btnGenerate=document.getElementById("btn-generate"),this.statusMessage=document.getElementById("status-message"),this.objectCount=document.getElementById("object-count"),this.searchInput=document.getElementById("place-search"),this.searchResults=document.getElementById("search-results"),this.useSatelliteCheckbox=document.getElementById("use-satellite"),this.satelliteOpacitySlider=document.getElementById("satellite-opacity"),this.satelliteOpacityValue=document.getElementById("satellite-opacity-value"),this.setupEventListeners(),this.setupPlacesSearch(),this.setupSatelliteToggle(),this.initGoogleMaps(r.defaultZoom??10)}setupEventListeners(){this.inputLat.addEventListener("change",()=>{this.currentLat=parseFloat(this.inputLat.value),this.updateMarker()}),this.inputLng.addEventListener("change",()=>{this.currentLng=parseFloat(this.inputLng.value),this.updateMarker()}),this.inputScale.addEventListener("input",()=>{this.currentScale=parseInt(this.inputScale.value),this.scaleValue.textContent=this.currentScale.toString()}),this.btnGenerate.addEventListener("click",()=>{this.generateTerrain()}),document.querySelectorAll(".quick-loc-btn").forEach(e=>{e.addEventListener("click",r=>{const o=r.target,c=parseFloat(o.dataset.lat||"0"),u=parseFloat(o.dataset.lng||"0");this.setLocation(c,u)})}),setInterval(()=>{this.objectCount.textContent=this.app.scene.count.toString()},500)}initGoogleMaps(e){window.google&&window.google.maps?this.createMap(e):window.addEventListener("google-maps-ready",()=>{this.createMap(e)})}async createMap(e){const r=document.getElementById("google-map");if(!r)return;this.map=new google.maps.Map(r,{center:{lat:this.currentLat,lng:this.currentLng},zoom:e,mapId:this.mapId,mapTypeId:"terrain",disableDefaultUI:!0,zoomControl:!0});const o=document.createElement("div");o.innerHTML=`
            <div style = "
            width: 24px;
            height: 24px;
            background: #4ecdc4;
            border: 3px solid #fff;
            border - radius: 50 %;
            box - shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            cursor: grab;
            border-radius: 100%;
            "></div>
        `;const{AdvancedMarkerElement:c}=await google.maps.importLibrary("marker");this.marker=new c({position:{lat:this.currentLat,lng:this.currentLng},map:this.map,gmpDraggable:!0,content:o,title:"Selected Location"}),this.map.addListener("click",u=>{u.latLng&&this.setLocation(u.latLng.lat(),u.latLng.lng())}),this.marker.addListener("gmp-dragend",()=>{var p;const u=(p=this.marker)==null?void 0:p.position;u&&typeof u=="object"&&"lat"in u&&(this.currentLat=u.lat,this.currentLng=u.lng,this.updateInputs())}),console.log("ðºï¸ Google Maps initialized with AdvancedMarkerElement")}setupPlacesSearch(){!this.searchInput||!this.searchResults||(this.searchInput.addEventListener("input",()=>{const e=this.searchInput.value.trim();if(this.searchDebounceTimer&&clearTimeout(this.searchDebounceTimer),e.length<2){this.hideSearchResults();return}this.searchDebounceTimer=setTimeout(()=>{this.searchPlaces(e)},300)}),document.addEventListener("click",e=>{!this.searchInput.contains(e.target)&&!this.searchResults.contains(e.target)&&this.hideSearchResults()}),this.searchInput.addEventListener("keydown",e=>{e.key==="Escape"&&this.hideSearchResults()}),console.log("ð Places API (New) search initialized"))}async searchPlaces(e){this.searchResults.innerHTML='<div class="search-loading">Searching...</div>',this.searchResults.classList.add("visible");try{const r=await fetch("https://places.googleapis.com/v1/places:searchText",{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":this.apiKey,"X-Goog-FieldMask":"places.displayName,places.formattedAddress,places.location"},body:JSON.stringify({textQuery:e,maxResultCount:5})});if(!r.ok)throw new Error(`Places API error: ${r.status} `);const o=await r.json();this.displaySearchResults(o.places||[])}catch(r){console.error("Places search error:",r),this.searchResults.innerHTML='<div class="search-loading">Search failed</div>'}}displaySearchResults(e){if(e.length===0){this.searchResults.innerHTML='<div class="search-loading">No results found</div>';return}this.searchResults.innerHTML=e.map(r=>{var o,c,u;return`
            <div class="search-result-item" data-lat="${(o=r.location)==null?void 0:o.latitude}" data-lng="${(c=r.location)==null?void 0:c.longitude}">
                <div class="name">${((u=r.displayName)==null?void 0:u.text)||"Unknown"}</div>
                <div class="address">${r.formattedAddress||""}</div>
            </div>
        `}).join(""),this.searchResults.querySelectorAll(".search-result-item").forEach(r=>{r.addEventListener("click",()=>{var p;const o=parseFloat(r.dataset.lat||"0"),c=parseFloat(r.dataset.lng||"0"),u=((p=r.querySelector(".name"))==null?void 0:p.textContent)||"";this.setLocation(o,c),this.searchInput.value=u,this.hideSearchResults(),this.map&&this.map.setZoom(12),console.log(`ð Selected: ${u} `)})})}hideSearchResults(){this.searchResults.classList.remove("visible")}setLocation(e,r){this.currentLat=e,this.currentLng=r,this.updateInputs(),this.updateMarker(),this.map&&this.map.panTo({lat:e,lng:r})}updateInputs(){this.inputLat.value=this.currentLat.toFixed(4),this.inputLng.value=this.currentLng.toFixed(4)}updateMarker(){this.marker&&(this.marker.position={lat:this.currentLat,lng:this.currentLng}),this.map&&this.map.panTo({lat:this.currentLat,lng:this.currentLng})}showStatus(e,r){this.statusMessage.textContent=e,this.statusMessage.className=`status visible ${r} `}hideStatus(){this.statusMessage.className="status"}async generateTerrain(){var e,r;if(!this.isGenerating){this.isGenerating=!0,this.btnGenerate.disabled=!0,this.showStatus("ð Fetching terrain data...","loading");try{console.log(`ðï¸ Generating terrain at ${this.currentLat}, ${this.currentLng} (scale: ${this.currentScale}m)`);const o=await Oc.generateCompleteTile({centerLat:this.currentLat,centerLng:this.currentLng,scale:this.currentScale});this.showStatus("ð¨ Building 3D mesh...","loading");const c=this.app.renderer.getDevice(),u=this.app.renderer.getTerrainMaterialGroupLayout(),p=this.app.renderer.getBlendSettingsBuffer(),d=Dt.fromHeightmap(c,o.heightmap.elevationData,o.heightmap.width,o.heightmap.height,{targetSize:20,heightScale:.003});this.showStatus("ð°ï¸ Fetching satellite imagery...","loading");const x=this.calculateSatelliteZoom(this.currentScale),b=await wt.fetchSatelliteImage(this.currentLat,this.currentLng,this.apiKey,{zoom:x,size:640,scale:2}),T=((e=this.useSatelliteCheckbox)==null?void 0:e.checked)??!1,S=parseInt(((r=this.satelliteOpacitySlider)==null?void 0:r.value)??"20")/100;this.app.renderer.updateBlendSettings(T?S:0);const M=wt.createTerrainMaterial(c,{data:o.solarData.ghiData,width:o.solarData.width,height:o.solarData.height,minGHI:o.solarData.minGHI,maxGHI:o.solarData.maxGHI},{data:b},u,p);for(const A of this.app.scene.getAll())this.app.scene.removeById(A.id);const E=new ct({mesh:d,material:M.bindGroup,renderType:ut.Terrain,transform:new Xe(Se(0,0,-5),Se(90,0,0),Se(1,1,1))});this.app.scene.add(E),this.showStatus(`â Terrain loaded!(${o.heightmap.width}x${o.heightmap.height})`,"success"),console.log("â Terrain added to scene"),setTimeout(()=>this.hideStatus(),3e3)}catch(o){console.error("â Failed to generate terrain:",o),this.showStatus(`â Error: ${o instanceof Error?o.message:"Unknown error"} `,"error")}finally{this.isGenerating=!1,this.btnGenerate.disabled=!1}}}setupSatelliteToggle(){const e=()=>{var o;return parseInt(((o=this.satelliteOpacitySlider)==null?void 0:o.value)??"20")/100},r=o=>{this.satelliteOpacityValue&&(this.satelliteOpacityValue.textContent=`${Math.round(o*100)}%`)};this.useSatelliteCheckbox&&this.useSatelliteCheckbox.addEventListener("change",()=>{const o=this.useSatelliteCheckbox.checked?e():0;this.app.renderer.updateBlendSettings(o)}),this.satelliteOpacitySlider&&this.satelliteOpacitySlider.addEventListener("input",()=>{var c;const o=e();r(o),(c=this.useSatelliteCheckbox)!=null&&c.checked&&this.app.renderer.updateBlendSettings(o)}),document.addEventListener("keydown",o=>{o.code==="KeyV"&&!this.isInputFocused()&&(this.useSatelliteCheckbox?(this.useSatelliteCheckbox.checked=!this.useSatelliteCheckbox.checked,this.useSatelliteCheckbox.dispatchEvent(new Event("change"))):this.app.renderer.toggleSatellite())})}isInputFocused(){const e=document.activeElement;return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement}getCoordinates(){return{lat:this.currentLat,lng:this.currentLng,scale:this.currentScale}}calculateSatelliteZoom(e){return e<=10?19:e<=20?18:e<=30?17:e<=50?16:e<=75?15:14}}const Zi="AIzaSyC8gyUcO5dg76rRJti1ypgyIAyRZQd7FjA";function _c(s){return new Promise((e,r)=>{var c;if((c=window.google)!=null&&c.maps){e();return}const o=document.createElement("script");o.src=`https://maps.googleapis.com/maps/api/js?key=${s}&callback=initMap&v=weekly&libraries=marker`,o.async=!0,o.defer=!0,o.onerror=()=>r(new Error("Failed to load Google Maps API")),document.head.appendChild(o),window.addEventListener("google-maps-ready",()=>e(),{once:!0})})}const Bc=document.getElementById("gfx-main");(async()=>{try{await _c(Zi),console.log("â Google Maps API loaded")}catch(r){console.error("â Failed to load Google Maps API:",r)}const s=new Aa(Bc);await s.init(),s.run();const e=new Lc(s,{defaultLat:39.925,defaultLng:32.837,defaultZoom:10,apiKey:Zi});console.log("ð¯ Application initialized with Google Maps integration"),console.log(`ð¦ Scene contains ${s.scene.count} objects`),console.log('ðºï¸ Click the map to select a location, then click "Generate Terrain"'),window.app=s,window.mapController=e})();export{Gc as L,kc as a,Ao as g};
