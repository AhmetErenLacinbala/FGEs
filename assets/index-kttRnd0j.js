const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./raw-in9isEBO.js","./basedecoder-B2c5_Eok.js","./lzw-_aCqfs4w.js","./jpeg-JhJy4lL1.js","./deflate-Dthki0TA.js","./pako.esm-BkaqWuDM.js","./packbits-DDWKfGV_.js","./lerc-CGgRTp2d.js","./zstd-DD6JHAQz.js","./webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
var wo=Object.defineProperty;var bo=(s,e,r)=>e in s?wo(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var z=(s,e,r)=>bo(s,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&o(p)}).observe(document,{childList:!0,subtree:!0});function r(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(l){if(l.ep)return;l.ep=!0;const c=r(l);fetch(l.href,c)}})();var Bn;let yr=(Bn=class{constructor(){z(this,"texture");z(this,"sampler");z(this,"view");z(this,"bindGroup")}async initFromGHIData(e,r,o,l,c,p,d){console.log("‚òÄÔ∏è Creating material from GHI data:",{width:o,height:l,minGHI:c,maxGHI:p});const x=new Uint8Array(o*l*4);for(let R=0;R<r.length;R++){const I=(r[R]-c)/(p-c);let S,M,P;if(I<.5){const H=I*2;S=0,M=Math.floor(H*255),P=Math.floor((1-H)*255)}else{const H=(I-.5)*2;S=Math.floor(H*255),M=255,P=0}const m=R*4;x[m+0]=S,x[m+1]=M,x[m+2]=P,x[m+3]=255}const T={size:{width:o,height:l},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT};this.texture=e.createTexture(T),e.queue.writeTexture({texture:this.texture},x,{bytesPerRow:o*4},{width:o,height:l});const b={format:"rgba8unorm",dimension:"2d",aspect:"all",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:0,arrayLayerCount:1};this.view=this.texture.createView(b);const C={magFilter:"linear",minFilter:"linear"};this.sampler=e.createSampler(C),this.bindGroup=e.createBindGroup({layout:d,entries:[{binding:0,resource:this.view},{binding:1,resource:this.sampler}]}),console.log("‚úÖ GHI material created successfully")}async init(e,r,o){const c=await(await fetch(r)).blob(),p=await createImageBitmap(c);await this.loadImageBitmap(e,p);const d={format:"rgba8unorm",dimension:"2d",aspect:"all",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:0,arrayLayerCount:1};this.view=this.texture.createView(d);const x={addressModeU:"repeat",addressModeV:"repeat",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"};this.sampler=e.createSampler(x),this.bindGroup=e.createBindGroup({layout:o,entries:[{binding:0,resource:this.view},{binding:1,resource:this.sampler}]})}async loadImageBitmap(e,r){const o=Math.floor(Math.log2(Math.max(r.width,r.height)))+1,l={size:{width:r.width,height:r.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:o};this.texture=e.createTexture(l),e.queue.copyExternalImageToTexture({source:r},{texture:this.texture,mipLevel:0},[r.width,r.height])}async initComputeShader(e){function r(...ie){const re=document.createElement("pre");re.textContent=ie.join(" "),document.body.appendChild(re)}const o=[8,8,8],l=[8,8,2],c=ie=>ie.reduce((re,ce)=>re*ce),p=c(l),x=c(o)*p,T=x*4*4,b=`
        @group(0) @binding(0) var<storage, read_write> workgroupResult: array<vec3u>;
        @group(0) @binding(1) var<storage, read_write> localResult: array<vec3u>;
        @group(0) @binding(2) var<storage, read_write> globalResult: array<vec3u>;

        @compute @workgroup_size(${l.join(",")})
        fn main(
            @builtin(workgroup_id) workgroup_id : vec3<u32>,
            @builtin(local_invocation_id) local_invocation_id : vec3<u32>,
            @builtin(global_invocation_id) global_invocation_id : vec3<u32>,
            @builtin(local_invocation_index) local_invocation_index : u32,
            @builtin(num_workgroups) num_workgroups : vec3<u32>,
        ) {
            let workgroup_index =  
                workgroup_id.x +
                workgroup_id.y * num_workgroups.x +
                workgroup_id.z * num_workgroups.x * num_workgroups.y;

            let global_invocation_index =
                workgroup_index * ${p} +
                local_invocation_index;

            workgroupResult[global_invocation_index] = workgroup_id;
            localResult[global_invocation_index] = local_invocation_id;
            globalResult[global_invocation_index] = global_invocation_id;
        }
    `,C=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC,R=e.createBuffer({size:T,usage:C}),I=e.createBuffer({size:T,usage:C}),S=e.createBuffer({size:T,usage:C}),M=GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST,P=e.createBuffer({size:T,usage:M}),m=e.createBuffer({size:T,usage:M}),H=e.createBuffer({size:T,usage:M}),_=e.createShaderModule({code:b}),G=e.createComputePipeline({layout:"auto",compute:{module:_,entryPoint:"main"}}),F=e.createBindGroup({layout:G.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:R}},{binding:1,resource:{buffer:I}},{binding:2,resource:{buffer:S}}]}),V=e.createCommandEncoder(),i=V.beginComputePass();i.setPipeline(G),i.setBindGroup(0,F);const D=performance.now();i.dispatchWorkgroups(...o),i.end(),V.copyBufferToBuffer(R,0,P,0,T),V.copyBufferToBuffer(I,0,m,0,T),V.copyBufferToBuffer(S,0,H,0,T),e.queue.submit([V.finish()]),await Promise.all([P.mapAsync(GPUMapMode.READ),m.mapAsync(GPUMapMode.READ),H.mapAsync(GPUMapMode.READ)]);const j=performance.now(),Y=new Uint32Array(P.getMappedRange()),J=new Uint32Array(m.getMappedRange()),Z=new Uint32Array(H.getMappedRange()),q=(ie,re)=>{const ce=re*4;return`${ie[ce]}, ${ie[ce+1]}, ${ie[ce+2]}`};r(`‚úÖ GPU Compute Shader Finished in ${(j-D).toFixed(2)} ms`),r(`Results for ${x} total threads:`);for(let ie=0;ie<x;++ie)ie%p===0&&r(`---------------------------------------
global                 local     global   dispatch: ${ie/p}
invoc.    workgroup    invoc.    invoc.
index     id           id        id
---------------------------------------`),r(`${ie.toString().padStart(3)}:      ${q(Y,ie)}      ${q(J,ie)}   ${q(Z,ie)}`);P.unmap(),m.unmap(),H.unmap()}async generateMipmaps(e){const r=e.createShaderModule({code:await fetch("/mipmapComputerShader.wgsl").then(x=>x.text())}),o=e.createComputePipeline({layout:"auto",compute:{module:r,entryPoint:"main"}}),l=e.createCommandEncoder();console.log(this.texture);const c=this.texture.width,p=this.texture.height,d=Math.floor(Math.log2(Math.max(c,p)));for(let x=0;x<d;x++){const T=this.texture.createView({baseMipLevel:x,mipLevelCount:1}),b=this.texture.createView({baseMipLevel:x+1,mipLevelCount:1}),C=e.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:T},{binding:1,resource:b}]}),R=l.beginComputePass();R.setPipeline(o),R.setBindGroup(0,C);const I=Math.max(1,Math.floor(c/2**(x+1))),S=Math.max(1,Math.floor(p/2**(x+1)));R.dispatchWorkgroups(Math.ceil(I/8),Math.ceil(S/8)),R.end()}e.queue.submit([l.finish()])}},z(Bn,"computeBindGroupLayout"),Bn);const Bi=`struct TransformData{
    view: mat4x4<f32>,
    projection: mat4x4<f32>,
};

struct ObjectData{
    model: array<mat4x4<f32>>
}

@binding(0) @group(0) var<uniform> transformUBO: TransformData;
@binding(1) @group(0) var<storage,read> objects: ObjectData;

@binding(0) @group(1) var myTexture: texture_2d<f32>;
@binding(1) @group(1) var mySampler: sampler;

struct Fragment{
    @builtin(position) Position: vec4<f32>,
    @location(0) TexCoord: vec2<f32>,
};

@vertex
fn vs_main(
    @builtin(instance_index) ID: u32,
    @location(0) vertexPosition: vec3<f32>, 
    @location(1) vertexTextureCoord: vec2<f32>) -> Fragment {

    var output : Fragment;
    output.Position = transformUBO.projection * transformUBO.view * objects.model[ID]* vec4<f32>(vertexPosition, 1.0);
    output.TexCoord = vertexTextureCoord;
    return output;
}

@fragment
fn fs_main(@location(0) TexCoord: vec2<f32>) -> @location(0) vec4<f32>{
    return textureSample(myTexture, mySampler, TexCoord);
}


`;class Eo{constructor(e){z(this,"buffer");z(this,"bufferLayout");const r=new Float32Array([0,0,.5,.5,0,0,-.5,-.5,0,1,0,.5,-.5,1,1]),o=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,l={size:r.byteLength,usage:o,mappedAtCreation:!0};this.buffer=e.createBuffer(l),new Float32Array(this.buffer.getMappedRange()).set(r),this.buffer.unmap(),this.bufferLayout={arrayStride:5*4,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:3*4}]}}}var An=1e-6,St=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});function er(){var s=new St(16);return St!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s}function Wi(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Gn(s,e,r){var o=r[0],l=r[1],c=r[2],p,d,x,T,b,C,R,I,S,M,P,m;return e===s?(s[12]=e[0]*o+e[4]*l+e[8]*c+e[12],s[13]=e[1]*o+e[5]*l+e[9]*c+e[13],s[14]=e[2]*o+e[6]*l+e[10]*c+e[14],s[15]=e[3]*o+e[7]*l+e[11]*c+e[15]):(p=e[0],d=e[1],x=e[2],T=e[3],b=e[4],C=e[5],R=e[6],I=e[7],S=e[8],M=e[9],P=e[10],m=e[11],s[0]=p,s[1]=d,s[2]=x,s[3]=T,s[4]=b,s[5]=C,s[6]=R,s[7]=I,s[8]=S,s[9]=M,s[10]=P,s[11]=m,s[12]=p*o+b*l+S*c+e[12],s[13]=d*o+C*l+M*c+e[13],s[14]=x*o+R*l+P*c+e[14],s[15]=T*o+I*l+m*c+e[15]),s}function So(s,e,r){var o=Math.sin(r),l=Math.cos(r),c=e[4],p=e[5],d=e[6],x=e[7],T=e[8],b=e[9],C=e[10],R=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=c*l+T*o,s[5]=p*l+b*o,s[6]=d*l+C*o,s[7]=x*l+R*o,s[8]=T*l-c*o,s[9]=b*l-p*o,s[10]=C*l-d*o,s[11]=R*l-x*o,s}function Ao(s,e,r){var o=Math.sin(r),l=Math.cos(r),c=e[0],p=e[1],d=e[2],x=e[3],T=e[8],b=e[9],C=e[10],R=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=c*l-T*o,s[1]=p*l-b*o,s[2]=d*l-C*o,s[3]=x*l-R*o,s[8]=c*o+T*l,s[9]=p*o+b*l,s[10]=d*o+C*l,s[11]=x*o+R*l,s}function Ki(s,e,r){var o=Math.sin(r),l=Math.cos(r),c=e[0],p=e[1],d=e[2],x=e[3],T=e[4],b=e[5],C=e[6],R=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=c*l+T*o,s[1]=p*l+b*o,s[2]=d*l+C*o,s[3]=x*l+R*o,s[4]=T*l-c*o,s[5]=b*l-p*o,s[6]=C*l-d*o,s[7]=R*l-x*o,s}function Co(s,e,r,o,l){var c=1/Math.tan(e/2),p;return s[0]=c/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=c,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,l!=null&&l!==1/0?(p=1/(o-l),s[10]=(l+o)*p,s[14]=2*l*o*p):(s[10]=-1,s[14]=-2*o),s}var Ro=Co;function Io(s,e,r,o){var l,c,p,d,x,T,b,C,R,I,S=e[0],M=e[1],P=e[2],m=o[0],H=o[1],_=o[2],G=r[0],F=r[1],V=r[2];return Math.abs(S-G)<An&&Math.abs(M-F)<An&&Math.abs(P-V)<An?Wi(s):(b=S-G,C=M-F,R=P-V,I=1/Math.hypot(b,C,R),b*=I,C*=I,R*=I,l=H*R-_*C,c=_*b-m*R,p=m*C-H*b,I=Math.hypot(l,c,p),I?(I=1/I,l*=I,c*=I,p*=I):(l=0,c=0,p=0),d=C*p-R*c,x=R*l-b*p,T=b*c-C*l,I=Math.hypot(d,x,T),I?(I=1/I,d*=I,x*=I,T*=I):(d=0,x=0,T=0),s[0]=l,s[1]=d,s[2]=b,s[3]=0,s[4]=c,s[5]=x,s[6]=C,s[7]=0,s[8]=p,s[9]=T,s[10]=R,s[11]=0,s[12]=-(l*S+c*M+p*P),s[13]=-(d*S+x*M+T*P),s[14]=-(b*S+C*M+R*P),s[15]=1,s)}function pt(){var s=new St(3);return St!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Xt(s,e,r){var o=new St(3);return o[0]=s,o[1]=e,o[2]=r,o}function Mo(s,e,r,o){return s[0]=e,s[1]=r,s[2]=o,s}function No(s,e,r){return s[0]=e[0]+r[0],s[1]=e[1]+r[1],s[2]=e[2]+r[2],s}function Cn(s,e,r,o){return s[0]=e[0]+r[0]*o,s[1]=e[1]+r[1]*o,s[2]=e[2]+r[2]*o,s}function Bo(s,e){var r=e[0],o=e[1],l=e[2],c=r*r+o*o+l*l;return c>0&&(c=1/Math.sqrt(c)),s[0]=e[0]*c,s[1]=e[1]*c,s[2]=e[2]*c,s}function Pi(s,e,r){var o=e[0],l=e[1],c=e[2],p=r[0],d=r[1],x=r[2];return s[0]=l*x-c*d,s[1]=c*p-o*x,s[2]=o*d-l*p,s}(function(){var s=pt();return function(e,r,o,l,c,p){var d,x;for(r||(r=3),o||(o=0),l?x=Math.min(l*r+o,e.length):x=e.length,d=o;d<x;d+=r)s[0]=e[d],s[1]=e[d+1],s[2]=e[d+2],c(s,s,p),e[d]=s[0],e[d+1]=s[1],e[d+2]=s[2];return e}})();function Xi(){var s=new St(2);return St!=Float32Array&&(s[0]=0,s[1]=0),s}function Li(s,e){var r=new St(2);return r[0]=s,r[1]=e,r}(function(){var s=Xi();return function(e,r,o,l,c,p){var d,x;for(r||(r=2),o||(o=0),l?x=Math.min(l*r+o,e.length):x=e.length,d=o;d<x;d+=r)s[0]=e[d],s[1]=e[d+1],c(s,s,p),e[d]=s[0],e[d+1]=s[1];return e}})();var Xe=(s=>(s[s.TRIANGLE=0]="TRIANGLE",s[s.QUAD=1]="QUAD",s[s.TERRAIN=2]="TERRAIN",s))(Xe||{});class Po{constructor(e){z(this,"vertexBuffer");z(this,"indexBuffer");z(this,"bufferLayout");z(this,"indexCount");this.indexCount=0;const r={size:1024,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST};this.vertexBuffer=e.createBuffer(r);const o={size:1024,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST};this.indexBuffer=e.createBuffer(o),this.bufferLayout={arrayStride:5*4,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:3*4}]}}updateTerrain(e,r,o){this.vertexBuffer.destroy(),this.indexBuffer.destroy();const l={size:r.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0};this.vertexBuffer=e.createBuffer(l),new Float32Array(this.vertexBuffer.getMappedRange()).set(r),this.vertexBuffer.unmap();const c={size:o.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0};this.indexBuffer=e.createBuffer(c),new Uint32Array(this.indexBuffer.getMappedRange()).set(o),this.indexBuffer.unmap(),this.indexCount=o.length,console.log(`üèîÔ∏è Terrain mesh updated: ${r.length/5} vertices, ${o.length} indices`)}hasData(){return this.indexCount>0}}const Lo="modulepreload",Do=function(s,e){return new URL(s,e).href},Di={},Ct=function(e,r,o){let l=Promise.resolve();if(r&&r.length>0){const p=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),x=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));l=Promise.allSettled(r.map(T=>{if(T=Do(T,o),T in Di)return;Di[T]=!0;const b=T.endsWith(".css"),C=b?'[rel="stylesheet"]':"";if(!!o)for(let S=p.length-1;S>=0;S--){const M=p[S];if(M.href===T&&(!b||M.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${T}"]${C}`))return;const I=document.createElement("link");if(I.rel=b?"stylesheet":Lo,b||(I.as="script"),I.crossOrigin="",I.href=T,x&&I.setAttribute("nonce",x),document.head.appendChild(I),b)return new Promise((S,M)=>{I.addEventListener("load",S),I.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${T}`)))})}))}function c(p){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=p,window.dispatchEvent(d),!d.defaultPrevented)throw p}return l.then(p=>{for(const d of p||[])d.status==="rejected"&&c(d.reason);return e().catch(c)})};class Ji{constructor(){this._listeners={}}addEventListener(e,r){const o=this._listeners;return o[e]===void 0&&(o[e]=[]),o[e].indexOf(r)===-1&&o[e].push(r),this}removeEventListener(e,r){const l=this._listeners[e];if(l!==void 0){const c=l.indexOf(r);c!==-1&&l.splice(c,1)}return this}dispatchEvent(e){const o=this._listeners[e.type];if(o!==void 0){const l=o.slice(0);for(let c=0,p=l.length;c<p;c++)l[c].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class Jt{constructor(e,r,o,l={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=r,this._child=o,this._attributes=l,!r.isOnGraph(o))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class Oo extends Ji{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const r=new Set;for(const o of this.listParentEdges(e))r.add(o.getParent());return Array.from(r)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const r=new Set;for(const o of this.listChildEdges(e))r.add(o.getChild());return Array.from(r)}disconnectParents(e,r){for(const o of this.listParentEdges(e))(!r||r(o.getParent()))&&o.dispose();return this}_createEdge(e,r,o,l){const c=new Jt(e,r,o,l);this._edges.add(c);const p=c.getParent();this._parentEdges.has(p)||this._parentEdges.set(p,new Set),this._parentEdges.get(p).add(c);const d=c.getChild();return this._childEdges.has(d)||this._childEdges.set(d,new Set),this._childEdges.get(d).add(c),c}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function xr(){return xr=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])}return s},xr.apply(this,arguments)}class bt{constructor(e){if(this.list=[],e)for(const r of e)this.list.push(r)}add(e){this.list.push(e)}remove(e){const r=this.list.indexOf(e);r>=0&&this.list.splice(r,1)}removeChild(e){const r=[];for(const o of this.list)o.getChild()===e&&r.push(o);for(const o of r)this.remove(o);return r}listRefsByChild(e){const r=[];for(const o of this.list)o.getChild()===e&&r.push(o);return r}values(){return this.list}}class Ee{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const r of e)this.add(r)}add(e){const r=e.getChild();this.removeChild(r),this.set.add(e),this.map.set(r,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const r=this.map.get(e)||null;return r&&this.remove(r),r}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class lt{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,r){this.map[e]=r}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const Te=Symbol("attributes"),Dt=Symbol("immutableKeys");class jn extends Ji{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Te]=void 0,this[Dt]=void 0,this.graph=e,this[Dt]=new Set,this[Te]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),r={};for(const o in e){const l=e[o];if(l instanceof jn){const c=this.graph._createEdge(o,this,l);this[Dt].add(o),r[o]=c}else r[o]=l}return r}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,r){for(const o in this[Te]){const l=this[Te][o];if(l instanceof Jt){const c=l;c.getChild()===e&&this.setRef(o,r,c.getAttributes())}else if(l instanceof bt)for(const c of l.listRefsByChild(e)){const p=c.getAttributes();this.removeRef(o,e),this.addRef(o,r,p)}else if(l instanceof Ee){const c=l.getRefByChild(e);if(c){const p=c.getAttributes();this.removeRef(o,e),this.addRef(o,r,p)}}else if(l instanceof lt)for(const c of l.keys()){const p=l.get(c);p.getChild()===e&&this.setRefMap(o,c,r,p.getAttributes())}}return this}get(e){return this[Te][e]}set(e,r){return this[Te][e]=r,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const r=this[Te][e];return r?r.getChild():null}setRef(e,r,o){if(this[Dt].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const l=this[Te][e];if(l&&l.dispose(),!r)return this;const c=this.graph._createEdge(e,this,r,o);return this[Te][e]=c,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(o=>o.getChild())}addRef(e,r,o){const l=this.graph._createEdge(e,this,r,o);return this.assertRefList(e).add(l),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,r){const o=this.assertRefList(e);if(o instanceof bt)for(const l of o.listRefsByChild(r))l.dispose();else{const l=o.getRefByChild(r);l&&l.dispose()}return this}assertRefList(e){const r=this[Te][e];if(r instanceof bt||r instanceof Ee)return r;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(r=>r.getChild())}getRefMap(e,r){const l=this.assertRefMap(e).get(r);return l?l.getChild():null}setRefMap(e,r,o,l){const c=this.assertRefMap(e),p=c.get(r);if(p&&p.dispose(),!o)return this;l=Object.assign(l||{},{key:r});const d=this.graph._createEdge(e,this,o,xr({},l,{key:r}));return c.set(r,d),this.dispatchEvent({type:"change",attribute:e,key:r})}assertRefMap(e){const r=this[Te][e];if(r instanceof lt)return r;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(xr({},e,{target:this})),this.graph.dispatchEvent(xr({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const r=e.getName();if(this[Te][r]===e)this[Te][r]=null,this[Dt].has(r)&&e.getChild().dispose();else if(this[Te][r]instanceof bt)this[Te][r].remove(e);else if(this[Te][r]instanceof Ee)this[Te][r].remove(e);else if(this[Te][r]instanceof lt){const o=this[Te][r];for(const l of o.keys())o.get(l)===e&&o.delete(l)}else return;this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:r})}}const Zi="v4.2.1",$r="@glb.bin";var te;(function(s){s.ACCESSOR="Accessor",s.ANIMATION="Animation",s.ANIMATION_CHANNEL="AnimationChannel",s.ANIMATION_SAMPLER="AnimationSampler",s.BUFFER="Buffer",s.CAMERA="Camera",s.MATERIAL="Material",s.MESH="Mesh",s.PRIMITIVE="Primitive",s.PRIMITIVE_TARGET="PrimitiveTarget",s.NODE="Node",s.ROOT="Root",s.SCENE="Scene",s.SKIN="Skin",s.TEXTURE="Texture",s.TEXTURE_INFO="TextureInfo"})(te||(te={}));var qr;(function(s){s.INTERLEAVED="interleaved",s.SEPARATE="separate"})(qr||(qr={}));var He;(function(s){s.ARRAY_BUFFER="ARRAY_BUFFER",s.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",s.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",s.OTHER="OTHER",s.SPARSE="SPARSE"})(He||(He={}));var Pn;(function(s){s[s.R=4096]="R",s[s.G=256]="G",s[s.B=16]="B",s[s.A=1]="A"})(Pn||(Pn={}));var Et;(function(s){s.GLTF="GLTF",s.GLB="GLB"})(Et||(Et={}));const Jr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class xe{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const r=atob(e.split(",")[1]),o=new Uint8Array(r.length);for(let l=0;l<r.length;l++)o[l]=r.charCodeAt(l);return o}else{const r=e.split(",")[1],o=e.indexOf("base64")>=0;return Buffer.from(r,o?"base64":"utf8")}}static encodeText(e){return new TextEncoder().encode(e)}static decodeText(e){return new TextDecoder().decode(e)}static concat(e){let r=0;for(const c of e)r+=c.byteLength;const o=new Uint8Array(r);let l=0;for(const c of e)o.set(c,l),l+=c.byteLength;return o}static pad(e,r=0){const o=this.padNumber(e.byteLength);if(o===e.byteLength)return e;const l=new Uint8Array(o);if(l.set(e),r!==0)for(let c=e.byteLength;c<o;c++)l[c]=r;return l}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,r){if(e===r)return!0;if(e.byteLength!==r.byteLength)return!1;let o=e.byteLength;for(;o--;)if(e[o]!==r[o])return!1;return!0}static toView(e,r=0,o=1/0){return new Uint8Array(e.buffer,e.byteOffset+r,Math.min(e.byteLength,o))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class _o{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let r=new DataView(e.buffer,e.byteOffset+4),o,l;for(;r.byteLength;){if(o=r.getUint16(0,!1),Fo(r,o),l=r.getUint8(o+1),l===192||l===193||l===194)return[r.getUint16(o+7,!1),r.getUint16(o+5,!1)];r=new DataView(e.buffer,r.byteOffset+o+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class Zr{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const r=new DataView(e.buffer,e.byteOffset);return xe.decodeText(e.slice(12,16))===Zr.PNG_FRIED_CHUNK_NAME?[r.getUint32(32,!1),r.getUint32(36,!1)]:[r.getUint32(16,!1),r.getUint32(20,!1)]}getChannels(e){return 4}}Zr.PNG_FRIED_CHUNK_NAME="CgBI";class Ft{static registerFormat(e,r){this.impls[e]=r}static getMimeType(e){for(const r in this.impls)if(this.impls[r].match(e))return r;return null}static getSize(e,r){return this.impls[r]?this.impls[r].getSize(e):null}static getChannels(e,r){return this.impls[r]?this.impls[r].getChannels(e):null}static getVRAMByteLength(e,r){if(!this.impls[r])return null;if(this.impls[r].getVRAMByteLength)return this.impls[r].getVRAMByteLength(e);let o=0;const l=4,c=this.getSize(e,r);if(!c)return null;for(;c[0]>1||c[1]>1;)o+=c[0]*c[1]*l,c[0]=Math.max(Math.floor(c[0]/2),1),c[1]=Math.max(Math.floor(c[1]/2),1);return o+=1*1*l,o}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}Ft.impls={"image/jpeg":new _o,"image/png":new Zr};function Fo(s,e){if(e>s.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(s.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return s}class Qt{static basename(e){const r=e.split(/[\\/]/).pop();return r.substring(0,r.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const r=e.match(/data:(image\/\w+)/)[1];return Ft.mimeTypeToExtension(r)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}var Ln=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});function Uo(){var s=new Ln(3);return Ln!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Rn(s){var e=s[0],r=s[1],o=s[2];return Math.hypot(e,r,o)}(function(){var s=Uo();return function(e,r,o,l,c,p){var d,x;for(r||(r=3),o||(o=0),l?x=Math.min(l*r+o,e.length):x=e.length,d=o;d<x;d+=r)s[0]=e[d],s[1]=e[d+1],s[2]=e[d+2],c(s,s,p),e[d]=s[0],e[d+1]=s[1],e[d+2]=s[2];return e}})();const Oi="https://null.example";class Tr{static dirname(e){const r=e.lastIndexOf("/");return r===-1?"./":e.substring(0,r+1)}static basename(e){return Qt.basename(new URL(e,Oi).pathname)}static extension(e){return Qt.extension(new URL(e,Oi).pathname)}static resolve(e,r){if(!this.isRelativePath(r))return r;const o=e.split("/"),l=r.split("/");o.pop();for(let c=0;c<l.length;c++)l[c]!=="."&&(l[c]===".."?o.pop():o.push(l[c]));return o.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Tr.DEFAULT_INIT={};Tr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;function _i(s){return Object.prototype.toString.call(s)==="[object Object]"}function _t(s){if(_i(s)===!1)return!1;const e=s.constructor;if(e===void 0)return!0;const r=e.prototype;return!(_i(r)===!1||Object.hasOwn(r,"isPrototypeOf")===!1)}var Dn,On;(function(s){s[s.SILENT=4]="SILENT",s[s.ERROR=3]="ERROR",s[s.WARN=2]="WARN",s[s.INFO=1]="INFO",s[s.DEBUG=0]="DEBUG"})(On||(On={}));class qe{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=qe.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=qe.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=qe.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=qe.Verbosity.ERROR&&console.error(e)}}Dn=qe;qe.Verbosity=On;qe.DEFAULT_INSTANCE=new Dn(Dn.Verbosity.INFO);function ko(s){var e=s[0],r=s[1],o=s[2],l=s[3],c=s[4],p=s[5],d=s[6],x=s[7],T=s[8],b=s[9],C=s[10],R=s[11],I=s[12],S=s[13],M=s[14],P=s[15],m=e*p-r*c,H=e*d-o*c,_=e*x-l*c,G=r*d-o*p,F=r*x-l*p,V=o*x-l*d,i=T*S-b*I,D=T*M-C*I,j=T*P-R*I,Y=b*M-C*S,J=b*P-R*S,Z=C*P-R*M;return m*Z-H*J+_*Y+G*j-F*D+V*i}function Go(s,e,r){var o=e[0],l=e[1],c=e[2],p=e[3],d=e[4],x=e[5],T=e[6],b=e[7],C=e[8],R=e[9],I=e[10],S=e[11],M=e[12],P=e[13],m=e[14],H=e[15],_=r[0],G=r[1],F=r[2],V=r[3];return s[0]=_*o+G*d+F*C+V*M,s[1]=_*l+G*x+F*R+V*P,s[2]=_*c+G*T+F*I+V*m,s[3]=_*p+G*b+F*S+V*H,_=r[4],G=r[5],F=r[6],V=r[7],s[4]=_*o+G*d+F*C+V*M,s[5]=_*l+G*x+F*R+V*P,s[6]=_*c+G*T+F*I+V*m,s[7]=_*p+G*b+F*S+V*H,_=r[8],G=r[9],F=r[10],V=r[11],s[8]=_*o+G*d+F*C+V*M,s[9]=_*l+G*x+F*R+V*P,s[10]=_*c+G*T+F*I+V*m,s[11]=_*p+G*b+F*S+V*H,_=r[12],G=r[13],F=r[14],V=r[15],s[12]=_*o+G*d+F*C+V*M,s[13]=_*l+G*x+F*R+V*P,s[14]=_*c+G*T+F*I+V*m,s[15]=_*p+G*b+F*S+V*H,s}function jo(s,e){var r=e[0],o=e[1],l=e[2],c=e[4],p=e[5],d=e[6],x=e[8],T=e[9],b=e[10];return s[0]=Math.hypot(r,o,l),s[1]=Math.hypot(c,p,d),s[2]=Math.hypot(x,T,b),s}function Ho(s,e){var r=new Ln(3);jo(r,e);var o=1/r[0],l=1/r[1],c=1/r[2],p=e[0]*o,d=e[1]*l,x=e[2]*c,T=e[4]*o,b=e[5]*l,C=e[6]*c,R=e[8]*o,I=e[9]*l,S=e[10]*c,M=p+b+S,P=0;return M>0?(P=Math.sqrt(M+1)*2,s[3]=.25*P,s[0]=(C-I)/P,s[1]=(R-x)/P,s[2]=(d-T)/P):p>b&&p>S?(P=Math.sqrt(1+p-b-S)*2,s[3]=(C-I)/P,s[0]=.25*P,s[1]=(d+T)/P,s[2]=(R+x)/P):b>S?(P=Math.sqrt(1+b-p-S)*2,s[3]=(R-x)/P,s[0]=(d+T)/P,s[1]=.25*P,s[2]=(C+I)/P):(P=Math.sqrt(1+S-p-b)*2,s[3]=(d-T)/P,s[0]=(R+x)/P,s[1]=(C+I)/P,s[2]=.25*P),s}class Se{static identity(e){return e}static eq(e,r,o=1e-5){if(e.length!==r.length)return!1;for(let l=0;l<e.length;l++)if(Math.abs(e[l]-r[l])>o)return!1;return!0}static clamp(e,r,o){return e<r?r:e>o?o:e}static decodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return Math.round(Se.clamp(e,0,1)*65535);case 5121:return Math.round(Se.clamp(e,0,1)*255);case 5122:return Math.round(Se.clamp(e,-1,1)*32767);case 5120:return Math.round(Se.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,r,o,l){let c=Rn([e[0],e[1],e[2]]);const p=Rn([e[4],e[5],e[6]]),d=Rn([e[8],e[9],e[10]]);ko(e)<0&&(c=-c),r[0]=e[12],r[1]=e[13],r[2]=e[14];const T=e.slice(),b=1/c,C=1/p,R=1/d;T[0]*=b,T[1]*=b,T[2]*=b,T[4]*=C,T[5]*=C,T[6]*=C,T[8]*=R,T[9]*=R,T[10]*=R,Ho(o,T),l[0]=c,l[1]=p,l[2]=d}static compose(e,r,o,l){const c=l,p=r[0],d=r[1],x=r[2],T=r[3],b=p+p,C=d+d,R=x+x,I=p*b,S=p*C,M=p*R,P=d*C,m=d*R,H=x*R,_=T*b,G=T*C,F=T*R,V=o[0],i=o[1],D=o[2];return c[0]=(1-(P+H))*V,c[1]=(S+F)*V,c[2]=(M-G)*V,c[3]=0,c[4]=(S-F)*i,c[5]=(1-(I+H))*i,c[6]=(m+_)*i,c[7]=0,c[8]=(M+G)*D,c[9]=(m-_)*D,c[10]=(1-(I+P))*D,c[11]=0,c[12]=e[0],c[13]=e[1],c[14]=e[2],c[15]=1,c}}function Vo(s,e){if(!!s!=!!e)return!1;const r=s.getChild(),o=e.getChild();return r===o||r.equals(o)}function zo(s,e){if(!!s!=!!e)return!1;const r=s.values(),o=e.values();if(r.length!==o.length)return!1;for(let l=0;l<r.length;l++){const c=r[l],p=o[l];if(c.getChild()!==p.getChild()&&!c.getChild().equals(p.getChild()))return!1}return!0}function $o(s,e){if(!!s!=!!e)return!1;const r=s.keys(),o=e.keys();if(r.length!==o.length)return!1;for(const l of r){const c=s.get(l),p=e.get(l);if(!!c!=!!p)return!1;const d=c.getChild(),x=p.getChild();if(d!==x&&!d.equals(x))return!1}return!0}function Qi(s,e){if(s===e)return!0;if(!!s!=!!e||!s||!e||s.length!==e.length)return!1;for(let r=0;r<s.length;r++)if(s[r]!==e[r])return!1;return!0}function es(s,e){if(s===e)return!0;if(!!s!=!!e)return!1;if(!_t(s)||!_t(e))return s===e;const r=s,o=e;let l=0,c=0,p;for(p in r)l++;for(p in o)c++;if(l!==c)return!1;for(p in r){const d=r[p],x=o[p];if(Yr(d)&&Yr(x)){if(!Qi(d,x))return!1}else if(_t(d)&&_t(x)){if(!es(d,x))return!1}else if(d!==x)return!1}return!0}function Yr(s){return Array.isArray(s)||ArrayBuffer.isView(s)}const Fi="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",qo=999,Yo=6,Ui=new Set,Wo=function(){let e="";for(let r=0;r<Yo;r++)e+=Fi.charAt(Math.floor(Math.random()*Fi.length));return e},Ko=function(){for(let e=0;e<qo;e++){const r=Wo();if(!Ui.has(r))return Ui.add(r),r}return""},At=s=>s,Xo=new Set;class Hn extends jn{constructor(e,r=""){super(e),this[Te].name=r,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,r){return Array.isArray(r)&&(r=r.slice()),super.set(e,r)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,At)}copy(e,r=At){for(const o in this[Te]){const l=this[Te][o];if(l instanceof Jt)this[Dt].has(o)||l.dispose();else if(l instanceof bt||l instanceof Ee)for(const c of l.values())c.dispose();else if(l instanceof lt)for(const c of l.values())c.dispose()}for(const o in e[Te]){const l=this[Te][o],c=e[Te][o];if(c instanceof Jt)this[Dt].has(o)?l.getChild().copy(r(c.getChild()),r):this.setRef(o,r(c.getChild()),c.getAttributes());else if(c instanceof Ee||c instanceof bt)for(const p of c.values())this.addRef(o,r(p.getChild()),p.getAttributes());else if(c instanceof lt)for(const p of c.keys()){const d=c.get(p);this.setRefMap(o,p,r(d.getChild()),d.getAttributes())}else _t(c)?this[Te][o]=JSON.parse(JSON.stringify(c)):Array.isArray(c)||c instanceof ArrayBuffer||ArrayBuffer.isView(c)?this[Te][o]=c.slice():this[Te][o]=c}return this}equals(e,r=Xo){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const o in this[Te]){if(r.has(o))continue;const l=this[Te][o],c=e[Te][o];if(l instanceof Jt||c instanceof Jt){if(!Vo(l,c))return!1}else if(l instanceof Ee||c instanceof Ee||l instanceof bt||c instanceof bt){if(!zo(l,c))return!1}else if(l instanceof lt||c instanceof lt){if(!$o(l,c))return!1}else if(_t(l)||_t(c)){if(!es(l,c))return!1}else if(Yr(l)||Yr(c)){if(!Qi(l,c))return!1}else if(l!==c)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Oe extends Hn{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new lt})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,r){return r&&r._validateParent(this),this.setRefMap("extensions",e,r)}listExtensions(){return this.listRefMapValues("extensions")}}class le extends Oe{init(){this.propertyType=te.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:le.Type.SCALAR,componentType:le.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case le.Type.SCALAR:return 1;case le.Type.VEC2:return 2;case le.Type.VEC3:return 3;case le.Type.VEC4:return 4;case le.Type.MAT2:return 4;case le.Type.MAT3:return 9;case le.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case le.ComponentType.BYTE:return 1;case le.ComponentType.UNSIGNED_BYTE:return 1;case le.ComponentType.SHORT:return 2;case le.ComponentType.UNSIGNED_SHORT:return 2;case le.ComponentType.UNSIGNED_INT:return 4;case le.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const r=this.getNormalized(),o=this.getElementSize(),l=this.getComponentType();if(this.getMin(e),r)for(let c=0;c<o;c++)e[c]=Se.decodeNormalizedInt(e[c],l);return e}getMin(e){const r=this.getArray(),o=this.getCount(),l=this.getElementSize();for(let c=0;c<l;c++)e[c]=1/0;for(let c=0;c<o*l;c+=l)for(let p=0;p<l;p++){const d=r[c+p];Number.isFinite(d)&&(e[p]=Math.min(e[p],d))}return e}getMaxNormalized(e){const r=this.getNormalized(),o=this.getElementSize(),l=this.getComponentType();if(this.getMax(e),r)for(let c=0;c<o;c++)e[c]=Se.decodeNormalizedInt(e[c],l);return e}getMax(e){const r=this.get("array"),o=this.getCount(),l=this.getElementSize();for(let c=0;c<l;c++)e[c]=-1/0;for(let c=0;c<o*l;c+=l)for(let p=0;p<l;p++){const d=r[c+p];Number.isFinite(d)&&(e[p]=Math.max(e[p],d))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return le.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const r=this.getElementSize(),o=this.getComponentType(),l=this.getArray();return this.getNormalized()?Se.decodeNormalizedInt(l[e*r],o):l[e*r]}setScalar(e,r){const o=this.getElementSize(),l=this.getComponentType(),c=this.getArray();return this.getNormalized()?c[e*o]=Se.encodeNormalizedInt(r,l):c[e*o]=r,this}getElement(e,r){const o=this.getNormalized(),l=this.getElementSize(),c=this.getComponentType(),p=this.getArray();for(let d=0;d<l;d++)o?r[d]=Se.decodeNormalizedInt(p[e*l+d],c):r[d]=p[e*l+d];return r}setElement(e,r){const o=this.getNormalized(),l=this.getElementSize(),c=this.getComponentType(),p=this.getArray();for(let d=0;d<l;d++)o?p[e*l+d]=Se.encodeNormalizedInt(r[d],c):p[e*l+d]=r[d];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?Jo(e):le.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}le.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};le.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function Jo(s){switch(s.constructor){case Float32Array:return le.ComponentType.FLOAT;case Uint32Array:return le.ComponentType.UNSIGNED_INT;case Uint16Array:return le.ComponentType.UNSIGNED_SHORT;case Uint8Array:return le.ComponentType.UNSIGNED_BYTE;case Int16Array:return le.ComponentType.SHORT;case Int8Array:return le.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class ts extends Oe{init(){this.propertyType=te.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new Ee,samplers:new Ee})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class rs extends Oe{init(){this.propertyType=te.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}rs.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class Sr extends Oe{init(){this.propertyType=te.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Sr.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:He.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:He.OTHER})}}Sr.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class ns extends Oe{init(){this.propertyType=te.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}let Ar=class is extends Oe{init(){this.propertyType=te.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:is.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}};Ar.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Zo extends Hn{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}Zo.EXTENSION_NAME=void 0;class Je extends Oe{init(){this.propertyType=te.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Je.WrapMode.REPEAT,wrapT:Je.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Je.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Je.MagFilter={NEAREST:9728,LINEAR:9729};Je.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Ur,G:kr,B:Gr,A:Qo}=Pn;class kt extends Oe{init(){this.propertyType=te.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:kt.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Je(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Je(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Je(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Je(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Je(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const r=this.get("baseColorFactor").slice();return r[3]=e,this.set("baseColorFactor",r)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Ur|kr|Gr|Qo,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Ur|kr|Gr,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Ur|kr|Gr})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Ur})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:kr|Gr})}}kt.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class ss extends Oe{init(){this.propertyType=te.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new Ee})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class os extends Oe{init(){this.propertyType=te.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new Ee})}copy(e,r=At){if(r===At)throw new Error("Node cannot be copied.");return super.copy(e,r)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Se.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const r=this.get("translation").slice(),o=this.get("rotation").slice(),l=this.get("scale").slice();return Se.decompose(e,r,o,l),this.set("translation",r).set("rotation",o).set("scale",l)}getWorldTranslation(){const e=[0,0,0];return Se.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Se.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Se.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let l=this;l!=null;l=l.getParentNode())e.push(l);let r;const o=e.pop().getMatrix();for(;r=e.pop();)Go(o,o,r.getMatrix());return o}addChild(e){const r=e.getParentNode();r&&r.removeChild(e);for(const o of e.listParents())o.propertyType===te.SCENE&&o.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===te.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const r of this.listChildren())r.traverse(e);return this}}class Qr extends Oe{init(){this.propertyType=te.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Qr.Mode.TRIANGLES,material:null,indices:null,attributes:new lt,targets:new Ee})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:He.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:He.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}Qr.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class ea extends Hn{init(){this.propertyType=te.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new lt})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:He.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function De(){return De=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)({}).hasOwnProperty.call(r,o)&&(s[o]=r[o])}return s},De.apply(null,arguments)}let as=class extends Oe{init(){this.propertyType=te.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new Ee})}copy(e,r=At){if(r===At)throw new Error("Scene cannot be copied.");return super.copy(e,r)}addChild(e){const r=e.getParentNode();return r&&r.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const r of this.listChildren())r.traverse(e);return this}};class ls extends Oe{init(){this.propertyType=te.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new Ee})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:He.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class cs extends Oe{init(){this.propertyType=te.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Ft.extensionToMimeType(Qt.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const r=Ft.extensionToMimeType(Qt.extension(e));return r&&this.set("mimeType",r),this}getImage(){return this.get("image")}setImage(e){return this.set("image",xe.assertView(e))}getSize(){const e=this.get("image");return e?Ft.getSize(e,this.getMimeType()):null}}class ta extends Oe{init(){this.propertyType=te.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${Zi}`,version:"2.0"},defaultScene:null,accessors:new Ee,animations:new Ee,buffers:new Ee,cameras:new Ee,materials:new Ee,meshes:new Ee,nodes:new Ee,scenes:new Ee,skins:new Ee,textures:new Ee})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",r=>{this._addChildOfRoot(r.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,r=At){if(r===At)throw new Error("Root cannot be copied.");this.set("asset",De({},e.get("asset"))),this.setName(e.getName()),this.setExtras(De({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?r(e.getDefaultScene()):null);for(const o of e.listRefMapKeys("extensions")){const l=e.getExtension(o);this.setExtension(o,r(l))}return this}_addChildOfRoot(e){return e instanceof as?this.addRef("scenes",e):e instanceof os?this.addRef("nodes",e):e instanceof Ar?this.addRef("cameras",e):e instanceof ls?this.addRef("skins",e):e instanceof ss?this.addRef("meshes",e):e instanceof kt?this.addRef("materials",e):e instanceof cs?this.addRef("textures",e):e instanceof ts?this.addRef("animations",e):e instanceof le?this.addRef("accessors",e):e instanceof ns&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class wr{static fromGraph(e){return wr._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new Oo,this._root=new ta(this._graph),this._logger=qe.DEFAULT_INSTANCE,wr._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const r=e.map(o=>o.name);for(const o of e)await o(this,{stack:r});return this}createExtension(e){const r=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(l=>l.extensionName===r)||new e(this)}createScene(e=""){return new as(this._graph,e)}createNode(e=""){return new os(this._graph,e)}createCamera(e=""){return new Ar(this._graph,e)}createSkin(e=""){return new ls(this._graph,e)}createMesh(e=""){return new ss(this._graph,e)}createPrimitive(){return new Qr(this._graph)}createPrimitiveTarget(e=""){return new ea(this._graph,e)}createMaterial(e=""){return new kt(this._graph,e)}createTexture(e=""){return new cs(this._graph,e)}createAnimation(e=""){return new ts(this._graph,e)}createAnimationChannel(e=""){return new rs(this._graph,e)}createAnimationSampler(e=""){return new Sr(this._graph,e)}createAccessor(e="",r=null){return r||(r=this.getRoot().listBuffers()[0]),new le(this._graph,e).setBuffer(r)}createBuffer(e=""){return new ns(this._graph,e)}}wr._GRAPH_DOCUMENTS=new WeakMap;class ra{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,r){this.textureInfos.set(e,r),r.texCoord!==void 0&&e.setTexCoord(r.texCoord),r.extras!==void 0&&e.setExtras(r.extras);const o=this.jsonDoc.json.textures[r.index];if(o.sampler===void 0)return;const l=this.jsonDoc.json.samplers[o.sampler];l.magFilter!==void 0&&e.setMagFilter(l.magFilter),l.minFilter!==void 0&&e.setMinFilter(l.minFilter),l.wrapS!==void 0&&e.setWrapS(l.wrapS),l.wrapT!==void 0&&e.setWrapT(l.wrapT)}}const ki={logger:qe.DEFAULT_INSTANCE,extensions:[],dependencies:{}},na=new Set([te.BUFFER,te.TEXTURE,te.MATERIAL,te.MESH,te.PRIMITIVE,te.NODE,te.SCENE]);class ia{static read(e,r=ki){const o=De({},ki,r),{json:l}=e,c=new wr().setLogger(o.logger);this.validate(e,o);const p=new ra(e),d=l.asset,x=c.getRoot().getAsset();d.copyright&&(x.copyright=d.copyright),d.extras&&(x.extras=d.extras),l.extras!==void 0&&c.getRoot().setExtras(De({},l.extras));const T=l.extensionsUsed||[],b=l.extensionsRequired||[];o.extensions.sort((i,D)=>i.EXTENSION_NAME>D.EXTENSION_NAME?1:-1);for(const i of o.extensions)if(T.includes(i.EXTENSION_NAME)){const D=c.createExtension(i).setRequired(b.includes(i.EXTENSION_NAME)),j=D.prereadTypes.filter(Y=>!na.has(Y));j.length&&o.logger.warn(`Preread hooks for some types (${j.join()}), requested by extension ${D.extensionName}, are unsupported. Please file an issue or a PR.`);for(const Y of D.readDependencies)D.install(Y,o.dependencies[Y])}const C=l.buffers||[];c.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.BUFFER)).forEach(i=>i.preread(p,te.BUFFER)),p.buffers=C.map(i=>{const D=c.createBuffer(i.name);return i.extras&&D.setExtras(i.extras),i.uri&&i.uri.indexOf("__")!==0&&D.setURI(i.uri),D});const R=l.bufferViews||[];p.bufferViewBuffers=R.map((i,D)=>{if(!p.bufferViews[D]){const j=e.json.buffers[i.buffer],Y=j.uri?e.resources[j.uri]:e.resources[$r],J=i.byteOffset||0;p.bufferViews[D]=xe.toView(Y,J,i.byteLength)}return p.buffers[i.buffer]});const I=l.accessors||[];p.accessors=I.map(i=>{const D=p.bufferViewBuffers[i.bufferView],j=c.createAccessor(i.name,D).setType(i.type);return i.extras&&j.setExtras(i.extras),i.normalized!==void 0&&j.setNormalized(i.normalized),i.bufferView===void 0||j.setArray(Vr(i,p)),j});const S=l.images||[],M=l.textures||[];c.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.TEXTURE)).forEach(i=>i.preread(p,te.TEXTURE)),p.textures=S.map(i=>{const D=c.createTexture(i.name);if(i.extras&&D.setExtras(i.extras),i.bufferView!==void 0){const j=l.bufferViews[i.bufferView],Y=e.json.buffers[j.buffer],J=Y.uri?e.resources[Y.uri]:e.resources[$r],Z=j.byteOffset||0,q=j.byteLength,ie=J.slice(Z,Z+q);D.setImage(ie)}else i.uri!==void 0&&(D.setImage(e.resources[i.uri]),i.uri.indexOf("__")!==0&&D.setURI(i.uri));if(i.mimeType!==void 0)D.setMimeType(i.mimeType);else if(i.uri){const j=Qt.extension(i.uri);D.setMimeType(Ft.extensionToMimeType(j))}return D}),c.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.MATERIAL)).forEach(i=>i.preread(p,te.MATERIAL));const P=l.materials||[];p.materials=P.map(i=>{const D=c.createMaterial(i.name);i.extras&&D.setExtras(i.extras),i.alphaMode!==void 0&&D.setAlphaMode(i.alphaMode),i.alphaCutoff!==void 0&&D.setAlphaCutoff(i.alphaCutoff),i.doubleSided!==void 0&&D.setDoubleSided(i.doubleSided);const j=i.pbrMetallicRoughness||{};if(j.baseColorFactor!==void 0&&D.setBaseColorFactor(j.baseColorFactor),i.emissiveFactor!==void 0&&D.setEmissiveFactor(i.emissiveFactor),j.metallicFactor!==void 0&&D.setMetallicFactor(j.metallicFactor),j.roughnessFactor!==void 0&&D.setRoughnessFactor(j.roughnessFactor),j.baseColorTexture!==void 0){const Y=j.baseColorTexture,J=p.textures[M[Y.index].source];D.setBaseColorTexture(J),p.setTextureInfo(D.getBaseColorTextureInfo(),Y)}if(i.emissiveTexture!==void 0){const Y=i.emissiveTexture,J=p.textures[M[Y.index].source];D.setEmissiveTexture(J),p.setTextureInfo(D.getEmissiveTextureInfo(),Y)}if(i.normalTexture!==void 0){const Y=i.normalTexture,J=p.textures[M[Y.index].source];D.setNormalTexture(J),p.setTextureInfo(D.getNormalTextureInfo(),Y),i.normalTexture.scale!==void 0&&D.setNormalScale(i.normalTexture.scale)}if(i.occlusionTexture!==void 0){const Y=i.occlusionTexture,J=p.textures[M[Y.index].source];D.setOcclusionTexture(J),p.setTextureInfo(D.getOcclusionTextureInfo(),Y),i.occlusionTexture.strength!==void 0&&D.setOcclusionStrength(i.occlusionTexture.strength)}if(j.metallicRoughnessTexture!==void 0){const Y=j.metallicRoughnessTexture,J=p.textures[M[Y.index].source];D.setMetallicRoughnessTexture(J),p.setTextureInfo(D.getMetallicRoughnessTextureInfo(),Y)}return D}),c.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.MESH)).forEach(i=>i.preread(p,te.MESH));const m=l.meshes||[];c.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.PRIMITIVE)).forEach(i=>i.preread(p,te.PRIMITIVE)),p.meshes=m.map(i=>{const D=c.createMesh(i.name);return i.extras&&D.setExtras(i.extras),i.weights!==void 0&&D.setWeights(i.weights),(i.primitives||[]).forEach(Y=>{const J=c.createPrimitive();Y.extras&&J.setExtras(Y.extras),Y.material!==void 0&&J.setMaterial(p.materials[Y.material]),Y.mode!==void 0&&J.setMode(Y.mode);for(const[ie,re]of Object.entries(Y.attributes||{}))J.setAttribute(ie,p.accessors[re]);Y.indices!==void 0&&J.setIndices(p.accessors[Y.indices]);const Z=i.extras&&i.extras.targetNames||[];(Y.targets||[]).forEach((ie,re)=>{const ce=Z[re]||re.toString(),ge=c.createPrimitiveTarget(ce);for(const[Ce,we]of Object.entries(ie))ge.setAttribute(Ce,p.accessors[we]);J.addTarget(ge)}),D.addPrimitive(J)}),D});const H=l.cameras||[];p.cameras=H.map(i=>{const D=c.createCamera(i.name).setType(i.type);if(i.extras&&D.setExtras(i.extras),i.type===Ar.Type.PERSPECTIVE){const j=i.perspective;D.setYFov(j.yfov),D.setZNear(j.znear),j.zfar!==void 0&&D.setZFar(j.zfar),j.aspectRatio!==void 0&&D.setAspectRatio(j.aspectRatio)}else{const j=i.orthographic;D.setZNear(j.znear).setZFar(j.zfar).setXMag(j.xmag).setYMag(j.ymag)}return D});const _=l.nodes||[];c.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.NODE)).forEach(i=>i.preread(p,te.NODE)),p.nodes=_.map(i=>{const D=c.createNode(i.name);if(i.extras&&D.setExtras(i.extras),i.translation!==void 0&&D.setTranslation(i.translation),i.rotation!==void 0&&D.setRotation(i.rotation),i.scale!==void 0&&D.setScale(i.scale),i.matrix!==void 0){const j=[0,0,0],Y=[0,0,0,1],J=[1,1,1];Se.decompose(i.matrix,j,Y,J),D.setTranslation(j),D.setRotation(Y),D.setScale(J)}return i.weights!==void 0&&D.setWeights(i.weights),D});const G=l.skins||[];p.skins=G.map(i=>{const D=c.createSkin(i.name);i.extras&&D.setExtras(i.extras),i.inverseBindMatrices!==void 0&&D.setInverseBindMatrices(p.accessors[i.inverseBindMatrices]),i.skeleton!==void 0&&D.setSkeleton(p.nodes[i.skeleton]);for(const j of i.joints)D.addJoint(p.nodes[j]);return D}),_.map((i,D)=>{const j=p.nodes[D];(i.children||[]).forEach(J=>j.addChild(p.nodes[J])),i.mesh!==void 0&&j.setMesh(p.meshes[i.mesh]),i.camera!==void 0&&j.setCamera(p.cameras[i.camera]),i.skin!==void 0&&j.setSkin(p.skins[i.skin])});const F=l.animations||[];p.animations=F.map(i=>{const D=c.createAnimation(i.name);i.extras&&D.setExtras(i.extras);const Y=(i.samplers||[]).map(Z=>{const q=c.createAnimationSampler().setInput(p.accessors[Z.input]).setOutput(p.accessors[Z.output]).setInterpolation(Z.interpolation||Sr.Interpolation.LINEAR);return Z.extras&&q.setExtras(Z.extras),D.addSampler(q),q});return(i.channels||[]).forEach(Z=>{const q=c.createAnimationChannel().setSampler(Y[Z.sampler]).setTargetPath(Z.target.path);Z.target.node!==void 0&&q.setTargetNode(p.nodes[Z.target.node]),Z.extras&&q.setExtras(Z.extras),D.addChannel(q)}),D});const V=l.scenes||[];return c.getRoot().listExtensionsUsed().filter(i=>i.prereadTypes.includes(te.SCENE)).forEach(i=>i.preread(p,te.SCENE)),p.scenes=V.map(i=>{const D=c.createScene(i.name);return i.extras&&D.setExtras(i.extras),(i.nodes||[]).map(Y=>p.nodes[Y]).forEach(Y=>D.addChild(Y)),D}),l.scene!==void 0&&c.getRoot().setDefaultScene(p.scenes[l.scene]),c.getRoot().listExtensionsUsed().forEach(i=>i.read(p)),I.forEach((i,D)=>{const j=p.accessors[D],Y=!!i.sparse,J=!i.bufferView&&!j.getArray();(Y||J)&&j.setSparse(!0).setArray(oa(i,p))}),c}static validate(e,r){const o=e.json;if(o.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${o.asset.version}".`);if(o.extensionsRequired){for(const l of o.extensionsRequired)if(!r.extensions.find(c=>c.EXTENSION_NAME===l))throw new Error(`Missing required extension, "${l}".`)}if(o.extensionsUsed)for(const l of o.extensionsUsed)r.extensions.find(c=>c.EXTENSION_NAME===l)||r.logger.warn(`Missing optional extension, "${l}".`)}}function sa(s,e){const r=e.jsonDoc,o=e.bufferViews[s.bufferView],l=r.json.bufferViews[s.bufferView],c=Jr[s.componentType],p=le.getElementSize(s.type),d=c.BYTES_PER_ELEMENT,x=s.byteOffset||0,T=new c(s.count*p),b=new DataView(o.buffer,o.byteOffset,o.byteLength),C=l.byteStride;for(let R=0;R<s.count;R++)for(let I=0;I<p;I++){const S=x+R*C+I*d;let M;switch(s.componentType){case le.ComponentType.FLOAT:M=b.getFloat32(S,!0);break;case le.ComponentType.UNSIGNED_INT:M=b.getUint32(S,!0);break;case le.ComponentType.UNSIGNED_SHORT:M=b.getUint16(S,!0);break;case le.ComponentType.UNSIGNED_BYTE:M=b.getUint8(S);break;case le.ComponentType.SHORT:M=b.getInt16(S,!0);break;case le.ComponentType.BYTE:M=b.getInt8(S);break;default:throw new Error(`Unexpected componentType "${s.componentType}".`)}T[R*p+I]=M}return T}function Vr(s,e){const r=e.jsonDoc,o=e.bufferViews[s.bufferView],l=r.json.bufferViews[s.bufferView],c=Jr[s.componentType],p=le.getElementSize(s.type),d=c.BYTES_PER_ELEMENT,x=p*d;if(l.byteStride!==void 0&&l.byteStride!==x)return sa(s,e);const T=o.byteOffset+(s.byteOffset||0),b=s.count*p*d;return new c(o.buffer.slice(T,T+b))}function oa(s,e){const r=Jr[s.componentType],o=le.getElementSize(s.type);let l;s.bufferView!==void 0?l=Vr(s,e):l=new r(s.count*o);const c=s.sparse;if(!c)return l;const p=c.count,d=De({},s,c.indices,{count:p,type:"SCALAR"}),x=De({},s,c.values,{count:p}),T=Vr(d,e),b=Vr(x,e);for(let C=0;C<d.count;C++)for(let R=0;R<o;R++)l[T[C]*o+R]=b[C*o+R];return l}var br;(function(s){s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(br||(br={}));class Ut{constructor(e,r,o){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=r,this.options=o;const l=e.getRoot(),c=l.listBuffers().length,p=l.listTextures().length;this.bufferURIGenerator=new Gi(c>1,()=>o.basename||"buffer"),this.imageURIGenerator=new Gi(p>1,d=>aa(e,d)||o.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,r){const o={magFilter:r.getMagFilter()||void 0,minFilter:r.getMinFilter()||void 0,wrapS:r.getWrapS(),wrapT:r.getWrapT()},l=JSON.stringify(o);this.samplerDefIndexMap.has(l)||(this.samplerDefIndexMap.set(l,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(o));const c={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(l)},p=JSON.stringify(c);this.textureDefIndexMap.has(p)||(this.textureDefIndexMap.set(p,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(c));const d={index:this.textureDefIndexMap.get(p)};return r.getTexCoord()!==0&&(d.texCoord=r.getTexCoord()),Object.keys(r.getExtras()).length>0&&(d.extras=r.getExtras()),this.textureInfoDefMap.set(r,d),d}createPropertyDef(e){const r={};return e.getName()&&(r.name=e.getName()),Object.keys(e.getExtras()).length>0&&(r.extras=e.getExtras()),r}createAccessorDef(e){const r=this.createPropertyDef(e);return r.type=e.getType(),r.componentType=e.getComponentType(),r.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(l=>l.getName()==="attributes"&&l.getAttributes().key==="POSITION"||l.getName()==="input")&&(r.max=e.getMax([]).map(Math.fround),r.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(r.normalized=e.getNormalized()),r}createImageData(e,r,o){if(this.options.format===Et.GLB)this.imageBufferViews.push(r),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:r.byteLength});else{const l=Ft.mimeTypeToExtension(o.getMimeType());e.uri=this.imageURIGenerator.createURI(o,l),this.assignResourceURI(e.uri,r,!1)}}assignResourceURI(e,r,o){const l=this.jsonDoc.resources;if(!(e in l)){l[e]=r;return}if(r===l[e]){this.logger.warn(`Duplicate resource URI, "${e}".`);return}const c=`Resource URI "${e}" already assigned to different data.`;if(!o){this.logger.warn(c);return}throw new Error(c)}getAccessorUsage(e){const r=this._accessorUsageMap.get(e);if(r)return r;if(e.getSparse())return He.SPARSE;for(const o of this._doc.getGraph().listParentEdges(e)){const{usage:l}=o.getAttributes();if(l)return l;o.getParent().propertyType!==te.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${o.getName()}".`)}return He.OTHER}addAccessorToUsageGroup(e,r){const o=this._accessorUsageMap.get(e);if(o&&o!==r)throw new Error(`Accessor with usage "${o}" cannot be reused as "${r}".`);return this._accessorUsageMap.set(e,r),this}}Ut.BufferViewTarget=br;Ut.BufferViewUsage=He;Ut.USAGE_TO_TARGET={[He.ARRAY_BUFFER]:br.ARRAY_BUFFER,[He.ELEMENT_ARRAY_BUFFER]:br.ELEMENT_ARRAY_BUFFER};class Gi{constructor(e,r){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=r}createURI(e,r){if(e.getURI())return e.getURI();if(this.multiple){const o=this.basename(e);return this.counter[o]=this.counter[o]||1,`${o}_${this.counter[o]++}.${r}`}else return`${this.basename(e)}.${r}`}}function aa(s,e){const r=s.getGraph().listParentEdges(e).find(o=>o.getParent()!==s.getRoot());return r?r.getName().replace(/texture$/i,""):""}const{BufferViewUsage:jr}=Ut,{UNSIGNED_INT:la,UNSIGNED_SHORT:ca,UNSIGNED_BYTE:ua}=le.ComponentType,fa=new Set([te.ACCESSOR,te.BUFFER,te.MATERIAL,te.MESH]);class ha{static write(e,r){const o=e.getGraph(),l=e.getRoot(),c={asset:De({generator:`glTF-Transform ${Zi}`},l.getAsset()),extras:De({},l.getExtras())},p={json:c,resources:{}},d=new Ut(e,p,r),x=r.logger||qe.DEFAULT_INSTANCE,T=new Set(r.extensions.map(m=>m.EXTENSION_NAME)),b=e.getRoot().listExtensionsUsed().filter(m=>T.has(m.extensionName)).sort((m,H)=>m.extensionName>H.extensionName?1:-1),C=e.getRoot().listExtensionsRequired().filter(m=>T.has(m.extensionName)).sort((m,H)=>m.extensionName>H.extensionName?1:-1);b.length<e.getRoot().listExtensionsUsed().length&&x.warn("Some extensions were not registered for I/O, and will not be written.");for(const m of b){const H=m.prewriteTypes.filter(_=>!fa.has(_));H.length&&x.warn(`Prewrite hooks for some types (${H.join()}), requested by extension ${m.extensionName}, are unsupported. Please file an issue or a PR.`);for(const _ of m.writeDependencies)m.install(_,r.dependencies[_])}function R(m,H,_,G){const F=[];let V=0;for(const j of m){const Y=d.createAccessorDef(j);Y.bufferView=c.bufferViews.length;const J=j.getArray(),Z=xe.pad(xe.toView(J));Y.byteOffset=V,V+=Z.byteLength,F.push(Z),d.accessorIndexMap.set(j,c.accessors.length),c.accessors.push(Y)}const i=xe.concat(F),D={buffer:H,byteOffset:_,byteLength:i.byteLength};return G&&(D.target=G),c.bufferViews.push(D),{buffers:F,byteLength:V}}function I(m,H,_){const G=m[0].getCount();let F=0;for(const Y of m){const J=d.createAccessorDef(Y);J.bufferView=c.bufferViews.length,J.byteOffset=F;const Z=Y.getElementSize(),q=Y.getComponentSize();F+=xe.padNumber(Z*q),d.accessorIndexMap.set(Y,c.accessors.length),c.accessors.push(J)}const V=G*F,i=new ArrayBuffer(V),D=new DataView(i);for(let Y=0;Y<G;Y++){let J=0;for(const Z of m){const q=Z.getElementSize(),ie=Z.getComponentSize(),re=Z.getComponentType(),ce=Z.getArray();for(let ge=0;ge<q;ge++){const Ce=Y*F+J+ge*ie,we=ce[Y*q+ge];switch(re){case le.ComponentType.FLOAT:D.setFloat32(Ce,we,!0);break;case le.ComponentType.BYTE:D.setInt8(Ce,we);break;case le.ComponentType.SHORT:D.setInt16(Ce,we,!0);break;case le.ComponentType.UNSIGNED_BYTE:D.setUint8(Ce,we);break;case le.ComponentType.UNSIGNED_SHORT:D.setUint16(Ce,we,!0);break;case le.ComponentType.UNSIGNED_INT:D.setUint32(Ce,we,!0);break;default:throw new Error("Unexpected component type: "+re)}}J+=xe.padNumber(q*ie)}}const j={buffer:H,byteOffset:_,byteLength:V,byteStride:F,target:Ut.BufferViewTarget.ARRAY_BUFFER};return c.bufferViews.push(j),{byteLength:V,buffers:[new Uint8Array(i)]}}function S(m,H,_){const G=[];let F=0;const V=new Map;let i=-1/0,D=!1;for(const re of m){const ce=d.createAccessorDef(re);c.accessors.push(ce),d.accessorIndexMap.set(re,c.accessors.length-1);const ge=[],Ce=[],we=[],ct=new Array(re.getElementSize()).fill(0);for(let Ze=0,nr=re.getCount();Ze<nr;Ze++)if(re.getElement(Ze,we),!Se.eq(we,ct,0)){i=Math.max(Ze,i),ge.push(Ze);for(let Ye=0;Ye<we.length;Ye++)Ce.push(we[Ye])}const yt=ge.length,mt={accessorDef:ce,count:yt};if(V.set(re,mt),yt===0)continue;yt>re.getCount()/2&&(D=!0);const Rt=Jr[re.getComponentType()];mt.indices=ge,mt.values=new Rt(Ce)}if(!Number.isFinite(i))return{buffers:G,byteLength:F};D&&x.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const j=i<255?Uint8Array:i<65535?Uint16Array:Uint32Array,Y=i<255?ua:i<65535?ca:la,J={buffer:H,byteOffset:_+F,byteLength:0};for(const re of m){const ce=V.get(re);if(ce.count===0)continue;ce.indicesByteOffset=J.byteLength;const ge=xe.pad(xe.toView(new j(ce.indices)));G.push(ge),F+=ge.byteLength,J.byteLength+=ge.byteLength}c.bufferViews.push(J);const Z=c.bufferViews.length-1,q={buffer:H,byteOffset:_+F,byteLength:0};for(const re of m){const ce=V.get(re);if(ce.count===0)continue;ce.valuesByteOffset=q.byteLength;const ge=xe.pad(xe.toView(ce.values));G.push(ge),F+=ge.byteLength,q.byteLength+=ge.byteLength}c.bufferViews.push(q);const ie=c.bufferViews.length-1;for(const re of m){const ce=V.get(re);ce.count!==0&&(ce.accessorDef.sparse={count:ce.count,indices:{bufferView:Z,byteOffset:ce.indicesByteOffset,componentType:Y},values:{bufferView:ie,byteOffset:ce.valuesByteOffset}})}return{buffers:G,byteLength:F}}if(c.accessors=[],c.bufferViews=[],c.samplers=[],c.textures=[],c.images=l.listTextures().map((m,H)=>{const _=d.createPropertyDef(m);m.getMimeType()&&(_.mimeType=m.getMimeType());const G=m.getImage();return G&&d.createImageData(_,G,m),d.imageIndexMap.set(m,H),_}),b.filter(m=>m.prewriteTypes.includes(te.ACCESSOR)).forEach(m=>m.prewrite(d,te.ACCESSOR)),l.listAccessors().forEach(m=>{const H=d.accessorUsageGroupedByParent,_=d.accessorParents;if(d.accessorIndexMap.has(m))return;const G=d.getAccessorUsage(m);if(d.addAccessorToUsageGroup(m,G),H.has(G)){const F=o.listParents(m).find(V=>V.propertyType!==te.ROOT);_.set(m,F)}}),b.filter(m=>m.prewriteTypes.includes(te.BUFFER)).forEach(m=>m.prewrite(d,te.BUFFER)),(l.listAccessors().length>0||d.otherBufferViews.size>0||l.listTextures().length>0&&r.format===Et.GLB)&&l.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");c.buffers=[],l.listBuffers().forEach((m,H)=>{const _=d.createPropertyDef(m),G=d.accessorUsageGroupedByParent,F=m.listParents().filter(q=>q instanceof le),V=new Set(F.map(q=>d.accessorParents.get(q))),i=new Map(Array.from(V).map((q,ie)=>[q,ie])),D={};for(const q of F){var j;if(d.accessorIndexMap.has(q))continue;const ie=d.getAccessorUsage(q);let re=ie;if(G.has(ie)){const ce=d.accessorParents.get(q);re+=`:${i.get(ce)}`}D[j=re]||(D[j]={usage:ie,accessors:[]}),D[re].accessors.push(q)}const Y=[],J=c.buffers.length;let Z=0;for(const{usage:q,accessors:ie}of Object.values(D))if(q===jr.ARRAY_BUFFER&&r.vertexLayout===qr.INTERLEAVED){const re=I(ie,J,Z);Z+=re.byteLength;for(const ce of re.buffers)Y.push(ce)}else if(q===jr.ARRAY_BUFFER)for(const re of ie){const ce=I([re],J,Z);Z+=ce.byteLength;for(const ge of ce.buffers)Y.push(ge)}else if(q===jr.SPARSE){const re=S(ie,J,Z);Z+=re.byteLength;for(const ce of re.buffers)Y.push(ce)}else if(q===jr.ELEMENT_ARRAY_BUFFER){const re=Ut.BufferViewTarget.ELEMENT_ARRAY_BUFFER,ce=R(ie,J,Z,re);Z+=ce.byteLength;for(const ge of ce.buffers)Y.push(ge)}else{const re=R(ie,J,Z);Z+=re.byteLength;for(const ce of re.buffers)Y.push(ce)}if(d.imageBufferViews.length&&H===0){for(let q=0;q<d.imageBufferViews.length;q++)if(c.bufferViews[c.images[q].bufferView].byteOffset=Z,Z+=d.imageBufferViews[q].byteLength,Y.push(d.imageBufferViews[q]),Z%8){const ie=8-Z%8;Z+=ie,Y.push(new Uint8Array(ie))}}if(d.otherBufferViews.has(m))for(const q of d.otherBufferViews.get(m))c.bufferViews.push({buffer:J,byteOffset:Z,byteLength:q.byteLength}),d.otherBufferViewsIndexMap.set(q,c.bufferViews.length-1),Z+=q.byteLength,Y.push(q);if(Z){let q;r.format===Et.GLB?q=$r:(q=d.bufferURIGenerator.createURI(m,"bin"),_.uri=q),_.byteLength=Z,d.assignResourceURI(q,xe.concat(Y),!0)}c.buffers.push(_),d.bufferIndexMap.set(m,H)}),l.listAccessors().find(m=>!m.getBuffer())&&x.warn("Skipped writing one or more Accessors: no Buffer assigned."),b.filter(m=>m.prewriteTypes.includes(te.MATERIAL)).forEach(m=>m.prewrite(d,te.MATERIAL)),c.materials=l.listMaterials().map((m,H)=>{const _=d.createPropertyDef(m);if(m.getAlphaMode()!==kt.AlphaMode.OPAQUE&&(_.alphaMode=m.getAlphaMode()),m.getAlphaMode()===kt.AlphaMode.MASK&&(_.alphaCutoff=m.getAlphaCutoff()),m.getDoubleSided()&&(_.doubleSided=!0),_.pbrMetallicRoughness={},Se.eq(m.getBaseColorFactor(),[1,1,1,1])||(_.pbrMetallicRoughness.baseColorFactor=m.getBaseColorFactor()),Se.eq(m.getEmissiveFactor(),[0,0,0])||(_.emissiveFactor=m.getEmissiveFactor()),m.getRoughnessFactor()!==1&&(_.pbrMetallicRoughness.roughnessFactor=m.getRoughnessFactor()),m.getMetallicFactor()!==1&&(_.pbrMetallicRoughness.metallicFactor=m.getMetallicFactor()),m.getBaseColorTexture()){const G=m.getBaseColorTexture(),F=m.getBaseColorTextureInfo();_.pbrMetallicRoughness.baseColorTexture=d.createTextureInfoDef(G,F)}if(m.getEmissiveTexture()){const G=m.getEmissiveTexture(),F=m.getEmissiveTextureInfo();_.emissiveTexture=d.createTextureInfoDef(G,F)}if(m.getNormalTexture()){const G=m.getNormalTexture(),F=m.getNormalTextureInfo(),V=d.createTextureInfoDef(G,F);m.getNormalScale()!==1&&(V.scale=m.getNormalScale()),_.normalTexture=V}if(m.getOcclusionTexture()){const G=m.getOcclusionTexture(),F=m.getOcclusionTextureInfo(),V=d.createTextureInfoDef(G,F);m.getOcclusionStrength()!==1&&(V.strength=m.getOcclusionStrength()),_.occlusionTexture=V}if(m.getMetallicRoughnessTexture()){const G=m.getMetallicRoughnessTexture(),F=m.getMetallicRoughnessTextureInfo();_.pbrMetallicRoughness.metallicRoughnessTexture=d.createTextureInfoDef(G,F)}return d.materialIndexMap.set(m,H),_}),b.filter(m=>m.prewriteTypes.includes(te.MESH)).forEach(m=>m.prewrite(d,te.MESH)),c.meshes=l.listMeshes().map((m,H)=>{const _=d.createPropertyDef(m);let G=null;return _.primitives=m.listPrimitives().map(F=>{const V={attributes:{}};V.mode=F.getMode();const i=F.getMaterial();i&&(V.material=d.materialIndexMap.get(i)),Object.keys(F.getExtras()).length&&(V.extras=F.getExtras());const D=F.getIndices();D&&(V.indices=d.accessorIndexMap.get(D));for(const j of F.listSemantics())V.attributes[j]=d.accessorIndexMap.get(F.getAttribute(j));for(const j of F.listTargets()){const Y={};for(const J of j.listSemantics())Y[J]=d.accessorIndexMap.get(j.getAttribute(J));V.targets=V.targets||[],V.targets.push(Y)}return F.listTargets().length&&!G&&(G=F.listTargets().map(j=>j.getName())),V}),m.getWeights().length&&(_.weights=m.getWeights()),G&&(_.extras=_.extras||{},_.extras.targetNames=G),d.meshIndexMap.set(m,H),_}),c.cameras=l.listCameras().map((m,H)=>{const _=d.createPropertyDef(m);if(_.type=m.getType(),_.type===Ar.Type.PERSPECTIVE){_.perspective={znear:m.getZNear(),zfar:m.getZFar(),yfov:m.getYFov()};const G=m.getAspectRatio();G!==null&&(_.perspective.aspectRatio=G)}else _.orthographic={znear:m.getZNear(),zfar:m.getZFar(),xmag:m.getXMag(),ymag:m.getYMag()};return d.cameraIndexMap.set(m,H),_}),c.nodes=l.listNodes().map((m,H)=>{const _=d.createPropertyDef(m);return Se.eq(m.getTranslation(),[0,0,0])||(_.translation=m.getTranslation()),Se.eq(m.getRotation(),[0,0,0,1])||(_.rotation=m.getRotation()),Se.eq(m.getScale(),[1,1,1])||(_.scale=m.getScale()),m.getWeights().length&&(_.weights=m.getWeights()),d.nodeIndexMap.set(m,H),_}),c.skins=l.listSkins().map((m,H)=>{const _=d.createPropertyDef(m),G=m.getInverseBindMatrices();G&&(_.inverseBindMatrices=d.accessorIndexMap.get(G));const F=m.getSkeleton();return F&&(_.skeleton=d.nodeIndexMap.get(F)),_.joints=m.listJoints().map(V=>d.nodeIndexMap.get(V)),d.skinIndexMap.set(m,H),_}),l.listNodes().forEach((m,H)=>{const _=c.nodes[H],G=m.getMesh();G&&(_.mesh=d.meshIndexMap.get(G));const F=m.getCamera();F&&(_.camera=d.cameraIndexMap.get(F));const V=m.getSkin();V&&(_.skin=d.skinIndexMap.get(V)),m.listChildren().length>0&&(_.children=m.listChildren().map(i=>d.nodeIndexMap.get(i)))}),c.animations=l.listAnimations().map((m,H)=>{const _=d.createPropertyDef(m),G=new Map;return _.samplers=m.listSamplers().map((F,V)=>{const i=d.createPropertyDef(F);return i.input=d.accessorIndexMap.get(F.getInput()),i.output=d.accessorIndexMap.get(F.getOutput()),i.interpolation=F.getInterpolation(),G.set(F,V),i}),_.channels=m.listChannels().map(F=>{const V=d.createPropertyDef(F);return V.sampler=G.get(F.getSampler()),V.target={node:d.nodeIndexMap.get(F.getTargetNode()),path:F.getTargetPath()},V}),d.animationIndexMap.set(m,H),_}),c.scenes=l.listScenes().map((m,H)=>{const _=d.createPropertyDef(m);return _.nodes=m.listChildren().map(G=>d.nodeIndexMap.get(G)),d.sceneIndexMap.set(m,H),_});const P=l.getDefaultScene();return P&&(c.scene=l.listScenes().indexOf(P)),c.extensionsUsed=b.map(m=>m.extensionName),c.extensionsRequired=C.map(m=>m.extensionName),b.forEach(m=>m.write(d)),da(c),p}}function da(s){const e=[];for(const r in s){const o=s[r];(Array.isArray(o)&&o.length===0||o===null||o===""||o&&typeof o=="object"&&Object.keys(o).length===0)&&e.push(r)}for(const r of e)delete s[r]}var Wr;(function(s){s[s.JSON=1313821514]="JSON",s[s.BIN=5130562]="BIN"})(Wr||(Wr={}));class pa{constructor(){this._logger=qe.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=qr.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const r of e)this._extensions.add(r),r.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const r=await this.readURI(e,"view");this.lastReadBytes=r.byteLength;const o=ji(r)?this._binaryToJSON(r):{json:JSON.parse(xe.decodeText(r)),resources:{}};return await this._readResourcesExternal(o,this.dirname(e)),this._readResourcesInternal(o),o}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),ia.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const r=this._binaryToJSON(xe.assertView(e));this._readResourcesInternal(r);const o=r.json;if(o.buffers&&o.buffers.some(l=>ga(r,l)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(o.images&&o.images.some(l=>ya(r,l)))throw new Error("Cannot resolve external images with binaryToJSON().");return r}async readBinary(e){return this.readJSON(await this.binaryToJSON(xe.assertView(e)))}async writeJSON(e,r={}){if(r.format===Et.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0‚Äì1 buffers.");return ha.write(e,{format:r.format||Et.GLTF,basename:r.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:De({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:r,resources:o}=await this.writeJSON(e,{format:Et.GLB}),l=new Uint32Array([1179937895,2,12]),c=JSON.stringify(r),p=xe.pad(xe.encodeText(c),32),d=xe.toView(new Uint32Array([p.byteLength,1313821514])),x=xe.concat([d,p]);l[l.length-1]+=x.byteLength;const T=Object.values(o)[0];if(!T||!T.byteLength)return xe.concat([xe.toView(l),x]);const b=xe.pad(T,0),C=xe.toView(new Uint32Array([b.byteLength,5130562])),R=xe.concat([C,b]);return l[l.length-1]+=R.byteLength,xe.concat([xe.toView(l),x,R])}async _readResourcesExternal(e,r){var o=this;const l=e.json.images||[],c=e.json.buffers||[],p=[...l,...c].map(async function(d){const x=d.uri;if(!x||x.match(/data:/))return Promise.resolve();e.resources[x]=await o.readURI(o.resolve(r,x),"view"),o.lastReadBytes+=e.resources[x].byteLength});await Promise.all(p)}_readResourcesInternal(e){function r(c){if(c.uri){if(c.uri in e.resources){xe.assertView(e.resources[c.uri]);return}if(c.uri.match(/data:/)){const p=`__${Ko()}.${Qt.extension(c.uri)}`;e.resources[p]=xe.createBufferFromDataURI(c.uri),c.uri=p}}}(e.json.images||[]).forEach(c=>{if(c.bufferView===void 0&&c.uri===void 0)throw new Error("Missing resource URI or buffer view.");r(c)}),(e.json.buffers||[]).forEach(r)}_copyJSON(e){const{images:r,buffers:o}=e.json;return e={json:De({},e.json),resources:De({},e.resources)},r&&(e.json.images=r.map(l=>De({},l))),o&&(e.json.buffers=o.map(l=>De({},l))),e}_binaryToJSON(e){if(!ji(e))throw new Error("Invalid glTF 2.0 binary.");const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==Wr.JSON)throw new Error("Missing required GLB JSON chunk.");const o=20,l=r[0],c=xe.decodeText(xe.toView(e,o,l)),p=JSON.parse(c),d=o+l;if(e.byteLength<=d)return{json:p,resources:{}};const x=new Uint32Array(e.buffer,e.byteOffset+d,2);if(x[1]!==Wr.BIN)return{json:p,resources:{}};const T=x[0],b=xe.toView(e,d+8,T);return{json:p,resources:{[$r]:b}}}}function ga(s,e){return e.uri!==void 0&&!(e.uri in s.resources)}function ya(s,e){return e.uri!==void 0&&!(e.uri in s.resources)&&e.bufferView===void 0}function ji(s){if(s.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(s.buffer,s.byteOffset,3);return e[0]===1179937895&&e[1]===2}class ma extends pa{constructor(e=Tr.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=e}async readURI(e,r){const o=await fetch(e,this._fetchConfig);switch(r){case"view":return new Uint8Array(await o.arrayBuffer());case"text":return o.text()}}resolve(e,r){return Tr.resolve(e,r)}dirname(e){return Tr.dirname(e)}}class Hi{constructor(){z(this,"vertices");z(this,"indices");z(this,"vertexCount");z(this,"indexCount");this.vertices=[],this.indices=[]}populateTerrainData(e,r,o,l=1){if(!e||e.length===0)return console.error("Invalid heightmap data: empty or null"),!1;if(r<=0||o<=0)return console.error(`Invalid heightmap dimensions: ${r}x${o}`),!1;if(e.length!==r*o)return console.error(`Heightmap data size mismatch: expected ${r*o}, got ${e.length}`),!1;const c=r,p=o;console.log(`üèîÔ∏è Generating terrain: ${c}x${p} (${e.length} pixels)`),this.vertices=[],this.indices=[];const d=(T,b)=>T>=0&&T<p&&b>=0&&b<c?e[T*c+b]:0;this.vertices=new Array(p*c);let x=0;for(let T=0;T<p;T++)for(let b=0;b<c;b++){const R=(b-c/2)*.02,I=(T-p/2)*.02,S=(d(T,b)-1e3)*.02*.1,M=d(T,b-1),P=d(T,b+1),m=d(T-1,b),H=d(T+1,b),_=(P-M)*.02*.01,G=(H-m)*.02*.01,F=pt();Mo(F,-_,.02*.1,-G),Bo(F,F);const V={position:Xt(R,S,I),color:Xt(Math.min(S*.5+.3,1),.5,Math.max(.2,1-S*.5)),normal:F,uv:Li(b/(c-1),T/(p-1))};this.vertices[x++]=V}this.indices=[];for(let T=0;T<p-1;T++)for(let b=0;b<c-1;b++){const C=T*c+b,R=T*c+(b+1),I=(T+1)*c+b,S=(T+1)*c+(b+1);this.indices.push(C),this.indices.push(I),this.indices.push(R),this.indices.push(R),this.indices.push(I),this.indices.push(S)}return this.vertexCount=this.vertices.length,this.indexCount=this.indices.length,console.log(`üèîÔ∏è Terrain generated: ${this.vertexCount} vertices, ${this.indexCount} indices`),!0}populateTerrainFromTile(e,r=1){return console.log(`üéØ Creating terrain from tile: ${e.width}x${e.height} pixels`),this.populateTerrainData(e.heightData,e.width,e.height,r)}async loadGLTF(e){var R,I,S,M;const c=(await new ma().read(e)).getRoot().listMeshes()[0];if(console.log(c),!c){console.error("No meshes found in glTF file.");return}const p=c.listPrimitives()[0];if(!p){console.error("No primitives found in the mesh.");return}const d=(R=p.getAttribute("POSITION"))==null?void 0:R.getArray(),x=(I=p.getAttribute("NORMAL"))==null?void 0:I.getArray(),T=(S=p.getAttribute("TEXCOORD_0"))==null?void 0:S.getArray(),b=(M=p.getIndices())==null?void 0:M.getArray();if(!d||!b){console.error("Missing position or index data!");return}const C=d.length/3;for(let P=0;P<C;P++)this.vertices.push({position:Xt(d[P*3],d[P*3+1],d[P*3+2]),color:Xt(1,1,1),normal:x?Xt(x[P*3],x[P*3+1],x[P*3+2]):pt(),uv:T?Li(T[P*2],T[P*2+1]):Xi()});this.indices=Array.from(b)}getFlattenedVertices(){const e=new Float32Array(this.vertices.length*5);for(let r=0;r<this.vertices.length;r++){const o=this.vertices[r];e.set([...o.position,...o.uv],r*5)}return e}getIndexArray(){return new Uint32Array(this.indices)}async loadFile(e){return await(await(await fetch(e)).blob()).text()}}class xa{constructor(e,r){z(this,"device");z(this,"vertices");z(this,"buffer");z(this,"bufferLayout");z(this,"indices");z(this,"vertexBuffer");z(this,"indexBuffer");z(this,"material");z(this,"vertexCount");z(this,"indexCount");this.device=e;const o=r.getFlattenedVertices(),l=r.getIndexArray();this.vertexCount=r.vertices.length,this.indexCount=r.indices.length,this.createBuffers(o,l)}init(){this.vertexCount=this.vertices.length/5;const e=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,r={size:this.vertices.byteLength,usage:e,mappedAtCreation:!0};this.buffer=this.device.createBuffer(r),new Float32Array(this.buffer.getMappedRange()).set(this.vertices),this.buffer.unmap(),this.bufferLayout={arrayStride:5*4,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:3*4}]}}createBuffers(e,r){this.vertexBuffer=this.device.createBuffer({size:e.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),new Float32Array(this.vertexBuffer.getMappedRange()).set(e),this.vertexBuffer.unmap(),this.indexBuffer=this.device.createBuffer({size:r.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),new Uint32Array(this.indexBuffer.getMappedRange()).set(r),this.indexBuffer.unmap(),this.bufferLayout={arrayStride:5*4,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:3*4}]}}bind(e){e.setVertexBuffer(0,this.vertexBuffer),e.setIndexBuffer(this.indexBuffer,"uint32")}draw(e,r){e.drawIndexed(this.indexCount,1,0,0,r)}}class Ta{constructor(e){z(this,"tiles",new Map);console.log("üåû SolarTerrainRenderer initialized")}async addTile(e){console.log(`üåû Solar terrain tile received: ${e.tileId}`),console.log("üìä Tile data summary:",{heightmapSize:`${e.heightmap.width}x${e.heightmap.height}`,solarSize:`${e.solarData.width}x${e.solarData.height}`,heightRange:`${e.heightmap.minHeight.toFixed(1)}m to ${e.heightmap.maxHeight.toFixed(1)}m`,ghiRange:`${e.solarData.minGHI.toFixed(2)} to ${e.solarData.maxGHI.toFixed(2)} ${e.solarData.unit}`}),console.log("‚úÖ Solar terrain tile logged (integration pending)")}getAllTiles(){return Array.from(this.tiles.values())}removeTile(e){const r=this.tiles.get(e);r&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.heightTexture.destroy(),r.solarTexture.destroy(),this.tiles.delete(e),console.log(`üóëÔ∏è Removed tile ${e}`))}destroy(){for(const e of this.tiles.keys())this.removeTile(e);console.log("üí• SolarTerrainRenderer destroyed")}}function Me(s){return(e,...r)=>va(s,e,r)}function tr(s,e){return Me(us(s,e).get)}const{apply:va,getOwnPropertyDescriptor:us,getPrototypeOf:Vn,ownKeys:wa}=Reflect,{iterator:Cr,toStringTag:ba}=Symbol,Ea=Object,{create:zn,defineProperty:Sa}=Ea,Aa=Array,Ca=Aa.prototype,fs=Ca[Cr],Ra=Me(fs),hs=ArrayBuffer,Ia=hs.prototype;tr(Ia,"byteLength");const Vi=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Vi&&tr(Vi.prototype,"byteLength");const ds=Vn(Uint8Array);ds.from;const _e=ds.prototype;_e[Cr];Me(_e.keys);Me(_e.values);Me(_e.entries);Me(_e.set);Me(_e.reverse);Me(_e.fill);Me(_e.copyWithin);Me(_e.sort);Me(_e.slice);Me(_e.subarray);tr(_e,"buffer");tr(_e,"byteOffset");tr(_e,"length");tr(_e,ba);const Ma=Uint8Array,ps=Uint16Array,$n=Uint32Array,Na=Float32Array,Er=Vn([][Cr]()),gs=Me(Er.next),Ba=Me(function*(){}().next),Pa=Vn(Er),La=DataView.prototype,Da=Me(La.getUint16),qn=WeakMap,ys=qn.prototype,ms=Me(ys.get),Oa=Me(ys.set),xs=new qn,_a=zn(null,{next:{value:function(){const e=ms(xs,this);return gs(e)}},[Cr]:{value:function(){return this}}});function Fa(s){if(s[Cr]===fs&&Er.next===gs)return s;const e=zn(_a);return Oa(xs,e,Ra(s)),e}const Ua=new qn,ka=zn(Pa,{next:{value:function(){const e=ms(Ua,this);return Ba(e)},writable:!0,configurable:!0}});for(const s of wa(Er))s!=="next"&&Sa(ka,s,us(Er,s));const Ts=new hs(4),Ga=new Na(Ts),ja=new $n(Ts),st=new ps(512),ot=new Ma(512);for(let s=0;s<256;++s){const e=s-127;e<-24?(st[s]=0,st[s|256]=32768,ot[s]=24,ot[s|256]=24):e<-14?(st[s]=1024>>-e-14,st[s|256]=1024>>-e-14|32768,ot[s]=-e-1,ot[s|256]=-e-1):e<=15?(st[s]=e+15<<10,st[s|256]=e+15<<10|32768,ot[s]=13,ot[s|256]=13):e<128?(st[s]=31744,st[s|256]=64512,ot[s]=24,ot[s|256]=24):(st[s]=31744,st[s|256]=64512,ot[s]=13,ot[s|256]=13)}const Yn=new $n(2048);for(let s=1;s<1024;++s){let e=s<<13,r=0;for(;!(e&8388608);)e<<=1,r-=8388608;e&=-8388609,r+=947912704,Yn[s]=e|r}for(let s=1024;s<2048;++s)Yn[s]=939524096+(s-1024<<13);const rr=new $n(64);for(let s=1;s<31;++s)rr[s]=s<<23;rr[31]=1199570944;rr[32]=2147483648;for(let s=33;s<63;++s)rr[s]=2147483648+(s-32<<23);rr[63]=3347054592;const vs=new ps(64);for(let s=1;s<64;++s)s!==32&&(vs[s]=1024);function Ha(s){const e=s>>10;return ja[0]=Yn[vs[e]+(s&1023)]+rr[e],Ga[0]}function ws(s,e,...r){return Ha(Da(s,e,...Fa(r)))}function In(s,e,r){const o=typeof s=="object"?s.outer:s,l=o.slice(0,o.indexOf(">")+1),c=['"',"'"];for(let p=0;p<c.length;p++){const d=c[p],x=e+"\\="+d+"([^"+d+"]*)"+d,b=new RegExp(x).exec(l);if(b)return b[1]}}function Va(s,e,r){const l=new RegExp(e).exec(s.slice(r));return l?r+l.index:-1}function Mn(s,e,r){const l=new RegExp(e).exec(s.slice(r));return l?r+l.index+l[0].length-1:-1}function zi(s,e){const r=new RegExp(e,"g"),o=s.match(r);return o?o.length:0}function za(s,e,r){const o=r&&r.debug||!1,l=!(r&&typeof r.nested===!1),c=r&&r.startIndex||0;o&&console.log("[xml-utils] starting findTagByName with",e," and ",r);const p=Va(s,`<${e}[ 
>/]`,c);if(o&&console.log("[xml-utils] start:",p),p===-1)return;const d=s.slice(p+e.length);let x=Mn(d,"^[^<]*[ /]>",0);const T=x!==-1&&d[x-1]==="/";if(o&&console.log("[xml-utils] selfClosing:",T),T===!1)if(l){let I=0,S=1,M=0;for(;(x=Mn(d,"[ /]"+e+">",I))!==-1;){const P=d.substring(I,x+1);if(S+=zi(P,"<"+e+`[ 
	>]`),M+=zi(P,"</"+e+">"),M>=S)break;I=x}}else x=Mn(d,"[ /]"+e+">",0);const b=p+e.length+x+1;if(o&&console.log("[xml-utils] end:",b),b===-1)return;const C=s.slice(p,b);let R;return T?R=null:R=C.slice(C.indexOf(">")+1,C.lastIndexOf("<")),{inner:R,outer:C,start:p,end:b}}function $a(s,e,r){const o=[];let c=0,p;for(;p=za(s,e,{debug:!1,startIndex:c});)c=p.start+1+e.length,o.push(p);return o}const vr={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34412:"CZ_LSMINFO",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},at={};for(const s in vr)vr.hasOwnProperty(s)&&(at[vr[s]]=parseInt(s,10));const qa=[at.BitsPerSample,at.ExtraSamples,at.SampleFormat,at.StripByteCounts,at.StripOffsets,at.StripRowCounts,at.TileByteCounts,at.TileOffsets,at.SubIFDs],Nn={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ue={};for(const s in Nn)Nn.hasOwnProperty(s)&&(ue[Nn[s]]=parseInt(s,10));const je={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8},Ya={Unspecified:0},zl={AddCompression:1},$l={None:0,Deflate:1,Zstandard:2},Wa={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function Ka(s,e){const{width:r,height:o}=s,l=new Uint8Array(r*o*3);let c;for(let p=0,d=0;p<s.length;++p,d+=3)c=256-s[p]/e*256,l[d]=c,l[d+1]=c,l[d+2]=c;return l}function Xa(s,e){const{width:r,height:o}=s,l=new Uint8Array(r*o*3);let c;for(let p=0,d=0;p<s.length;++p,d+=3)c=s[p]/e*256,l[d]=c,l[d+1]=c,l[d+2]=c;return l}function Ja(s,e){const{width:r,height:o}=s,l=new Uint8Array(r*o*3),c=e.length/3,p=e.length/3*2;for(let d=0,x=0;d<s.length;++d,x+=3){const T=s[d];l[x]=e[T]/65536*256,l[x+1]=e[T+c]/65536*256,l[x+2]=e[T+p]/65536*256}return l}function Za(s){const{width:e,height:r}=s,o=new Uint8Array(e*r*3);for(let l=0,c=0;l<s.length;l+=4,c+=3){const p=s[l],d=s[l+1],x=s[l+2],T=s[l+3];o[c]=255*((255-p)/256)*((255-T)/256),o[c+1]=255*((255-d)/256)*((255-T)/256),o[c+2]=255*((255-x)/256)*((255-T)/256)}return o}function Qa(s){const{width:e,height:r}=s,o=new Uint8ClampedArray(e*r*3);for(let l=0,c=0;l<s.length;l+=3,c+=3){const p=s[l],d=s[l+1],x=s[l+2];o[c]=p+1.402*(x-128),o[c+1]=p-.34414*(d-128)-.71414*(x-128),o[c+2]=p+1.772*(d-128)}return o}const el=.95047,tl=1,rl=1.08883;function nl(s){const{width:e,height:r}=s,o=new Uint8Array(e*r*3);for(let l=0,c=0;l<s.length;l+=3,c+=3){const p=s[l+0],d=s[l+1]<<24>>24,x=s[l+2]<<24>>24;let T=(p+16)/116,b=d/500+T,C=T-x/200,R,I,S;b=el*(b*b*b>.008856?b*b*b:(b-16/116)/7.787),T=tl*(T*T*T>.008856?T*T*T:(T-16/116)/7.787),C=rl*(C*C*C>.008856?C*C*C:(C-16/116)/7.787),R=b*3.2406+T*-1.5372+C*-.4986,I=b*-.9689+T*1.8758+C*.0415,S=b*.0557+T*-.204+C*1.057,R=R>.0031308?1.055*R**(1/2.4)-.055:12.92*R,I=I>.0031308?1.055*I**(1/2.4)-.055:12.92*I,S=S>.0031308?1.055*S**(1/2.4)-.055:12.92*S,o[c]=Math.max(0,Math.min(1,R))*255,o[c+1]=Math.max(0,Math.min(1,I))*255,o[c+2]=Math.max(0,Math.min(1,S))*255}return o}const bs=new Map,il=new Map;function gt(s,e,r=!0){Array.isArray(s)||(s=[s]),s.forEach(o=>{bs.set(o,e),il.set(o,r)})}async function sl(s){const e=bs.get(s.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${s.Compression}`);const r=await e();return new r(s)}gt([void 0,1],()=>Ct(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1]),import.meta.url).then(s=>s.default),!1);gt(5,()=>Ct(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1]),import.meta.url).then(s=>s.default));gt(6,()=>{throw new Error("old style JPEG compression is not supported.")});gt(7,()=>Ct(()=>import("./jpeg-JhJy4lL1.js"),__vite__mapDeps([3,1]),import.meta.url).then(s=>s.default));gt([8,32946],()=>Ct(()=>import("./deflate-Dthki0TA.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(s=>s.default));gt(32773,()=>Ct(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1]),import.meta.url).then(s=>s.default));gt(34887,()=>Ct(()=>import("./lerc-CGgRTp2d.js"),__vite__mapDeps([7,5,1]),import.meta.url).then(async s=>(await s.zstd.init(),s)).then(s=>s.default));gt(5e4,()=>Ct(()=>import("./zstd-DD6JHAQz.js"),__vite__mapDeps([8,1]),import.meta.url).then(async s=>(await s.zstd.init(),s)).then(s=>s.default));gt(50001,()=>Ct(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([9,1]),import.meta.url).then(s=>s.default),!1);function en(s,e,r,o=1){return new(Object.getPrototypeOf(s)).constructor(e*r*o)}function ol(s,e,r,o,l){const c=e/o,p=r/l;return s.map(d=>{const x=en(d,o,l);for(let T=0;T<l;++T){const b=Math.min(Math.round(p*T),r-1);for(let C=0;C<o;++C){const R=Math.min(Math.round(c*C),e-1),I=d[b*e+R];x[T*o+C]=I}}return x})}function Zt(s,e,r){return(1-r)*s+r*e}function al(s,e,r,o,l){const c=e/o,p=r/l;return s.map(d=>{const x=en(d,o,l);for(let T=0;T<l;++T){const b=p*T,C=Math.floor(b),R=Math.min(Math.ceil(b),r-1);for(let I=0;I<o;++I){const S=c*I,M=S%1,P=Math.floor(S),m=Math.min(Math.ceil(S),e-1),H=d[C*e+P],_=d[C*e+m],G=d[R*e+P],F=d[R*e+m],V=Zt(Zt(H,_,M),Zt(G,F,M),b%1);x[T*o+I]=V}}return x})}function ll(s,e,r,o,l,c="nearest"){switch(c.toLowerCase()){case"nearest":return ol(s,e,r,o,l);case"bilinear":case"linear":return al(s,e,r,o,l);default:throw new Error(`Unsupported resampling method: '${c}'`)}}function cl(s,e,r,o,l,c){const p=e/o,d=r/l,x=en(s,o,l,c);for(let T=0;T<l;++T){const b=Math.min(Math.round(d*T),r-1);for(let C=0;C<o;++C){const R=Math.min(Math.round(p*C),e-1);for(let I=0;I<c;++I){const S=s[b*e*c+R*c+I];x[T*o*c+C*c+I]=S}}}return x}function ul(s,e,r,o,l,c){const p=e/o,d=r/l,x=en(s,o,l,c);for(let T=0;T<l;++T){const b=d*T,C=Math.floor(b),R=Math.min(Math.ceil(b),r-1);for(let I=0;I<o;++I){const S=p*I,M=S%1,P=Math.floor(S),m=Math.min(Math.ceil(S),e-1);for(let H=0;H<c;++H){const _=s[C*e*c+P*c+H],G=s[C*e*c+m*c+H],F=s[R*e*c+P*c+H],V=s[R*e*c+m*c+H],i=Zt(Zt(_,G,M),Zt(F,V,M),b%1);x[T*o*c+I*c+H]=i}}}return x}function fl(s,e,r,o,l,c,p="nearest"){switch(p.toLowerCase()){case"nearest":return cl(s,e,r,o,l,c);case"bilinear":case"linear":return ul(s,e,r,o,l,c);default:throw new Error(`Unsupported resampling method: '${p}'`)}}function hl(s,e,r){let o=0;for(let l=e;l<r;++l)o+=s[l];return o}function _n(s,e,r){switch(s){case 1:if(e<=8)return new Uint8Array(r);if(e<=16)return new Uint16Array(r);if(e<=32)return new Uint32Array(r);break;case 2:if(e===8)return new Int8Array(r);if(e===16)return new Int16Array(r);if(e===32)return new Int32Array(r);break;case 3:switch(e){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}break}throw Error("Unsupported data format/bitsPerSample")}function dl(s,e){return(s===1||s===2)&&e<=32&&e%8===0?!1:!(s===3&&(e===16||e===32||e===64))}function pl(s,e,r,o,l,c,p){const d=new DataView(s),x=r===2?p*c:p*c*o,T=r===2?1:o,b=_n(e,l,x),C=parseInt("1".repeat(l),2);if(e===1){let R;r===1?R=o*l:R=l;let I=c*R;I&7&&(I=I+7&-8);for(let S=0;S<p;++S){const M=S*I;for(let P=0;P<c;++P){const m=M+P*T*l;for(let H=0;H<T;++H){const _=m+H*l,G=(S*c+P)*T+H,F=Math.floor(_/8),V=_%8;if(V+l<=8)b[G]=d.getUint8(F)>>8-l-V&C;else if(V+l<=16)b[G]=d.getUint16(F)>>16-l-V&C;else if(V+l<=24){const i=d.getUint16(F)<<8|d.getUint8(F+2);b[G]=i>>24-l-V&C}else b[G]=d.getUint32(F)>>32-l-V&C}}}}return b.buffer}class gl{constructor(e,r,o,l,c,p){this.fileDirectory=e,this.geoKeys=r,this.dataView=o,this.littleEndian=l,this.tiles=c?{}:null,this.isTiled=!e.StripOffsets;const d=e.PlanarConfiguration;if(this.planarConfiguration=typeof d>"u"?1:d,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=p}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let r=0;r<this.fileDirectory.BitsPerSample.length;++r)e+=this.getSampleByteSize(r);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const r=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,o=this.fileDirectory.BitsPerSample[e];switch(r){case 1:if(o<=8)return DataView.prototype.getUint8;if(o<=16)return DataView.prototype.getUint16;if(o<=32)return DataView.prototype.getUint32;break;case 2:if(o<=8)return DataView.prototype.getInt8;if(o<=16)return DataView.prototype.getInt16;if(o<=32)return DataView.prototype.getInt32;break;case 3:switch(o){case 16:return function(l,c){return ws(this,l,c)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,r){const o=this.getSampleFormat(e),l=this.getBitsPerSample(e);return _n(o,l,r)}async getTileOrStrip(e,r,o,l,c){const p=Math.ceil(this.getWidth()/this.getTileWidth()),d=Math.ceil(this.getHeight()/this.getTileHeight());let x;const{tiles:T}=this;this.planarConfiguration===1?x=r*p+e:this.planarConfiguration===2&&(x=o*p*d+r*p+e);let b,C;if(this.isTiled?(b=this.fileDirectory.TileOffsets[x],C=this.fileDirectory.TileByteCounts[x]):(b=this.fileDirectory.StripOffsets[x],C=this.fileDirectory.StripByteCounts[x]),C===0){const S=this.getBlockHeight(r)*this.getTileWidth(),M=this.planarConfiguration===2?this.getSampleByteSize(o):this.getBytesPerPixel(),P=new ArrayBuffer(S*M);return this.getArrayForSample(o,P).fill(this.getGDALNoData()||0),{x:e,y:r,sample:o,data:P}}const R=(await this.source.fetch([{offset:b,length:C}],c))[0];let I;return T===null||!T[x]?(I=(async()=>{let S=await l.decode(this.fileDirectory,R);const M=this.getSampleFormat(),P=this.getBitsPerSample();return dl(M,P)&&(S=pl(S,M,this.planarConfiguration,this.getSamplesPerPixel(),P,this.getTileWidth(),this.getBlockHeight(r))),S})(),T!==null&&(T[x]=I)):I=T[x],{x:e,y:r,sample:o,data:await I}}async _readRaster(e,r,o,l,c,p,d,x,T){const b=this.getTileWidth(),C=this.getTileHeight(),R=this.getWidth(),I=this.getHeight(),S=Math.max(Math.floor(e[0]/b),0),M=Math.min(Math.ceil(e[2]/b),Math.ceil(R/b)),P=Math.max(Math.floor(e[1]/C),0),m=Math.min(Math.ceil(e[3]/C),Math.ceil(I/C)),H=e[2]-e[0];let _=this.getBytesPerPixel();const G=[],F=[];for(let D=0;D<r.length;++D)this.planarConfiguration===1?G.push(hl(this.fileDirectory.BitsPerSample,0,r[D])/8):G.push(0),F.push(this.getReaderForSample(r[D]));const V=[],{littleEndian:i}=this;for(let D=P;D<m;++D)for(let j=S;j<M;++j){let Y;this.planarConfiguration===1&&(Y=this.getTileOrStrip(j,D,0,c,T));for(let J=0;J<r.length;++J){const Z=J,q=r[J];this.planarConfiguration===2&&(_=this.getSampleByteSize(q),Y=this.getTileOrStrip(j,D,q,c,T));const ie=Y.then(re=>{const ce=re.data,ge=new DataView(ce),Ce=this.getBlockHeight(re.y),we=re.y*C,ct=re.x*b,yt=we+Ce,mt=(re.x+1)*b,Rt=F[Z],Ze=Math.min(Ce,Ce-(yt-e[3]),I-we),nr=Math.min(b,b-(mt-e[2]),R-ct);for(let Ye=Math.max(0,e[1]-we);Ye<Ze;++Ye)for(let It=Math.max(0,e[0]-ct);It<nr;++It){const tn=(Ye*b+It)*_,ir=Rt.call(ge,tn+G[Z],i);let Be;l?(Be=(Ye+we-e[1])*H*r.length+(It+ct-e[0])*r.length+Z,o[Be]=ir):(Be=(Ye+we-e[1])*H+It+ct-e[0],o[Z][Be]=ir)}});V.push(ie)}}if(await Promise.all(V),p&&e[2]-e[0]!==p||d&&e[3]-e[1]!==d){let D;return l?D=fl(o,e[2]-e[0],e[3]-e[1],p,d,r.length,x):D=ll(o,e[2]-e[0],e[3]-e[1],p,d,x),D.width=p,D.height=d,D}return o.width=p||e[2]-e[0],o.height=d||e[3]-e[1],o}async readRasters({window:e,samples:r=[],interleave:o,pool:l=null,width:c,height:p,resampleMethod:d,fillValue:x,signal:T}={}){const b=e||[0,0,this.getWidth(),this.getHeight()];if(b[0]>b[2]||b[1]>b[3])throw new Error("Invalid subsets");const C=b[2]-b[0],R=b[3]-b[1],I=C*R,S=this.getSamplesPerPixel();if(!r||!r.length)for(let H=0;H<S;++H)r.push(H);else for(let H=0;H<r.length;++H)if(r[H]>=S)return Promise.reject(new RangeError(`Invalid sample index '${r[H]}'.`));let M;if(o){const H=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,_=Math.max.apply(null,this.fileDirectory.BitsPerSample);M=_n(H,_,I*r.length),x&&M.fill(x)}else{M=[];for(let H=0;H<r.length;++H){const _=this.getArrayForSample(r[H],I);Array.isArray(x)&&H<x.length?_.fill(x[H]):x&&!Array.isArray(x)&&_.fill(x),M.push(_)}}const P=l||await sl(this.fileDirectory);return await this._readRaster(b,r,M,o,P,c,p,d,T)}async readRGB({window:e,interleave:r=!0,pool:o=null,width:l,height:c,resampleMethod:p,enableAlpha:d=!1,signal:x}={}){const T=e||[0,0,this.getWidth(),this.getHeight()];if(T[0]>T[2]||T[1]>T[3])throw new Error("Invalid subsets");const b=this.fileDirectory.PhotometricInterpretation;if(b===je.RGB){let m=[0,1,2];if(this.fileDirectory.ExtraSamples!==Ya.Unspecified&&d){m=[];for(let H=0;H<this.fileDirectory.BitsPerSample.length;H+=1)m.push(H)}return this.readRasters({window:e,interleave:r,samples:m,pool:o,width:l,height:c,resampleMethod:p,signal:x})}let C;switch(b){case je.WhiteIsZero:case je.BlackIsZero:case je.Palette:C=[0];break;case je.CMYK:C=[0,1,2,3];break;case je.YCbCr:case je.CIELab:C=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const R={window:T,interleave:!0,samples:C,pool:o,width:l,height:c,resampleMethod:p,signal:x},{fileDirectory:I}=this,S=await this.readRasters(R),M=2**this.fileDirectory.BitsPerSample[0];let P;switch(b){case je.WhiteIsZero:P=Ka(S,M);break;case je.BlackIsZero:P=Xa(S,M);break;case je.Palette:P=Ja(S,I.ColorMap);break;case je.CMYK:P=Za(S);break;case je.YCbCr:P=Qa(S);break;case je.CIELab:P=nl(S);break;default:throw new Error("Unsupported photometric interpretation.")}if(!r){const m=new Uint8Array(P.length/3),H=new Uint8Array(P.length/3),_=new Uint8Array(P.length/3);for(let G=0,F=0;G<P.length;G+=3,++F)m[F]=P[G],H[F]=P[G+1],_[F]=P[G+2];P=[m,H,_]}return P.width=S.width,P.height=S.height,P}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let r=0;r<this.fileDirectory.ModelTiepoint.length;r+=6)e.push({i:this.fileDirectory.ModelTiepoint[r],j:this.fileDirectory.ModelTiepoint[r+1],k:this.fileDirectory.ModelTiepoint[r+2],x:this.fileDirectory.ModelTiepoint[r+3],y:this.fileDirectory.ModelTiepoint[r+4],z:this.fileDirectory.ModelTiepoint[r+5]});return e}getGDALMetadata(e=null){const r={};if(!this.fileDirectory.GDAL_METADATA)return null;const o=this.fileDirectory.GDAL_METADATA;let l=$a(o,"Item");e===null?l=l.filter(c=>In(c,"sample")===void 0):l=l.filter(c=>Number(In(c,"sample"))===e);for(let c=0;c<l.length;++c){const p=l[c];r[In(p,"name")]=p.inner}return r}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,r=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(r)return[r[3],r[7],r[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const r=this.fileDirectory.ModelPixelScale,o=this.fileDirectory.ModelTransformation;if(r)return[r[0],-r[1],r[2]];if(o)return o[1]===0&&o[4]===0?[o[0],-o[5],o[10]]:[Math.sqrt(o[0]*o[0]+o[4]*o[4]),-Math.sqrt(o[1]*o[1]+o[5]*o[5]),o[10]];if(e){const[l,c,p]=e.getResolution();return[l*e.getWidth()/this.getWidth(),c*e.getHeight()/this.getHeight(),p*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const r=this.getHeight(),o=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[l,c,p,d,x,T,b,C]=this.fileDirectory.ModelTransformation,I=[[0,0],[0,r],[o,0],[o,r]].map(([P,m])=>[d+l*P+c*m,C+x*P+T*m]),S=I.map(P=>P[0]),M=I.map(P=>P[1]);return[Math.min(...S),Math.min(...M),Math.max(...S),Math.max(...M)]}else{const l=this.getOrigin(),c=this.getResolution(),p=l[0],d=l[1],x=p+c[0]*o,T=d+c[1]*r;return[Math.min(p,x),Math.min(d,T),Math.max(p,x),Math.max(d,T)]}}}class yl{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,r){const o=this.getUint32(e,r),l=this.getUint32(e+4,r);let c;if(r){if(c=o+2**32*l,!Number.isSafeInteger(c))throw new Error(`${c} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return c}if(c=2**32*o+l,!Number.isSafeInteger(c))throw new Error(`${c} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return c}getInt64(e,r){let o=0;const l=(this._dataView.getUint8(e+(r?7:0))&128)>0;let c=!0;for(let p=0;p<8;p++){let d=this._dataView.getUint8(e+(r?p:7-p));l&&(c?d!==0&&(d=~(d-1)&255,c=!1):d=~d&255),o+=d*256**p}return l&&(o=-o),o}getUint8(e,r){return this._dataView.getUint8(e,r)}getInt8(e,r){return this._dataView.getInt8(e,r)}getUint16(e,r){return this._dataView.getUint16(e,r)}getInt16(e,r){return this._dataView.getInt16(e,r)}getUint32(e,r){return this._dataView.getUint32(e,r)}getInt32(e,r){return this._dataView.getInt32(e,r)}getFloat16(e,r){return ws(this._dataView,e,r)}getFloat32(e,r){return this._dataView.getFloat32(e,r)}getFloat64(e,r){return this._dataView.getFloat64(e,r)}}class ml{constructor(e,r,o,l){this._dataView=new DataView(e),this._sliceOffset=r,this._littleEndian=o,this._bigTiff=l}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,r){return this.sliceOffset<=e&&this.sliceTop>=e+r}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const r=this.readUint32(e),o=this.readUint32(e+4);let l;if(this._littleEndian){if(l=r+2**32*o,!Number.isSafeInteger(l))throw new Error(`${l} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return l}if(l=2**32*r+o,!Number.isSafeInteger(l))throw new Error(`${l} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return l}readInt64(e){let r=0;const o=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let l=!0;for(let c=0;c<8;c++){let p=this._dataView.getUint8(e+(this._littleEndian?c:7-c));o&&(l?p!==0&&(p=~(p-1)&255,l=!1):p=~p&255),r+=p*256**c}return o&&(r=-r),r}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}class xl{async fetch(e,r=void 0){return Promise.all(e.map(o=>this.fetchSlice(o,r)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class Wn extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Wn),this.name="AbortError"}}class Tl extends xl{constructor(e){super(),this.arrayBuffer=e}fetchSlice(e,r){if(r&&r.aborted)throw new Wn("Request aborted");return this.arrayBuffer.slice(e.offset,e.offset+e.length)}}function vl(s){return new Tl(s)}function Fn(s){switch(s){case ue.BYTE:case ue.ASCII:case ue.SBYTE:case ue.UNDEFINED:return 1;case ue.SHORT:case ue.SSHORT:return 2;case ue.LONG:case ue.SLONG:case ue.FLOAT:case ue.IFD:return 4;case ue.RATIONAL:case ue.SRATIONAL:case ue.DOUBLE:case ue.LONG8:case ue.SLONG8:case ue.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${s}`)}}function wl(s){const e=s.GeoKeyDirectory;if(!e)return null;const r={};for(let o=4;o<=e[3]*4;o+=4){const l=Wa[e[o]],c=e[o+1]?vr[e[o+1]]:null,p=e[o+2],d=e[o+3];let x=null;if(!c)x=d;else{if(x=s[c],typeof x>"u"||x===null)throw new Error(`Could not get value of geoKey '${l}'.`);typeof x=="string"?x=x.substring(d,d+p-1):x.subarray&&(x=x.subarray(d,d+p),p===1&&(x=x[0]))}r[l]=x}return r}function Kt(s,e,r,o){let l=null,c=null;const p=Fn(e);switch(e){case ue.BYTE:case ue.ASCII:case ue.UNDEFINED:l=new Uint8Array(r),c=s.readUint8;break;case ue.SBYTE:l=new Int8Array(r),c=s.readInt8;break;case ue.SHORT:l=new Uint16Array(r),c=s.readUint16;break;case ue.SSHORT:l=new Int16Array(r),c=s.readInt16;break;case ue.LONG:case ue.IFD:l=new Uint32Array(r),c=s.readUint32;break;case ue.SLONG:l=new Int32Array(r),c=s.readInt32;break;case ue.LONG8:case ue.IFD8:l=new Array(r),c=s.readUint64;break;case ue.SLONG8:l=new Array(r),c=s.readInt64;break;case ue.RATIONAL:l=new Uint32Array(r*2),c=s.readUint32;break;case ue.SRATIONAL:l=new Int32Array(r*2),c=s.readInt32;break;case ue.FLOAT:l=new Float32Array(r),c=s.readFloat32;break;case ue.DOUBLE:l=new Float64Array(r),c=s.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===ue.RATIONAL||e===ue.SRATIONAL)for(let d=0;d<r;d+=2)l[d]=c.call(s,o+d*p),l[d+1]=c.call(s,o+(d*p+4));else for(let d=0;d<r;++d)l[d]=c.call(s,o+d*p);return e===ue.ASCII?new TextDecoder("utf-8").decode(l):l}class bl{constructor(e,r,o,l){this.fileDirectory=e,this.rawFileDirectory=r,this.geoKeyDirectory=o,this.nextIFDByteOffset=l}}class Hr extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class El{async readRasters(e={}){const{window:r,width:o,height:l}=e;let{resX:c,resY:p,bbox:d}=e;const x=await this.getImage();let T=x;const b=await this.getImageCount(),C=x.getBoundingBox();if(r&&d)throw new Error('Both "bbox" and "window" passed.');if(o||l){if(r){const[S,M]=x.getOrigin(),[P,m]=x.getResolution();d=[S+r[0]*P,M+r[1]*m,S+r[2]*P,M+r[3]*m]}const I=d||C;if(o){if(c)throw new Error("Both width and resX passed");c=(I[2]-I[0])/o}if(l){if(p)throw new Error("Both width and resY passed");p=(I[3]-I[1])/l}}if(c||p){const I=[];for(let S=0;S<b;++S){const M=await this.getImage(S),{SubfileType:P,NewSubfileType:m}=M.fileDirectory;(S===0||P===2||m&1)&&I.push(M)}I.sort((S,M)=>S.getWidth()-M.getWidth());for(let S=0;S<I.length;++S){const M=I[S],P=(C[2]-C[0])/M.getWidth(),m=(C[3]-C[1])/M.getHeight();if(T=M,c&&c>P||p&&p>m)break}}let R=r;if(d){const[I,S]=x.getOrigin(),[M,P]=T.getResolution(x);R=[Math.round((d[0]-I)/M),Math.round((d[1]-S)/P),Math.round((d[2]-I)/M),Math.round((d[3]-S)/P)],R=[Math.min(R[0],R[2]),Math.min(R[1],R[3]),Math.max(R[0],R[2]),Math.max(R[1],R[3])]}return T.readRasters({...e,window:R})}}class Kn extends El{constructor(e,r,o,l,c={}){super(),this.source=e,this.littleEndian=r,this.bigTiff=o,this.firstIFDOffset=l,this.cache=c.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,r){const o=this.bigTiff?4048:1024;return new ml((await this.source.fetch([{offset:e,length:typeof r<"u"?r:o}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const r=this.bigTiff?20:12,o=this.bigTiff?8:2;let l=await this.getSlice(e);const c=this.bigTiff?l.readUint64(e):l.readUint16(e),p=c*r+(this.bigTiff?16:6);l.covers(e,p)||(l=await this.getSlice(e,p));const d={},x=new Map;let T=e+(this.bigTiff?8:2);for(let R=0;R<c;T+=r,++R){const I=l.readUint16(T),S=l.readUint16(T+2),M=this.bigTiff?l.readUint64(T+4):l.readUint32(T+4);let P,m;const H=Fn(S),_=T+(this.bigTiff?12:8);if(H*M<=(this.bigTiff?8:4))P=Kt(l,S,M,_);else{const F=l.readOffset(_),V=Fn(S)*M;if(l.covers(F,V))P=Kt(l,S,M,F);else{const i=await this.getSlice(F,V);P=Kt(i,S,M,F)}}M===1&&qa.indexOf(I)===-1&&!(S===ue.RATIONAL||S===ue.SRATIONAL)?m=P[0]:m=P;const G=vr[I];G&&(d[G]=m),x.set(I,m)}const b=wl(d),C=l.readOffset(e+o+r*c);return new bl(d,x,b,C)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(r){throw r instanceof Hr?new Hr(e):r}return this.ifdRequests[e]=(async()=>{const r=await this.ifdRequests[e-1];if(r.nextIFDByteOffset===0)throw new Hr(e);return this.parseFileDirectoryAt(r.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const r=await this.requestIFD(e);return new gl(r.fileDirectory,r.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,r=!0;for(;r;)try{await this.requestIFD(e),++e}catch(o){if(o instanceof Hr)r=!1;else throw o}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const r="GDAL_STRUCTURAL_METADATA_SIZE=",o=r.length+100;let l=await this.getSlice(e,o);if(r===Kt(l,ue.ASCII,r.length,e)){const p=Kt(l,ue.ASCII,o,e).split(`
`)[0],d=Number(p.split("=")[1].split(" ")[0])+p.length;d>o&&(l=await this.getSlice(e,d));const x=Kt(l,ue.ASCII,d,e);this.ghostValues={},x.split(`
`).filter(T=>T.length>0).map(T=>T.split("=")).forEach(([T,b])=>{this.ghostValues[T]=b})}return this.ghostValues}static async fromSource(e,r,o){const l=(await e.fetch([{offset:0,length:1024}],o))[0],c=new yl(l),p=c.getUint16(0,0);let d;if(p===18761)d=!0;else if(p===19789)d=!1;else throw new TypeError("Invalid byte order value.");const x=c.getUint16(2,d);let T;if(x===42)T=!1;else if(x===43){if(T=!0,c.getUint16(4,d)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const b=T?c.getUint64(8,d):c.getUint32(4,d);return new Kn(e,d,T,b,r)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function Kr(s,e){return Kn.fromSource(vl(s),e)}const Ot=class Ot{constructor(){z(this,"baseUrl");this.baseUrl="http://147.93.127.105:3000",console.log("üåê API Service initialized with base URL:",this.baseUrl)}static getInstance(){return Ot.instance||(Ot.instance=new Ot),Ot.instance}getBaseUrl(){return this.baseUrl}getEndpoint(e){return`${this.baseUrl}${e.startsWith("/")?e:"/"+e}`}};z(Ot,"instance");let Un=Ot;class Sl{constructor(){z(this,"config");this.config=Un.getInstance()}async testConnection(){try{console.log("üîå Testing backend connection...");const e=await fetch(this.config.getEndpoint("/terrain/test-r2"),{method:"GET"});return console.log("‚úÖ Backend health check:",e.status),e.ok}catch(e){return console.error("‚ùå Backend connection test failed:",e),!1}}async generateTile(e){return console.log("üöÄ Generating terrain tile...",e),fetch(this.config.getEndpoint("/terrain/generate-tile"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async downloadFile(e){console.log("üì• Downloading file:",e);const r=e.startsWith("http")?e:this.config.getEndpoint(e);return fetch(r)}async downloadSolarData(e){console.log("‚òÄÔ∏è Downloading solar data:",e);const r=e.startsWith("http")?e:this.config.getEndpoint(e);return fetch(r)}getFileDownloadUrl(e){return this.config.getEndpoint(`/terrain/files/${e}`)}getGHIDataUrl(e){return this.config.getEndpoint(e)}getBaseUrl(){return this.config.getBaseUrl()}async makeRequest(e,r={}){const o=this.config.getEndpoint(e);return console.log(`üåê Making request to: ${o}`),fetch(o,{headers:{"Content-Type":"application/json",...r.headers},...r})}getEnvironmentInfo(){return{baseUrl:this.config.getBaseUrl(),environment:"production",devMode:!1}}}const Le=new Sl;console.log("üåê API Service Environment:",Le.getEnvironmentInfo());class Al{constructor(){z(this,"tileCache",new Map);console.log("üåû SolarTerrainService initialized with API service"),console.log("üåê Environment:",Le.getEnvironmentInfo())}async generateCompleteTile(e){var r,o,l,c,p;try{console.log("üöÄ Requesting complete tile...",e);const d=await Le.generateTile(e);if(!d.ok)throw new Error(`Backend error: ${d.status} ${d.statusText}`);const x=await d.json();console.log("‚úÖ Backend response received:",x),console.log("üîç Checking GHI data in response:"),console.log("  - GHI Success:",(r=x.ghiResult)==null?void 0:r.success),console.log("  - GHI Filename:",(o=x.ghiResult)==null?void 0:o.filename),console.log("  - GHI URL:",(l=x.cacheInfo)==null?void 0:l.ghiTileUrl),console.log("  - GHI Resolution:",(c=x.ghiResult)==null?void 0:c.resolution),console.log("  - GHI Data Shape:",(p=x.ghiResult)==null?void 0:p.dataShape);const[T,b]=await Promise.all([this.downloadAndProcessHeightmap(x.cacheInfo.downloadUrl),this.downloadAndProcessSolarData(Le.getGHIDataUrl(x.cacheInfo.ghiTileUrl))]),C=this.generateTileId(e),R={tileId:C,bounds:x.cacheInfo.region,center:x.cacheInfo.centerCoordinates,heightmap:T,solarData:b,heightmapUrl:x.cacheInfo.downloadUrl,solarUrl:Le.getGHIDataUrl(x.cacheInfo.ghiTileUrl)};return this.tileCache.set(C,R),console.log("‚úÖ Complete tile processed:",{tileId:C,heightmapSize:`${T.width}x${T.height}`,solarSize:`${b.width}x${b.height}`,heightRange:`${T.minHeight.toFixed(1)}m to ${T.maxHeight.toFixed(1)}m`,ghiRange:`${b.minGHI.toFixed(2)} to ${b.maxGHI.toFixed(2)} ${b.unit}`}),R}catch(d){throw console.error("‚ùå Failed to generate complete tile:",d),d}}async downloadAndProcessHeightmap(e){try{console.log("üì• Downloading heightmap:",e);const r=await Le.downloadFile(e);if(!r.ok)throw new Error(`Failed to download heightmap: ${r.status}`);const o=await r.arrayBuffer();console.log("üìä Heightmap downloaded, size:",o.byteLength);const c=await(await Kr(o)).getImage(),p=await c.readRasters(),d=c.getWidth(),x=c.getHeight(),T=new Float32Array(p[0]);let b=T[0],C=T[0];for(let R=1;R<T.length;R++){const I=T[R];I<b&&(b=I),I>C&&(C=I)}return console.log("‚úÖ Heightmap processed:",{width:d,height:x,minHeight:b.toFixed(1)+"m",maxHeight:C.toFixed(1)+"m"}),{width:d,height:x,elevationData:T,minHeight:b,maxHeight:C}}catch(r){throw console.error("‚ùå Failed to process heightmap:",r),r}}async downloadAndProcessSolarData(e){try{console.log("‚òÄÔ∏è Downloading solar data:",e),console.log("‚òÄÔ∏è Full GHI URL:",e);const r=await Le.downloadSolarData(e);if(console.log("‚òÄÔ∏è GHI Response status:",r.status,r.statusText),!r.ok)throw new Error(`Failed to download solar data: ${r.status} ${r.statusText}`);const o=await r.arrayBuffer();console.log("üìä Solar data downloaded successfully!"),console.log("  - Size:",o.byteLength,"bytes"),console.log("  - First 16 bytes:",new Uint8Array(o.slice(0,16))),console.log("‚òÄÔ∏è Processing GHI TIF with geotiff library...");const l=await Kr(o);console.log("‚òÄÔ∏è GeoTIFF object created successfully");const c=await l.getImage();console.log("‚òÄÔ∏è GeoTIFF image loaded"),console.log("  - Width:",c.getWidth()),console.log("  - Height:",c.getHeight()),console.log("  - Samples per pixel:",c.getSamplesPerPixel()),console.log("  - Bits per sample:",c.getBitsPerSample());const p=await c.readRasters();console.log("‚òÄÔ∏è Rasters read successfully"),console.log("  - Raster type:",p[0].constructor.name),console.log("  - Raster length:",p[0].length);const d=c.getWidth(),x=c.getHeight(),T=new Float32Array(p[0]);console.log("‚òÄÔ∏è GHI data converted to Float32Array"),console.log("  - Array length:",T.length),console.log("  - First 5 values:",Array.from(T.slice(0,5)));let b=T[0],C=T[0];for(let R=1;R<T.length;R++){const I=T[R];I<b&&(b=I),I>C&&(C=I)}return console.log("‚úÖ Solar data processed:",{width:d,height:x,minGHI:b.toFixed(2)+" kWh/m¬≤/day",maxGHI:C.toFixed(2)+" kWh/m¬≤/day"}),{width:d,height:x,ghiData:T,minGHI:b,maxGHI:C,unit:"kWh/m¬≤/day"}}catch(r){throw console.error("‚ùå Failed to process solar data:",r),r}}generateTileId(e){return`tile_${e.centerLat}_${e.centerLng}_${e.scale}`}getCachedTile(e){const r=this.generateTileId(e);return this.tileCache.get(r)||null}getCacheStats(){let e=0;return this.tileCache.forEach(r=>{e+=r.heightmap.elevationData.byteLength,e+=r.solarData.ghiData.byteLength}),{count:this.tileCache.size,totalSize:e}}clearCache(){this.tileCache.clear(),console.log("üßπ Tile cache cleared")}async generateTileGrid(e,r,o=3,l=30){const c=[],d=[];for(let T=0;T<o;T++)for(let b=0;b<o;b++){const C=(T-Math.floor(o/2))*.1,R=(b-Math.floor(o/2))*.1,I=e+R,S=r+C,M={centerLat:I,centerLng:S,scale:l};d.push(this.generateCompleteTile(M))}return(await Promise.allSettled(d)).forEach((T,b)=>{T.status==="fulfilled"?c.push(T.value):console.error(`‚ùå Failed to load tile ${b}:`,T.reason)}),console.log(`‚úÖ Generated ${c.length}/${o*o} tiles in grid`),c}}const $i=new Al;class Cl{constructor(e){z(this,"canvas");z(this,"adaptor");z(this,"device");z(this,"context");z(this,"format");z(this,"uniformBuffer");z(this,"pipeline");z(this,"frameGroupLayout");z(this,"materialGroupLayout");z(this,"frameBindGroup");z(this,"depthStencilState");z(this,"depthStencilBuffer");z(this,"depthStencilView");z(this,"depthStencilAttachment");z(this,"triangleMesh");z(this,"terrainMesh");z(this,"model");z(this,"triangleMaterial");z(this,"quadMaterial");z(this,"terrainMaterial");z(this,"objectBuffer");z(this,"builder");z(this,"terrainBuilder");z(this,"solarTerrainRenderer");z(this,"solarPipeline");this.canvas=e}async init(){await this.setupDevice(),await this.setupBindGroupLayouts(),await this.createAssets(),await this.setupDepthBufferResources(),await this.setupPipeline(),await this.setupBindGroup(),await this.initializeSolarTerrain()}async setupDevice(){var r,o;this.adaptor=await((r=navigator.gpu)==null?void 0:r.requestAdapter()),this.device=await((o=this.adaptor)==null?void 0:o.requestDevice());const e=document.querySelector("#compcheck");if(this.adaptor)e.innerHTML="WebGPU is supported. Click to the canvas";else{e.innerHTML="WebGPU is not supported",console.error("WebGPU is not supported on this device!");return}this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}async setupBindGroupLayouts(){this.frameGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage",hasDynamicOffset:!1}}]}),this.materialGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]})}async setupDepthBufferResources(){this.depthStencilState={format:"depth24plus-stencil8",depthWriteEnabled:!0,depthCompare:"less-equal"};const r={size:{width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1},format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT};this.depthStencilBuffer=this.device.createTexture(r);const o={format:"depth24plus-stencil8",dimension:"2d",aspect:"all"};this.depthStencilView=this.depthStencilBuffer.createView(o),this.depthStencilAttachment={view:this.depthStencilView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilLoadOp:"clear",stencilStoreOp:"discard"}}async setupPipeline(){const e=this.device.createPipelineLayout({bindGroupLayouts:[this.frameGroupLayout,this.materialGroupLayout]});this.pipeline=this.device.createRenderPipeline({layout:e,vertex:{module:this.device.createShaderModule({code:Bi}),entryPoint:"vs_main",buffers:[this.triangleMesh.bufferLayout]},fragment:{module:this.device.createShaderModule({code:Bi}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},depthStencil:this.depthStencilState})}async createAssets(){this.triangleMesh=new Eo(this.device),this.triangleMaterial=new yr,this.quadMaterial=new yr,this.terrainMesh=new Po(this.device),this.terrainMaterial=new yr,this.builder=new Hi,await this.builder.loadGLTF("models/flat_vase.glb"),this.model=new xa(this.device,this.builder),this.terrainBuilder=new Hi,this.uniformBuffer=this.device.createBuffer({size:64*2,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const e={size:64*1024,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE};this.objectBuffer=this.device.createBuffer(e),await this.triangleMaterial.init(this.device,"img/floor.jpg",this.materialGroupLayout),await this.quadMaterial.init(this.device,"img/floor.jpg",this.materialGroupLayout),await this.quadMaterial.generateMipmaps(this.device),this.terrainMaterial=new yr}async generateTerrain(e){try{console.log("üèîÔ∏è Generating terrain mesh from tile data...");const r=1;if(!this.terrainBuilder.populateTerrainFromTile(e,r)){console.error("‚ùå Failed to populate terrain data");return}console.log("üìä Terrain builder stats:",{vertexCount:this.terrainBuilder.vertexCount,indexCount:this.terrainBuilder.indexCount,worldScale:r});const l=this.terrainBuilder.getFlattenedVertices(),c=this.terrainBuilder.getIndexArray();console.log("üìä Mesh data:",{vertexArrayLength:l.length,indexArrayLength:c.length,vertexFloatsPerVertex:l.length/this.terrainBuilder.vertexCount,firstFewVertices:Array.from(l.slice(0,15))}),this.terrainMesh.updateTerrain(this.device,l,c),console.log("‚úÖ Terrain mesh generated successfully with scale:",r)}catch(r){console.error("‚ùå Error generating terrain mesh:",r)}}async generateTerrainWithGHI(e,r){try{console.log("üåû Generating terrain with GHI solar texture..."),await this.generateTerrain(e);const o=new yr;await o.initFromGHIData(this.device,r.ghiData,r.width,r.height,r.minGHI,r.maxGHI,this.materialGroupLayout),this.terrainMaterial=o,console.log("‚úÖ Terrain with GHI texture generated successfully")}catch(o){console.error("‚ùå Error generating terrain with GHI:",o)}}ensureTerrainInScene(){console.log("üéØ Ensuring terrain object exists in scene for GHI rendering")}async render(e){if(!this.device){console.error("DEVICE IS NOT CREATED");return}if(!this.pipeline){console.error("PIPELINE IS NOT CREATED");return}const r=er();Ro(r,Math.PI/4,800/600,.1,50);const o=e.viewTransform;this.device.queue.writeBuffer(this.objectBuffer,0,e.modelTransform,0,e.modelTransform.length),this.device.queue.writeBuffer(this.uniformBuffer,0,new Float32Array(o)),this.device.queue.writeBuffer(this.uniformBuffer,64,new Float32Array(r));const l=this.device.createCommandEncoder(),c=this.context.getCurrentTexture().createView(),p=l.beginRenderPass({colorAttachments:[{view:c,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:this.depthStencilAttachment});p.setPipeline(this.pipeline),p.setBindGroup(0,this.frameBindGroup);let d=0;p.setVertexBuffer(0,this.triangleMesh.buffer),p.setBindGroup(1,this.triangleMaterial.bindGroup),p.draw(3,e.objectCounts[Xe.TRIANGLE],0,d),d+=e.objectCounts[Xe.TRIANGLE],console.log("üîç Terrain render check:",{hasMeshData:this.terrainMesh.hasData(),terrainCount:e.objectCounts[Xe.TERRAIN],hasBindGroup:!!this.terrainMaterial.bindGroup}),this.terrainMesh.hasData()&&e.objectCounts[Xe.TERRAIN]>0&&this.terrainMaterial.bindGroup?(p.setVertexBuffer(0,this.terrainMesh.vertexBuffer),p.setIndexBuffer(this.terrainMesh.indexBuffer,"uint32"),p.setBindGroup(1,this.terrainMaterial.bindGroup),p.drawIndexed(this.terrainMesh.indexCount,e.objectCounts[Xe.TERRAIN],0,0,d),d+=e.objectCounts[Xe.TERRAIN],console.log("üåû Rendering terrain with GHI texture")):this.terrainMesh.hasData()&&e.objectCounts[Xe.TERRAIN]>0?console.log("‚ö†Ô∏è Terrain mesh ready but GHI material not initialized yet"):this.terrainMesh.hasData()?console.log("‚ö†Ô∏è Terrain mesh ready but terrain count is 0"):console.log("‚ö†Ô∏è No terrain mesh data available"),d=this.renderSolarTerrain(p,d),this.model.bind(p),p.setBindGroup(1,this.triangleMaterial.bindGroup),this.model.draw(p,d),d+=1,p.end(),this.device.queue.submit([l.finish()])}async setupBindGroup(){this.frameBindGroup=this.device.createBindGroup({layout:this.frameGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:this.objectBuffer}}]})}async initializeSolarTerrain(){console.log("üåû Initializing solar terrain system...");try{this.solarTerrainRenderer=new Ta(this.device),console.log("‚úÖ Solar terrain system initialized")}catch(e){console.error("‚ùå Failed to initialize solar terrain system:",e)}}async loadSolarTerrainTile(e,r,o=30){try{console.log(`üèîÔ∏è Loading solar terrain tile at ${e}, ${r} (scale: ${o})`);const l=await $i.generateCompleteTile({centerLat:e,centerLng:r,scale:o});console.log("üåû Complete tile data received, generating terrain with GHI texture..."),await this.generateTerrainWithGHI(l.heightmap,l.solarData),console.log(`‚úÖ Solar terrain tile loaded: ${l.tileId}`)}catch(l){throw console.error("‚ùå Failed to load solar terrain tile:",l),l}}async loadSolarTerrainGrid(e,r,o=3,l=30){try{console.log(`üåç Loading ${o}x${o} solar terrain grid at ${e}, ${r}`);const c=await $i.generateTileGrid(e,r,o,l),p=c.map(d=>this.solarTerrainRenderer.addTile(d));await Promise.allSettled(p),console.log(`‚úÖ Solar terrain grid loaded: ${c.length} tiles`)}catch(c){throw console.error("‚ùå Failed to load solar terrain grid:",c),c}}renderSolarTerrain(e,r){if(!this.solarTerrainRenderer)return r;const o=this.solarTerrainRenderer.getAllTiles();if(o.length===0)return r;console.log(`üé¨ Rendering ${o.length} solar terrain tiles`);for(const l of o)this.device.queue.writeBuffer(this.objectBuffer,r*16*4,new Float32Array(l.modelMatrix)),e.setVertexBuffer(0,l.vertexBuffer),e.setIndexBuffer(l.indexBuffer,"uint32"),e.drawIndexed(l.meshData.indexCount,1,0,0,r),r++;return r}}function wt(s){return s*Math.PI/180}class Rl{constructor(e,r){z(this,"position");z(this,"eulers");z(this,"model");this.position=e,this.eulers=pt(),this.eulers[2]=r}update(){this.eulers[2]+=6,this.eulers[2]%=360,this.model=er(),Gn(this.model,this.model,this.position),Ki(this.model,this.model,wt(this.eulers[2]))}getModel(){return this.model}}class Il{constructor(e,r,o){z(this,"position");z(this,"eulers");z(this,"view");z(this,"forwards");z(this,"right");z(this,"up");this.position=e,this.eulers=pt(),this.eulers=[0,o,r],this.forwards=pt(),this.right=pt(),this.up=pt()}update(){this.forwards=[Math.cos(wt(this.eulers[2]))*Math.cos(wt(this.eulers[1])),Math.sin(wt(this.eulers[2]))*Math.cos(wt(this.eulers[1])),Math.sin(wt(this.eulers[1]))],Pi(this.right,this.forwards,[0,0,1]),Pi(this.up,this.right,this.forwards);const e=pt();No(e,this.position,this.forwards),this.view=er(),Io(this.view,this.position,e,this.up)}getView(){return this.view}}const Xr=class Xr{constructor(e,r){z(this,"id");z(this,"position");z(this,"eulers");z(this,"model");this.id=Xr.idCounter++,this.position=e,this.eulers=r}update(){this.eulers[2]+=6,this.eulers[2]%=360,this.model=er(),Gn(this.model,this.model,this.position),Ao(this.model,this.model,wt(this.eulers[1])),Ki(this.model,this.model,wt(this.eulers[2]))}getModel(){return this.model}getId(){return this.id}};z(Xr,"idCounter",0);let kn=Xr;class Ml{constructor(e){z(this,"position");z(this,"model");this.position=e,this.model=er()}update(){Wi(this.model),Gn(this.model,this.model,this.position),So(this.model,this.model,Math.PI/2)}getModel(){return this.model}}class Nl{constructor(){z(this,"triangles");z(this,"terrains");z(this,"player");z(this,"object_data");z(this,"triangle_count");z(this,"terrain_count");z(this,"vase");this.triangles=[],this.terrains=[],this.object_data=new Float32Array(16*1024),this.triangle_count=0,this.terrain_count=0,this.makeTriangles(),this.vase=new kn([0,0,0],[0,0,0]),this.player=new Il([-10,0,1],0,0)}makeTriangles(){let e=0;for(let r=-5;r<=5;r++){this.triangles.push(new Rl([2,r,0],0));let o=er();for(let l=0;l<16;l++)this.object_data[16*e+l]=o.at(l);e++,this.triangle_count++}}addTerrain(e){const r=new Ml(e);this.terrains.push(r),this.terrain_count++,console.log(`üèîÔ∏è Terrain added at position: ${e}`)}update(){let e=0;this.triangles.forEach(o=>{o.update();let l=o.getModel();for(let c=0;c<16;c++)this.object_data[16*e+c]=l.at(c);e++}),this.terrains.forEach(o=>{o.update();let l=o.getModel();for(let c=0;c<16;c++)this.object_data[16*e+c]=l.at(c);e++}),this.vase.update();let r=this.vase.getModel();for(let o=0;o<16;o++)this.object_data[16*e+o]=r.at(o);e++,this.player.update()}getPlayer(){return this.player}getObjects(){return{viewTransform:this.player.getView(),modelTransform:this.object_data,objectCounts:{[Xe.TRIANGLE]:this.triangle_count,[Xe.QUAD]:0,[Xe.TERRAIN]:this.terrain_count}}}spinPlayer(e,r){this.player.eulers[2]-=e,this.player.eulers[2]%=360,this.player.eulers[1]=Math.min(89,Math.max(-89,this.player.eulers[1]+r))}movePlayer(e,r,o){Cn(this.player.position,this.player.position,this.player.forwards,e),Cn(this.player.position,this.player.position,this.player.right,r),Cn(this.player.position,this.player.position,this.player.up,o)}}function Bl(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var zr={exports:{}};/*!
 * jQuery JavaScript Library v3.7.1
 * https://jquery.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2023-08-28T13:37Z
 */var Pl=zr.exports,qi;function Ll(){return qi||(qi=1,function(s){(function(e,r){s.exports=e.document?r(e,!0):function(o){if(!o.document)throw new Error("jQuery requires a window with a document");return r(o)}})(typeof window<"u"?window:Pl,function(e,r){var o=[],l=Object.getPrototypeOf,c=o.slice,p=o.flat?function(t){return o.flat.call(t)}:function(t){return o.concat.apply([],t)},d=o.push,x=o.indexOf,T={},b=T.toString,C=T.hasOwnProperty,R=C.toString,I=R.call(Object),S={},M=function(n){return typeof n=="function"&&typeof n.nodeType!="number"&&typeof n.item!="function"},P=function(n){return n!=null&&n===n.window},m=e.document,H={type:!0,src:!0,nonce:!0,noModule:!0};function _(t,n,a){a=a||m;var u,f,h=a.createElement("script");if(h.text=t,n)for(u in H)f=n[u]||n.getAttribute&&n.getAttribute(u),f&&h.setAttribute(u,f);a.head.appendChild(h).parentNode.removeChild(h)}function G(t){return t==null?t+"":typeof t=="object"||typeof t=="function"?T[b.call(t)]||"object":typeof t}var F="3.7.1",V=/HTML$/i,i=function(t,n){return new i.fn.init(t,n)};i.fn=i.prototype={jquery:F,constructor:i,length:0,toArray:function(){return c.call(this)},get:function(t){return t==null?c.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var n=i.merge(this.constructor(),t);return n.prevObject=this,n},each:function(t){return i.each(this,t)},map:function(t){return this.pushStack(i.map(this,function(n,a){return t.call(n,a,n)}))},slice:function(){return this.pushStack(c.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(i.grep(this,function(t,n){return(n+1)%2}))},odd:function(){return this.pushStack(i.grep(this,function(t,n){return n%2}))},eq:function(t){var n=this.length,a=+t+(t<0?n:0);return this.pushStack(a>=0&&a<n?[this[a]]:[])},end:function(){return this.prevObject||this.constructor()},push:d,sort:o.sort,splice:o.splice},i.extend=i.fn.extend=function(){var t,n,a,u,f,h,g=arguments[0]||{},w=1,v=arguments.length,A=!1;for(typeof g=="boolean"&&(A=g,g=arguments[w]||{},w++),typeof g!="object"&&!M(g)&&(g={}),w===v&&(g=this,w--);w<v;w++)if((t=arguments[w])!=null)for(n in t)u=t[n],!(n==="__proto__"||g===u)&&(A&&u&&(i.isPlainObject(u)||(f=Array.isArray(u)))?(a=g[n],f&&!Array.isArray(a)?h=[]:!f&&!i.isPlainObject(a)?h={}:h=a,f=!1,g[n]=i.extend(A,h,u)):u!==void 0&&(g[n]=u));return g},i.extend({expando:"jQuery"+(F+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var n,a;return!t||b.call(t)!=="[object Object]"?!1:(n=l(t),n?(a=C.call(n,"constructor")&&n.constructor,typeof a=="function"&&R.call(a)===I):!0)},isEmptyObject:function(t){var n;for(n in t)return!1;return!0},globalEval:function(t,n,a){_(t,{nonce:n&&n.nonce},a)},each:function(t,n){var a,u=0;if(D(t))for(a=t.length;u<a&&n.call(t[u],u,t[u])!==!1;u++);else for(u in t)if(n.call(t[u],u,t[u])===!1)break;return t},text:function(t){var n,a="",u=0,f=t.nodeType;if(!f)for(;n=t[u++];)a+=i.text(n);return f===1||f===11?t.textContent:f===9?t.documentElement.textContent:f===3||f===4?t.nodeValue:a},makeArray:function(t,n){var a=n||[];return t!=null&&(D(Object(t))?i.merge(a,typeof t=="string"?[t]:t):d.call(a,t)),a},inArray:function(t,n,a){return n==null?-1:x.call(n,t,a)},isXMLDoc:function(t){var n=t&&t.namespaceURI,a=t&&(t.ownerDocument||t).documentElement;return!V.test(n||a&&a.nodeName||"HTML")},merge:function(t,n){for(var a=+n.length,u=0,f=t.length;u<a;u++)t[f++]=n[u];return t.length=f,t},grep:function(t,n,a){for(var u,f=[],h=0,g=t.length,w=!a;h<g;h++)u=!n(t[h],h),u!==w&&f.push(t[h]);return f},map:function(t,n,a){var u,f,h=0,g=[];if(D(t))for(u=t.length;h<u;h++)f=n(t[h],h,a),f!=null&&g.push(f);else for(h in t)f=n(t[h],h,a),f!=null&&g.push(f);return p(g)},guid:1,support:S}),typeof Symbol=="function"&&(i.fn[Symbol.iterator]=o[Symbol.iterator]),i.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,n){T["[object "+n+"]"]=n.toLowerCase()});function D(t){var n=!!t&&"length"in t&&t.length,a=G(t);return M(t)||P(t)?!1:a==="array"||n===0||typeof n=="number"&&n>0&&n-1 in t}function j(t,n){return t.nodeName&&t.nodeName.toLowerCase()===n.toLowerCase()}var Y=o.pop,J=o.sort,Z=o.splice,q="[\\x20\\t\\r\\n\\f]",ie=new RegExp("^"+q+"+|((?:^|[^\\\\])(?:\\\\.)*)"+q+"+$","g");i.contains=function(t,n){var a=n&&n.parentNode;return t===a||!!(a&&a.nodeType===1&&(t.contains?t.contains(a):t.compareDocumentPosition&&t.compareDocumentPosition(a)&16))};var re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function ce(t,n){return n?t==="\0"?"ÔøΩ":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}i.escapeSelector=function(t){return(t+"").replace(re,ce)};var ge=m,Ce=d;(function(){var t,n,a,u,f,h=Ce,g,w,v,A,O,k=i.expando,B=0,$=0,oe=Dr(),ye=Dr(),fe=Dr(),Ie=Dr(),Re=function(y,E){return y===E&&(f=!0),0},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",tt="(?:\\\\[\\da-fA-F]{1,6}"+q+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",pe="\\["+q+"*("+tt+")(?:"+q+"*([*^$|!~]?=)"+q+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+tt+"))|)"+q+"*\\]",Pt=":("+tt+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+pe+")*)|.*)\\)|)",me=new RegExp(q+"+","g"),Ae=new RegExp("^"+q+"*,"+q+"*"),dr=new RegExp("^"+q+"*([>+~]|"+q+")"+q+"*"),xn=new RegExp(q+"|>"),rt=new RegExp(Pt),pr=new RegExp("^"+tt+"$"),nt={ID:new RegExp("^#("+tt+")"),CLASS:new RegExp("^\\.("+tt+")"),TAG:new RegExp("^("+tt+"|[*])"),ATTR:new RegExp("^"+pe),PSEUDO:new RegExp("^"+Pt),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+q+"*(even|odd|(([+-]|)(\\d*)n|)"+q+"*(?:([+-]|)"+q+"*(\\d+)|))"+q+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+q+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+q+"*((?:-\\d)?\\d*)"+q+"*\\)|)(?=[^-]|$)","i")},xt=/^(?:input|select|textarea|button)$/i,Tt=/^h\d$/i,ze=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Tn=/[+~]/,ht=new RegExp("\\\\[\\da-fA-F]{1,6}"+q+"?|\\\\([^\\r\\n\\f])","g"),dt=function(y,E){var N="0x"+y.slice(1)-65536;return E||(N<0?String.fromCharCode(N+65536):String.fromCharCode(N>>10|55296,N&1023|56320))},po=function(){vt()},go=_r(function(y){return y.disabled===!0&&j(y,"fieldset")},{dir:"parentNode",next:"legend"});function yo(){try{return g.activeElement}catch{}}try{h.apply(o=c.call(ge.childNodes),ge.childNodes),o[ge.childNodes.length].nodeType}catch{h={apply:function(E,N){Ce.apply(E,c.call(N))},call:function(E){Ce.apply(E,c.call(arguments,1))}}}function ve(y,E,N,L){var U,W,K,Q,X,he,se,ae=E&&E.ownerDocument,de=E?E.nodeType:9;if(N=N||[],typeof y!="string"||!y||de!==1&&de!==9&&de!==11)return N;if(!L&&(vt(E),E=E||g,v)){if(de!==11&&(X=ze.exec(y)))if(U=X[1]){if(de===9)if(K=E.getElementById(U)){if(K.id===U)return h.call(N,K),N}else return N;else if(ae&&(K=ae.getElementById(U))&&ve.contains(E,K)&&K.id===U)return h.call(N,K),N}else{if(X[2])return h.apply(N,E.getElementsByTagName(y)),N;if((U=X[3])&&E.getElementsByClassName)return h.apply(N,E.getElementsByClassName(U)),N}if(!Ie[y+" "]&&(!A||!A.test(y))){if(se=y,ae=E,de===1&&(xn.test(y)||dr.test(y))){for(ae=Tn.test(y)&&vn(E.parentNode)||E,(ae!=E||!S.scope)&&((Q=E.getAttribute("id"))?Q=i.escapeSelector(Q):E.setAttribute("id",Q=k)),he=gr(y),W=he.length;W--;)he[W]=(Q?"#"+Q:":scope")+" "+Or(he[W]);se=he.join(",")}try{return h.apply(N,ae.querySelectorAll(se)),N}catch{Ie(y,!0)}finally{Q===k&&E.removeAttribute("id")}}}return Ni(y.replace(ie,"$1"),E,N,L)}function Dr(){var y=[];function E(N,L){return y.push(N+" ")>n.cacheLength&&delete E[y.shift()],E[N+" "]=L}return E}function Ke(y){return y[k]=!0,y}function Yt(y){var E=g.createElement("fieldset");try{return!!y(E)}catch{return!1}finally{E.parentNode&&E.parentNode.removeChild(E),E=null}}function mo(y){return function(E){return j(E,"input")&&E.type===y}}function xo(y){return function(E){return(j(E,"input")||j(E,"button"))&&E.type===y}}function Ii(y){return function(E){return"form"in E?E.parentNode&&E.disabled===!1?"label"in E?"label"in E.parentNode?E.parentNode.disabled===y:E.disabled===y:E.isDisabled===y||E.isDisabled!==!y&&go(E)===y:E.disabled===y:"label"in E?E.disabled===y:!1}}function Lt(y){return Ke(function(E){return E=+E,Ke(function(N,L){for(var U,W=y([],N.length,E),K=W.length;K--;)N[U=W[K]]&&(N[U]=!(L[U]=N[U]))})})}function vn(y){return y&&typeof y.getElementsByTagName<"u"&&y}function vt(y){var E,N=y?y.ownerDocument||y:ge;return N==g||N.nodeType!==9||!N.documentElement||(g=N,w=g.documentElement,v=!i.isXMLDoc(g),O=w.matches||w.webkitMatchesSelector||w.msMatchesSelector,w.msMatchesSelector&&ge!=g&&(E=g.defaultView)&&E.top!==E&&E.addEventListener("unload",po),S.getById=Yt(function(L){return w.appendChild(L).id=i.expando,!g.getElementsByName||!g.getElementsByName(i.expando).length}),S.disconnectedMatch=Yt(function(L){return O.call(L,"*")}),S.scope=Yt(function(){return g.querySelectorAll(":scope")}),S.cssHas=Yt(function(){try{return g.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),S.getById?(n.filter.ID=function(L){var U=L.replace(ht,dt);return function(W){return W.getAttribute("id")===U}},n.find.ID=function(L,U){if(typeof U.getElementById<"u"&&v){var W=U.getElementById(L);return W?[W]:[]}}):(n.filter.ID=function(L){var U=L.replace(ht,dt);return function(W){var K=typeof W.getAttributeNode<"u"&&W.getAttributeNode("id");return K&&K.value===U}},n.find.ID=function(L,U){if(typeof U.getElementById<"u"&&v){var W,K,Q,X=U.getElementById(L);if(X){if(W=X.getAttributeNode("id"),W&&W.value===L)return[X];for(Q=U.getElementsByName(L),K=0;X=Q[K++];)if(W=X.getAttributeNode("id"),W&&W.value===L)return[X]}return[]}}),n.find.TAG=function(L,U){return typeof U.getElementsByTagName<"u"?U.getElementsByTagName(L):U.querySelectorAll(L)},n.find.CLASS=function(L,U){if(typeof U.getElementsByClassName<"u"&&v)return U.getElementsByClassName(L)},A=[],Yt(function(L){var U;w.appendChild(L).innerHTML="<a id='"+k+"' href='' disabled='disabled'></a><select id='"+k+"-\r\\' disabled='disabled'><option selected=''></option></select>",L.querySelectorAll("[selected]").length||A.push("\\["+q+"*(?:value|"+et+")"),L.querySelectorAll("[id~="+k+"-]").length||A.push("~="),L.querySelectorAll("a#"+k+"+*").length||A.push(".#.+[+~]"),L.querySelectorAll(":checked").length||A.push(":checked"),U=g.createElement("input"),U.setAttribute("type","hidden"),L.appendChild(U).setAttribute("name","D"),w.appendChild(L).disabled=!0,L.querySelectorAll(":disabled").length!==2&&A.push(":enabled",":disabled"),U=g.createElement("input"),U.setAttribute("name",""),L.appendChild(U),L.querySelectorAll("[name='']").length||A.push("\\["+q+"*name"+q+"*="+q+`*(?:''|"")`)}),S.cssHas||A.push(":has"),A=A.length&&new RegExp(A.join("|")),Re=function(L,U){if(L===U)return f=!0,0;var W=!L.compareDocumentPosition-!U.compareDocumentPosition;return W||(W=(L.ownerDocument||L)==(U.ownerDocument||U)?L.compareDocumentPosition(U):1,W&1||!S.sortDetached&&U.compareDocumentPosition(L)===W?L===g||L.ownerDocument==ge&&ve.contains(ge,L)?-1:U===g||U.ownerDocument==ge&&ve.contains(ge,U)?1:u?x.call(u,L)-x.call(u,U):0:W&4?-1:1)}),g}ve.matches=function(y,E){return ve(y,null,null,E)},ve.matchesSelector=function(y,E){if(vt(y),v&&!Ie[E+" "]&&(!A||!A.test(E)))try{var N=O.call(y,E);if(N||S.disconnectedMatch||y.document&&y.document.nodeType!==11)return N}catch{Ie(E,!0)}return ve(E,g,null,[y]).length>0},ve.contains=function(y,E){return(y.ownerDocument||y)!=g&&vt(y),i.contains(y,E)},ve.attr=function(y,E){(y.ownerDocument||y)!=g&&vt(y);var N=n.attrHandle[E.toLowerCase()],L=N&&C.call(n.attrHandle,E.toLowerCase())?N(y,E,!v):void 0;return L!==void 0?L:y.getAttribute(E)},ve.error=function(y){throw new Error("Syntax error, unrecognized expression: "+y)},i.uniqueSort=function(y){var E,N=[],L=0,U=0;if(f=!S.sortStable,u=!S.sortStable&&c.call(y,0),J.call(y,Re),f){for(;E=y[U++];)E===y[U]&&(L=N.push(U));for(;L--;)Z.call(y,N[L],1)}return u=null,y},i.fn.uniqueSort=function(){return this.pushStack(i.uniqueSort(c.apply(this)))},n=i.expr={cacheLength:50,createPseudo:Ke,match:nt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(y){return y[1]=y[1].replace(ht,dt),y[3]=(y[3]||y[4]||y[5]||"").replace(ht,dt),y[2]==="~="&&(y[3]=" "+y[3]+" "),y.slice(0,4)},CHILD:function(y){return y[1]=y[1].toLowerCase(),y[1].slice(0,3)==="nth"?(y[3]||ve.error(y[0]),y[4]=+(y[4]?y[5]+(y[6]||1):2*(y[3]==="even"||y[3]==="odd")),y[5]=+(y[7]+y[8]||y[3]==="odd")):y[3]&&ve.error(y[0]),y},PSEUDO:function(y){var E,N=!y[6]&&y[2];return nt.CHILD.test(y[0])?null:(y[3]?y[2]=y[4]||y[5]||"":N&&rt.test(N)&&(E=gr(N,!0))&&(E=N.indexOf(")",N.length-E)-N.length)&&(y[0]=y[0].slice(0,E),y[2]=N.slice(0,E)),y.slice(0,3))}},filter:{TAG:function(y){var E=y.replace(ht,dt).toLowerCase();return y==="*"?function(){return!0}:function(N){return j(N,E)}},CLASS:function(y){var E=oe[y+" "];return E||(E=new RegExp("(^|"+q+")"+y+"("+q+"|$)"))&&oe(y,function(N){return E.test(typeof N.className=="string"&&N.className||typeof N.getAttribute<"u"&&N.getAttribute("class")||"")})},ATTR:function(y,E,N){return function(L){var U=ve.attr(L,y);return U==null?E==="!=":E?(U+="",E==="="?U===N:E==="!="?U!==N:E==="^="?N&&U.indexOf(N)===0:E==="*="?N&&U.indexOf(N)>-1:E==="$="?N&&U.slice(-N.length)===N:E==="~="?(" "+U.replace(me," ")+" ").indexOf(N)>-1:E==="|="?U===N||U.slice(0,N.length+1)===N+"-":!1):!0}},CHILD:function(y,E,N,L,U){var W=y.slice(0,3)!=="nth",K=y.slice(-4)!=="last",Q=E==="of-type";return L===1&&U===0?function(X){return!!X.parentNode}:function(X,he,se){var ae,de,ne,be,Ge,Ne=W!==K?"nextSibling":"previousSibling",$e=X.parentNode,it=Q&&X.nodeName.toLowerCase(),Wt=!se&&!Q,Pe=!1;if($e){if(W){for(;Ne;){for(ne=X;ne=ne[Ne];)if(Q?j(ne,it):ne.nodeType===1)return!1;Ge=Ne=y==="only"&&!Ge&&"nextSibling"}return!0}if(Ge=[K?$e.firstChild:$e.lastChild],K&&Wt){for(de=$e[k]||($e[k]={}),ae=de[y]||[],be=ae[0]===B&&ae[1],Pe=be&&ae[2],ne=be&&$e.childNodes[be];ne=++be&&ne&&ne[Ne]||(Pe=be=0)||Ge.pop();)if(ne.nodeType===1&&++Pe&&ne===X){de[y]=[B,be,Pe];break}}else if(Wt&&(de=X[k]||(X[k]={}),ae=de[y]||[],be=ae[0]===B&&ae[1],Pe=be),Pe===!1)for(;(ne=++be&&ne&&ne[Ne]||(Pe=be=0)||Ge.pop())&&!((Q?j(ne,it):ne.nodeType===1)&&++Pe&&(Wt&&(de=ne[k]||(ne[k]={}),de[y]=[B,Pe]),ne===X)););return Pe-=U,Pe===L||Pe%L===0&&Pe/L>=0}}},PSEUDO:function(y,E){var N,L=n.pseudos[y]||n.setFilters[y.toLowerCase()]||ve.error("unsupported pseudo: "+y);return L[k]?L(E):L.length>1?(N=[y,y,"",E],n.setFilters.hasOwnProperty(y.toLowerCase())?Ke(function(U,W){for(var K,Q=L(U,E),X=Q.length;X--;)K=x.call(U,Q[X]),U[K]=!(W[K]=Q[X])}):function(U){return L(U,0,N)}):L}},pseudos:{not:Ke(function(y){var E=[],N=[],L=Sn(y.replace(ie,"$1"));return L[k]?Ke(function(U,W,K,Q){for(var X,he=L(U,null,Q,[]),se=U.length;se--;)(X=he[se])&&(U[se]=!(W[se]=X))}):function(U,W,K){return E[0]=U,L(E,null,K,N),E[0]=null,!N.pop()}}),has:Ke(function(y){return function(E){return ve(y,E).length>0}}),contains:Ke(function(y){return y=y.replace(ht,dt),function(E){return(E.textContent||i.text(E)).indexOf(y)>-1}}),lang:Ke(function(y){return pr.test(y||"")||ve.error("unsupported lang: "+y),y=y.replace(ht,dt).toLowerCase(),function(E){var N;do if(N=v?E.lang:E.getAttribute("xml:lang")||E.getAttribute("lang"))return N=N.toLowerCase(),N===y||N.indexOf(y+"-")===0;while((E=E.parentNode)&&E.nodeType===1);return!1}}),target:function(y){var E=e.location&&e.location.hash;return E&&E.slice(1)===y.id},root:function(y){return y===w},focus:function(y){return y===yo()&&g.hasFocus()&&!!(y.type||y.href||~y.tabIndex)},enabled:Ii(!1),disabled:Ii(!0),checked:function(y){return j(y,"input")&&!!y.checked||j(y,"option")&&!!y.selected},selected:function(y){return y.parentNode&&y.parentNode.selectedIndex,y.selected===!0},empty:function(y){for(y=y.firstChild;y;y=y.nextSibling)if(y.nodeType<6)return!1;return!0},parent:function(y){return!n.pseudos.empty(y)},header:function(y){return Tt.test(y.nodeName)},input:function(y){return xt.test(y.nodeName)},button:function(y){return j(y,"input")&&y.type==="button"||j(y,"button")},text:function(y){var E;return j(y,"input")&&y.type==="text"&&((E=y.getAttribute("type"))==null||E.toLowerCase()==="text")},first:Lt(function(){return[0]}),last:Lt(function(y,E){return[E-1]}),eq:Lt(function(y,E,N){return[N<0?N+E:N]}),even:Lt(function(y,E){for(var N=0;N<E;N+=2)y.push(N);return y}),odd:Lt(function(y,E){for(var N=1;N<E;N+=2)y.push(N);return y}),lt:Lt(function(y,E,N){var L;for(N<0?L=N+E:N>E?L=E:L=N;--L>=0;)y.push(L);return y}),gt:Lt(function(y,E,N){for(var L=N<0?N+E:N;++L<E;)y.push(L);return y})}},n.pseudos.nth=n.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[t]=mo(t);for(t in{submit:!0,reset:!0})n.pseudos[t]=xo(t);function Mi(){}Mi.prototype=n.filters=n.pseudos,n.setFilters=new Mi;function gr(y,E){var N,L,U,W,K,Q,X,he=ye[y+" "];if(he)return E?0:he.slice(0);for(K=y,Q=[],X=n.preFilter;K;){(!N||(L=Ae.exec(K)))&&(L&&(K=K.slice(L[0].length)||K),Q.push(U=[])),N=!1,(L=dr.exec(K))&&(N=L.shift(),U.push({value:N,type:L[0].replace(ie," ")}),K=K.slice(N.length));for(W in n.filter)(L=nt[W].exec(K))&&(!X[W]||(L=X[W](L)))&&(N=L.shift(),U.push({value:N,type:W,matches:L}),K=K.slice(N.length));if(!N)break}return E?K.length:K?ve.error(y):ye(y,Q).slice(0)}function Or(y){for(var E=0,N=y.length,L="";E<N;E++)L+=y[E].value;return L}function _r(y,E,N){var L=E.dir,U=E.next,W=U||L,K=N&&W==="parentNode",Q=$++;return E.first?function(X,he,se){for(;X=X[L];)if(X.nodeType===1||K)return y(X,he,se);return!1}:function(X,he,se){var ae,de,ne=[B,Q];if(se){for(;X=X[L];)if((X.nodeType===1||K)&&y(X,he,se))return!0}else for(;X=X[L];)if(X.nodeType===1||K)if(de=X[k]||(X[k]={}),U&&j(X,U))X=X[L]||X;else{if((ae=de[W])&&ae[0]===B&&ae[1]===Q)return ne[2]=ae[2];if(de[W]=ne,ne[2]=y(X,he,se))return!0}return!1}}function wn(y){return y.length>1?function(E,N,L){for(var U=y.length;U--;)if(!y[U](E,N,L))return!1;return!0}:y[0]}function To(y,E,N){for(var L=0,U=E.length;L<U;L++)ve(y,E[L],N);return N}function Fr(y,E,N,L,U){for(var W,K=[],Q=0,X=y.length,he=E!=null;Q<X;Q++)(W=y[Q])&&(!N||N(W,L,U))&&(K.push(W),he&&E.push(Q));return K}function bn(y,E,N,L,U,W){return L&&!L[k]&&(L=bn(L)),U&&!U[k]&&(U=bn(U,W)),Ke(function(K,Q,X,he){var se,ae,de,ne,be=[],Ge=[],Ne=Q.length,$e=K||To(E||"*",X.nodeType?[X]:X,[]),it=y&&(K||!E)?Fr($e,be,y,X,he):$e;if(N?(ne=U||(K?y:Ne||L)?[]:Q,N(it,ne,X,he)):ne=it,L)for(se=Fr(ne,Ge),L(se,[],X,he),ae=se.length;ae--;)(de=se[ae])&&(ne[Ge[ae]]=!(it[Ge[ae]]=de));if(K){if(U||y){if(U){for(se=[],ae=ne.length;ae--;)(de=ne[ae])&&se.push(it[ae]=de);U(null,ne=[],se,he)}for(ae=ne.length;ae--;)(de=ne[ae])&&(se=U?x.call(K,de):be[ae])>-1&&(K[se]=!(Q[se]=de))}}else ne=Fr(ne===Q?ne.splice(Ne,ne.length):ne),U?U(null,Q,ne,he):h.apply(Q,ne)})}function En(y){for(var E,N,L,U=y.length,W=n.relative[y[0].type],K=W||n.relative[" "],Q=W?1:0,X=_r(function(ae){return ae===E},K,!0),he=_r(function(ae){return x.call(E,ae)>-1},K,!0),se=[function(ae,de,ne){var be=!W&&(ne||de!=a)||((E=de).nodeType?X(ae,de,ne):he(ae,de,ne));return E=null,be}];Q<U;Q++)if(N=n.relative[y[Q].type])se=[_r(wn(se),N)];else{if(N=n.filter[y[Q].type].apply(null,y[Q].matches),N[k]){for(L=++Q;L<U&&!n.relative[y[L].type];L++);return bn(Q>1&&wn(se),Q>1&&Or(y.slice(0,Q-1).concat({value:y[Q-2].type===" "?"*":""})).replace(ie,"$1"),N,Q<L&&En(y.slice(Q,L)),L<U&&En(y=y.slice(L)),L<U&&Or(y))}se.push(N)}return wn(se)}function vo(y,E){var N=E.length>0,L=y.length>0,U=function(W,K,Q,X,he){var se,ae,de,ne=0,be="0",Ge=W&&[],Ne=[],$e=a,it=W||L&&n.find.TAG("*",he),Wt=B+=$e==null?1:Math.random()||.1,Pe=it.length;for(he&&(a=K==g||K||he);be!==Pe&&(se=it[be])!=null;be++){if(L&&se){for(ae=0,!K&&se.ownerDocument!=g&&(vt(se),Q=!v);de=y[ae++];)if(de(se,K||g,Q)){h.call(X,se);break}he&&(B=Wt)}N&&((se=!de&&se)&&ne--,W&&Ge.push(se))}if(ne+=be,N&&be!==ne){for(ae=0;de=E[ae++];)de(Ge,Ne,K,Q);if(W){if(ne>0)for(;be--;)Ge[be]||Ne[be]||(Ne[be]=Y.call(X));Ne=Fr(Ne)}h.apply(X,Ne),he&&!W&&Ne.length>0&&ne+E.length>1&&i.uniqueSort(X)}return he&&(B=Wt,a=$e),Ge};return N?Ke(U):U}function Sn(y,E){var N,L=[],U=[],W=fe[y+" "];if(!W){for(E||(E=gr(y)),N=E.length;N--;)W=En(E[N]),W[k]?L.push(W):U.push(W);W=fe(y,vo(U,L)),W.selector=y}return W}function Ni(y,E,N,L){var U,W,K,Q,X,he=typeof y=="function"&&y,se=!L&&gr(y=he.selector||y);if(N=N||[],se.length===1){if(W=se[0]=se[0].slice(0),W.length>2&&(K=W[0]).type==="ID"&&E.nodeType===9&&v&&n.relative[W[1].type]){if(E=(n.find.ID(K.matches[0].replace(ht,dt),E)||[])[0],E)he&&(E=E.parentNode);else return N;y=y.slice(W.shift().value.length)}for(U=nt.needsContext.test(y)?0:W.length;U--&&(K=W[U],!n.relative[Q=K.type]);)if((X=n.find[Q])&&(L=X(K.matches[0].replace(ht,dt),Tn.test(W[0].type)&&vn(E.parentNode)||E))){if(W.splice(U,1),y=L.length&&Or(W),!y)return h.apply(N,L),N;break}}return(he||Sn(y,se))(L,E,!v,N,!E||Tn.test(y)&&vn(E.parentNode)||E),N}S.sortStable=k.split("").sort(Re).join("")===k,vt(),S.sortDetached=Yt(function(y){return y.compareDocumentPosition(g.createElement("fieldset"))&1}),i.find=ve,i.expr[":"]=i.expr.pseudos,i.unique=i.uniqueSort,ve.compile=Sn,ve.select=Ni,ve.setDocument=vt,ve.tokenize=gr,ve.escape=i.escapeSelector,ve.getText=i.text,ve.isXML=i.isXMLDoc,ve.selectors=i.expr,ve.support=i.support,ve.uniqueSort=i.uniqueSort})();var we=function(t,n,a){for(var u=[],f=a!==void 0;(t=t[n])&&t.nodeType!==9;)if(t.nodeType===1){if(f&&i(t).is(a))break;u.push(t)}return u},ct=function(t,n){for(var a=[];t;t=t.nextSibling)t.nodeType===1&&t!==n&&a.push(t);return a},yt=i.expr.match.needsContext,mt=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Rt(t,n,a){return M(n)?i.grep(t,function(u,f){return!!n.call(u,f,u)!==a}):n.nodeType?i.grep(t,function(u){return u===n!==a}):typeof n!="string"?i.grep(t,function(u){return x.call(n,u)>-1!==a}):i.filter(n,t,a)}i.filter=function(t,n,a){var u=n[0];return a&&(t=":not("+t+")"),n.length===1&&u.nodeType===1?i.find.matchesSelector(u,t)?[u]:[]:i.find.matches(t,i.grep(n,function(f){return f.nodeType===1}))},i.fn.extend({find:function(t){var n,a,u=this.length,f=this;if(typeof t!="string")return this.pushStack(i(t).filter(function(){for(n=0;n<u;n++)if(i.contains(f[n],this))return!0}));for(a=this.pushStack([]),n=0;n<u;n++)i.find(t,f[n],a);return u>1?i.uniqueSort(a):a},filter:function(t){return this.pushStack(Rt(this,t||[],!1))},not:function(t){return this.pushStack(Rt(this,t||[],!0))},is:function(t){return!!Rt(this,typeof t=="string"&&yt.test(t)?i(t):t||[],!1).length}});var Ze,nr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Ye=i.fn.init=function(t,n,a){var u,f;if(!t)return this;if(a=a||Ze,typeof t=="string")if(t[0]==="<"&&t[t.length-1]===">"&&t.length>=3?u=[null,t,null]:u=nr.exec(t),u&&(u[1]||!n))if(u[1]){if(n=n instanceof i?n[0]:n,i.merge(this,i.parseHTML(u[1],n&&n.nodeType?n.ownerDocument||n:m,!0)),mt.test(u[1])&&i.isPlainObject(n))for(u in n)M(this[u])?this[u](n[u]):this.attr(u,n[u]);return this}else return f=m.getElementById(u[2]),f&&(this[0]=f,this.length=1),this;else return!n||n.jquery?(n||a).find(t):this.constructor(n).find(t);else{if(t.nodeType)return this[0]=t,this.length=1,this;if(M(t))return a.ready!==void 0?a.ready(t):t(i)}return i.makeArray(t,this)};Ye.prototype=i.fn,Ze=i(m);var It=/^(?:parents|prev(?:Until|All))/,tn={children:!0,contents:!0,next:!0,prev:!0};i.fn.extend({has:function(t){var n=i(t,this),a=n.length;return this.filter(function(){for(var u=0;u<a;u++)if(i.contains(this,n[u]))return!0})},closest:function(t,n){var a,u=0,f=this.length,h=[],g=typeof t!="string"&&i(t);if(!yt.test(t)){for(;u<f;u++)for(a=this[u];a&&a!==n;a=a.parentNode)if(a.nodeType<11&&(g?g.index(a)>-1:a.nodeType===1&&i.find.matchesSelector(a,t))){h.push(a);break}}return this.pushStack(h.length>1?i.uniqueSort(h):h)},index:function(t){return t?typeof t=="string"?x.call(i(t),this[0]):x.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,n){return this.pushStack(i.uniqueSort(i.merge(this.get(),i(t,n))))},addBack:function(t){return this.add(t==null?this.prevObject:this.prevObject.filter(t))}});function ir(t,n){for(;(t=t[n])&&t.nodeType!==1;);return t}i.each({parent:function(t){var n=t.parentNode;return n&&n.nodeType!==11?n:null},parents:function(t){return we(t,"parentNode")},parentsUntil:function(t,n,a){return we(t,"parentNode",a)},next:function(t){return ir(t,"nextSibling")},prev:function(t){return ir(t,"previousSibling")},nextAll:function(t){return we(t,"nextSibling")},prevAll:function(t){return we(t,"previousSibling")},nextUntil:function(t,n,a){return we(t,"nextSibling",a)},prevUntil:function(t,n,a){return we(t,"previousSibling",a)},siblings:function(t){return ct((t.parentNode||{}).firstChild,t)},children:function(t){return ct(t.firstChild)},contents:function(t){return t.contentDocument!=null&&l(t.contentDocument)?t.contentDocument:(j(t,"template")&&(t=t.content||t),i.merge([],t.childNodes))}},function(t,n){i.fn[t]=function(a,u){var f=i.map(this,n,a);return t.slice(-5)!=="Until"&&(u=a),u&&typeof u=="string"&&(f=i.filter(u,f)),this.length>1&&(tn[t]||i.uniqueSort(f),It.test(t)&&f.reverse()),this.pushStack(f)}});var Be=/[^\x20\t\r\n\f]+/g;function Es(t){var n={};return i.each(t.match(Be)||[],function(a,u){n[u]=!0}),n}i.Callbacks=function(t){t=typeof t=="string"?Es(t):i.extend({},t);var n,a,u,f,h=[],g=[],w=-1,v=function(){for(f=f||t.once,u=n=!0;g.length;w=-1)for(a=g.shift();++w<h.length;)h[w].apply(a[0],a[1])===!1&&t.stopOnFalse&&(w=h.length,a=!1);t.memory||(a=!1),n=!1,f&&(a?h=[]:h="")},A={add:function(){return h&&(a&&!n&&(w=h.length-1,g.push(a)),function O(k){i.each(k,function(B,$){M($)?(!t.unique||!A.has($))&&h.push($):$&&$.length&&G($)!=="string"&&O($)})}(arguments),a&&!n&&v()),this},remove:function(){return i.each(arguments,function(O,k){for(var B;(B=i.inArray(k,h,B))>-1;)h.splice(B,1),B<=w&&w--}),this},has:function(O){return O?i.inArray(O,h)>-1:h.length>0},empty:function(){return h&&(h=[]),this},disable:function(){return f=g=[],h=a="",this},disabled:function(){return!h},lock:function(){return f=g=[],!a&&!n&&(h=a=""),this},locked:function(){return!!f},fireWith:function(O,k){return f||(k=k||[],k=[O,k.slice?k.slice():k],g.push(k),n||v()),this},fire:function(){return A.fireWith(this,arguments),this},fired:function(){return!!u}};return A};function Gt(t){return t}function Rr(t){throw t}function Xn(t,n,a,u){var f;try{t&&M(f=t.promise)?f.call(t).done(n).fail(a):t&&M(f=t.then)?f.call(t,n,a):n.apply(void 0,[t].slice(u))}catch(h){a.apply(void 0,[h])}}i.extend({Deferred:function(t){var n=[["notify","progress",i.Callbacks("memory"),i.Callbacks("memory"),2],["resolve","done",i.Callbacks("once memory"),i.Callbacks("once memory"),0,"resolved"],["reject","fail",i.Callbacks("once memory"),i.Callbacks("once memory"),1,"rejected"]],a="pending",u={state:function(){return a},always:function(){return f.done(arguments).fail(arguments),this},catch:function(h){return u.then(null,h)},pipe:function(){var h=arguments;return i.Deferred(function(g){i.each(n,function(w,v){var A=M(h[v[4]])&&h[v[4]];f[v[1]](function(){var O=A&&A.apply(this,arguments);O&&M(O.promise)?O.promise().progress(g.notify).done(g.resolve).fail(g.reject):g[v[0]+"With"](this,A?[O]:arguments)})}),h=null}).promise()},then:function(h,g,w){var v=0;function A(O,k,B,$){return function(){var oe=this,ye=arguments,fe=function(){var Re,et;if(!(O<v)){if(Re=B.apply(oe,ye),Re===k.promise())throw new TypeError("Thenable self-resolution");et=Re&&(typeof Re=="object"||typeof Re=="function")&&Re.then,M(et)?$?et.call(Re,A(v,k,Gt,$),A(v,k,Rr,$)):(v++,et.call(Re,A(v,k,Gt,$),A(v,k,Rr,$),A(v,k,Gt,k.notifyWith))):(B!==Gt&&(oe=void 0,ye=[Re]),($||k.resolveWith)(oe,ye))}},Ie=$?fe:function(){try{fe()}catch(Re){i.Deferred.exceptionHook&&i.Deferred.exceptionHook(Re,Ie.error),O+1>=v&&(B!==Rr&&(oe=void 0,ye=[Re]),k.rejectWith(oe,ye))}};O?Ie():(i.Deferred.getErrorHook?Ie.error=i.Deferred.getErrorHook():i.Deferred.getStackHook&&(Ie.error=i.Deferred.getStackHook()),e.setTimeout(Ie))}}return i.Deferred(function(O){n[0][3].add(A(0,O,M(w)?w:Gt,O.notifyWith)),n[1][3].add(A(0,O,M(h)?h:Gt)),n[2][3].add(A(0,O,M(g)?g:Rr))}).promise()},promise:function(h){return h!=null?i.extend(h,u):u}},f={};return i.each(n,function(h,g){var w=g[2],v=g[5];u[g[1]]=w.add,v&&w.add(function(){a=v},n[3-h][2].disable,n[3-h][3].disable,n[0][2].lock,n[0][3].lock),w.add(g[3].fire),f[g[0]]=function(){return f[g[0]+"With"](this===f?void 0:this,arguments),this},f[g[0]+"With"]=w.fireWith}),u.promise(f),t&&t.call(f,f),f},when:function(t){var n=arguments.length,a=n,u=Array(a),f=c.call(arguments),h=i.Deferred(),g=function(w){return function(v){u[w]=this,f[w]=arguments.length>1?c.call(arguments):v,--n||h.resolveWith(u,f)}};if(n<=1&&(Xn(t,h.done(g(a)).resolve,h.reject,!n),h.state()==="pending"||M(f[a]&&f[a].then)))return h.then();for(;a--;)Xn(f[a],g(a),h.reject);return h.promise()}});var Ss=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;i.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&Ss.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},i.readyException=function(t){e.setTimeout(function(){throw t})};var rn=i.Deferred();i.fn.ready=function(t){return rn.then(t).catch(function(n){i.readyException(n)}),this},i.extend({isReady:!1,readyWait:1,ready:function(t){(t===!0?--i.readyWait:i.isReady)||(i.isReady=!0,!(t!==!0&&--i.readyWait>0)&&rn.resolveWith(m,[i]))}}),i.ready.then=rn.then;function Ir(){m.removeEventListener("DOMContentLoaded",Ir),e.removeEventListener("load",Ir),i.ready()}m.readyState==="complete"||m.readyState!=="loading"&&!m.documentElement.doScroll?e.setTimeout(i.ready):(m.addEventListener("DOMContentLoaded",Ir),e.addEventListener("load",Ir));var ut=function(t,n,a,u,f,h,g){var w=0,v=t.length,A=a==null;if(G(a)==="object"){f=!0;for(w in a)ut(t,n,w,a[w],!0,h,g)}else if(u!==void 0&&(f=!0,M(u)||(g=!0),A&&(g?(n.call(t,u),n=null):(A=n,n=function(O,k,B){return A.call(i(O),B)})),n))for(;w<v;w++)n(t[w],a,g?u:u.call(t[w],w,n(t[w],a)));return f?t:A?n.call(t):v?n(t[0],a):h},As=/^-ms-/,Cs=/-([a-z])/g;function Rs(t,n){return n.toUpperCase()}function Qe(t){return t.replace(As,"ms-").replace(Cs,Rs)}var sr=function(t){return t.nodeType===1||t.nodeType===9||!+t.nodeType};function or(){this.expando=i.expando+or.uid++}or.uid=1,or.prototype={cache:function(t){var n=t[this.expando];return n||(n={},sr(t)&&(t.nodeType?t[this.expando]=n:Object.defineProperty(t,this.expando,{value:n,configurable:!0}))),n},set:function(t,n,a){var u,f=this.cache(t);if(typeof n=="string")f[Qe(n)]=a;else for(u in n)f[Qe(u)]=n[u];return f},get:function(t,n){return n===void 0?this.cache(t):t[this.expando]&&t[this.expando][Qe(n)]},access:function(t,n,a){return n===void 0||n&&typeof n=="string"&&a===void 0?this.get(t,n):(this.set(t,n,a),a!==void 0?a:n)},remove:function(t,n){var a,u=t[this.expando];if(u!==void 0){if(n!==void 0)for(Array.isArray(n)?n=n.map(Qe):(n=Qe(n),n=n in u?[n]:n.match(Be)||[]),a=n.length;a--;)delete u[n[a]];(n===void 0||i.isEmptyObject(u))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var n=t[this.expando];return n!==void 0&&!i.isEmptyObject(n)}};var ee=new or,Fe=new or,Is=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ms=/[A-Z]/g;function Ns(t){return t==="true"?!0:t==="false"?!1:t==="null"?null:t===+t+""?+t:Is.test(t)?JSON.parse(t):t}function Jn(t,n,a){var u;if(a===void 0&&t.nodeType===1)if(u="data-"+n.replace(Ms,"-$&").toLowerCase(),a=t.getAttribute(u),typeof a=="string"){try{a=Ns(a)}catch{}Fe.set(t,n,a)}else a=void 0;return a}i.extend({hasData:function(t){return Fe.hasData(t)||ee.hasData(t)},data:function(t,n,a){return Fe.access(t,n,a)},removeData:function(t,n){Fe.remove(t,n)},_data:function(t,n,a){return ee.access(t,n,a)},_removeData:function(t,n){ee.remove(t,n)}}),i.fn.extend({data:function(t,n){var a,u,f,h=this[0],g=h&&h.attributes;if(t===void 0){if(this.length&&(f=Fe.get(h),h.nodeType===1&&!ee.get(h,"hasDataAttrs"))){for(a=g.length;a--;)g[a]&&(u=g[a].name,u.indexOf("data-")===0&&(u=Qe(u.slice(5)),Jn(h,u,f[u])));ee.set(h,"hasDataAttrs",!0)}return f}return typeof t=="object"?this.each(function(){Fe.set(this,t)}):ut(this,function(w){var v;if(h&&w===void 0)return v=Fe.get(h,t),v!==void 0||(v=Jn(h,t),v!==void 0)?v:void 0;this.each(function(){Fe.set(this,t,w)})},null,n,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){Fe.remove(this,t)})}}),i.extend({queue:function(t,n,a){var u;if(t)return n=(n||"fx")+"queue",u=ee.get(t,n),a&&(!u||Array.isArray(a)?u=ee.access(t,n,i.makeArray(a)):u.push(a)),u||[]},dequeue:function(t,n){n=n||"fx";var a=i.queue(t,n),u=a.length,f=a.shift(),h=i._queueHooks(t,n),g=function(){i.dequeue(t,n)};f==="inprogress"&&(f=a.shift(),u--),f&&(n==="fx"&&a.unshift("inprogress"),delete h.stop,f.call(t,g,h)),!u&&h&&h.empty.fire()},_queueHooks:function(t,n){var a=n+"queueHooks";return ee.get(t,a)||ee.access(t,a,{empty:i.Callbacks("once memory").add(function(){ee.remove(t,[n+"queue",a])})})}}),i.fn.extend({queue:function(t,n){var a=2;return typeof t!="string"&&(n=t,t="fx",a--),arguments.length<a?i.queue(this[0],t):n===void 0?this:this.each(function(){var u=i.queue(this,t,n);i._queueHooks(this,t),t==="fx"&&u[0]!=="inprogress"&&i.dequeue(this,t)})},dequeue:function(t){return this.each(function(){i.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,n){var a,u=1,f=i.Deferred(),h=this,g=this.length,w=function(){--u||f.resolveWith(h,[h])};for(typeof t!="string"&&(n=t,t=void 0),t=t||"fx";g--;)a=ee.get(h[g],t+"queueHooks"),a&&a.empty&&(u++,a.empty.add(w));return w(),f.promise(n)}});var Zn=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ar=new RegExp("^(?:([+-])=|)("+Zn+")([a-z%]*)$","i"),ft=["Top","Right","Bottom","Left"],Mt=m.documentElement,jt=function(t){return i.contains(t.ownerDocument,t)},Bs={composed:!0};Mt.getRootNode&&(jt=function(t){return i.contains(t.ownerDocument,t)||t.getRootNode(Bs)===t.ownerDocument});var Mr=function(t,n){return t=n||t,t.style.display==="none"||t.style.display===""&&jt(t)&&i.css(t,"display")==="none"};function Qn(t,n,a,u){var f,h,g=20,w=u?function(){return u.cur()}:function(){return i.css(t,n,"")},v=w(),A=a&&a[3]||(i.cssNumber[n]?"":"px"),O=t.nodeType&&(i.cssNumber[n]||A!=="px"&&+v)&&ar.exec(i.css(t,n));if(O&&O[3]!==A){for(v=v/2,A=A||O[3],O=+v||1;g--;)i.style(t,n,O+A),(1-h)*(1-(h=w()/v||.5))<=0&&(g=0),O=O/h;O=O*2,i.style(t,n,O+A),a=a||[]}return a&&(O=+O||+v||0,f=a[1]?O+(a[1]+1)*a[2]:+a[2],u&&(u.unit=A,u.start=O,u.end=f)),f}var ei={};function Ps(t){var n,a=t.ownerDocument,u=t.nodeName,f=ei[u];return f||(n=a.body.appendChild(a.createElement(u)),f=i.css(n,"display"),n.parentNode.removeChild(n),f==="none"&&(f="block"),ei[u]=f,f)}function Ht(t,n){for(var a,u,f=[],h=0,g=t.length;h<g;h++)u=t[h],u.style&&(a=u.style.display,n?(a==="none"&&(f[h]=ee.get(u,"display")||null,f[h]||(u.style.display="")),u.style.display===""&&Mr(u)&&(f[h]=Ps(u))):a!=="none"&&(f[h]="none",ee.set(u,"display",a)));for(h=0;h<g;h++)f[h]!=null&&(t[h].style.display=f[h]);return t}i.fn.extend({show:function(){return Ht(this,!0)},hide:function(){return Ht(this)},toggle:function(t){return typeof t=="boolean"?t?this.show():this.hide():this.each(function(){Mr(this)?i(this).show():i(this).hide()})}});var lr=/^(?:checkbox|radio)$/i,ti=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ri=/^$|^module$|\/(?:java|ecma)script/i;(function(){var t=m.createDocumentFragment(),n=t.appendChild(m.createElement("div")),a=m.createElement("input");a.setAttribute("type","radio"),a.setAttribute("checked","checked"),a.setAttribute("name","t"),n.appendChild(a),S.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,n.innerHTML="<textarea>x</textarea>",S.noCloneChecked=!!n.cloneNode(!0).lastChild.defaultValue,n.innerHTML="<option></option>",S.option=!!n.lastChild})();var Ve={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ve.tbody=Ve.tfoot=Ve.colgroup=Ve.caption=Ve.thead,Ve.th=Ve.td,S.option||(Ve.optgroup=Ve.option=[1,"<select multiple='multiple'>","</select>"]);function Ue(t,n){var a;return typeof t.getElementsByTagName<"u"?a=t.getElementsByTagName(n||"*"):typeof t.querySelectorAll<"u"?a=t.querySelectorAll(n||"*"):a=[],n===void 0||n&&j(t,n)?i.merge([t],a):a}function nn(t,n){for(var a=0,u=t.length;a<u;a++)ee.set(t[a],"globalEval",!n||ee.get(n[a],"globalEval"))}var Ls=/<|&#?\w+;/;function ni(t,n,a,u,f){for(var h,g,w,v,A,O,k=n.createDocumentFragment(),B=[],$=0,oe=t.length;$<oe;$++)if(h=t[$],h||h===0)if(G(h)==="object")i.merge(B,h.nodeType?[h]:h);else if(!Ls.test(h))B.push(n.createTextNode(h));else{for(g=g||k.appendChild(n.createElement("div")),w=(ti.exec(h)||["",""])[1].toLowerCase(),v=Ve[w]||Ve._default,g.innerHTML=v[1]+i.htmlPrefilter(h)+v[2],O=v[0];O--;)g=g.lastChild;i.merge(B,g.childNodes),g=k.firstChild,g.textContent=""}for(k.textContent="",$=0;h=B[$++];){if(u&&i.inArray(h,u)>-1){f&&f.push(h);continue}if(A=jt(h),g=Ue(k.appendChild(h),"script"),A&&nn(g),a)for(O=0;h=g[O++];)ri.test(h.type||"")&&a.push(h)}return k}var ii=/^([^.]*)(?:\.(.+)|)/;function Vt(){return!0}function zt(){return!1}function sn(t,n,a,u,f,h){var g,w;if(typeof n=="object"){typeof a!="string"&&(u=u||a,a=void 0);for(w in n)sn(t,w,a,u,n[w],h);return t}if(u==null&&f==null?(f=a,u=a=void 0):f==null&&(typeof a=="string"?(f=u,u=void 0):(f=u,u=a,a=void 0)),f===!1)f=zt;else if(!f)return t;return h===1&&(g=f,f=function(v){return i().off(v),g.apply(this,arguments)},f.guid=g.guid||(g.guid=i.guid++)),t.each(function(){i.event.add(this,n,f,u,a)})}i.event={global:{},add:function(t,n,a,u,f){var h,g,w,v,A,O,k,B,$,oe,ye,fe=ee.get(t);if(sr(t))for(a.handler&&(h=a,a=h.handler,f=h.selector),f&&i.find.matchesSelector(Mt,f),a.guid||(a.guid=i.guid++),(v=fe.events)||(v=fe.events=Object.create(null)),(g=fe.handle)||(g=fe.handle=function(Ie){return typeof i<"u"&&i.event.triggered!==Ie.type?i.event.dispatch.apply(t,arguments):void 0}),n=(n||"").match(Be)||[""],A=n.length;A--;)w=ii.exec(n[A])||[],$=ye=w[1],oe=(w[2]||"").split(".").sort(),$&&(k=i.event.special[$]||{},$=(f?k.delegateType:k.bindType)||$,k=i.event.special[$]||{},O=i.extend({type:$,origType:ye,data:u,handler:a,guid:a.guid,selector:f,needsContext:f&&i.expr.match.needsContext.test(f),namespace:oe.join(".")},h),(B=v[$])||(B=v[$]=[],B.delegateCount=0,(!k.setup||k.setup.call(t,u,oe,g)===!1)&&t.addEventListener&&t.addEventListener($,g)),k.add&&(k.add.call(t,O),O.handler.guid||(O.handler.guid=a.guid)),f?B.splice(B.delegateCount++,0,O):B.push(O),i.event.global[$]=!0)},remove:function(t,n,a,u,f){var h,g,w,v,A,O,k,B,$,oe,ye,fe=ee.hasData(t)&&ee.get(t);if(!(!fe||!(v=fe.events))){for(n=(n||"").match(Be)||[""],A=n.length;A--;){if(w=ii.exec(n[A])||[],$=ye=w[1],oe=(w[2]||"").split(".").sort(),!$){for($ in v)i.event.remove(t,$+n[A],a,u,!0);continue}for(k=i.event.special[$]||{},$=(u?k.delegateType:k.bindType)||$,B=v[$]||[],w=w[2]&&new RegExp("(^|\\.)"+oe.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=h=B.length;h--;)O=B[h],(f||ye===O.origType)&&(!a||a.guid===O.guid)&&(!w||w.test(O.namespace))&&(!u||u===O.selector||u==="**"&&O.selector)&&(B.splice(h,1),O.selector&&B.delegateCount--,k.remove&&k.remove.call(t,O));g&&!B.length&&((!k.teardown||k.teardown.call(t,oe,fe.handle)===!1)&&i.removeEvent(t,$,fe.handle),delete v[$])}i.isEmptyObject(v)&&ee.remove(t,"handle events")}},dispatch:function(t){var n,a,u,f,h,g,w=new Array(arguments.length),v=i.event.fix(t),A=(ee.get(this,"events")||Object.create(null))[v.type]||[],O=i.event.special[v.type]||{};for(w[0]=v,n=1;n<arguments.length;n++)w[n]=arguments[n];if(v.delegateTarget=this,!(O.preDispatch&&O.preDispatch.call(this,v)===!1)){for(g=i.event.handlers.call(this,v,A),n=0;(f=g[n++])&&!v.isPropagationStopped();)for(v.currentTarget=f.elem,a=0;(h=f.handlers[a++])&&!v.isImmediatePropagationStopped();)(!v.rnamespace||h.namespace===!1||v.rnamespace.test(h.namespace))&&(v.handleObj=h,v.data=h.data,u=((i.event.special[h.origType]||{}).handle||h.handler).apply(f.elem,w),u!==void 0&&(v.result=u)===!1&&(v.preventDefault(),v.stopPropagation()));return O.postDispatch&&O.postDispatch.call(this,v),v.result}},handlers:function(t,n){var a,u,f,h,g,w=[],v=n.delegateCount,A=t.target;if(v&&A.nodeType&&!(t.type==="click"&&t.button>=1)){for(;A!==this;A=A.parentNode||this)if(A.nodeType===1&&!(t.type==="click"&&A.disabled===!0)){for(h=[],g={},a=0;a<v;a++)u=n[a],f=u.selector+" ",g[f]===void 0&&(g[f]=u.needsContext?i(f,this).index(A)>-1:i.find(f,this,null,[A]).length),g[f]&&h.push(u);h.length&&w.push({elem:A,handlers:h})}}return A=this,v<n.length&&w.push({elem:A,handlers:n.slice(v)}),w},addProp:function(t,n){Object.defineProperty(i.Event.prototype,t,{enumerable:!0,configurable:!0,get:M(n)?function(){if(this.originalEvent)return n(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(a){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:a})}})},fix:function(t){return t[i.expando]?t:new i.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var n=this||t;return lr.test(n.type)&&n.click&&j(n,"input")&&Nr(n,"click",!0),!1},trigger:function(t){var n=this||t;return lr.test(n.type)&&n.click&&j(n,"input")&&Nr(n,"click"),!0},_default:function(t){var n=t.target;return lr.test(n.type)&&n.click&&j(n,"input")&&ee.get(n,"click")||j(n,"a")}},beforeunload:{postDispatch:function(t){t.result!==void 0&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}};function Nr(t,n,a){if(!a){ee.get(t,n)===void 0&&i.event.add(t,n,Vt);return}ee.set(t,n,!1),i.event.add(t,n,{namespace:!1,handler:function(u){var f,h=ee.get(this,n);if(u.isTrigger&1&&this[n]){if(h)(i.event.special[n]||{}).delegateType&&u.stopPropagation();else if(h=c.call(arguments),ee.set(this,n,h),this[n](),f=ee.get(this,n),ee.set(this,n,!1),h!==f)return u.stopImmediatePropagation(),u.preventDefault(),f}else h&&(ee.set(this,n,i.event.trigger(h[0],h.slice(1),this)),u.stopPropagation(),u.isImmediatePropagationStopped=Vt)}})}i.removeEvent=function(t,n,a){t.removeEventListener&&t.removeEventListener(n,a)},i.Event=function(t,n){if(!(this instanceof i.Event))return new i.Event(t,n);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.defaultPrevented===void 0&&t.returnValue===!1?Vt:zt,this.target=t.target&&t.target.nodeType===3?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,n&&i.extend(this,n),this.timeStamp=t&&t.timeStamp||Date.now(),this[i.expando]=!0},i.Event.prototype={constructor:i.Event,isDefaultPrevented:zt,isPropagationStopped:zt,isImmediatePropagationStopped:zt,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Vt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Vt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Vt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},i.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},i.event.addProp),i.each({focus:"focusin",blur:"focusout"},function(t,n){function a(u){if(m.documentMode){var f=ee.get(this,"handle"),h=i.event.fix(u);h.type=u.type==="focusin"?"focus":"blur",h.isSimulated=!0,f(u),h.target===h.currentTarget&&f(h)}else i.event.simulate(n,u.target,i.event.fix(u))}i.event.special[t]={setup:function(){var u;if(Nr(this,t,!0),m.documentMode)u=ee.get(this,n),u||this.addEventListener(n,a),ee.set(this,n,(u||0)+1);else return!1},trigger:function(){return Nr(this,t),!0},teardown:function(){var u;if(m.documentMode)u=ee.get(this,n)-1,u?ee.set(this,n,u):(this.removeEventListener(n,a),ee.remove(this,n));else return!1},_default:function(u){return ee.get(u.target,t)},delegateType:n},i.event.special[n]={setup:function(){var u=this.ownerDocument||this.document||this,f=m.documentMode?this:u,h=ee.get(f,n);h||(m.documentMode?this.addEventListener(n,a):u.addEventListener(t,a,!0)),ee.set(f,n,(h||0)+1)},teardown:function(){var u=this.ownerDocument||this.document||this,f=m.documentMode?this:u,h=ee.get(f,n)-1;h?ee.set(f,n,h):(m.documentMode?this.removeEventListener(n,a):u.removeEventListener(t,a,!0),ee.remove(f,n))}}}),i.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,n){i.event.special[t]={delegateType:n,bindType:n,handle:function(a){var u,f=this,h=a.relatedTarget,g=a.handleObj;return(!h||h!==f&&!i.contains(f,h))&&(a.type=g.origType,u=g.handler.apply(this,arguments),a.type=n),u}}}),i.fn.extend({on:function(t,n,a,u){return sn(this,t,n,a,u)},one:function(t,n,a,u){return sn(this,t,n,a,u,1)},off:function(t,n,a){var u,f;if(t&&t.preventDefault&&t.handleObj)return u=t.handleObj,i(t.delegateTarget).off(u.namespace?u.origType+"."+u.namespace:u.origType,u.selector,u.handler),this;if(typeof t=="object"){for(f in t)this.off(f,n,t[f]);return this}return(n===!1||typeof n=="function")&&(a=n,n=void 0),a===!1&&(a=zt),this.each(function(){i.event.remove(this,t,a,n)})}});var Ds=/<script|<style|<link/i,Os=/checked\s*(?:[^=]|=\s*.checked.)/i,_s=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function si(t,n){return j(t,"table")&&j(n.nodeType!==11?n:n.firstChild,"tr")&&i(t).children("tbody")[0]||t}function Fs(t){return t.type=(t.getAttribute("type")!==null)+"/"+t.type,t}function Us(t){return(t.type||"").slice(0,5)==="true/"?t.type=t.type.slice(5):t.removeAttribute("type"),t}function oi(t,n){var a,u,f,h,g,w,v;if(n.nodeType===1){if(ee.hasData(t)&&(h=ee.get(t),v=h.events,v)){ee.remove(n,"handle events");for(f in v)for(a=0,u=v[f].length;a<u;a++)i.event.add(n,f,v[f][a])}Fe.hasData(t)&&(g=Fe.access(t),w=i.extend({},g),Fe.set(n,w))}}function ks(t,n){var a=n.nodeName.toLowerCase();a==="input"&&lr.test(t.type)?n.checked=t.checked:(a==="input"||a==="textarea")&&(n.defaultValue=t.defaultValue)}function $t(t,n,a,u){n=p(n);var f,h,g,w,v,A,O=0,k=t.length,B=k-1,$=n[0],oe=M($);if(oe||k>1&&typeof $=="string"&&!S.checkClone&&Os.test($))return t.each(function(ye){var fe=t.eq(ye);oe&&(n[0]=$.call(this,ye,fe.html())),$t(fe,n,a,u)});if(k&&(f=ni(n,t[0].ownerDocument,!1,t,u),h=f.firstChild,f.childNodes.length===1&&(f=h),h||u)){for(g=i.map(Ue(f,"script"),Fs),w=g.length;O<k;O++)v=f,O!==B&&(v=i.clone(v,!0,!0),w&&i.merge(g,Ue(v,"script"))),a.call(t[O],v,O);if(w)for(A=g[g.length-1].ownerDocument,i.map(g,Us),O=0;O<w;O++)v=g[O],ri.test(v.type||"")&&!ee.access(v,"globalEval")&&i.contains(A,v)&&(v.src&&(v.type||"").toLowerCase()!=="module"?i._evalUrl&&!v.noModule&&i._evalUrl(v.src,{nonce:v.nonce||v.getAttribute("nonce")},A):_(v.textContent.replace(_s,""),v,A))}return t}function ai(t,n,a){for(var u,f=n?i.filter(n,t):t,h=0;(u=f[h])!=null;h++)!a&&u.nodeType===1&&i.cleanData(Ue(u)),u.parentNode&&(a&&jt(u)&&nn(Ue(u,"script")),u.parentNode.removeChild(u));return t}i.extend({htmlPrefilter:function(t){return t},clone:function(t,n,a){var u,f,h,g,w=t.cloneNode(!0),v=jt(t);if(!S.noCloneChecked&&(t.nodeType===1||t.nodeType===11)&&!i.isXMLDoc(t))for(g=Ue(w),h=Ue(t),u=0,f=h.length;u<f;u++)ks(h[u],g[u]);if(n)if(a)for(h=h||Ue(t),g=g||Ue(w),u=0,f=h.length;u<f;u++)oi(h[u],g[u]);else oi(t,w);return g=Ue(w,"script"),g.length>0&&nn(g,!v&&Ue(t,"script")),w},cleanData:function(t){for(var n,a,u,f=i.event.special,h=0;(a=t[h])!==void 0;h++)if(sr(a)){if(n=a[ee.expando]){if(n.events)for(u in n.events)f[u]?i.event.remove(a,u):i.removeEvent(a,u,n.handle);a[ee.expando]=void 0}a[Fe.expando]&&(a[Fe.expando]=void 0)}}}),i.fn.extend({detach:function(t){return ai(this,t,!0)},remove:function(t){return ai(this,t)},text:function(t){return ut(this,function(n){return n===void 0?i.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=n)})},null,t,arguments.length)},append:function(){return $t(this,arguments,function(t){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var n=si(this,t);n.appendChild(t)}})},prepend:function(){return $t(this,arguments,function(t){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var n=si(this,t);n.insertBefore(t,n.firstChild)}})},before:function(){return $t(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return $t(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,n=0;(t=this[n])!=null;n++)t.nodeType===1&&(i.cleanData(Ue(t,!1)),t.textContent="");return this},clone:function(t,n){return t=t??!1,n=n??t,this.map(function(){return i.clone(this,t,n)})},html:function(t){return ut(this,function(n){var a=this[0]||{},u=0,f=this.length;if(n===void 0&&a.nodeType===1)return a.innerHTML;if(typeof n=="string"&&!Ds.test(n)&&!Ve[(ti.exec(n)||["",""])[1].toLowerCase()]){n=i.htmlPrefilter(n);try{for(;u<f;u++)a=this[u]||{},a.nodeType===1&&(i.cleanData(Ue(a,!1)),a.innerHTML=n);a=0}catch{}}a&&this.empty().append(n)},null,t,arguments.length)},replaceWith:function(){var t=[];return $t(this,arguments,function(n){var a=this.parentNode;i.inArray(this,t)<0&&(i.cleanData(Ue(this)),a&&a.replaceChild(n,this))},t)}}),i.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,n){i.fn[t]=function(a){for(var u,f=[],h=i(a),g=h.length-1,w=0;w<=g;w++)u=w===g?this:this.clone(!0),i(h[w])[n](u),d.apply(f,u.get());return this.pushStack(f)}});var on=new RegExp("^("+Zn+")(?!px)[a-z%]+$","i"),an=/^--/,Br=function(t){var n=t.ownerDocument.defaultView;return(!n||!n.opener)&&(n=e),n.getComputedStyle(t)},li=function(t,n,a){var u,f,h={};for(f in n)h[f]=t.style[f],t.style[f]=n[f];u=a.call(t);for(f in n)t.style[f]=h[f];return u},Gs=new RegExp(ft.join("|"),"i");(function(){function t(){if(A){v.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",A.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Mt.appendChild(v).appendChild(A);var O=e.getComputedStyle(A);a=O.top!=="1%",w=n(O.marginLeft)===12,A.style.right="60%",h=n(O.right)===36,u=n(O.width)===36,A.style.position="absolute",f=n(A.offsetWidth/3)===12,Mt.removeChild(v),A=null}}function n(O){return Math.round(parseFloat(O))}var a,u,f,h,g,w,v=m.createElement("div"),A=m.createElement("div");A.style&&(A.style.backgroundClip="content-box",A.cloneNode(!0).style.backgroundClip="",S.clearCloneStyle=A.style.backgroundClip==="content-box",i.extend(S,{boxSizingReliable:function(){return t(),u},pixelBoxStyles:function(){return t(),h},pixelPosition:function(){return t(),a},reliableMarginLeft:function(){return t(),w},scrollboxSize:function(){return t(),f},reliableTrDimensions:function(){var O,k,B,$;return g==null&&(O=m.createElement("table"),k=m.createElement("tr"),B=m.createElement("div"),O.style.cssText="position:absolute;left:-11111px;border-collapse:separate",k.style.cssText="box-sizing:content-box;border:1px solid",k.style.height="1px",B.style.height="9px",B.style.display="block",Mt.appendChild(O).appendChild(k).appendChild(B),$=e.getComputedStyle(k),g=parseInt($.height,10)+parseInt($.borderTopWidth,10)+parseInt($.borderBottomWidth,10)===k.offsetHeight,Mt.removeChild(O)),g}}))})();function cr(t,n,a){var u,f,h,g,w=an.test(n),v=t.style;return a=a||Br(t),a&&(g=a.getPropertyValue(n)||a[n],w&&g&&(g=g.replace(ie,"$1")||void 0),g===""&&!jt(t)&&(g=i.style(t,n)),!S.pixelBoxStyles()&&on.test(g)&&Gs.test(n)&&(u=v.width,f=v.minWidth,h=v.maxWidth,v.minWidth=v.maxWidth=v.width=g,g=a.width,v.width=u,v.minWidth=f,v.maxWidth=h)),g!==void 0?g+"":g}function ci(t,n){return{get:function(){if(t()){delete this.get;return}return(this.get=n).apply(this,arguments)}}}var ui=["Webkit","Moz","ms"],fi=m.createElement("div").style,hi={};function js(t){for(var n=t[0].toUpperCase()+t.slice(1),a=ui.length;a--;)if(t=ui[a]+n,t in fi)return t}function ln(t){var n=i.cssProps[t]||hi[t];return n||(t in fi?t:hi[t]=js(t)||t)}var Hs=/^(none|table(?!-c[ea]).+)/,Vs={position:"absolute",visibility:"hidden",display:"block"},di={letterSpacing:"0",fontWeight:"400"};function pi(t,n,a){var u=ar.exec(n);return u?Math.max(0,u[2]-(a||0))+(u[3]||"px"):n}function cn(t,n,a,u,f,h){var g=n==="width"?1:0,w=0,v=0,A=0;if(a===(u?"border":"content"))return 0;for(;g<4;g+=2)a==="margin"&&(A+=i.css(t,a+ft[g],!0,f)),u?(a==="content"&&(v-=i.css(t,"padding"+ft[g],!0,f)),a!=="margin"&&(v-=i.css(t,"border"+ft[g]+"Width",!0,f))):(v+=i.css(t,"padding"+ft[g],!0,f),a!=="padding"?v+=i.css(t,"border"+ft[g]+"Width",!0,f):w+=i.css(t,"border"+ft[g]+"Width",!0,f));return!u&&h>=0&&(v+=Math.max(0,Math.ceil(t["offset"+n[0].toUpperCase()+n.slice(1)]-h-v-w-.5))||0),v+A}function gi(t,n,a){var u=Br(t),f=!S.boxSizingReliable()||a,h=f&&i.css(t,"boxSizing",!1,u)==="border-box",g=h,w=cr(t,n,u),v="offset"+n[0].toUpperCase()+n.slice(1);if(on.test(w)){if(!a)return w;w="auto"}return(!S.boxSizingReliable()&&h||!S.reliableTrDimensions()&&j(t,"tr")||w==="auto"||!parseFloat(w)&&i.css(t,"display",!1,u)==="inline")&&t.getClientRects().length&&(h=i.css(t,"boxSizing",!1,u)==="border-box",g=v in t,g&&(w=t[v])),w=parseFloat(w)||0,w+cn(t,n,a||(h?"border":"content"),g,u,w)+"px"}i.extend({cssHooks:{opacity:{get:function(t,n){if(n){var a=cr(t,"opacity");return a===""?"1":a}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(t,n,a,u){if(!(!t||t.nodeType===3||t.nodeType===8||!t.style)){var f,h,g,w=Qe(n),v=an.test(n),A=t.style;if(v||(n=ln(w)),g=i.cssHooks[n]||i.cssHooks[w],a!==void 0){if(h=typeof a,h==="string"&&(f=ar.exec(a))&&f[1]&&(a=Qn(t,n,f),h="number"),a==null||a!==a)return;h==="number"&&!v&&(a+=f&&f[3]||(i.cssNumber[w]?"":"px")),!S.clearCloneStyle&&a===""&&n.indexOf("background")===0&&(A[n]="inherit"),(!g||!("set"in g)||(a=g.set(t,a,u))!==void 0)&&(v?A.setProperty(n,a):A[n]=a)}else return g&&"get"in g&&(f=g.get(t,!1,u))!==void 0?f:A[n]}},css:function(t,n,a,u){var f,h,g,w=Qe(n),v=an.test(n);return v||(n=ln(w)),g=i.cssHooks[n]||i.cssHooks[w],g&&"get"in g&&(f=g.get(t,!0,a)),f===void 0&&(f=cr(t,n,u)),f==="normal"&&n in di&&(f=di[n]),a===""||a?(h=parseFloat(f),a===!0||isFinite(h)?h||0:f):f}}),i.each(["height","width"],function(t,n){i.cssHooks[n]={get:function(a,u,f){if(u)return Hs.test(i.css(a,"display"))&&(!a.getClientRects().length||!a.getBoundingClientRect().width)?li(a,Vs,function(){return gi(a,n,f)}):gi(a,n,f)},set:function(a,u,f){var h,g=Br(a),w=!S.scrollboxSize()&&g.position==="absolute",v=w||f,A=v&&i.css(a,"boxSizing",!1,g)==="border-box",O=f?cn(a,n,f,A,g):0;return A&&w&&(O-=Math.ceil(a["offset"+n[0].toUpperCase()+n.slice(1)]-parseFloat(g[n])-cn(a,n,"border",!1,g)-.5)),O&&(h=ar.exec(u))&&(h[3]||"px")!=="px"&&(a.style[n]=u,u=i.css(a,n)),pi(a,u,O)}}}),i.cssHooks.marginLeft=ci(S.reliableMarginLeft,function(t,n){if(n)return(parseFloat(cr(t,"marginLeft"))||t.getBoundingClientRect().left-li(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),i.each({margin:"",padding:"",border:"Width"},function(t,n){i.cssHooks[t+n]={expand:function(a){for(var u=0,f={},h=typeof a=="string"?a.split(" "):[a];u<4;u++)f[t+ft[u]+n]=h[u]||h[u-2]||h[0];return f}},t!=="margin"&&(i.cssHooks[t+n].set=pi)}),i.fn.extend({css:function(t,n){return ut(this,function(a,u,f){var h,g,w={},v=0;if(Array.isArray(u)){for(h=Br(a),g=u.length;v<g;v++)w[u[v]]=i.css(a,u[v],!1,h);return w}return f!==void 0?i.style(a,u,f):i.css(a,u)},t,n,arguments.length>1)}});function ke(t,n,a,u,f){return new ke.prototype.init(t,n,a,u,f)}i.Tween=ke,ke.prototype={constructor:ke,init:function(t,n,a,u,f,h){this.elem=t,this.prop=a,this.easing=f||i.easing._default,this.options=n,this.start=this.now=this.cur(),this.end=u,this.unit=h||(i.cssNumber[a]?"":"px")},cur:function(){var t=ke.propHooks[this.prop];return t&&t.get?t.get(this):ke.propHooks._default.get(this)},run:function(t){var n,a=ke.propHooks[this.prop];return this.options.duration?this.pos=n=i.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=n=t,this.now=(this.end-this.start)*n+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),a&&a.set?a.set(this):ke.propHooks._default.set(this),this}},ke.prototype.init.prototype=ke.prototype,ke.propHooks={_default:{get:function(t){var n;return t.elem.nodeType!==1||t.elem[t.prop]!=null&&t.elem.style[t.prop]==null?t.elem[t.prop]:(n=i.css(t.elem,t.prop,""),!n||n==="auto"?0:n)},set:function(t){i.fx.step[t.prop]?i.fx.step[t.prop](t):t.elem.nodeType===1&&(i.cssHooks[t.prop]||t.elem.style[ln(t.prop)]!=null)?i.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},ke.propHooks.scrollTop=ke.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},i.easing={linear:function(t){return t},swing:function(t){return .5-Math.cos(t*Math.PI)/2},_default:"swing"},i.fx=ke.prototype.init,i.fx.step={};var qt,Pr,zs=/^(?:toggle|show|hide)$/,$s=/queueHooks$/;function un(){Pr&&(m.hidden===!1&&e.requestAnimationFrame?e.requestAnimationFrame(un):e.setTimeout(un,i.fx.interval),i.fx.tick())}function yi(){return e.setTimeout(function(){qt=void 0}),qt=Date.now()}function Lr(t,n){var a,u=0,f={height:t};for(n=n?1:0;u<4;u+=2-n)a=ft[u],f["margin"+a]=f["padding"+a]=t;return n&&(f.opacity=f.width=t),f}function mi(t,n,a){for(var u,f=(We.tweeners[n]||[]).concat(We.tweeners["*"]),h=0,g=f.length;h<g;h++)if(u=f[h].call(a,n,t))return u}function qs(t,n,a){var u,f,h,g,w,v,A,O,k="width"in n||"height"in n,B=this,$={},oe=t.style,ye=t.nodeType&&Mr(t),fe=ee.get(t,"fxshow");a.queue||(g=i._queueHooks(t,"fx"),g.unqueued==null&&(g.unqueued=0,w=g.empty.fire,g.empty.fire=function(){g.unqueued||w()}),g.unqueued++,B.always(function(){B.always(function(){g.unqueued--,i.queue(t,"fx").length||g.empty.fire()})}));for(u in n)if(f=n[u],zs.test(f)){if(delete n[u],h=h||f==="toggle",f===(ye?"hide":"show"))if(f==="show"&&fe&&fe[u]!==void 0)ye=!0;else continue;$[u]=fe&&fe[u]||i.style(t,u)}if(v=!i.isEmptyObject(n),!(!v&&i.isEmptyObject($))){k&&t.nodeType===1&&(a.overflow=[oe.overflow,oe.overflowX,oe.overflowY],A=fe&&fe.display,A==null&&(A=ee.get(t,"display")),O=i.css(t,"display"),O==="none"&&(A?O=A:(Ht([t],!0),A=t.style.display||A,O=i.css(t,"display"),Ht([t]))),(O==="inline"||O==="inline-block"&&A!=null)&&i.css(t,"float")==="none"&&(v||(B.done(function(){oe.display=A}),A==null&&(O=oe.display,A=O==="none"?"":O)),oe.display="inline-block")),a.overflow&&(oe.overflow="hidden",B.always(function(){oe.overflow=a.overflow[0],oe.overflowX=a.overflow[1],oe.overflowY=a.overflow[2]})),v=!1;for(u in $)v||(fe?"hidden"in fe&&(ye=fe.hidden):fe=ee.access(t,"fxshow",{display:A}),h&&(fe.hidden=!ye),ye&&Ht([t],!0),B.done(function(){ye||Ht([t]),ee.remove(t,"fxshow");for(u in $)i.style(t,u,$[u])})),v=mi(ye?fe[u]:0,u,B),u in fe||(fe[u]=v.start,ye&&(v.end=v.start,v.start=0))}}function Ys(t,n){var a,u,f,h,g;for(a in t)if(u=Qe(a),f=n[u],h=t[a],Array.isArray(h)&&(f=h[1],h=t[a]=h[0]),a!==u&&(t[u]=h,delete t[a]),g=i.cssHooks[u],g&&"expand"in g){h=g.expand(h),delete t[u];for(a in h)a in t||(t[a]=h[a],n[a]=f)}else n[u]=f}function We(t,n,a){var u,f,h=0,g=We.prefilters.length,w=i.Deferred().always(function(){delete v.elem}),v=function(){if(f)return!1;for(var k=qt||yi(),B=Math.max(0,A.startTime+A.duration-k),$=B/A.duration||0,oe=1-$,ye=0,fe=A.tweens.length;ye<fe;ye++)A.tweens[ye].run(oe);return w.notifyWith(t,[A,oe,B]),oe<1&&fe?B:(fe||w.notifyWith(t,[A,1,0]),w.resolveWith(t,[A]),!1)},A=w.promise({elem:t,props:i.extend({},n),opts:i.extend(!0,{specialEasing:{},easing:i.easing._default},a),originalProperties:n,originalOptions:a,startTime:qt||yi(),duration:a.duration,tweens:[],createTween:function(k,B){var $=i.Tween(t,A.opts,k,B,A.opts.specialEasing[k]||A.opts.easing);return A.tweens.push($),$},stop:function(k){var B=0,$=k?A.tweens.length:0;if(f)return this;for(f=!0;B<$;B++)A.tweens[B].run(1);return k?(w.notifyWith(t,[A,1,0]),w.resolveWith(t,[A,k])):w.rejectWith(t,[A,k]),this}}),O=A.props;for(Ys(O,A.opts.specialEasing);h<g;h++)if(u=We.prefilters[h].call(A,t,O,A.opts),u)return M(u.stop)&&(i._queueHooks(A.elem,A.opts.queue).stop=u.stop.bind(u)),u;return i.map(O,mi,A),M(A.opts.start)&&A.opts.start.call(t,A),A.progress(A.opts.progress).done(A.opts.done,A.opts.complete).fail(A.opts.fail).always(A.opts.always),i.fx.timer(i.extend(v,{elem:t,anim:A,queue:A.opts.queue})),A}i.Animation=i.extend(We,{tweeners:{"*":[function(t,n){var a=this.createTween(t,n);return Qn(a.elem,t,ar.exec(n),a),a}]},tweener:function(t,n){M(t)?(n=t,t=["*"]):t=t.match(Be);for(var a,u=0,f=t.length;u<f;u++)a=t[u],We.tweeners[a]=We.tweeners[a]||[],We.tweeners[a].unshift(n)},prefilters:[qs],prefilter:function(t,n){n?We.prefilters.unshift(t):We.prefilters.push(t)}}),i.speed=function(t,n,a){var u=t&&typeof t=="object"?i.extend({},t):{complete:a||!a&&n||M(t)&&t,duration:t,easing:a&&n||n&&!M(n)&&n};return i.fx.off?u.duration=0:typeof u.duration!="number"&&(u.duration in i.fx.speeds?u.duration=i.fx.speeds[u.duration]:u.duration=i.fx.speeds._default),(u.queue==null||u.queue===!0)&&(u.queue="fx"),u.old=u.complete,u.complete=function(){M(u.old)&&u.old.call(this),u.queue&&i.dequeue(this,u.queue)},u},i.fn.extend({fadeTo:function(t,n,a,u){return this.filter(Mr).css("opacity",0).show().end().animate({opacity:n},t,a,u)},animate:function(t,n,a,u){var f=i.isEmptyObject(t),h=i.speed(n,a,u),g=function(){var w=We(this,i.extend({},t),h);(f||ee.get(this,"finish"))&&w.stop(!0)};return g.finish=g,f||h.queue===!1?this.each(g):this.queue(h.queue,g)},stop:function(t,n,a){var u=function(f){var h=f.stop;delete f.stop,h(a)};return typeof t!="string"&&(a=n,n=t,t=void 0),n&&this.queue(t||"fx",[]),this.each(function(){var f=!0,h=t!=null&&t+"queueHooks",g=i.timers,w=ee.get(this);if(h)w[h]&&w[h].stop&&u(w[h]);else for(h in w)w[h]&&w[h].stop&&$s.test(h)&&u(w[h]);for(h=g.length;h--;)g[h].elem===this&&(t==null||g[h].queue===t)&&(g[h].anim.stop(a),f=!1,g.splice(h,1));(f||!a)&&i.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var n,a=ee.get(this),u=a[t+"queue"],f=a[t+"queueHooks"],h=i.timers,g=u?u.length:0;for(a.finish=!0,i.queue(this,t,[]),f&&f.stop&&f.stop.call(this,!0),n=h.length;n--;)h[n].elem===this&&h[n].queue===t&&(h[n].anim.stop(!0),h.splice(n,1));for(n=0;n<g;n++)u[n]&&u[n].finish&&u[n].finish.call(this);delete a.finish})}}),i.each(["toggle","show","hide"],function(t,n){var a=i.fn[n];i.fn[n]=function(u,f,h){return u==null||typeof u=="boolean"?a.apply(this,arguments):this.animate(Lr(n,!0),u,f,h)}}),i.each({slideDown:Lr("show"),slideUp:Lr("hide"),slideToggle:Lr("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,n){i.fn[t]=function(a,u,f){return this.animate(n,a,u,f)}}),i.timers=[],i.fx.tick=function(){var t,n=0,a=i.timers;for(qt=Date.now();n<a.length;n++)t=a[n],!t()&&a[n]===t&&a.splice(n--,1);a.length||i.fx.stop(),qt=void 0},i.fx.timer=function(t){i.timers.push(t),i.fx.start()},i.fx.interval=13,i.fx.start=function(){Pr||(Pr=!0,un())},i.fx.stop=function(){Pr=null},i.fx.speeds={slow:600,fast:200,_default:400},i.fn.delay=function(t,n){return t=i.fx&&i.fx.speeds[t]||t,n=n||"fx",this.queue(n,function(a,u){var f=e.setTimeout(a,t);u.stop=function(){e.clearTimeout(f)}})},function(){var t=m.createElement("input"),n=m.createElement("select"),a=n.appendChild(m.createElement("option"));t.type="checkbox",S.checkOn=t.value!=="",S.optSelected=a.selected,t=m.createElement("input"),t.value="t",t.type="radio",S.radioValue=t.value==="t"}();var xi,ur=i.expr.attrHandle;i.fn.extend({attr:function(t,n){return ut(this,i.attr,t,n,arguments.length>1)},removeAttr:function(t){return this.each(function(){i.removeAttr(this,t)})}}),i.extend({attr:function(t,n,a){var u,f,h=t.nodeType;if(!(h===3||h===8||h===2)){if(typeof t.getAttribute>"u")return i.prop(t,n,a);if((h!==1||!i.isXMLDoc(t))&&(f=i.attrHooks[n.toLowerCase()]||(i.expr.match.bool.test(n)?xi:void 0)),a!==void 0){if(a===null){i.removeAttr(t,n);return}return f&&"set"in f&&(u=f.set(t,a,n))!==void 0?u:(t.setAttribute(n,a+""),a)}return f&&"get"in f&&(u=f.get(t,n))!==null?u:(u=i.find.attr(t,n),u??void 0)}},attrHooks:{type:{set:function(t,n){if(!S.radioValue&&n==="radio"&&j(t,"input")){var a=t.value;return t.setAttribute("type",n),a&&(t.value=a),n}}}},removeAttr:function(t,n){var a,u=0,f=n&&n.match(Be);if(f&&t.nodeType===1)for(;a=f[u++];)t.removeAttribute(a)}}),xi={set:function(t,n,a){return n===!1?i.removeAttr(t,a):t.setAttribute(a,a),a}},i.each(i.expr.match.bool.source.match(/\w+/g),function(t,n){var a=ur[n]||i.find.attr;ur[n]=function(u,f,h){var g,w,v=f.toLowerCase();return h||(w=ur[v],ur[v]=g,g=a(u,f,h)!=null?v:null,ur[v]=w),g}});var Ws=/^(?:input|select|textarea|button)$/i,Ks=/^(?:a|area)$/i;i.fn.extend({prop:function(t,n){return ut(this,i.prop,t,n,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[i.propFix[t]||t]})}}),i.extend({prop:function(t,n,a){var u,f,h=t.nodeType;if(!(h===3||h===8||h===2))return(h!==1||!i.isXMLDoc(t))&&(n=i.propFix[n]||n,f=i.propHooks[n]),a!==void 0?f&&"set"in f&&(u=f.set(t,a,n))!==void 0?u:t[n]=a:f&&"get"in f&&(u=f.get(t,n))!==null?u:t[n]},propHooks:{tabIndex:{get:function(t){var n=i.find.attr(t,"tabindex");return n?parseInt(n,10):Ws.test(t.nodeName)||Ks.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),S.optSelected||(i.propHooks.selected={get:function(t){var n=t.parentNode;return n&&n.parentNode&&n.parentNode.selectedIndex,null},set:function(t){var n=t.parentNode;n&&(n.selectedIndex,n.parentNode&&n.parentNode.selectedIndex)}}),i.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){i.propFix[this.toLowerCase()]=this});function Nt(t){var n=t.match(Be)||[];return n.join(" ")}function Bt(t){return t.getAttribute&&t.getAttribute("class")||""}function fn(t){return Array.isArray(t)?t:typeof t=="string"?t.match(Be)||[]:[]}i.fn.extend({addClass:function(t){var n,a,u,f,h,g;return M(t)?this.each(function(w){i(this).addClass(t.call(this,w,Bt(this)))}):(n=fn(t),n.length?this.each(function(){if(u=Bt(this),a=this.nodeType===1&&" "+Nt(u)+" ",a){for(h=0;h<n.length;h++)f=n[h],a.indexOf(" "+f+" ")<0&&(a+=f+" ");g=Nt(a),u!==g&&this.setAttribute("class",g)}}):this)},removeClass:function(t){var n,a,u,f,h,g;return M(t)?this.each(function(w){i(this).removeClass(t.call(this,w,Bt(this)))}):arguments.length?(n=fn(t),n.length?this.each(function(){if(u=Bt(this),a=this.nodeType===1&&" "+Nt(u)+" ",a){for(h=0;h<n.length;h++)for(f=n[h];a.indexOf(" "+f+" ")>-1;)a=a.replace(" "+f+" "," ");g=Nt(a),u!==g&&this.setAttribute("class",g)}}):this):this.attr("class","")},toggleClass:function(t,n){var a,u,f,h,g=typeof t,w=g==="string"||Array.isArray(t);return M(t)?this.each(function(v){i(this).toggleClass(t.call(this,v,Bt(this),n),n)}):typeof n=="boolean"&&w?n?this.addClass(t):this.removeClass(t):(a=fn(t),this.each(function(){if(w)for(h=i(this),f=0;f<a.length;f++)u=a[f],h.hasClass(u)?h.removeClass(u):h.addClass(u);else(t===void 0||g==="boolean")&&(u=Bt(this),u&&ee.set(this,"__className__",u),this.setAttribute&&this.setAttribute("class",u||t===!1?"":ee.get(this,"__className__")||""))}))},hasClass:function(t){var n,a,u=0;for(n=" "+t+" ";a=this[u++];)if(a.nodeType===1&&(" "+Nt(Bt(a))+" ").indexOf(n)>-1)return!0;return!1}});var Xs=/\r/g;i.fn.extend({val:function(t){var n,a,u,f=this[0];return arguments.length?(u=M(t),this.each(function(h){var g;this.nodeType===1&&(u?g=t.call(this,h,i(this).val()):g=t,g==null?g="":typeof g=="number"?g+="":Array.isArray(g)&&(g=i.map(g,function(w){return w==null?"":w+""})),n=i.valHooks[this.type]||i.valHooks[this.nodeName.toLowerCase()],(!n||!("set"in n)||n.set(this,g,"value")===void 0)&&(this.value=g))})):f?(n=i.valHooks[f.type]||i.valHooks[f.nodeName.toLowerCase()],n&&"get"in n&&(a=n.get(f,"value"))!==void 0?a:(a=f.value,typeof a=="string"?a.replace(Xs,""):a??"")):void 0}}),i.extend({valHooks:{option:{get:function(t){var n=i.find.attr(t,"value");return n??Nt(i.text(t))}},select:{get:function(t){var n,a,u,f=t.options,h=t.selectedIndex,g=t.type==="select-one",w=g?null:[],v=g?h+1:f.length;for(h<0?u=v:u=g?h:0;u<v;u++)if(a=f[u],(a.selected||u===h)&&!a.disabled&&(!a.parentNode.disabled||!j(a.parentNode,"optgroup"))){if(n=i(a).val(),g)return n;w.push(n)}return w},set:function(t,n){for(var a,u,f=t.options,h=i.makeArray(n),g=f.length;g--;)u=f[g],(u.selected=i.inArray(i.valHooks.option.get(u),h)>-1)&&(a=!0);return a||(t.selectedIndex=-1),h}}}}),i.each(["radio","checkbox"],function(){i.valHooks[this]={set:function(t,n){if(Array.isArray(n))return t.checked=i.inArray(i(t).val(),n)>-1}},S.checkOn||(i.valHooks[this].get=function(t){return t.getAttribute("value")===null?"on":t.value})});var fr=e.location,Ti={guid:Date.now()},hn=/\?/;i.parseXML=function(t){var n,a;if(!t||typeof t!="string")return null;try{n=new e.DOMParser().parseFromString(t,"text/xml")}catch{}return a=n&&n.getElementsByTagName("parsererror")[0],(!n||a)&&i.error("Invalid XML: "+(a?i.map(a.childNodes,function(u){return u.textContent}).join(`
`):t)),n};var vi=/^(?:focusinfocus|focusoutblur)$/,wi=function(t){t.stopPropagation()};i.extend(i.event,{trigger:function(t,n,a,u){var f,h,g,w,v,A,O,k,B=[a||m],$=C.call(t,"type")?t.type:t,oe=C.call(t,"namespace")?t.namespace.split("."):[];if(h=k=g=a=a||m,!(a.nodeType===3||a.nodeType===8)&&!vi.test($+i.event.triggered)&&($.indexOf(".")>-1&&(oe=$.split("."),$=oe.shift(),oe.sort()),v=$.indexOf(":")<0&&"on"+$,t=t[i.expando]?t:new i.Event($,typeof t=="object"&&t),t.isTrigger=u?2:3,t.namespace=oe.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+oe.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=a),n=n==null?[t]:i.makeArray(n,[t]),O=i.event.special[$]||{},!(!u&&O.trigger&&O.trigger.apply(a,n)===!1))){if(!u&&!O.noBubble&&!P(a)){for(w=O.delegateType||$,vi.test(w+$)||(h=h.parentNode);h;h=h.parentNode)B.push(h),g=h;g===(a.ownerDocument||m)&&B.push(g.defaultView||g.parentWindow||e)}for(f=0;(h=B[f++])&&!t.isPropagationStopped();)k=h,t.type=f>1?w:O.bindType||$,A=(ee.get(h,"events")||Object.create(null))[t.type]&&ee.get(h,"handle"),A&&A.apply(h,n),A=v&&h[v],A&&A.apply&&sr(h)&&(t.result=A.apply(h,n),t.result===!1&&t.preventDefault());return t.type=$,!u&&!t.isDefaultPrevented()&&(!O._default||O._default.apply(B.pop(),n)===!1)&&sr(a)&&v&&M(a[$])&&!P(a)&&(g=a[v],g&&(a[v]=null),i.event.triggered=$,t.isPropagationStopped()&&k.addEventListener($,wi),a[$](),t.isPropagationStopped()&&k.removeEventListener($,wi),i.event.triggered=void 0,g&&(a[v]=g)),t.result}},simulate:function(t,n,a){var u=i.extend(new i.Event,a,{type:t,isSimulated:!0});i.event.trigger(u,null,n)}}),i.fn.extend({trigger:function(t,n){return this.each(function(){i.event.trigger(t,n,this)})},triggerHandler:function(t,n){var a=this[0];if(a)return i.event.trigger(t,n,a,!0)}});var Js=/\[\]$/,bi=/\r?\n/g,Zs=/^(?:submit|button|image|reset|file)$/i,Qs=/^(?:input|select|textarea|keygen)/i;function dn(t,n,a,u){var f;if(Array.isArray(n))i.each(n,function(h,g){a||Js.test(t)?u(t,g):dn(t+"["+(typeof g=="object"&&g!=null?h:"")+"]",g,a,u)});else if(!a&&G(n)==="object")for(f in n)dn(t+"["+f+"]",n[f],a,u);else u(t,n)}i.param=function(t,n){var a,u=[],f=function(h,g){var w=M(g)?g():g;u[u.length]=encodeURIComponent(h)+"="+encodeURIComponent(w??"")};if(t==null)return"";if(Array.isArray(t)||t.jquery&&!i.isPlainObject(t))i.each(t,function(){f(this.name,this.value)});else for(a in t)dn(a,t[a],n,f);return u.join("&")},i.fn.extend({serialize:function(){return i.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=i.prop(this,"elements");return t?i.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!i(this).is(":disabled")&&Qs.test(this.nodeName)&&!Zs.test(t)&&(this.checked||!lr.test(t))}).map(function(t,n){var a=i(this).val();return a==null?null:Array.isArray(a)?i.map(a,function(u){return{name:n.name,value:u.replace(bi,`\r
`)}}):{name:n.name,value:a.replace(bi,`\r
`)}}).get()}});var eo=/%20/g,to=/#.*$/,ro=/([?&])_=[^&]*/,no=/^(.*?):[ \t]*([^\r\n]*)$/mg,io=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,so=/^(?:GET|HEAD)$/,oo=/^\/\//,Ei={},pn={},Si="*/".concat("*"),gn=m.createElement("a");gn.href=fr.href;function Ai(t){return function(n,a){typeof n!="string"&&(a=n,n="*");var u,f=0,h=n.toLowerCase().match(Be)||[];if(M(a))for(;u=h[f++];)u[0]==="+"?(u=u.slice(1)||"*",(t[u]=t[u]||[]).unshift(a)):(t[u]=t[u]||[]).push(a)}}function Ci(t,n,a,u){var f={},h=t===pn;function g(w){var v;return f[w]=!0,i.each(t[w]||[],function(A,O){var k=O(n,a,u);if(typeof k=="string"&&!h&&!f[k])return n.dataTypes.unshift(k),g(k),!1;if(h)return!(v=k)}),v}return g(n.dataTypes[0])||!f["*"]&&g("*")}function yn(t,n){var a,u,f=i.ajaxSettings.flatOptions||{};for(a in n)n[a]!==void 0&&((f[a]?t:u||(u={}))[a]=n[a]);return u&&i.extend(!0,t,u),t}function ao(t,n,a){for(var u,f,h,g,w=t.contents,v=t.dataTypes;v[0]==="*";)v.shift(),u===void 0&&(u=t.mimeType||n.getResponseHeader("Content-Type"));if(u){for(f in w)if(w[f]&&w[f].test(u)){v.unshift(f);break}}if(v[0]in a)h=v[0];else{for(f in a){if(!v[0]||t.converters[f+" "+v[0]]){h=f;break}g||(g=f)}h=h||g}if(h)return h!==v[0]&&v.unshift(h),a[h]}function lo(t,n,a,u){var f,h,g,w,v,A={},O=t.dataTypes.slice();if(O[1])for(g in t.converters)A[g.toLowerCase()]=t.converters[g];for(h=O.shift();h;)if(t.responseFields[h]&&(a[t.responseFields[h]]=n),!v&&u&&t.dataFilter&&(n=t.dataFilter(n,t.dataType)),v=h,h=O.shift(),h){if(h==="*")h=v;else if(v!=="*"&&v!==h){if(g=A[v+" "+h]||A["* "+h],!g){for(f in A)if(w=f.split(" "),w[1]===h&&(g=A[v+" "+w[0]]||A["* "+w[0]],g)){g===!0?g=A[f]:A[f]!==!0&&(h=w[0],O.unshift(w[1]));break}}if(g!==!0)if(g&&t.throws)n=g(n);else try{n=g(n)}catch(k){return{state:"parsererror",error:g?k:"No conversion from "+v+" to "+h}}}}return{state:"success",data:n}}i.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fr.href,type:"GET",isLocal:io.test(fr.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Si,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":i.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,n){return n?yn(yn(t,i.ajaxSettings),n):yn(i.ajaxSettings,t)},ajaxPrefilter:Ai(Ei),ajaxTransport:Ai(pn),ajax:function(t,n){typeof t=="object"&&(n=t,t=void 0),n=n||{};var a,u,f,h,g,w,v,A,O,k,B=i.ajaxSetup({},n),$=B.context||B,oe=B.context&&($.nodeType||$.jquery)?i($):i.event,ye=i.Deferred(),fe=i.Callbacks("once memory"),Ie=B.statusCode||{},Re={},et={},tt="canceled",pe={readyState:0,getResponseHeader:function(me){var Ae;if(v){if(!h)for(h={};Ae=no.exec(f);)h[Ae[1].toLowerCase()+" "]=(h[Ae[1].toLowerCase()+" "]||[]).concat(Ae[2]);Ae=h[me.toLowerCase()+" "]}return Ae==null?null:Ae.join(", ")},getAllResponseHeaders:function(){return v?f:null},setRequestHeader:function(me,Ae){return v==null&&(me=et[me.toLowerCase()]=et[me.toLowerCase()]||me,Re[me]=Ae),this},overrideMimeType:function(me){return v==null&&(B.mimeType=me),this},statusCode:function(me){var Ae;if(me)if(v)pe.always(me[pe.status]);else for(Ae in me)Ie[Ae]=[Ie[Ae],me[Ae]];return this},abort:function(me){var Ae=me||tt;return a&&a.abort(Ae),Pt(0,Ae),this}};if(ye.promise(pe),B.url=((t||B.url||fr.href)+"").replace(oo,fr.protocol+"//"),B.type=n.method||n.type||B.method||B.type,B.dataTypes=(B.dataType||"*").toLowerCase().match(Be)||[""],B.crossDomain==null){w=m.createElement("a");try{w.href=B.url,w.href=w.href,B.crossDomain=gn.protocol+"//"+gn.host!=w.protocol+"//"+w.host}catch{B.crossDomain=!0}}if(B.data&&B.processData&&typeof B.data!="string"&&(B.data=i.param(B.data,B.traditional)),Ci(Ei,B,n,pe),v)return pe;A=i.event&&B.global,A&&i.active++===0&&i.event.trigger("ajaxStart"),B.type=B.type.toUpperCase(),B.hasContent=!so.test(B.type),u=B.url.replace(to,""),B.hasContent?B.data&&B.processData&&(B.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(B.data=B.data.replace(eo,"+")):(k=B.url.slice(u.length),B.data&&(B.processData||typeof B.data=="string")&&(u+=(hn.test(u)?"&":"?")+B.data,delete B.data),B.cache===!1&&(u=u.replace(ro,"$1"),k=(hn.test(u)?"&":"?")+"_="+Ti.guid+++k),B.url=u+k),B.ifModified&&(i.lastModified[u]&&pe.setRequestHeader("If-Modified-Since",i.lastModified[u]),i.etag[u]&&pe.setRequestHeader("If-None-Match",i.etag[u])),(B.data&&B.hasContent&&B.contentType!==!1||n.contentType)&&pe.setRequestHeader("Content-Type",B.contentType),pe.setRequestHeader("Accept",B.dataTypes[0]&&B.accepts[B.dataTypes[0]]?B.accepts[B.dataTypes[0]]+(B.dataTypes[0]!=="*"?", "+Si+"; q=0.01":""):B.accepts["*"]);for(O in B.headers)pe.setRequestHeader(O,B.headers[O]);if(B.beforeSend&&(B.beforeSend.call($,pe,B)===!1||v))return pe.abort();if(tt="abort",fe.add(B.complete),pe.done(B.success),pe.fail(B.error),a=Ci(pn,B,n,pe),!a)Pt(-1,"No Transport");else{if(pe.readyState=1,A&&oe.trigger("ajaxSend",[pe,B]),v)return pe;B.async&&B.timeout>0&&(g=e.setTimeout(function(){pe.abort("timeout")},B.timeout));try{v=!1,a.send(Re,Pt)}catch(me){if(v)throw me;Pt(-1,me)}}function Pt(me,Ae,dr,xn){var rt,pr,nt,xt,Tt,ze=Ae;v||(v=!0,g&&e.clearTimeout(g),a=void 0,f=xn||"",pe.readyState=me>0?4:0,rt=me>=200&&me<300||me===304,dr&&(xt=ao(B,pe,dr)),!rt&&i.inArray("script",B.dataTypes)>-1&&i.inArray("json",B.dataTypes)<0&&(B.converters["text script"]=function(){}),xt=lo(B,xt,pe,rt),rt?(B.ifModified&&(Tt=pe.getResponseHeader("Last-Modified"),Tt&&(i.lastModified[u]=Tt),Tt=pe.getResponseHeader("etag"),Tt&&(i.etag[u]=Tt)),me===204||B.type==="HEAD"?ze="nocontent":me===304?ze="notmodified":(ze=xt.state,pr=xt.data,nt=xt.error,rt=!nt)):(nt=ze,(me||!ze)&&(ze="error",me<0&&(me=0))),pe.status=me,pe.statusText=(Ae||ze)+"",rt?ye.resolveWith($,[pr,ze,pe]):ye.rejectWith($,[pe,ze,nt]),pe.statusCode(Ie),Ie=void 0,A&&oe.trigger(rt?"ajaxSuccess":"ajaxError",[pe,B,rt?pr:nt]),fe.fireWith($,[pe,ze]),A&&(oe.trigger("ajaxComplete",[pe,B]),--i.active||i.event.trigger("ajaxStop")))}return pe},getJSON:function(t,n,a){return i.get(t,n,a,"json")},getScript:function(t,n){return i.get(t,void 0,n,"script")}}),i.each(["get","post"],function(t,n){i[n]=function(a,u,f,h){return M(u)&&(h=h||f,f=u,u=void 0),i.ajax(i.extend({url:a,type:n,dataType:h,data:u,success:f},i.isPlainObject(a)&&a))}}),i.ajaxPrefilter(function(t){var n;for(n in t.headers)n.toLowerCase()==="content-type"&&(t.contentType=t.headers[n]||"")}),i._evalUrl=function(t,n,a){return i.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(u){i.globalEval(u,n,a)}})},i.fn.extend({wrapAll:function(t){var n;return this[0]&&(M(t)&&(t=t.call(this[0])),n=i(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&n.insertBefore(this[0]),n.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(t){return M(t)?this.each(function(n){i(this).wrapInner(t.call(this,n))}):this.each(function(){var n=i(this),a=n.contents();a.length?a.wrapAll(t):n.append(t)})},wrap:function(t){var n=M(t);return this.each(function(a){i(this).wrapAll(n?t.call(this,a):t)})},unwrap:function(t){return this.parent(t).not("body").each(function(){i(this).replaceWith(this.childNodes)}),this}}),i.expr.pseudos.hidden=function(t){return!i.expr.pseudos.visible(t)},i.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},i.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch{}};var co={0:200,1223:204},hr=i.ajaxSettings.xhr();S.cors=!!hr&&"withCredentials"in hr,S.ajax=hr=!!hr,i.ajaxTransport(function(t){var n,a;if(S.cors||hr&&!t.crossDomain)return{send:function(u,f){var h,g=t.xhr();if(g.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(h in t.xhrFields)g[h]=t.xhrFields[h];t.mimeType&&g.overrideMimeType&&g.overrideMimeType(t.mimeType),!t.crossDomain&&!u["X-Requested-With"]&&(u["X-Requested-With"]="XMLHttpRequest");for(h in u)g.setRequestHeader(h,u[h]);n=function(w){return function(){n&&(n=a=g.onload=g.onerror=g.onabort=g.ontimeout=g.onreadystatechange=null,w==="abort"?g.abort():w==="error"?typeof g.status!="number"?f(0,"error"):f(g.status,g.statusText):f(co[g.status]||g.status,g.statusText,(g.responseType||"text")!=="text"||typeof g.responseText!="string"?{binary:g.response}:{text:g.responseText},g.getAllResponseHeaders()))}},g.onload=n(),a=g.onerror=g.ontimeout=n("error"),g.onabort!==void 0?g.onabort=a:g.onreadystatechange=function(){g.readyState===4&&e.setTimeout(function(){n&&a()})},n=n("abort");try{g.send(t.hasContent&&t.data||null)}catch(w){if(n)throw w}},abort:function(){n&&n()}}}),i.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),i.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return i.globalEval(t),t}}}),i.ajaxPrefilter("script",function(t){t.cache===void 0&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),i.ajaxTransport("script",function(t){if(t.crossDomain||t.scriptAttrs){var n,a;return{send:function(u,f){n=i("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",a=function(h){n.remove(),a=null,h&&f(h.type==="error"?404:200,h.type)}),m.head.appendChild(n[0])},abort:function(){a&&a()}}}});var Ri=[],mn=/(=)\?(?=&|$)|\?\?/;i.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Ri.pop()||i.expando+"_"+Ti.guid++;return this[t]=!0,t}}),i.ajaxPrefilter("json jsonp",function(t,n,a){var u,f,h,g=t.jsonp!==!1&&(mn.test(t.url)?"url":typeof t.data=="string"&&(t.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&mn.test(t.data)&&"data");if(g||t.dataTypes[0]==="jsonp")return u=t.jsonpCallback=M(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,g?t[g]=t[g].replace(mn,"$1"+u):t.jsonp!==!1&&(t.url+=(hn.test(t.url)?"&":"?")+t.jsonp+"="+u),t.converters["script json"]=function(){return h||i.error(u+" was not called"),h[0]},t.dataTypes[0]="json",f=e[u],e[u]=function(){h=arguments},a.always(function(){f===void 0?i(e).removeProp(u):e[u]=f,t[u]&&(t.jsonpCallback=n.jsonpCallback,Ri.push(u)),h&&M(f)&&f(h[0]),h=f=void 0}),"script"}),S.createHTMLDocument=function(){var t=m.implementation.createHTMLDocument("").body;return t.innerHTML="<form></form><form></form>",t.childNodes.length===2}(),i.parseHTML=function(t,n,a){if(typeof t!="string")return[];typeof n=="boolean"&&(a=n,n=!1);var u,f,h;return n||(S.createHTMLDocument?(n=m.implementation.createHTMLDocument(""),u=n.createElement("base"),u.href=m.location.href,n.head.appendChild(u)):n=m),f=mt.exec(t),h=!a&&[],f?[n.createElement(f[1])]:(f=ni([t],n,h),h&&h.length&&i(h).remove(),i.merge([],f.childNodes))},i.fn.load=function(t,n,a){var u,f,h,g=this,w=t.indexOf(" ");return w>-1&&(u=Nt(t.slice(w)),t=t.slice(0,w)),M(n)?(a=n,n=void 0):n&&typeof n=="object"&&(f="POST"),g.length>0&&i.ajax({url:t,type:f||"GET",dataType:"html",data:n}).done(function(v){h=arguments,g.html(u?i("<div>").append(i.parseHTML(v)).find(u):v)}).always(a&&function(v,A){g.each(function(){a.apply(this,h||[v.responseText,A,v])})}),this},i.expr.pseudos.animated=function(t){return i.grep(i.timers,function(n){return t===n.elem}).length},i.offset={setOffset:function(t,n,a){var u,f,h,g,w,v,A,O=i.css(t,"position"),k=i(t),B={};O==="static"&&(t.style.position="relative"),w=k.offset(),h=i.css(t,"top"),v=i.css(t,"left"),A=(O==="absolute"||O==="fixed")&&(h+v).indexOf("auto")>-1,A?(u=k.position(),g=u.top,f=u.left):(g=parseFloat(h)||0,f=parseFloat(v)||0),M(n)&&(n=n.call(t,a,i.extend({},w))),n.top!=null&&(B.top=n.top-w.top+g),n.left!=null&&(B.left=n.left-w.left+f),"using"in n?n.using.call(t,B):k.css(B)}},i.fn.extend({offset:function(t){if(arguments.length)return t===void 0?this:this.each(function(f){i.offset.setOffset(this,t,f)});var n,a,u=this[0];if(u)return u.getClientRects().length?(n=u.getBoundingClientRect(),a=u.ownerDocument.defaultView,{top:n.top+a.pageYOffset,left:n.left+a.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var t,n,a,u=this[0],f={top:0,left:0};if(i.css(u,"position")==="fixed")n=u.getBoundingClientRect();else{for(n=this.offset(),a=u.ownerDocument,t=u.offsetParent||a.documentElement;t&&(t===a.body||t===a.documentElement)&&i.css(t,"position")==="static";)t=t.parentNode;t&&t!==u&&t.nodeType===1&&(f=i(t).offset(),f.top+=i.css(t,"borderTopWidth",!0),f.left+=i.css(t,"borderLeftWidth",!0))}return{top:n.top-f.top-i.css(u,"marginTop",!0),left:n.left-f.left-i.css(u,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&i.css(t,"position")==="static";)t=t.offsetParent;return t||Mt})}}),i.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var a=n==="pageYOffset";i.fn[t]=function(u){return ut(this,function(f,h,g){var w;if(P(f)?w=f:f.nodeType===9&&(w=f.defaultView),g===void 0)return w?w[n]:f[h];w?w.scrollTo(a?w.pageXOffset:g,a?g:w.pageYOffset):f[h]=g},t,u,arguments.length)}}),i.each(["top","left"],function(t,n){i.cssHooks[n]=ci(S.pixelPosition,function(a,u){if(u)return u=cr(a,n),on.test(u)?i(a).position()[n]+"px":u})}),i.each({Height:"height",Width:"width"},function(t,n){i.each({padding:"inner"+t,content:n,"":"outer"+t},function(a,u){i.fn[u]=function(f,h){var g=arguments.length&&(a||typeof f!="boolean"),w=a||(f===!0||h===!0?"margin":"border");return ut(this,function(v,A,O){var k;return P(v)?u.indexOf("outer")===0?v["inner"+t]:v.document.documentElement["client"+t]:v.nodeType===9?(k=v.documentElement,Math.max(v.body["scroll"+t],k["scroll"+t],v.body["offset"+t],k["offset"+t],k["client"+t])):O===void 0?i.css(v,A,w):i.style(v,A,O,w)},n,g?f:void 0,g)}})}),i.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,n){i.fn[n]=function(a){return this.on(n,a)}}),i.fn.extend({bind:function(t,n,a){return this.on(t,null,n,a)},unbind:function(t,n){return this.off(t,null,n)},delegate:function(t,n,a,u){return this.on(n,t,a,u)},undelegate:function(t,n,a){return arguments.length===1?this.off(t,"**"):this.off(n,t||"**",a)},hover:function(t,n){return this.on("mouseenter",t).on("mouseleave",n||t)}}),i.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,n){i.fn[n]=function(a,u){return arguments.length>0?this.on(n,null,a,u):this.trigger(n)}});var uo=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;i.proxy=function(t,n){var a,u,f;if(typeof n=="string"&&(a=t[n],n=t,t=a),!!M(t))return u=c.call(arguments,2),f=function(){return t.apply(n||this,u.concat(c.call(arguments)))},f.guid=t.guid=t.guid||i.guid++,f},i.holdReady=function(t){t?i.readyWait++:i.ready(!0)},i.isArray=Array.isArray,i.parseJSON=JSON.parse,i.nodeName=j,i.isFunction=M,i.isWindow=P,i.camelCase=Qe,i.type=G,i.now=Date.now,i.isNumeric=function(t){var n=i.type(t);return(n==="number"||n==="string")&&!isNaN(t-parseFloat(t))},i.trim=function(t){return t==null?"":(t+"").replace(uo,"$1")};var fo=e.jQuery,ho=e.$;return i.noConflict=function(t){return e.$===i&&(e.$=ho),t&&e.jQuery===i&&(e.jQuery=fo),i},typeof r>"u"&&(e.jQuery=e.$=i),i})}(zr)),zr.exports}var Dl=Ll();const Yi=Bl(Dl);class Ol{constructor(e){z(this,"canvas");z(this,"renderer");z(this,"scene");z(this,"keyLabel");z(this,"mouseXLabel");z(this,"mouseYLabel");z(this,"forwardsAmount");z(this,"rightAmount");z(this,"upAmount");z(this,"run",()=>{this.scene.update(),this.scene.movePlayer(this.forwardsAmount,this.rightAmount,this.upAmount),this.renderer.render(this.scene.getObjects()),requestAnimationFrame(this.run)});this.canvas=e,this.renderer=new Cl(e),this.scene=new Nl,this.keyLabel=document.getElementById("keyboardKey"),this.mouseXLabel=document.getElementById("mousex"),this.mouseYLabel=document.getElementById("mousey"),this.forwardsAmount=0,this.rightAmount=0,this.upAmount=0,Yi(document).on("keydown",r=>{this.handleKeyPress(r)}),Yi(document).on("keyup",r=>{this.handleKeyRelease(r)}),this.canvas.onclick=()=>{this.canvas.requestPointerLock()},this.canvas.addEventListener("mousemove",r=>{this.handleMouseMove(r)})}async init(){await this.renderer.init()}async createTerrainFromTile(e){try{console.log("üéØ Creating terrain from tile data...");let r=e.heightData[0],o=e.heightData[0],l=0;for(let p=0;p<e.heightData.length;p++){const d=e.heightData[p];d<r&&(r=d),d>o&&(o=d),l+=d}console.log("üìä Tile data info:",{width:e.width,height:e.height,heightDataLength:e.heightData.length,centerCoords:e.centerCoordinates,region:e.region,heightMin:r,heightMax:o,heightAvg:l/e.heightData.length});const c=Xt(0,-1,0);this.scene.terrain_count===0&&this.scene.addTerrain(c),await this.renderer.generateTerrain(e),console.log("‚úÖ Terrain created and rendered successfully at position:",c)}catch(r){console.error("‚ùå Failed to create terrain from tile:",r)}}handleKeyPress(e){this.keyLabel.innerHTML=e.code,e.code==="KeyW"&&(this.forwardsAmount=.1),e.code==="KeyS"&&(this.forwardsAmount=-.1),e.code==="KeyA"&&(this.rightAmount=-.1),e.code==="KeyD"&&(this.rightAmount=.1),e.code==="KeyE"&&(this.upAmount+=.1),e.code==="KeyQ"&&(this.upAmount+=-.1)}handleKeyRelease(e){this.keyLabel.innerHTML=e.code,e.code==="KeyW"&&(this.forwardsAmount=0),e.code==="KeyS"&&(this.forwardsAmount=0),e.code==="KeyA"&&(this.rightAmount=0),e.code==="KeyD"&&(this.rightAmount=0),e.code==="KeyE"&&(this.upAmount=0),e.code==="KeyQ"&&(this.upAmount=0)}handleMouseMove(e){this.mouseXLabel.innerHTML=e.clientX.toString(),this.mouseYLabel.innerHTML=e.clientY.toString(),this.scene.spinPlayer(e.movementX/10,-e.movementY/10)}}class _l{constructor(){z(this,"tileState");z(this,"tileListeners");z(this,"progressListeners");this.tileState={isLoading:!1,currentStep:"idle",progress:0,error:null,currentRequest:null,lastResponse:null,tileCache:new Map},this.tileListeners=new Set,this.progressListeners=new Set,console.log("üèîÔ∏è TerrainService initialized with API service"),console.log("üåê Environment:",Le.getEnvironmentInfo())}subscribeTile(e){return this.tileListeners.add(e),()=>this.tileListeners.delete(e)}subscribeToProgress(e){return this.progressListeners.add(e),()=>this.progressListeners.delete(e)}getTileState(){return{...this.tileState}}notifyTileListeners(){this.tileListeners.forEach(e=>e(this.getTileState()))}notifyProgressListeners(e){this.progressListeners.forEach(r=>r(e))}setTileState(e){this.tileState={...this.tileState,...e},this.notifyTileListeners()}updateTileProgress(e,r,o){this.setTileState({currentStep:e,progress:o}),this.notifyProgressListeners({step:e,message:r,progress:o})}getTileCacheKey(e){const r=e.scale||30;return`tile_${e.centerLat}_${e.centerLng}_${r}`}validateTileRequest(e){if(Math.abs(e.centerLat)>90)throw new Error("Center latitude must be between -90 and 90");if(Math.abs(e.centerLng)>180)throw new Error("Center longitude must be between -180 and 180");if(e.scale&&e.scale<=0)throw new Error("Scale must be positive")}async generateTile(e){try{this.validateTileRequest(e);const r=this.getTileCacheKey(e),o=this.tileState.tileCache.get(r);if(o)return console.log("üéØ Returning cached tile data for:",r),this.setTileState({currentStep:"complete",progress:100,lastResponse:null}),o;this.setTileState({isLoading:!0,currentStep:"processing",progress:0,error:null,currentRequest:e}),console.log("üöÄ Starting tile generation process...",e),this.updateTileProgress("processing","Generating terrain tile...",10);const l=await Le.generateTile(e);if(!l.ok)throw new Error(`Backend error: ${l.status} ${l.statusText}`);const c=await l.json();console.log("‚úÖ Backend tile generation response received:",c),this.updateTileProgress("processing","Tile generated, downloading TIF...",50);const p=await this.downloadAndProcessTiff(c.cacheInfo.downloadUrl);this.updateTileProgress("downloading","TIF processing complete!",95);const d={width:p.width,height:p.height,heightData:p.elevationData,centerCoordinates:c.cacheInfo.centerCoordinates,region:c.cacheInfo.region,scale:c.cacheInfo.scale,tileSize:c.cacheInfo.tileSize,filename:c.cacheInfo.filename,downloadUrl:c.cacheInfo.downloadUrl,etag:c.r2Result.etag};return this.tileState.tileCache.set(r,d),this.setTileState({isLoading:!1,currentStep:"complete",progress:100,lastResponse:c,error:null}),console.log("‚úÖ Tile generation completed successfully"),d}catch(r){console.error("‚ùå Error in tile generation process:",r);let o="Unknown error occurred";throw r instanceof Error&&(o=r.message),this.setTileState({isLoading:!1,currentStep:"idle",progress:0,error:o}),new Error(o)}}async downloadAndProcessTiff(e){try{console.log("üîÑ Downloading TIF file from backend:",e),this.updateTileProgress("downloading","Downloading TIF file...",60);const r=await Le.downloadFile(e);if(!r.ok)throw new Error(`Failed to download TIF: ${r.status} ${r.statusText}`);const o=await r.arrayBuffer();console.log("‚úÖ TIF downloaded, size:",o.byteLength),this.updateTileProgress("downloading","Processing TIF file...",80);const c=await(await Kr(o)).getImage(),p=await c.readRasters(),d=c.getWidth(),x=c.getHeight(),T=c.getBoundingBox(),b=new Float32Array(p[0]);let C=b[0],R=b[0];for(let I=1;I<b.length;I++){const S=b[I];S<C&&(C=S),S>R&&(R=S)}return console.log("‚úÖ TIF processed:",{width:d,height:x,dataSize:b.length,minHeight:C.toFixed(1)+"m",maxHeight:R.toFixed(1)+"m",range:(R-C).toFixed(1)+"m"}),{elevationData:b,width:d,height:x,bounds:[T[0],T[1],T[2],T[3]]}}catch(r){throw console.error("‚ùå Error downloading/processing TIF:",r),new Error(`Failed to process TIF: ${r instanceof Error?r.message:"Unknown error"}`)}}getCachedTile(e){const r=this.getTileCacheKey(e);return this.tileState.tileCache.get(r)||null}clearTileCache(){console.log("üßπ Clearing tile cache..."),this.setTileState({tileCache:new Map})}getTileCacheStats(){let e=0;return this.tileState.tileCache.forEach(r=>{e+=r.heightData.byteLength}),{count:this.tileState.tileCache.size,keys:Array.from(this.tileState.tileCache.keys()),totalSize:e}}async testConnection(){try{return await Le.testConnection()}catch(e){return console.error("‚ùå Backend connection test failed:",e),!1}}getDownloadUrl(e){return Le.getFileDownloadUrl(e)}}const mr=new _l;class Fl{constructor(e,r={}){z(this,"terrainService");z(this,"uiContainer");z(this,"callbacks");this.terrainService=mr,this.callbacks=r;const o=document.getElementById(e);if(!o)throw new Error(`Container with id '${e}' not found`);this.uiContainer=o,this.init()}init(){this.createUI(),this.setupEventListeners(),this.terrainService.subscribeTile(e=>{this.updateUI(e),this.callbacks.onLoadingStateChange&&this.callbacks.onLoadingStateChange(e.isLoading),e.error&&this.callbacks.onError&&this.callbacks.onError(e.error)}),this.terrainService.subscribeToProgress(e=>{this.updateProgressUI(e),this.callbacks.onProgress&&this.callbacks.onProgress(e)})}createUI(){this.uiContainer.innerHTML=`
      <div class="tile-panel">
        <h3>üéØ Terrain Tile Generator</h3>
        
        <div class="backend-status" id="tile-backend-status">
          <span class="status-indicator" id="tile-status-indicator">‚ö™</span>
          <span id="tile-status-text">Ready for tile generation</span>
        </div>
        
        <div class="coordinates-input">
          <div class="coordinate-row">
            <label>
              Center Latitude: <input type="number" id="center-lat" step="0.001" value="35.363726" placeholder="Center latitude">
            </label>
            <label>
              Center Longitude: <input type="number" id="center-lng" step="0.001" value="138.729852" placeholder="Center longitude">
            </label>
          </div>
          <div class="coordinate-row">
            <label>
              Scale (m): <input type="number" id="tile-scale" step="1" value="30" placeholder="Scale in meters">
            </label>
          </div>
          <div class="coordinate-info">
            <small>üìè Tile size: 0.01¬∞ Generated bounds will be calculated automatically</small>
          </div>
        </div>

        <div class="actions">
          <button id="generate-tile" class="fetch-btn">Generate Tile</button>
          <button id="clear-tile-cache" class="clear-btn">Clear Tile Cache</button>
          <button id="test-tile-backend" class="test-btn">Test Backend</button>
        </div>

        <div class="status" id="tile-status">
          Ready to generate terrain tile from center coordinates
        </div>

        <div class="progress-container" id="tile-progress-container" style="display: none;">
          <div class="progress-steps">
            <div class="step" id="tile-step-processing">
              <div class="step-indicator">1</div>
              <div class="step-label">Processing</div>
            </div>
            <div class="step-arrow">‚Üí</div>
            <div class="step" id="tile-step-downloading">
              <div class="step-indicator">2</div>
              <div class="step-label">Downloading</div>
            </div>
          </div>
          
          <div class="progress-bar-container">
            <div class="progress-bar">
              <div class="progress-fill" id="tile-progress-fill"></div>
            </div>
            <div class="progress-text" id="tile-progress-text">Initializing...</div>
            <div class="progress-percentage" id="tile-progress-percentage">0%</div>
          </div>
        </div>

        <div class="results" id="tile-results" style="display: none;">
          <h4>üéØ Tile Results</h4>
          <div class="result-item">
            <strong>Filename:</strong> <span id="tile-result-filename">-</span>
          </div>
          <div class="result-item">
            <strong>Center:</strong> <span id="tile-result-center">-</span>
          </div>
          <div class="result-item">
            <strong>Calculated Bounds:</strong> <span id="tile-result-bounds">-</span>
          </div>
          <div class="result-item">
            <strong>Dimensions:</strong> <span id="tile-result-dimensions">-</span>
          </div>
          <div class="result-item">
            <strong>Height Range:</strong> <span id="tile-result-height-range">-</span>
          </div>
          <div class="result-item">
            <strong>Scale:</strong> <span id="tile-result-scale">-</span>
          </div>
          <div class="result-item">
            <strong>Tile Size:</strong> <span id="tile-result-tile-size">-</span>
          </div>
          <div class="result-item">
            <strong>File Size:</strong> <span id="tile-result-file-size">-</span>
          </div>
          <div class="result-item">
            <strong>Download:</strong> <a id="tile-result-url" href="#" target="_blank">Download TIF</a>
          </div>
        </div>

        <div class="cache-info" id="tile-cache-info">
          <h4>üíæ Tile Cache Status</h4>
          <div class="cache-stats">
            <span id="tile-cache-count">0</span> tiles cached | 
            <span id="tile-cache-size">0 KB</span> total
          </div>
        </div>
      </div>
    `}setupEventListeners(){const e=document.getElementById("generate-tile");e==null||e.addEventListener("click",()=>this.generateTile());const r=document.getElementById("clear-tile-cache");r==null||r.addEventListener("click",()=>this.clearCache());const o=document.getElementById("test-tile-backend");o==null||o.addEventListener("click",()=>this.testBackend()),this.updateCacheInfo()}async generateTile(){try{const e=document.getElementById("center-lat"),r=document.getElementById("center-lng"),o=document.getElementById("tile-scale"),l={centerLat:parseFloat(e.value),centerLng:parseFloat(r.value),scale:parseInt(o.value)||30};console.log("üéØ Generating tile with request:",l);const c=await this.terrainService.generateTile(l);this.displayTileResults(c),this.updateCacheInfo(),this.callbacks.onTileLoaded&&this.callbacks.onTileLoaded(c)}catch(e){console.error("‚ùå Error generating tile:",e);const r=e instanceof Error?e.message:"Unknown error",o=document.getElementById("tile-status");o&&(o.textContent=`‚ùå Error: ${r}`,o.className="status error"),this.callbacks.onError&&this.callbacks.onError(r)}}displayTileResults(e){let r=e.heightData[0],o=e.heightData[0];for(let p=1;p<e.heightData.length;p++){const d=e.heightData[p];d<r&&(r=d),d>o&&(o=d)}const l={filename:document.getElementById("tile-result-filename"),center:document.getElementById("tile-result-center"),bounds:document.getElementById("tile-result-bounds"),dimensions:document.getElementById("tile-result-dimensions"),heightRange:document.getElementById("tile-result-height-range"),scale:document.getElementById("tile-result-scale"),tileSize:document.getElementById("tile-result-tile-size"),fileSize:document.getElementById("tile-result-file-size"),url:document.getElementById("tile-result-url")};l.filename&&(l.filename.textContent=e.filename),l.center&&(l.center.textContent=`${e.centerCoordinates.lat.toFixed(4)}, ${e.centerCoordinates.lng.toFixed(4)}`),l.bounds&&(l.bounds.textContent=`${e.region.west.toFixed(4)}, ${e.region.south.toFixed(4)} ‚Üí ${e.region.east.toFixed(4)}, ${e.region.north.toFixed(4)}`),l.dimensions&&(l.dimensions.textContent=`${e.width}√ó${e.height}`),l.heightRange&&(l.heightRange.textContent=`${r.toFixed(1)}m - ${o.toFixed(1)}m`),l.scale&&(l.scale.textContent=`${e.scale}m`),l.tileSize&&(l.tileSize.textContent=`${e.tileSize}¬∞ (~${(e.tileSize*111).toFixed(1)}km)`),l.fileSize&&(l.fileSize.textContent=`${Math.round(e.heightData.byteLength/1024)} KB`),l.url&&(l.url.href=e.downloadUrl,l.url.textContent="Download TIF");const c=document.getElementById("tile-results");c&&(c.style.display="block")}updateUI(e){const r=document.getElementById("tile-status"),o=document.getElementById("tile-progress-container"),l=document.getElementById("generate-tile");e.isLoading?(r&&(r.textContent="Generating tile...",r.className="status loading"),o&&(o.style.display="block"),l&&(l.disabled=!0)):(r&&(r.textContent=e.error||"Ready to generate terrain tile",r.className=e.error?"status error":"status"),o&&(o.style.display="none"),l&&(l.disabled=!1)),this.updateCacheInfo()}updateProgressUI(e){const r=document.getElementById("tile-progress-fill"),o=document.getElementById("tile-progress-text"),l=document.getElementById("tile-progress-percentage"),c=document.getElementById("tile-step-processing"),p=document.getElementById("tile-step-downloading");r&&(r.style.width=`${e.progress}%`),o&&(o.textContent=e.message),l&&(l.textContent=`${e.progress}%`),c&&p&&(c.className=e.step==="processing"?"step active":"step completed",p.className=e.step==="downloading"?"step active":"step")}async clearCache(){this.terrainService.clearTileCache(),this.updateCacheInfo();const e=document.getElementById("tile-status");e&&(e.textContent="üßπ Tile cache cleared")}async testBackend(){const e=document.getElementById("tile-status"),r=document.getElementById("tile-status-indicator"),o=document.getElementById("tile-status-text");e&&(e.textContent="üîå Testing backend connection...");try{const l=await this.terrainService.testConnection();r&&(r.textContent=l?"üü¢":"üî¥"),o&&(o.textContent=l?"Backend connected":"Backend disconnected"),e&&(e.textContent=l?"‚úÖ Backend connection successful":"‚ùå Backend connection failed")}catch{r&&(r.textContent="üî¥"),o&&(o.textContent="Backend error"),e&&(e.textContent="‚ùå Backend connection failed")}}updateCacheInfo(){const e=this.terrainService.getTileCacheStats(),r=document.getElementById("tile-cache-count"),o=document.getElementById("tile-cache-size");r&&(r.textContent=e.count.toString()),o&&(o.textContent=`${Math.round(e.totalSize/1024)} KB`)}async generateTileData(e){try{const r=await this.terrainService.generateTile(e);return this.displayTileResults(r),this.updateCacheInfo(),r}catch(r){throw console.error("‚ùå Error generating tile programmatically:",r),r}}getTileFromCache(e){return this.terrainService.getCachedTile(e)}}class Ul{constructor(e){z(this,"tileController");z(this,"app");this.app=e,this.tileController=new Fl("tile-ui",{onTileLoaded:this.handleTileLoaded.bind(this),onError:this.handleTileError.bind(this),onLoadingStateChange:this.handleTileLoadingStateChange.bind(this),onProgress:this.handleTileProgress.bind(this)}),this.demonstrateTileGeneration()}async handleTileLoaded(e){var l;let r=e.heightData[0],o=e.heightData[0];for(let c=1;c<e.heightData.length;c++){const p=e.heightData[c];p<r&&(r=p),p>o&&(o=p)}if(console.log("üéØ Tile generated from working backend:",{filename:e.filename,centerCoordinates:e.centerCoordinates,dimensions:`${e.width}x${e.height}`,heightRange:`${r.toFixed(1)}m - ${o.toFixed(1)}m`,scale:e.scale,tileSize:`${e.tileSize}¬∞ (~${(e.tileSize*111).toFixed(1)}km)`,calculatedBounds:e.region,fileSizeKB:Math.round(e.heightData.byteLength/1024),downloadUrl:e.downloadUrl,etag:e.etag,dataPoints:e.heightData.length}),this.app&&this.app.createTerrainFromTile)try{console.log("üèîÔ∏è Creating 3D terrain from generated tile...");const c=mr.getTileState().lastResponse;if(c&&((l=c.cacheInfo)!=null&&l.ghiTileUrl)){console.log("‚òÄÔ∏è GHI data available, downloading for texture..."),console.log("‚òÄÔ∏è GHI URL:",c.cacheInfo.ghiTileUrl);try{const p=Le.getGHIDataUrl(c.cacheInfo.ghiTileUrl),d=await Le.downloadSolarData(p);if(d.ok){const x=await d.arrayBuffer();console.log("‚òÄÔ∏è GHI data downloaded, size:",x.byteLength);const b=await(await Kr(x)).getImage(),C=await b.readRasters(),R=new Float32Array(C[0]);let I=R[0],S=R[0];for(let P=1;P<R.length;P++){const m=R[P];m<I&&(I=m),m>S&&(S=m)}const M={width:b.getWidth(),height:b.getHeight(),ghiData:R,minGHI:I,maxGHI:S};console.log("‚òÄÔ∏è GHI data processed:",{width:M.width,height:M.height,minGHI:I.toFixed(2),maxGHI:S.toFixed(2),sampleValues:Array.from(R.slice(0,5))}),await this.app.createTerrainFromTile(e),await this.app.renderer.generateTerrainWithGHI(e,M),console.log("‚úÖ Terrain created with GHI texture");return}}catch(p){console.warn("‚ö†Ô∏è Failed to load GHI data, using regular terrain:",p)}}await this.app.createTerrainFromTile(e)}catch(c){console.error("‚ùå Failed to create 3D terrain:",c)}this.createWebGPUTileMesh(e)}handleTileError(e){console.error("‚ùå Tile generation error:",e)}handleTileLoadingStateChange(e){console.log("üîÑ Tile loading state changed:",e)}handleTileProgress(e){console.log(`üìä Tile Progress: ${e.step} - ${e.message} (${e.progress}%)`)}async demonstrateTileGeneration(){const e=await mr.testConnection();if(console.log("üîå Backend connection test:",e?"SUCCESS ‚úÖ":"FAILED ‚ùå"),!e){console.error("üö® Backend not available! Make sure NestJS server is running on:",Le.getBaseUrl());return}console.log("üéØ TileExample initialized with working backend integration"),console.log('üí° Click "Generate Tile" button to create terrain in 3D scene')}async generateTileData(e){try{console.log("üéØ Generating terrain tile programmatically:",e);const r=await this.tileController.generateTileData(e);return console.log("‚úÖ Tile generation completed:",{center:r.centerCoordinates,bounds:r.region,dimensions:`${r.width}x${r.height}`,tileSize:r.tileSize}),r}catch(r){throw console.error("‚ùå Error generating tile programmatically:",r),r}}getTileFromCache(e){return this.tileController.getTileFromCache(e)}createWebGPUTileMesh(e){console.log("üéÆ Creating WebGPU tile mesh from heightmap data..."),console.log("üìê Tile mesh parameters:",{center:e.centerCoordinates,bounds:e.region,dimensions:`${e.width}x${e.height}`,heightmapSize:e.heightData.length,tileSize:`${e.tileSize}¬∞ (~${(e.tileSize*111).toFixed(1)}km)`}),console.log("üí° Ready to create tile mesh with center coordinates and calculated bounds")}async generateTileGrid(e,r,o=3,l=30){console.log(`üóÇÔ∏è Generating ${o}x${o} tile grid centered at (${e}, ${r})`);const c=[],p=.01,d=Math.floor(o/2);for(let x=-d;x<=d;x++)for(let T=-d;T<=d;T++){const b=e+x*p,C=r+T*p;try{const R=await this.generateTileData({centerLat:b,centerLng:C,scale:l});c.push(R),console.log(`‚úÖ Generated tile ${c.length}/${o*o} at (${b.toFixed(4)}, ${C.toFixed(4)})`)}catch(R){console.error(`‚ùå Failed to generate tile at (${b.toFixed(4)}, ${C.toFixed(4)}):`,R)}}return console.log(`üéâ Grid generation complete: ${c.length}/${o*o} tiles successfully generated`),c}getTileStats(){const e=mr.getTileCacheStats();return{count:e.count,totalSizeKB:Math.round(e.totalSize/1024)}}clearCache(){mr.clearTileCache(),console.log("üßπ Tile cache cleared")}}function kl(s){return new Ul(s)}const Gl=document.getElementById("gfx-main");(async()=>{const s=new Ol(Gl);await s.init(),s.run();const e=kl(s);try{console.log("üåû Loading solar terrain with both heightmap and GHI data..."),await s.renderer.loadSolarTerrainTile(39.5,32.5,30),console.log("‚úÖ Solar terrain loaded successfully!"),console.log("üèîÔ∏è You should see 3D terrain with solar radiation overlay")}catch(r){console.error("‚ùå Failed to load solar terrain:",r),console.log("üìã Falling back to manual tile generation")}console.log("üéØ Application initialized with solar terrain system"),console.log("üìã Available methods:"),console.log("  üåû Solar Terrain:"),console.log("    - Auto: Solar terrain loads automatically on startup"),console.log("    - Manual: Call app.renderer.loadSolarTerrainTile(lat, lng, scale)"),console.log("    - Grid: Call app.renderer.loadSolarTerrainGrid(lat, lng, size, scale)"),console.log("  üéØ Legacy Tile Generation:"),console.log("    - UI: Use the tile panel to generate terrain tiles"),console.log("    - API: Call tileExample.generateTileData(request)"),console.log(""),console.log("üèîÔ∏è 3D Terrain: Both heightmap and solar data visualized together!"),window.tileExample=e,window.app=s})();export{zl as L,$l as a,Bl as g};
